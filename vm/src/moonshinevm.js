(function () { "use strict";
var HxOverrides = function() { };
HxOverrides.cca = function(s,index) {
	var x = s.charCodeAt(index);
	if(x != x) return undefined;
	return x;
};
HxOverrides.substr = function(s,pos,len) {
	if(pos != null && pos != 0 && len != null && len < 0) return "";
	if(len == null) len = s.length;
	if(pos < 0) {
		pos = s.length + pos;
		if(pos < 0) pos = 0;
	} else if(len < 0) len = s.length + len - pos;
	return s.substr(pos,len);
};
var VM = function() { };
VM.prototype = {
	resetGlobals: function() {
	}
	,bindLib: function() {
	}
	,load: function() {
	}
	,execute: function() {
	}
	,setGlobal: function() {
	}
	,getGlobal: function() {
	}
	,suspend: function() {
	}
	,resume: function() {
	}
	,dispose: function() {
	}
	,getCurrentVM: function() {
	}
};
var MoonshineVM = function() { };
MoonshineVM.inst = function() {
	var shine = null;
	__js__(haxe.Resource.getString("everything.js"));
	shine.stdout = { };
	shine.stdout.write = function(message) {
		console.log(message);
	};
	shine.stddebug = { };
	shine.stddebug.write = function(message1) {
	};
	shine.stderr = { };
	shine.stderr.write = function(message2,level) {
		if(level == null) "error"; else level;
		if(window.console != null && Object.prototype.hasOwnProperty.call(window.console,level)) (Reflect.field(window.console,level))(message2);
	};
	return shine;
};
var Reflect = function() { };
Reflect.field = function(o,field) {
	try {
		return o[field];
	} catch( e ) {
		return null;
	}
};
var StringTools = function() { };
StringTools.fastCodeAt = function(s,index) {
	return s.charCodeAt(index);
};
var haxe = {};
haxe.Resource = function() { };
haxe.Resource.getString = function(name) {
	var _g = 0;
	var _g1 = haxe.Resource.content;
	while(_g < _g1.length) {
		var x = _g1[_g];
		++_g;
		if(x.name == name) {
			if(x.str != null) return x.str;
			var b = haxe.crypto.Base64.decode(x.data);
			return b.toString();
		}
	}
	return null;
};
haxe.io = {};
haxe.io.Bytes = function(length,b) {
	this.length = length;
	this.b = b;
};
haxe.io.Bytes.alloc = function(length) {
	var a = new Array();
	var _g = 0;
	while(_g < length) {
		var i = _g++;
		a.push(0);
	}
	return new haxe.io.Bytes(length,a);
};
haxe.io.Bytes.ofString = function(s) {
	var a = new Array();
	var i = 0;
	while(i < s.length) {
		var c = StringTools.fastCodeAt(s,i++);
		if(55296 <= c && c <= 56319) c = c - 55232 << 10 | StringTools.fastCodeAt(s,i++) & 1023;
		if(c <= 127) a.push(c); else if(c <= 2047) {
			a.push(192 | c >> 6);
			a.push(128 | c & 63);
		} else if(c <= 65535) {
			a.push(224 | c >> 12);
			a.push(128 | c >> 6 & 63);
			a.push(128 | c & 63);
		} else {
			a.push(240 | c >> 18);
			a.push(128 | c >> 12 & 63);
			a.push(128 | c >> 6 & 63);
			a.push(128 | c & 63);
		}
	}
	return new haxe.io.Bytes(a.length,a);
};
haxe.io.Bytes.prototype = {
	get: function(pos) {
		return this.b[pos];
	}
	,set: function(pos,v) {
		this.b[pos] = v & 255;
	}
	,getString: function(pos,len) {
		if(pos < 0 || len < 0 || pos + len > this.length) throw haxe.io.Error.OutsideBounds;
		var s = "";
		var b = this.b;
		var fcc = String.fromCharCode;
		var i = pos;
		var max = pos + len;
		while(i < max) {
			var c = b[i++];
			if(c < 128) {
				if(c == 0) break;
				s += fcc(c);
			} else if(c < 224) s += fcc((c & 63) << 6 | b[i++] & 127); else if(c < 240) {
				var c2 = b[i++];
				s += fcc((c & 31) << 12 | (c2 & 127) << 6 | b[i++] & 127);
			} else {
				var c21 = b[i++];
				var c3 = b[i++];
				var u = (c & 15) << 18 | (c21 & 127) << 12 | (c3 & 127) << 6 | b[i++] & 127;
				s += fcc((u >> 10) + 55232);
				s += fcc(u & 1023 | 56320);
			}
		}
		return s;
	}
	,toString: function() {
		return this.getString(0,this.length);
	}
};
haxe.crypto = {};
haxe.crypto.Base64 = function() { };
haxe.crypto.Base64.decode = function(str,complement) {
	if(complement == null) complement = true;
	if(complement) while(HxOverrides.cca(str,str.length - 1) == 61) str = HxOverrides.substr(str,0,-1);
	return new haxe.crypto.BaseCode(haxe.crypto.Base64.BYTES).decodeBytes(haxe.io.Bytes.ofString(str));
};
haxe.crypto.BaseCode = function(base) {
	var len = base.length;
	var nbits = 1;
	while(len > 1 << nbits) nbits++;
	if(nbits > 8 || len != 1 << nbits) throw "BaseCode : base length must be a power of two.";
	this.base = base;
	this.nbits = nbits;
};
haxe.crypto.BaseCode.prototype = {
	initTable: function() {
		var tbl = new Array();
		var _g = 0;
		while(_g < 256) {
			var i = _g++;
			tbl[i] = -1;
		}
		var _g1 = 0;
		var _g2 = this.base.length;
		while(_g1 < _g2) {
			var i1 = _g1++;
			tbl[this.base.b[i1]] = i1;
		}
		this.tbl = tbl;
	}
	,decodeBytes: function(b) {
		var nbits = this.nbits;
		var base = this.base;
		if(this.tbl == null) this.initTable();
		var tbl = this.tbl;
		var size = b.length * nbits >> 3;
		var out = haxe.io.Bytes.alloc(size);
		var buf = 0;
		var curbits = 0;
		var pin = 0;
		var pout = 0;
		while(pout < size) {
			while(curbits < 8) {
				curbits += nbits;
				buf <<= nbits;
				var i = tbl[b.get(pin++)];
				if(i == -1) throw "BaseCode : invalid encoded char";
				buf |= i;
			}
			curbits -= 8;
			out.set(pout++,buf >> curbits & 255);
		}
		return out;
	}
};
haxe.io.Eof = function() { };
haxe.io.Eof.prototype = {
	toString: function() {
		return "Eof";
	}
};
haxe.io.Error = { __constructs__ : ["Blocked","Overflow","OutsideBounds","Custom"] };
haxe.io.Error.Blocked = ["Blocked",0];
haxe.io.Error.Blocked.__enum__ = haxe.io.Error;
haxe.io.Error.Overflow = ["Overflow",1];
haxe.io.Error.Overflow.__enum__ = haxe.io.Error;
haxe.io.Error.OutsideBounds = ["OutsideBounds",2];
haxe.io.Error.OutsideBounds.__enum__ = haxe.io.Error;
haxe.io.Error.Custom = function(e) { var $x = ["Custom",3,e]; $x.__enum__ = haxe.io.Error; return $x; };
haxe.Resource.content = [{ name : "everything.js", data : "LyoNCiAqIE1vb25zaGluZSAtIGEgTHVhIHZpcnR1YWwgbWFjaGluZS4NCiAqDQogKiBFbWFpbDogbW9vbnNoaW5lQGdhbWVzeXMuY28udWsNCiAqIGh0dHA6Ly9tb29uc2hpbmVqcy5vcmcNCiAqDQogKiBDb3B5cmlnaHQgKGMpIDIwMTMtMjAxNSBHYW1lc3lzIExpbWl0ZWQuIEFsbCByaWdodHMgcmVzZXJ2ZWQuDQogKg0KICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nDQogKiBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUNCiAqICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcNCiAqIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwNCiAqIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0bw0KICogcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvDQogKiB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6DQogKg0KICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUNCiAqIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLg0KICoNCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELA0KICogRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GDQogKiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuDQogKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWQ0KICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwNCiAqIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFDQogKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4NCiAqLw0KDQogDQooZnVuY3Rpb24gKCkgew0KCWlmICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnKSB7DQoJCXZhciBvcmlnaW5hbFZhbHVlID0gd2luZG93LnNoaW5lOw0KDQoJCXdpbmRvdy5zaGluZSA9IHsNCgkJCW5vQ29uZmxpY3Q6IGZ1bmN0aW9uICgpIHsNCgkJCQl3aW5kb3cuc2hpbmUgPSBvcmlnaW5hbFZhbHVlOw0KCQkJCXJldHVybiB0aGlzOw0KCQkJfQ0KCQl9Ow0KCX0NCn0pKCk7DQogDQovKioNCiAqIEBmaWxlT3ZlcnZpZXcgTHVhIHZpcnR1YWwgbWFjaGluZSBjbGFzcy4NCiAqIEBhdXRob3IgPGEgaHJlZj0ibWFpbHRvOnBhdWwuY3V0aGJlcnRzb25AZ2FtZXN5cy5jby51ayI+UGF1bCBDdXRoYmVydHNvbjwvYT4NCiAqLw0KDQoNCid1c2Ugc3RyaWN0JzsNCg0KDQooZnVuY3Rpb24gKHNoaW5lKSB7DQoNCg0KCS8qKg0KCSAqIEEgTHVhIHZpcnR1YWwgbWFjaGluZS4NCgkgKiBAY29uc3RydWN0b3INCgkgKiBAZXh0ZW5kcyBzaGluZS5FdmVudEVtaXR0ZXINCgkgKiBAcGFyYW0ge29iamVjdH0gZW52IE9iamVjdCBjb250YWluaW5nIGdsb2JhbCB2YXJpYWJsZXMgYW5kIG1ldGhvZHMgZnJvbSB0aGUgaG9zdC4NCgkgKi8NCglzaGluZS5WTSA9IGZ1bmN0aW9uIChlbnYpIHsNCgkJc2hpbmUuRXZlbnRFbWl0dGVyLmNhbGwodGhpcyk7DQoJCQ0KCQkvLyB0aGlzLl9maWxlcyA9IFtdOw0KCQkvLyB0aGlzLl9wYWNrYWdlZEZpbGVzID0ge307DQoJCXRoaXMuZmlsZU1hbmFnZXIgPSBuZXcgc2hpbmUuRmlsZU1hbmFnZXIoKTsNCgkJdGhpcy5fZW52ID0gZW52IHx8IHt9Ow0KCQl0aGlzLl9jb3JvdXRpbmVTdGFjayA9IFtdOw0KDQoJCXRoaXMuX3N0YXR1cyA9IHNoaW5lLlJVTk5JTkc7DQoJCXRoaXMuX3Jlc3VtZVN0YWNrID0gW107DQoJCXRoaXMuX2NhbGxiYWNrUXVldWUgPSBbXTsNCgkJdGhpcy5fY29yb3V0aW5lU3RhY2sgPSBbXTsNCg0KCQl0aGlzLl9yZXNldEdsb2JhbHMoKTsNCgl9Ow0KDQoJc2hpbmUuVk0ucHJvdG90eXBlID0gbmV3IHNoaW5lLkV2ZW50RW1pdHRlcigpOw0KCXNoaW5lLlZNLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHNoaW5lLlZNOw0KDQoNCglzaGluZS5SVU5OSU5HID0gMDsNCglzaGluZS5TVVNQRU5ESU5HID0gMTsNCglzaGluZS5TVVNQRU5ERUQgPSAyOw0KCXNoaW5lLlJFU1VNSU5HID0gMzsNCglzaGluZS5ERUFEID0gNDsNCg0KDQoNCgkJDQoJLyoqDQoJICogUmVzZXRzIGFsbCBnbG9iYWwgdmFyaWFibGVzIHRvIHRoZWlyIG9yaWdpbmFsIHZhbHVlcy4NCgkgKi8NCglzaGluZS5WTS5wcm90b3R5cGUuX3Jlc2V0R2xvYmFscyA9IGZ1bmN0aW9uICgpIHsNCgkJdmFyIGFyZyA9IG5ldyBzaGluZS5UYWJsZSgpOw0KCQlhcmcuc2V0TWVtYmVyKC0xLCAnbW9vbnNoaW5lJyk7DQoNCgkJdGhpcy5fZ2xvYmFscyA9IHRoaXMuX2JpbmRMaWIoc2hpbmUubGliKTsNCgkJdGhpcy5fZ2xvYmFscy5hcmcgPSBhcmc7DQoNCgkJLy8gTG9hZCBzdGFuZGFyZCBsaWIgaW50byBwYWNrYWdlLmxvYWRlZDoNCgkJZm9yICh2YXIgaSBpbiB0aGlzLl9nbG9iYWxzKSBpZiAodGhpcy5fZ2xvYmFscy5oYXNPd25Qcm9wZXJ0eShpKSAmJiB0aGlzLl9nbG9iYWxzW2ldIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUpIHRoaXMuX2dsb2JhbHNbJ3BhY2thZ2UnXS5sb2FkZWRbaV0gPSB0aGlzLl9nbG9iYWxzW2ldOw0KCQl0aGlzLl9nbG9iYWxzWydwYWNrYWdlJ10ubG9hZGVkLl9HID0gdGhpcy5fZ2xvYmFsczsNCg0KCQkvLyBMb2FkIGVudmlyb25tZW50IHZhcnMNCgkJZm9yICh2YXIgaSBpbiB0aGlzLl9lbnYpIGlmICh0aGlzLl9lbnYuaGFzT3duUHJvcGVydHkoaSkpIHRoaXMuX2dsb2JhbHNbaV0gPSB0aGlzLl9lbnZbaV07DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIFJldHVybnMgYSBjb3B5IG9mIGFuIG9iamVjdCwgd2l0aCBhbGwgZnVuY3Rpb25zIGJvdW5kIHRvIHRoZSBWTS4gKHJlY3Vyc2l2ZSkNCgkgKi8NCglzaGluZS5WTS5wcm90b3R5cGUuX2JpbmRMaWIgPSBmdW5jdGlvbiAobGliKSB7DQoJCXZhciByZXN1bHQgPSBzaGluZS5nYy5jcmVhdGVPYmplY3QoKTsNCg0KCQlmb3IgKHZhciBpIGluIGxpYikgew0KCQkJaWYgKGxpYi5oYXNPd25Qcm9wZXJ0eShpKSkgew0KDQoJCQkJLy8gaWYgKGxpYltpXSAmJiBsaWJbaV0uY29uc3RydWN0b3IgPT09IHNoaW5lLlRhYmxlKSB7DQoJCQkJLy8gCXJlc3VsdFtpXSA9IGxpYltpXTsvL25ldyBzaGluZS5UYWJsZShzaGluZS51dGlscy50b09iamVjdChsaWJbaV0pKTsNCg0KCQkJCS8vIH0gZWxzZSBpZiAobGliW2ldICYmIGxpYltpXS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB7DQoJCQkJLy8gCXJlc3VsdFtpXSA9IHRoaXMuX2JpbmRMaWIobGliW2ldKTsNCg0KCQkJCS8vIH0gZWxzZSBpZiAodHlwZW9mIGxpYltpXSA9PSAnZnVuY3Rpb24nKSB7DQoJCQkJLy8gCXJlc3VsdFtpXSA9IChmdW5jdGlvbiAoZnVuYywgY29udGV4dCkgew0KCQkJCS8vIAkJcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJndW1lbnRzKTsgfTsNCgkJCQkvLyAJfSkobGliW2ldLCB0aGlzKTsNCg0KCQkJCS8vIH0gZWxzZSB7DQoJCQkJCXJlc3VsdFtpXSA9IGxpYltpXTsNCgkJCQkvLyB9DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gbmV3IHNoaW5lLlRhYmxlKHJlc3VsdCk7DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIExvYWRzIGEgZmlsZSBjb250YWluaW5nIGNvbXBpbGVkIEx1YWMgY29kZSwgZGVjb21waWxlZCB0byBKU09OLg0KCSAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgVGhlIHVybCBvZiB0aGUgZmlsZSB0byBsb2FkLg0KCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2V4ZWN1dGUgPSB0cnVlXSBXaGV0aGVyIG9yIG5vdCB0byBleGVjdXRlIHRoZSBmaWxlIG9uY2UgbG9hZGVkLg0KCSAqIEBwYXJhbSB7b2JqZWN0fSBbY29Db25maWddIENvcm91dGluZSBjb25maWd1cmF0aW9uLiBPbmx5IGFwcGxpY2FibGUgaWYgZXhlY3V0ZSA9PSB0cnVlLg0KCSAqLw0KCXNoaW5lLlZNLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKHVybCwgZXhlY3V0ZSwgY29Db25maWcpIHsNCgkJdmFyIG1lID0gdGhpczsNCg0KCQl0aGlzLmZpbGVNYW5hZ2VyLmxvYWQodXJsLCBmdW5jdGlvbiAoZXJyLCBmaWxlKSB7DQoJCQlpZiAoZXJyKSB0aHJvdyBuZXcgVVJJRXJyb3IoJ0ZhaWxlZCB0byBsb2FkIGZpbGU6ICcgKyB1cmwgKyAnICgnICsgZXJyICsgJyknKTsNCg0KCQkJbWUuX3RyaWdnZXIoJ2ZpbGUtbG9hZGVkJywgZmlsZSk7DQoJCQlpZiAoZXhlY3V0ZSB8fCBleGVjdXRlID09PSB1bmRlZmluZWQpIG1lLmV4ZWN1dGUoY29Db25maWcsIGZpbGUpOw0KCQl9KTsNCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogRXhlY3V0ZXMgdGhlIGxvYWRlZCBMdWFjIGRhdGEuDQoJICogQHBhcmFtIHtvYmplY3R9IFtjb0NvbmZpZ10gQ29yb3V0aW5lIGNvbmZpZ3VyYXRpb24uDQoJICogQHBhcmFtIHtzaGluZS5GaWxlfSBbZmlsZV0gQSBzcGVjaWZpYyBmaWxlIHRvIGV4ZWN1dGUuIElmIG5vdCBwcmVzZW50LCBleGVjdXRlcyBhbGwgZmlsZXMgaW4gdGhlIG9yZGVyIGxvYWRlZC4NCgkgKi8NCglzaGluZS5WTS5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uIChjb0NvbmZpZywgZmlsZSkgew0KCQl2YXIgbWUgPSB0aGlzLA0KCQkJZmlsZXMgPSBmaWxlPyBbZmlsZV0gOiB0aGlzLl9maWxlcywNCgkJCWluZGV4LA0KCQkJZmlsZSwNCgkJCXRocmVhZDsNCg0KDQoJCWlmICghZmlsZXMubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IgKCdObyBmaWxlcyBsb2FkZWQuJyk7IA0KCQkNCgkJZm9yIChpbmRleCBpbiBmaWxlcykgew0KCQkJaWYgKGZpbGVzLmhhc093blByb3BlcnR5KGluZGV4KSkgew0KDQoJCQkJZmlsZSA9IGZpbGVzW2luZGV4XTsJCQ0KCQkJCWlmICghZmlsZS5kYXRhKSB0aHJvdyBuZXcgRXJyb3IoJ1RyaWVkIHRvIGV4ZWN1dGUgZmlsZSBiZWZvcmUgZGF0YSBsb2FkZWQuJyk7DQoJCQkNCgkJCQ0KCQkJCXRocmVhZCA9IHRoaXMuX3RocmVhZCA9IG5ldyBzaGluZS5GdW5jdGlvbih0aGlzLCBmaWxlLCBmaWxlLmRhdGEsIHRoaXMuX2dsb2JhbHMpOw0KCQkJCXRoaXMuX3RyaWdnZXIoJ2V4ZWN1dGluZycsIFt0aHJlYWQsIGNvQ29uZmlnXSk7DQoJCQkJDQoJCQkJdHJ5IHsNCgkJCQkJaWYgKCFjb0NvbmZpZykgew0KCQkJCQkJdGhyZWFkLmNhbGwgKCk7DQoJCQkJCQkNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCXZhciBjbyA9IHNoaW5lLmxpYi5jb3JvdXRpbmUud3JhcC5jYWxsKHRoaXMsIHRocmVhZCksDQoJCQkJCQkJcmVzdW1lID0gZnVuY3Rpb24gKCkgew0KCQkJCQkJCQljbygpOw0KCQkJCQkJCQlpZiAoY29Db25maWcudWlPbmx5ICYmIGNvLl9jb3JvdXRpbmUuc3RhdHVzICE9IHNoaW5lLkRFQUQpIHdpbmRvdy5zZXRUaW1lb3V0KHJlc3VtZSwgMSk7DQoJCQkJCQkJfTsNCgkJCQ0KCQkJCQkJcmVzdW1lKCk7DQoJCQkJCX0NCgkJCQkJDQoJCQkJfSBjYXRjaCAoZSkgew0KCQkJCQlzaGluZS5FcnJvci5jYXRjaEV4ZWN1dGlvbkVycm9yKGUpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCX07DQoNCg0KDQoNCgkvKioNCgkgKiBDcmVhdGVzIG9yIHVwZGF0ZXMgYSBnbG9iYWwgaW4gdGhlIGd1ZXN0IGVudmlyb25tZW50Lg0KCSAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIGdsb2JhbCB2YXJpYWJsZS4NCgkgKiBAcGFyYW0ge09iamVjdH0gdmFsdWUgVmFsdWUuDQoJICovDQoJc2hpbmUuVk0ucHJvdG90eXBlLnNldEdsb2JhbCA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkgew0KCQl0aGlzLl9nbG9iYWxzW25hbWVdID0gdmFsdWU7DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIFJldHJpZXZlcyBhIGdsb2JhbCBmcm9tIHRoZSBndWVzdCBlbnZpcm9ubWVudC4NCgkgKiBAcGFyYW0ge1N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBnbG9iYWwgdmFyaWFibGUuDQoJICogQHJldHVybnMge09iamVjdH0gVmFsdWUgb2YgdGhlIGdsb2JhbCB2YXJpYWJsZS4NCgkgKi8NCglzaGluZS5WTS5wcm90b3R5cGUuZ2V0R2xvYmFsID0gZnVuY3Rpb24gKG5hbWUpIHsNCgkJcmV0dXJuIHRoaXMuX2dsb2JhbHNbbmFtZV07DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIFN1c3BlbmRzIGFueSBleGVjdXRpb24gaW4gdGhlIFZNLg0KCSAqLw0KCXNoaW5lLlZNLnByb3RvdHlwZS5zdXNwZW5kID0gZnVuY3Rpb24gKCkgew0KCQlpZiAodGhpcy5fc3RhdHVzICE9PSBzaGluZS5SVU5OSU5HKSB0aHJvdyBuZXcgRXJyb3IoJ2F0dGVtcHQgdG8gc3VzcGVuZCBhIG5vbi1ydW5uaW5nIFZNJyk7DQoNCgkJdmFyIHZtID0gdGhpczsNCg0KCQl0aGlzLl9zdGF0dXMgPSBzaGluZS5TVVNQRU5ESU5HOw0KCQl0aGlzLl9yZXN1bWVWYXJzID0gdW5kZWZpbmVkOw0KDQoJCXdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCgkJCWlmICh2bS5fc3RhdHVzID09IHNoaW5lLlNVU1BFTkRJTkcpIHZtLl9zdGF0dXMgPSBzaGluZS5TVVNQRU5ERUQ7DQoJCX0sIDEpOw0KCX07DQoNCg0KDQoNCgkvKioNCgkgKiBSZXN1bWVzIGV4ZWN1dGlvbiBpbiB0aGUgVk0gZnJvbSB0aGUgcG9pbnQgYXQgd2hpY2ggaXQgd2FzIHN1c3BlbmRlZC4NCgkgKi8NCglzaGluZS5WTS5wcm90b3R5cGUucmVzdW1lID0gZnVuY3Rpb24gKHJldHZhbHMpIHsNCgkJaWYgKHRoaXMuX3N0YXR1cyAhPT0gc2hpbmUuU1VTUEVOREVEICYmIHRoaXMuX3N0YXR1cyAhPT0gc2hpbmUuU1VTUEVORElORykgdGhyb3cgbmV3IEVycm9yKCdhdHRlbXB0IHRvIHJlc3VtZSBhIG5vbi1zdXNwZW5kZWQgVk0nKTsNCg0KCQlpZiAoIWFyZ3VtZW50cy5sZW5ndGggfHwgcmV0dmFscyAhPT0gdW5kZWZpbmVkKSByZXR2YWxzID0gcmV0dmFscyB8fCB0aGlzLl9yZXN1bWVWYXJzOw0KDQoJCWlmIChyZXR2YWxzICYmICEocmV0dmFscyBpbnN0YW5jZW9mIEFycmF5KSkgew0KCQkJdmFyIGFyciA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCk7DQoJCQlhcnIucHVzaChyZXR2YWxzKTsNCgkJCXJldHZhbHMgPSBhcnI7DQoJCX0NCg0KCQl0aGlzLl9zdGF0dXMgPSBzaGluZS5SRVNVTUlORzsNCgkJdGhpcy5fcmVzdW1lVmFycyA9IHJldHZhbHM7DQoNCgkJdmFyIGYgPSB0aGlzLl9yZXN1bWVTdGFjay5wb3AoKTsNCg0KCQlpZiAoZikgew0KCQkJdHJ5IHsNCgkJCQlpZiAoZiBpbnN0YW5jZW9mIHNoaW5lLkNvcm91dGluZSkgew0KCQkJCQlmLnJlc3VtZSgpOw0KCQkJCX0gZWxzZSBpZiAoZiBpbnN0YW5jZW9mIHNoaW5lLkNsb3N1cmUpIHsNCgkJCQkJZi5fcnVuKCk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJZigpOw0KCQkJCX0NCgkJCQkNCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQlpZiAoISgoZSB8fCBzaGluZS5FTVBUWV9PQkopIGluc3RhbmNlb2Ygc2hpbmUuRXJyb3IpKSB7DQoJCQkJCXZhciBzdGFjayA9IChlLnN0YWNrIHx8ICcnKTsNCg0KCQkJCQllID0gbmV3IHNoaW5lLkVycm9yICgnRXJyb3IgaW4gaG9zdCBjYWxsOiAnICsgZS5tZXNzYWdlKTsNCgkJCQkJZS5zdGFjayA9IHN0YWNrOw0KCQkJCQllLmx1YVN0YWNrID0gc3RhY2suc3BsaXQgKCdcbicpOw0KCQkJCX0NCg0KCQkJCWlmICghZS5sdWFTdGFjaykgZS5sdWFTdGFjayA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCk7DQoJCQkJZS5sdWFTdGFjay5wdXNoKFtmLCBmLl9wYyAtIDFdKTsNCg0KCQkJCXNoaW5lLkVycm9yLmNhdGNoRXhlY3V0aW9uRXJyb3IoZSk7DQoJCQl9DQoJCX0NCgkNCgkJaWYgKHRoaXMuX3N0YXR1cyA9PSBzaGluZS5SVU5OSU5HKSB7DQoJCQl3aGlsZSAodGhpcy5fY2FsbGJhY2tRdWV1ZVswXSkgdGhpcy5fY2FsbGJhY2tRdWV1ZS5zaGlmdCgpKCk7DQoJCX0NCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogRHVtcHMgbWVtb3J5IGFzc29jaWF0ZWQgd2l0aCB0aGUgVk0uDQoJICovDQoJc2hpbmUuVk0ucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7DQoJCXZhciB0aHJlYWQ7DQoNCgkJZm9yICh2YXIgaSBpbiB0aGlzLl9maWxlcykgaWYgKHRoaXMuX2ZpbGVzLmhhc093blByb3BlcnR5KGkpKSB0aGlzLl9maWxlc1tpXS5kaXNwb3NlKCk7DQoNCgkJaWYgKHRocmVhZCA9IHRoaXMuX3RocmVhZCkgdGhyZWFkLmRpc3Bvc2UoKTsNCg0KCQlkZWxldGUgdGhpcy5fZmlsZXM7DQoJCWRlbGV0ZSB0aGlzLl90aHJlYWQ7DQoJCWRlbGV0ZSB0aGlzLl9nbG9iYWxzOw0KCQlkZWxldGUgdGhpcy5fZW52Ow0KCQlkZWxldGUgdGhpcy5fY29yb3V0aW5lU3RhY2s7DQoNCgkJdGhpcy5maWxlTWFuYWdlci5kaXNwb3NlKCk7DQoJCWRlbGV0ZSB0aGlzLmZpbGVNYW5hZ2VyOw0KDQoNCgkJLy8gQ2xlYXIgc3RhdGljIHN0YWNrcyAtLSBWZXJ5IGRhbmdlcm91cyBmb3IgZW52aXJvbm1lbnRzIHRoYXQgY29udGFpbiBtdWx0aXBsZSBWTXMhDQoJCXNoaW5lLkNsb3N1cmUuX2dyYXZleWFyZC5sZW5ndGggPSAwOw0KCQlzaGluZS5DbG9zdXJlLl9jdXJyZW50ID0gdW5kZWZpbmVkOw0KCQlzaGluZS5Db3JvdXRpbmUuX2dyYXZleWFyZC5sZW5ndGggPSAwOw0KCX07DQoNCg0KDQoNCgkvKioNCgkgKiBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBWTSB0aGF0IGlzIGN1cnJlbnRseSBleGVjdXRpbmcuDQoJICogQHJldHVybnMge3NoaW5lLlZNfSBDdXJyZW50IFZNDQoJICovDQoJc2hpbmUuZ2V0Q3VycmVudFZNID0gZnVuY3Rpb24gKCkgew0KCQl2YXIgY2xvc3VyZTsNCgkJcmV0dXJuIChjbG9zdXJlID0gdGhpcy5DbG9zdXJlLl9jdXJyZW50KSAmJiBjbG9zdXJlLl92bTsNCgl9Ow0KDQoJLyoqDQoJICogQSBMdWEgdmlydHVhbCBtYWNoaW5lLg0KCSAqIEBjb25zdHJ1Y3Rvcg0KCSAqIEBleHRlbmRzIHNoaW5lLkV2ZW50RW1pdHRlcg0KCSAqIEBwYXJhbSB7b2JqZWN0fSBlbnYgT2JqZWN0IGNvbnRhaW5pbmcgZ2xvYmFsIHZhcmlhYmxlcyBhbmQgbWV0aG9kcyBmcm9tIHRoZSBob3N0Lg0KCSAqLw0KCXNoaW5lLlZNID0gZnVuY3Rpb24gKGVudikgew0KCQlzaGluZS5FdmVudEVtaXR0ZXIuY2FsbCh0aGlzKTsNCgkJDQoJCS8vIHRoaXMuX2ZpbGVzID0gW107DQoJCS8vIHRoaXMuX3BhY2thZ2VkRmlsZXMgPSB7fTsNCgkJdGhpcy5maWxlTWFuYWdlciA9IG5ldyBzaGluZS5GaWxlTWFuYWdlcigpOw0KCQl0aGlzLl9lbnYgPSBlbnYgfHwge307DQoJCXRoaXMuX2Nvcm91dGluZVN0YWNrID0gW107DQoNCgkJdGhpcy5fc3RhdHVzID0gc2hpbmUuUlVOTklORzsNCgkJdGhpcy5fcmVzdW1lU3RhY2sgPSBbXTsNCgkJdGhpcy5fY2FsbGJhY2tRdWV1ZSA9IFtdOw0KCQl0aGlzLl9jb3JvdXRpbmVTdGFjayA9IFtdOw0KDQoJCXRoaXMuX3Jlc2V0R2xvYmFscygpOw0KCX07DQoNCglzaGluZS5WTS5wcm90b3R5cGUgPSBuZXcgc2hpbmUuRXZlbnRFbWl0dGVyKCk7DQoJc2hpbmUuVk0ucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc2hpbmUuVk07DQoNCg0KCXNoaW5lLlJVTk5JTkcgPSAwOw0KCXNoaW5lLlNVU1BFTkRJTkcgPSAxOw0KCXNoaW5lLlNVU1BFTkRFRCA9IDI7DQoJc2hpbmUuUkVTVU1JTkcgPSAzOw0KCXNoaW5lLkRFQUQgPSA0Ow0KDQoNCg0KCQkNCgkvKioNCgkgKiBSZXNldHMgYWxsIGdsb2JhbCB2YXJpYWJsZXMgdG8gdGhlaXIgb3JpZ2luYWwgdmFsdWVzLg0KCSAqLw0KCXNoaW5lLlZNLnByb3RvdHlwZS5fcmVzZXRHbG9iYWxzID0gZnVuY3Rpb24gKCkgew0KCQl2YXIgYXJnID0gbmV3IHNoaW5lLlRhYmxlKCk7DQoJCWFyZy5zZXRNZW1iZXIoLTEsICdtb29uc2hpbmUnKTsNCg0KCQl0aGlzLl9nbG9iYWxzID0gdGhpcy5fYmluZExpYihzaGluZS5saWIpOw0KCQl0aGlzLl9nbG9iYWxzLmFyZyA9IGFyZzsNCg0KCQkvLyBMb2FkIHN0YW5kYXJkIGxpYiBpbnRvIHBhY2thZ2UubG9hZGVkOg0KCQlmb3IgKHZhciBpIGluIHRoaXMuX2dsb2JhbHMpIGlmICh0aGlzLl9nbG9iYWxzLmhhc093blByb3BlcnR5KGkpICYmIHRoaXMuX2dsb2JhbHNbaV0gaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkgdGhpcy5fZ2xvYmFsc1sncGFja2FnZSddLmxvYWRlZFtpXSA9IHRoaXMuX2dsb2JhbHNbaV07DQoJCXRoaXMuX2dsb2JhbHNbJ3BhY2thZ2UnXS5sb2FkZWQuX0cgPSB0aGlzLl9nbG9iYWxzOw0KDQoJCS8vIExvYWQgZW52aXJvbm1lbnQgdmFycw0KCQlmb3IgKHZhciBpIGluIHRoaXMuX2VudikgaWYgKHRoaXMuX2Vudi5oYXNPd25Qcm9wZXJ0eShpKSkgdGhpcy5fZ2xvYmFsc1tpXSA9IHRoaXMuX2VudltpXTsNCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogUmV0dXJucyBhIGNvcHkgb2YgYW4gb2JqZWN0LCB3aXRoIGFsbCBmdW5jdGlvbnMgYm91bmQgdG8gdGhlIFZNLiAocmVjdXJzaXZlKQ0KCSAqLw0KCXNoaW5lLlZNLnByb3RvdHlwZS5fYmluZExpYiA9IGZ1bmN0aW9uIChsaWIpIHsNCgkJdmFyIHJlc3VsdCA9IHNoaW5lLmdjLmNyZWF0ZU9iamVjdCgpOw0KDQoJCWZvciAodmFyIGkgaW4gbGliKSB7DQoJCQlpZiAobGliLmhhc093blByb3BlcnR5KGkpKSB7DQoNCgkJCQkvLyBpZiAobGliW2ldICYmIGxpYltpXS5jb25zdHJ1Y3RvciA9PT0gc2hpbmUuVGFibGUpIHsNCgkJCQkvLyAJcmVzdWx0W2ldID0gbGliW2ldOy8vbmV3IHNoaW5lLlRhYmxlKHNoaW5lLnV0aWxzLnRvT2JqZWN0KGxpYltpXSkpOw0KDQoJCQkJLy8gfSBlbHNlIGlmIChsaWJbaV0gJiYgbGliW2ldLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHsNCgkJCQkvLyAJcmVzdWx0W2ldID0gdGhpcy5fYmluZExpYihsaWJbaV0pOw0KDQoJCQkJLy8gfSBlbHNlIGlmICh0eXBlb2YgbGliW2ldID09ICdmdW5jdGlvbicpIHsNCgkJCQkvLyAJcmVzdWx0W2ldID0gKGZ1bmN0aW9uIChmdW5jLCBjb250ZXh0KSB7DQoJCQkJLy8gCQlyZXR1cm4gZnVuY3Rpb24gKCkgeyByZXR1cm4gZnVuYy5hcHBseShjb250ZXh0LCBhcmd1bWVudHMpOyB9Ow0KCQkJCS8vIAl9KShsaWJbaV0sIHRoaXMpOw0KDQoJCQkJLy8gfSBlbHNlIHsNCgkJCQkJcmVzdWx0W2ldID0gbGliW2ldOw0KCQkJCS8vIH0NCgkJCX0NCgkJfQ0KDQoJCXJldHVybiBuZXcgc2hpbmUuVGFibGUocmVzdWx0KTsNCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogTG9hZHMgYSBmaWxlIGNvbnRhaW5pbmcgY29tcGlsZWQgTHVhYyBjb2RlLCBkZWNvbXBpbGVkIHRvIEpTT04uDQoJICogQHBhcmFtIHtzdHJpbmd9IHVybCBUaGUgdXJsIG9mIHRoZSBmaWxlIHRvIGxvYWQuDQoJICogQHBhcmFtIHtib29sZWFufSBbZXhlY3V0ZSA9IHRydWVdIFdoZXRoZXIgb3Igbm90IHRvIGV4ZWN1dGUgdGhlIGZpbGUgb25jZSBsb2FkZWQuDQoJICogQHBhcmFtIHtvYmplY3R9IFtjb0NvbmZpZ10gQ29yb3V0aW5lIGNvbmZpZ3VyYXRpb24uIE9ubHkgYXBwbGljYWJsZSBpZiBleGVjdXRlID09IHRydWUuDQoJICovDQoJc2hpbmUuVk0ucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAodXJsLCBleGVjdXRlLCBjb0NvbmZpZykgew0KCQl2YXIgbWUgPSB0aGlzOw0KDQoJCXRoaXMuZmlsZU1hbmFnZXIubG9hZCh1cmwsIGZ1bmN0aW9uIChlcnIsIGZpbGUpIHsNCgkJCWlmIChlcnIpIHRocm93IG5ldyBVUklFcnJvcignRmFpbGVkIHRvIGxvYWQgZmlsZTogJyArIHVybCArICcgKCcgKyBlcnIgKyAnKScpOw0KDQoJCQltZS5fdHJpZ2dlcignZmlsZS1sb2FkZWQnLCBmaWxlKTsNCgkJCWlmIChleGVjdXRlIHx8IGV4ZWN1dGUgPT09IHVuZGVmaW5lZCkgbWUuZXhlY3V0ZShjb0NvbmZpZywgZmlsZSk7DQoJCX0pOw0KCX07DQoNCg0KDQoNCgkvKioNCgkgKiBFeGVjdXRlcyB0aGUgbG9hZGVkIEx1YWMgZGF0YS4NCgkgKiBAcGFyYW0ge29iamVjdH0gW2NvQ29uZmlnXSBDb3JvdXRpbmUgY29uZmlndXJhdGlvbi4NCgkgKiBAcGFyYW0ge3NoaW5lLkZpbGV9IFtmaWxlXSBBIHNwZWNpZmljIGZpbGUgdG8gZXhlY3V0ZS4gSWYgbm90IHByZXNlbnQsIGV4ZWN1dGVzIGFsbCBmaWxlcyBpbiB0aGUgb3JkZXIgbG9hZGVkLg0KCSAqLw0KCXNoaW5lLlZNLnByb3RvdHlwZS5leGVjdXRlID0gZnVuY3Rpb24gKGNvQ29uZmlnLCBmaWxlKSB7DQoJCXZhciBtZSA9IHRoaXMsDQoJCQlmaWxlcyA9IGZpbGU/IFtmaWxlXSA6IHRoaXMuX2ZpbGVzLA0KCQkJaW5kZXgsDQoJCQlmaWxlLA0KCQkJdGhyZWFkOw0KDQoNCgkJaWYgKCFmaWxlcy5sZW5ndGgpIHRocm93IG5ldyBFcnJvciAoJ05vIGZpbGVzIGxvYWRlZC4nKTsgDQoJCQ0KCQlmb3IgKGluZGV4IGluIGZpbGVzKSB7DQoJCQlpZiAoZmlsZXMuaGFzT3duUHJvcGVydHkoaW5kZXgpKSB7DQoNCgkJCQlmaWxlID0gZmlsZXNbaW5kZXhdOwkJDQoJCQkJaWYgKCFmaWxlLmRhdGEpIHRocm93IG5ldyBFcnJvcignVHJpZWQgdG8gZXhlY3V0ZSBmaWxlIGJlZm9yZSBkYXRhIGxvYWRlZC4nKTsNCgkJCQ0KCQkJDQoJCQkJdGhyZWFkID0gdGhpcy5fdGhyZWFkID0gbmV3IHNoaW5lLkZ1bmN0aW9uKHRoaXMsIGZpbGUsIGZpbGUuZGF0YSwgdGhpcy5fZ2xvYmFscyk7DQoJCQkJdGhpcy5fdHJpZ2dlcignZXhlY3V0aW5nJywgW3RocmVhZCwgY29Db25maWddKTsNCgkJCQkNCgkJCQl0cnkgew0KCQkJCQlpZiAoIWNvQ29uZmlnKSB7DQoJCQkJCQl0aHJlYWQuY2FsbCAoKTsNCgkJCQkJCQ0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdmFyIGNvID0gc2hpbmUubGliLmNvcm91dGluZS53cmFwLmNhbGwodGhpcywgdGhyZWFkKSwNCgkJCQkJCQlyZXN1bWUgPSBmdW5jdGlvbiAoKSB7DQoJCQkJCQkJCWNvKCk7DQoJCQkJCQkJCWlmIChjb0NvbmZpZy51aU9ubHkgJiYgY28uX2Nvcm91dGluZS5zdGF0dXMgIT0gc2hpbmUuREVBRCkgd2luZG93LnNldFRpbWVvdXQocmVzdW1lLCAxKTsNCgkJCQkJCQl9Ow0KCQkJDQoJCQkJCQlyZXN1bWUoKTsNCgkJCQkJfQ0KCQkJCQkNCgkJCQl9IGNhdGNoIChlKSB7DQoJCQkJCXNoaW5lLkVycm9yLmNhdGNoRXhlY3V0aW9uRXJyb3IoZSk7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIENyZWF0ZXMgb3IgdXBkYXRlcyBhIGdsb2JhbCBpbiB0aGUgZ3Vlc3QgZW52aXJvbm1lbnQuDQoJICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgZ2xvYmFsIHZhcmlhYmxlLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSBWYWx1ZS4NCgkgKi8NCglzaGluZS5WTS5wcm90b3R5cGUuc2V0R2xvYmFsID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7DQoJCXRoaXMuX2dsb2JhbHNbbmFtZV0gPSB2YWx1ZTsNCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogUmV0cmlldmVzIGEgZ2xvYmFsIGZyb20gdGhlIGd1ZXN0IGVudmlyb25tZW50Lg0KCSAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIGdsb2JhbCB2YXJpYWJsZS4NCgkgKiBAcmV0dXJucyB7T2JqZWN0fSBWYWx1ZSBvZiB0aGUgZ2xvYmFsIHZhcmlhYmxlLg0KCSAqLw0KCXNoaW5lLlZNLnByb3RvdHlwZS5nZXRHbG9iYWwgPSBmdW5jdGlvbiAobmFtZSkgew0KCQlyZXR1cm4gdGhpcy5fZ2xvYmFsc1tuYW1lXTsNCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogU3VzcGVuZHMgYW55IGV4ZWN1dGlvbiBpbiB0aGUgVk0uDQoJICovDQoJc2hpbmUuVk0ucHJvdG90eXBlLnN1c3BlbmQgPSBmdW5jdGlvbiAoKSB7DQoJCWlmICh0aGlzLl9zdGF0dXMgIT09IHNoaW5lLlJVTk5JTkcpIHRocm93IG5ldyBFcnJvcignYXR0ZW1wdCB0byBzdXNwZW5kIGEgbm9uLXJ1bm5pbmcgVk0nKTsNCg0KCQl2YXIgdm0gPSB0aGlzOw0KDQoJCXRoaXMuX3N0YXR1cyA9IHNoaW5lLlNVU1BFTkRJTkc7DQoJCXRoaXMuX3Jlc3VtZVZhcnMgPSB1bmRlZmluZWQ7DQoNCgkJd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KCQkJaWYgKHZtLl9zdGF0dXMgPT0gc2hpbmUuU1VTUEVORElORykgdm0uX3N0YXR1cyA9IHNoaW5lLlNVU1BFTkRFRDsNCgkJfSwgMSk7DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIFJlc3VtZXMgZXhlY3V0aW9uIGluIHRoZSBWTSBmcm9tIHRoZSBwb2ludCBhdCB3aGljaCBpdCB3YXMgc3VzcGVuZGVkLg0KCSAqLw0KCXNoaW5lLlZNLnByb3RvdHlwZS5yZXN1bWUgPSBmdW5jdGlvbiAocmV0dmFscykgew0KCQlpZiAodGhpcy5fc3RhdHVzICE9PSBzaGluZS5TVVNQRU5ERUQgJiYgdGhpcy5fc3RhdHVzICE9PSBzaGluZS5TVVNQRU5ESU5HKSB0aHJvdyBuZXcgRXJyb3IoJ2F0dGVtcHQgdG8gcmVzdW1lIGEgbm9uLXN1c3BlbmRlZCBWTScpOw0KDQoJCWlmICghYXJndW1lbnRzLmxlbmd0aCB8fCByZXR2YWxzICE9PSB1bmRlZmluZWQpIHJldHZhbHMgPSByZXR2YWxzIHx8IHRoaXMuX3Jlc3VtZVZhcnM7DQoNCgkJaWYgKHJldHZhbHMgJiYgIShyZXR2YWxzIGluc3RhbmNlb2YgQXJyYXkpKSB7DQoJCQl2YXIgYXJyID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgkJCWFyci5wdXNoKHJldHZhbHMpOw0KCQkJcmV0dmFscyA9IGFycjsNCgkJfQ0KDQoJCXRoaXMuX3N0YXR1cyA9IHNoaW5lLlJFU1VNSU5HOw0KCQl0aGlzLl9yZXN1bWVWYXJzID0gcmV0dmFsczsNCg0KCQl2YXIgZiA9IHRoaXMuX3Jlc3VtZVN0YWNrLnBvcCgpOw0KDQoJCWlmIChmKSB7DQoJCQl0cnkgew0KCQkJCWlmIChmIGluc3RhbmNlb2Ygc2hpbmUuQ29yb3V0aW5lKSB7DQoJCQkJCWYucmVzdW1lKCk7DQoJCQkJfSBlbHNlIGlmIChmIGluc3RhbmNlb2Ygc2hpbmUuQ2xvc3VyZSkgew0KCQkJCQlmLl9ydW4oKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlmKCk7DQoJCQkJfQ0KCQkJCQ0KCQkJfSBjYXRjaCAoZSkgew0KCQkJCWlmICghKChlIHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBzaGluZS5FcnJvcikpIHsNCgkJCQkJdmFyIHN0YWNrID0gKGUuc3RhY2sgfHwgJycpOw0KDQoJCQkJCWUgPSBuZXcgc2hpbmUuRXJyb3IgKCdFcnJvciBpbiBob3N0IGNhbGw6ICcgKyBlLm1lc3NhZ2UpOw0KCQkJCQllLnN0YWNrID0gc3RhY2s7DQoJCQkJCWUubHVhU3RhY2sgPSBzdGFjay5zcGxpdCAoJ1xuJyk7DQoJCQkJfQ0KDQoJCQkJaWYgKCFlLmx1YVN0YWNrKSBlLmx1YVN0YWNrID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgkJCQllLmx1YVN0YWNrLnB1c2goW2YsIGYuX3BjIC0gMV0pOw0KDQoJCQkJc2hpbmUuRXJyb3IuY2F0Y2hFeGVjdXRpb25FcnJvcihlKTsNCgkJCX0NCgkJfQ0KCQ0KCQlpZiAodGhpcy5fc3RhdHVzID09IHNoaW5lLlJVTk5JTkcpIHsNCgkJCXdoaWxlICh0aGlzLl9jYWxsYmFja1F1ZXVlWzBdKSB0aGlzLl9jYWxsYmFja1F1ZXVlLnNoaWZ0KCkoKTsNCgkJfQ0KCX07DQoNCg0KDQoNCgkvKioNCgkgKiBEdW1wcyBtZW1vcnkgYXNzb2NpYXRlZCB3aXRoIHRoZSBWTS4NCgkgKi8NCglzaGluZS5WTS5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsNCgkJdmFyIHRocmVhZDsNCg0KCQlmb3IgKHZhciBpIGluIHRoaXMuX2ZpbGVzKSBpZiAodGhpcy5fZmlsZXMuaGFzT3duUHJvcGVydHkoaSkpIHRoaXMuX2ZpbGVzW2ldLmRpc3Bvc2UoKTsNCg0KCQlpZiAodGhyZWFkID0gdGhpcy5fdGhyZWFkKSB0aHJlYWQuZGlzcG9zZSgpOw0KDQoJCWRlbGV0ZSB0aGlzLl9maWxlczsNCgkJZGVsZXRlIHRoaXMuX3RocmVhZDsNCgkJZGVsZXRlIHRoaXMuX2dsb2JhbHM7DQoJCWRlbGV0ZSB0aGlzLl9lbnY7DQoJCWRlbGV0ZSB0aGlzLl9jb3JvdXRpbmVTdGFjazsNCg0KCQl0aGlzLmZpbGVNYW5hZ2VyLmRpc3Bvc2UoKTsNCgkJZGVsZXRlIHRoaXMuZmlsZU1hbmFnZXI7DQoNCg0KCQkvLyBDbGVhciBzdGF0aWMgc3RhY2tzIC0tIFZlcnkgZGFuZ2Vyb3VzIGZvciBlbnZpcm9ubWVudHMgdGhhdCBjb250YWluIG11bHRpcGxlIFZNcyENCgkJc2hpbmUuQ2xvc3VyZS5fZ3JhdmV5YXJkLmxlbmd0aCA9IDA7DQoJCXNoaW5lLkNsb3N1cmUuX2N1cnJlbnQgPSB1bmRlZmluZWQ7DQoJCXNoaW5lLkNvcm91dGluZS5fZ3JhdmV5YXJkLmxlbmd0aCA9IDA7DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIFJldHVybnMgYSByZWZlcmVuY2UgdG8gdGhlIFZNIHRoYXQgaXMgY3VycmVudGx5IGV4ZWN1dGluZy4NCgkgKiBAcmV0dXJucyB7c2hpbmUuVk19IEN1cnJlbnQgVk0NCgkgKi8NCglzaGluZS5nZXRDdXJyZW50Vk0gPSBmdW5jdGlvbiAoKSB7DQoJCXZhciBjbG9zdXJlOw0KCQlyZXR1cm4gKGNsb3N1cmUgPSB0aGlzLkNsb3N1cmUuX2N1cnJlbnQpICYmIGNsb3N1cmUuX3ZtOw0KCX07DQoNCgkvKioNCgkgKiBSZXByZXNlbnRzIGEgdGFibGUgaW4gTHVhLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSBvYmogSW5pdGlhbCB2YWx1ZXMgdG8gc2V0IHVwIGluIHRoZSBuZXcgdGFibGUuDQoJICovDQoJc2hpbmUuVGFibGUgPSBmdW5jdGlvbiAob2JqKSB7DQoNCgkJdmFyIGlzQXJyID0gKChvYmogfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIEFycmF5KSwNCgkJCW1ldGEsDQoJCQlrZXksDQoJCQl2YWx1ZSwNCgkJCWk7DQoNCgkJb2JqID0gb2JqIHx8IHNoaW5lLmdjLmNyZWF0ZU9iamVjdCgpOw0KDQoJCXRoaXMuX19zaGluZSA9IG1ldGEgPSBzaGluZS5nYy5jcmVhdGVPYmplY3QoKTsNCgkJbWV0YS50eXBlID0gJ3RhYmxlJzsNCgkJbWV0YS5pbmRleCA9ICsrc2hpbmUuVGFibGUuY291bnQ7DQoJCW1ldGEua2V5cyA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCk7DQoJCW1ldGEudmFsdWVzID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgkJbWV0YS5udW1WYWx1ZXMgPSBbdW5kZWZpbmVkXTsNCg0KDQoJCWZvciAoaSBpbiBvYmopIHsNCgkJCWlmIChvYmouaGFzT3duUHJvcGVydHkoaSkpIHsNCgkJCQl2YXIgaXRlcmF0ZTsNCg0KCQkJCWtleSA9IGlzQXJyPyBwYXJzZUludChpLCAxMCkgKyAxOiBpOw0KCQkJCXZhbHVlID0gb2JqW2ldOw0KCQkJCWlmICh2YWx1ZSA9PT0gbnVsbCkgdmFsdWUgPSB1bmRlZmluZWQ7DQoNCgkJCQlpZiAodHlwZW9mIGdldFF1YWxpZmllZENsYXNzTmFtZSAhPT0gJ3VuZGVmaW5lZCcpIHsNCgkJCQkJLy8gQWN0aW9uU2NyaXB0DQoJCQkJCWl0ZXJhdGUgPSAoZ2V0UXVhbGlmaWVkQ2xhc3NOYW1lKHZhbHVlKSA9PSAnT2JqZWN0JyAmJiAhKHZhbHVlIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUpICYmICEodmFsdWUgaW5zdGFuY2VvZiBzaGluZS5Db3JvdXRpbmUpICYmICEodmFsdWUgaW5zdGFuY2VvZiBzaGluZS5GdW5jdGlvbikgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIHNoaW5lLkNsb3N1cmUpKSB8fCBnZXRRdWFsaWZpZWRDbGFzc05hbWUodmFsdWUpID09ICdBcnJheSc7DQoJCQkJfSBlbHNlIHsNCgkJCQkJLy8gSmF2YVNjcmlwdA0KCQkJCQlpdGVyYXRlID0gKHR5cGVvZiB2YWx1ZSA9PSAnb2JqZWN0JyAmJiB2YWx1ZS5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KSB8fCB2YWx1ZSBpbnN0YW5jZW9mIEFycmF5Ow0KCQkJCX0NCgkJCQkNCgkJCQl0aGlzLnNldE1lbWJlcihrZXksIGl0ZXJhdGU/IG5ldyBzaGluZS5UYWJsZSh2YWx1ZSkgOiB2YWx1ZSk7DQoJCQl9DQoJCX0NCgkJDQoJfTsNCg0KDQoJLyoqDQoJICogS2VlcHMgYSBjb3VudCBvZiB0aGUgbnVtYmVyIG9mIHRhYmxlcyBjcmVhdGVkLCBpbiBvcmRlciB0byBpbmRleCB0aGVtIHVuaXF1ZWx5Lg0KCSAqIEB0eXBlIE51bWJlcg0KCSAqIEBzdGF0aWMNCgkgKi8NCglzaGluZS5UYWJsZS5jb3VudCA9IDA7DQoNCg0KDQoNCgkvKioNCgkgKiBHZXRzIGEgbWVtYmVyIG9mIHRoaXMgdGFibGUuIElmIG5vdCBmb3VuZCwgc2VhcmNoIHRoZSBtZXRhdGFibGUgY2hhaW4uDQoJICogQHBhcmFtIHtPYmplY3R9IGtleSBUaGUgbWVtYmVyJ3Mga2V5Lg0KCSAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSB2YWx1ZSBvZiB0aGUgbWVtYmVyIHNvdWdodC4NCgkgKi8NCglzaGluZS5UYWJsZS5wcm90b3R5cGUuZ2V0TWVtYmVyID0gZnVuY3Rpb24gKGtleSkgew0KCQl2YXIgdHlwID0gdHlwZW9mIGtleSwNCgkJCWluZGV4LCB2YWx1ZSwgbXQsIG1tOw0KDQoJCWlmICh0eXAgPT0gJ3N0cmluZycgJiYgKGtleSA9PSAnZ2V0TWVtYmVyJyB8fCBrZXkgPT0gJ3NldE1lbWJlcicpKSB0eXAgPSAnb2JqZWN0JzsNCg0KCQlzd2l0Y2ggKHR5cCkgew0KCQkJY2FzZSAnc3RyaW5nJzoNCgkJCQlpZiAodGhpcy5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIHRoaXNba2V5XSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gdGhpc1trZXldOw0KCQkJCWJyZWFrOw0KDQoJCQljYXNlICdudW1iZXInOg0KCQkJCWlmIChrZXkgPiAwICYmIGtleSA9PSBrZXkgPj4gMCkgew0KCQkJCQl2YWx1ZSA9IHRoaXMuX19zaGluZS5udW1WYWx1ZXNba2V5XTsNCgkJCQkJaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHJldHVybiB2YWx1ZTsNCgkJCQkJYnJlYWsNCgkJCQl9DQoNCgkJCWRlZmF1bHQ6DQoJCQkJaW5kZXggPSB0aGlzLl9fc2hpbmUua2V5cy5pbmRleE9mKGtleSk7DQoJCQkJaWYgKGluZGV4ID49IDApIHJldHVybiB0aGlzLl9fc2hpbmUudmFsdWVzW2luZGV4XTsNCgkJfQ0KCQkNCgkJaWYgKChtdCA9IHRoaXMuX19zaGluZS5tZXRhdGFibGUpICYmIChtbSA9IG10Ll9faW5kZXgpKSB7DQoJCQlzd2l0Y2ggKG1tLmNvbnN0cnVjdG9yKSB7DQoJCQkJY2FzZSBzaGluZS5UYWJsZTogcmV0dXJuIG1tLmdldE1lbWJlcihrZXkpOw0KCQkJCS8vIGNhc2UgRnVuY3Rpb246IHJldHVybiBtbSh0aGlzLCBrZXkpOw0KCQkJCS8vIGNhc2Ugc2hpbmUuRnVuY3Rpb246IHJldHVybiBtbS5hcHBseSh0aGlzLCBbdGhpcywga2V5XSlbMF07DQoJCQkJY2FzZSBGdW5jdGlvbjoNCgkJCQljYXNlIHNoaW5lLkZ1bmN0aW9uOg0KCQkJCQl2YWx1ZSA9IG1tLmFwcGx5KHRoaXMsIFt0aGlzLCBrZXldKTsNCgkJCQkJcmV0dXJuICh2YWx1ZSBpbnN0YW5jZW9mIEFycmF5KT8gdmFsdWVbMF0gOiB2YWx1ZTsNCgkJCX0NCgkJfQ0KCX07DQoNCg0KDQoNCgkvKioNCgkgKiBTZXRzIGEgbWVtYmVyIG9mIHRoaXMgdGFibGUuDQoJICogQHBhcmFtIHtPYmplY3R9IGtleSBUaGUgbWVtYmVyJ3Mga2V5Lg0KCSAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSBUaGUgbmV3IHZhbHVlIG9mIHRoZSBtZW1iZXIuDQoJICovDQoJc2hpbmUuVGFibGUucHJvdG90eXBlLnNldE1lbWJlciA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7DQoJCXZhciBtdCA9IHRoaXMuX19zaGluZS5tZXRhdGFibGUsDQoJCQl0eXAgPSB0eXBlb2Yga2V5LA0KCQkJcG9zaXRpdmVJbnRlZ2VyS2V5ID0ga2V5ID4gMCAmJiBrZXkgPT0ga2V5ID4+IDAsDQoJCQlvbGRWYWx1ZSwNCgkJCWtleXMsDQoJCQlpbmRleDsNCg0KCQlpZiAodHlwID09ICdzdHJpbmcnICYmIChrZXkgPT0gJ2dldE1lbWJlcicgfHwga2V5ID09ICdzZXRNZW1iZXInKSkgdHlwID0gJ29iamVjdCc7DQoNCgkJc3dpdGNoICh0eXApIHsNCgkJCWNhc2UgJ3N0cmluZyc6DQoJCQkJb2xkVmFsdWUgPSB0aGlzW2tleV07DQoJCQkJYnJlYWs7DQoNCgkJCWNhc2UgJ251bWJlcic6DQoJCQkJaWYgKHBvc2l0aXZlSW50ZWdlcktleSkgew0KCQkJCQlvbGRWYWx1ZSA9IHRoaXMuX19zaGluZS5udW1WYWx1ZXNba2V5XTsNCgkJCQkJYnJlYWs7DQoJCQkJfQ0KDQoJCQlkZWZhdWx0Og0KCQkJCWtleXMgPSB0aGlzLl9fc2hpbmUua2V5czsNCgkJCQlpbmRleCA9IGtleXMuaW5kZXhPZihrZXkpOw0KDQoJCQkJb2xkVmFsdWUgPSBpbmRleCA9PSAtMT8gdW5kZWZpbmVkIDogdGhpcy5fX3NoaW5lLnZhbHVlc1tpbmRleF07DQoJCQkJaWYgKG9sZFZhbHVlID09PSB1bmRlZmluZWQpIHNoaW5lLmdjLmluY3JSZWYoa2V5KTsNCgkJfQ0KDQoJCWlmIChvbGRWYWx1ZSA9PT0gdW5kZWZpbmVkICYmIG10ICYmIG10Ll9fbmV3aW5kZXgpIHsNCgkJCXN3aXRjaCAobXQuX19uZXdpbmRleC5jb25zdHJ1Y3Rvcikgew0KCQkJCWNhc2Ugc2hpbmUuVGFibGU6IHJldHVybiBtdC5fX25ld2luZGV4LnNldE1lbWJlcihrZXksIHZhbHVlKTsNCgkJCQljYXNlIEZ1bmN0aW9uOiByZXR1cm4gbXQuX19uZXdpbmRleCh0aGlzLCBrZXksIHZhbHVlKTsNCgkJCQljYXNlIHNoaW5lLkZ1bmN0aW9uOiByZXR1cm4gbXQuX19uZXdpbmRleC5hcHBseSh0aGlzLCBbdGhpcywga2V5LCB2YWx1ZV0pWzBdOw0KCQkJfQ0KCQl9DQoNCgkJc3dpdGNoICh0eXApIHsNCgkJCWNhc2UgJ3N0cmluZyc6DQoJCQkJdGhpc1trZXldID0gdmFsdWU7DQoJCQkJYnJlYWs7DQoNCgkJCWNhc2UgJ251bWJlcic6DQoJCQkJaWYgKHBvc2l0aXZlSW50ZWdlcktleSkgew0KCQkJCQl0aGlzLl9fc2hpbmUubnVtVmFsdWVzW2tleV0gPSB2YWx1ZTsNCgkJCQkJYnJlYWs7DQoJCQkJfQ0KDQoJCQlkZWZhdWx0Og0KCQkJCWlmIChpbmRleCA8IDApIHsNCgkJCQkJaW5kZXggPSBrZXlzLmxlbmd0aDsNCgkJCQkJa2V5c1tpbmRleF0gPSBrZXk7DQoJCQkJfQ0KCQkJCQ0KCQkJCXRoaXMuX19zaGluZS52YWx1ZXNbaW5kZXhdID0gdmFsdWU7DQoJCX0NCg0KCQlzaGluZS5nYy5pbmNyUmVmKHZhbHVlKTsNCgkJc2hpbmUuZ2MuZGVjclJlZihvbGRWYWx1ZSk7DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIFJldHVybnMgYSB1bmlxdWUgaWRlbnRpZmllciBmb3IgdGhlIHRhYmxlLg0KCSAqIEByZXR1cm5zIHtzdHJpbmd9IERlc2NyaXB0aW9uLg0KCSAqLw0KCXNoaW5lLlRhYmxlLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsNCgkJdmFyIG10Ow0KCQkNCgkJaWYgKHRoaXMuY29uc3RydWN0b3IgIT0gc2hpbmUuVGFibGUpIHJldHVybiAndXNlcmRhdGEnOw0KCQlpZiAodGhpcy5fX3NoaW5lICYmIChtdCA9IHRoaXMuX19zaGluZS5tZXRhdGFibGUpICYmIG10Ll9fdG9zdHJpbmcpIHJldHVybiBtdC5fX3Rvc3RyaW5nLmNhbGwodW5kZWZpbmVkLCB0aGlzKVswXTsNCg0KCQlyZXR1cm4gJ3RhYmxlOiAweCcgKyB0aGlzLl9fc2hpbmUuaW5kZXgudG9TdHJpbmcoMTYpOw0KCX07DQoNCgkvKioNCgkgKiBSZXByZXNlbnRzIGEgcmVnaXN0ZXIuDQoJICogQGNvbnN0cnVjdG9yDQoJICovDQoJc2hpbmUuUmVnaXN0ZXIgPSBmdW5jdGlvbiAoKSB7DQoJCXRoaXMuX2l0ZW1zID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgl9Ow0KDQoNCgkvKioNCgkgKiBBcnJheSBvZiBkaXNwb3NlZCByZWdpc3RlcnMsIHJlYWR5IHRvIGJlIHJldXNlZC4NCgkgKiBAdHlwZSBBcnJheQ0KCSAqIEBzdGF0aWMNCgkgKi8NCglzaGluZS5SZWdpc3Rlci5fZ3JhdmV5YXJkID0gW107DQoNCg0KDQoNCgkvKioNCgkgKiBSZXR1cm5zIGEgbmV3LCBlbXB0eSByZWdpc3Rlci4NCgkgKiBAcmV0dXJucyB7c2hpbmUuUmVnaXN0ZXJ9IEFuIGVtcHR5IHJlZ2lzdGVyDQoJICovDQoJc2hpbmUuUmVnaXN0ZXIuY3JlYXRlID0gZnVuY3Rpb24gKCkgew0KCQl2YXIgbyA9IHNoaW5lLlJlZ2lzdGVyLl9ncmF2ZXlhcmQucG9wKCk7DQoJCXJldHVybiBvIHx8IG5ldyBzaGluZS5SZWdpc3Rlcihhcmd1bWVudHMpOw0KCX07DQoNCg0KDQoNCgkvKioNCgkgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgaXRlbXMgaW4gdGhlIHJlZ2lzdGVyLg0KCSAqIEByZXR1cm5zIHtOdW1iZXJ9IE51bWJlciBvZiBpdGVtcy4NCgkgKi8NCglzaGluZS5SZWdpc3Rlci5wcm90b3R5cGUuZ2V0TGVuZ3RoID0gZnVuY3Rpb24gKCkgew0KCQlyZXR1cm4gdGhpcy5faXRlbXMubGVuZ3RoOw0KCX07DQoNCg0KDQoNCgkvKioNCgkgKiBSZXRyaWV2ZXMgYW4gaXRlbSBmcm9tIHRoZSByZWdpc3Rlci4NCgkgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggSW5kZXggb2YgdGhlIGl0ZW0uDQoJICogQHJldHVybnMge09iamVjdH0gVmFsdWUgb2YgdGhlIGl0ZW0uDQoJICovDQoJc2hpbmUuUmVnaXN0ZXIucHJvdG90eXBlLmdldEl0ZW0gPSBmdW5jdGlvbiAoaW5kZXgpIHsNCgkJcmV0dXJuIHRoaXMuX2l0ZW1zW2luZGV4XTsNCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogU2V0cyB0aGUgdmFsdWUgYW4gaXRlbSBpbiB0aGUgcmVnaXN0ZXIuDQoJICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4IEluZGV4IG9mIHRoZSBpdGVtLg0KCSAqIEBwYXJhbSB7T2JqZWN0fSB2YWx1ZSBWYWx1ZSBvZiB0aGUgaXRlbS4NCgkgKi8NCglzaGluZS5SZWdpc3Rlci5wcm90b3R5cGUuc2V0SXRlbSA9IGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsNCgkJdmFyIGl0ZW0gPSB0aGlzLl9pdGVtc1tpbmRleF07DQoNCgkJc2hpbmUuZ2MuaW5jclJlZih2YWx1ZSk7DQoJCXNoaW5lLmdjLmRlY3JSZWYoaXRlbSk7DQoNCgkJdGhpcy5faXRlbXNbaW5kZXhdID0gdmFsdWU7DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIFJld3JpdGVzIHRoZSB2YWx1ZXMgb2YgYWxsIHRoZSBpdGVtcyBpbiB0aGUgcmVnaXN0ZXIuDQoJICogQHBhcmFtIHtBcnJheX0gYXJyIFRoZSBlbnRpcmUgcmVnaXN0ZXIuDQoJICovDQoJc2hpbmUuUmVnaXN0ZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChhcnIpIHsNCgkJdmFyIGksIA0KCQkJbCA9IE1hdGgubWF4KGFyci5sZW5ndGgsIHRoaXMuX2l0ZW1zLmxlbmd0aCk7DQoNCgkJZm9yIChpID0gMDsgaSA8IGw7IGkrKykgdGhpcy5zZXRJdGVtKGksIGFycltpXSk7DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIEluc2VydHMgbmV3IGl0ZW1zIGF0IHRoZSBlbmQgb2YgdGhlIHJlZ2lzdGVyLg0KCSAqIEBwYXJhbSB7Li4uT2JqZWN0fSBPbmUgb3IgbW9yZSBpdGVtcyB0byBiZSBpbnNlcnRlZC4NCgkgKi8NCglzaGluZS5SZWdpc3Rlci5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uICgpIHsNCgkJdGhpcy5faXRlbXMucHVzaC5hcHBseSh0aGlzLl9pdGVtcywgYXJndW1lbnRzKTsNCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogUmVtb3ZlcyBhbiBpdGVtIGZyb20gdGhlIHJlZ2lzdGVyLg0KCSAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCBJbmRleCBvZiB0aGUgaXRlbSB0byByZW1vdmUuDQoJICovDQoJc2hpbmUuUmVnaXN0ZXIucHJvdG90eXBlLmNsZWFySXRlbSA9IGZ1bmN0aW9uIChpbmRleCkgew0KCQlkZWxldGUgdGhpcy5faXRlbXNbaW5kZXhdOw0KCX07DQoNCg0KDQoNCgkvKioNCgkgKiBTcGxpY2VzIHRoZSByZWdpc3Rlci4NCgkgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggSW5kZXggb2YgdGhlIGZpcnN0IGl0ZW0gdG8gcmVtb3ZlLg0KCSAqIEBwYXJhbSB7TnVtYmVyfSBsZW5ndGggTnVtYmVyIG9mIGl0ZW1zIHRvIHJlbW92ZS4NCgkgKiBAcGFyYW0gey4uLk9iamVjdH0gT25lIG9yIG1vcmUgaXRlbXMgdG8gYmUgaW5zZXJ0ZWQuDQoJICovDQoJc2hpbmUuUmVnaXN0ZXIucHJvdG90eXBlLnNwbGljZSA9IGZ1bmN0aW9uIChpbmRleCwgbGVuZ3RoKSB7DQoJCXRoaXMuX2l0ZW1zLnNwbGljZS5hcHBseSh0aGlzLl9pdGVtcywgYXJndW1lbnRzKTsNCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogRW1wdGllcyB0aGUgcmVnaXN0ZXIuDQoJICovDQoJc2hpbmUuUmVnaXN0ZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgew0KCQlmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMuX2l0ZW1zLmxlbmd0aDsgaSA8IGw7IGkrKykgc2hpbmUuZ2MuZGVjclJlZih0aGlzLl9pdGVtc1tpXSk7DQoJCXRoaXMuX2l0ZW1zLmxlbmd0aCA9IDA7DQoJfTsNCg0KDQoNCg0KCS8qKg0KCSAqIENsZWFucyB1cCB0aGUgcmVnaXN0ZXIgYW5kIGNhY2hlcyBpdCBmb3IgcmV1c2UuDQoJICovDQoJc2hpbmUuUmVnaXN0ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7DQoJCXRoaXMuX2l0ZW1zLnJlc2V0KCk7DQoJCXRoaXMuY29uc3RydWN0b3IuX2dyYXZleWFyZC5wdXNoKHRoaXMpOw0KCX07DQoNCgkvLyBTdGFuZGFyZCBvdXRwdXQNCglzaGluZS5zdGRvdXQgPSB7fTsNCg0KCXNoaW5lLnN0ZG91dC53cml0ZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7DQoJCS8vIE92ZXJ3cml0ZSB0aGlzIGluIGhvc3QgYXBwbGljYXRpb24NCgkJaWYgKGNvbnNvbGUgJiYgY29uc29sZS5sb2cpIHsNCgkJCWNvbnNvbGUubG9nKG1lc3NhZ2UpOw0KCQl9IGVsc2UgaWYgKHRyYWNlKSB7DQoJCQl0cmFjZShtZXNzYWdlKTsNCgkJfQ0KCX07DQoNCg0KDQoNCgkvLyBTdGFuZGFyZCBkZWJ1ZyBvdXRwdXQNCglzaGluZS5zdGRkZWJ1ZyA9IHt9Ow0KDQoJc2hpbmUuc3RkZGVidWcud3JpdGUgPSBmdW5jdGlvbiAobWVzc2FnZSkgew0KCQkvLyBNb29uc2hpbmUgYnl0ZWNvZGUgZGVidWdnaW5nIG91dHB1dA0KCX07DQoNCg0KDQoNCgkvLyBTdGFuZGFyZCBlcnJvciBvdXRwdXQNCglzaGluZS5zdGRlcnIgPSB7fTsNCg0KCXNoaW5lLnN0ZGVyci53cml0ZSA9IGZ1bmN0aW9uIChtZXNzYWdlLCBsZXZlbCkgew0KCQlsZXZlbCA9IGxldmVsIHx8ICdlcnJvcic7DQoJCWlmIChjb25zb2xlICYmIGNvbnNvbGVbbGV2ZWxdKSBjb25zb2xlW2xldmVsXShtZXNzYWdlKTsNCgl9Ow0KDQovKg0KCSoqIE5vdGVzOiANCgkxLiBBIHNoaW5lLkNsb3N1cmUgaW5zdGFuY2UgaXMgcGFzc2VkIGluIGFzIHRoZSBjb250ZXh0IGZvciB0aGUgb3BlcmF0aW9uIGhhbmRsZXJzLg0KCTIuIFRoZSBtYWluIG9wZXJhdGlvbiBmdW5jdGlvbnMgYXJlIHRoZSBlbnRyeSBwb2ludCBmb3IgdGhlIGludGVycHJldG9yLg0KCTMuIFRoZSBpbnRlcm5hbCBmdW5jdGlvbnMgYXJlIHVzZWQgYnkgdGhlIEpJVCBjb21waWxlciB3aGVyZSB0aGUgbWFpbiBmdW5jdGlvbnMgdXNlIHJlZ2lzdGVycy4NCiovDQoJc2hpbmUub3BlcmF0aW9ucyA9IHt9Ow0KCQ0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KCSogIE9wZXJhdGlvbnMNCgkqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIG1vdmUNCg0KCWZ1bmN0aW9uIG1vdmUgKGEsIGIpIHsNCgkJdmFyIHZhbCA9IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYiksDQoJCQlsb2NhbCwNCgkJCWk7DQoNCgkJdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShhLCB2YWwpOw0KDQoJCWlmICh0aGlzLl9kYXRhLmxvY2FscyAmJiB2YWwgJiYgdmFsIGluc3RhbmNlb2Ygc2hpbmUuRnVuY3Rpb24pIHsNCgkJCWZvciAoaSA9IHRoaXMuX2RhdGEubG9jYWxzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7DQoJCQkJbG9jYWwgPSB0aGlzLl9kYXRhLmxvY2Fsc1tpXTsNCgkJCQlpZiAobG9jYWwuc3RhcnRwYyA9PSB0aGlzLl9wYyAtIDEpIHRoaXMuX2xvY2FsRnVuY3Rpb25zW2xvY2FsLnZhcm5hbWVdID0gdmFsOw0KCQkJfQ0KCQl9DQoJfQ0KDQoJCQkNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCgkvLyBsb2Fkaw0KDQoJZnVuY3Rpb24gbG9hZGsgKGEsIGJ4KSB7DQoJCXRoaXMuX3JlZ2lzdGVyLnNldEl0ZW0oYSwgdGhpcy5nZXRDb25zdGFudChieCkpOw0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gbG9hZGJvb2wNCg0KCWZ1bmN0aW9uIGxvYWRib29sIChhLCBiLCBjKSB7DQoJCXRoaXMuX3JlZ2lzdGVyLnNldEl0ZW0oYSwgISFiKTsNCgkJaWYgKGMpIHRoaXMuX3BjKys7DQoJfQ0KCQkNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIGxvYWRuaWwNCg0KCWZ1bmN0aW9uIGxvYWRuaWwgKGEsIGIpIHsNCgkJZm9yICh2YXIgaSA9IGE7IGkgPD0gYjsgaSsrKSB0aGlzLl9yZWdpc3Rlci5zZXRJdGVtKGksIHVuZGVmaW5lZCk7DQoJfQ0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCgkvLyBnZXR1cHZhbA0KDQoJZnVuY3Rpb24gZ2V0dXB2YWwgKGEsIGIpIHsNCgkJLy8gaWYgKHRoaXMuX3VwdmFsdWVzW2JdID09PSB1bmRlZmluZWQpIHJldHVybjsNCgkJdmFyIHZhbHVlID0gKHRoaXMuX3VwdmFsdWVzW2JdID09PSB1bmRlZmluZWQpPyB1bmRlZmluZWQgOiB0aGlzLl91cHZhbHVlc1tiXS5nZXRWYWx1ZSgpOw0KCQl0aGlzLl9yZWdpc3Rlci5zZXRJdGVtKGEsIHZhbHVlKTsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIGdldGdsb2JhbA0KDQoJZnVuY3Rpb24gZ2V0Z2xvYmFsIChhLCBiKSB7DQoJCWIgPSB0aGlzLmdldENvbnN0YW50KGIpOw0KCQl0aGlzLl9yZWdpc3Rlci5zZXRJdGVtKGEsIGdldGdsb2JhbF9pbnRlcm5hbC5jYWxsKHRoaXMsIGIpKTsNCgl9DQoNCgkJDQoNCg0KCWZ1bmN0aW9uIGdldGdsb2JhbF9pbnRlcm5hbCAoa2V5KSB7DQoJCXJldHVybiAoa2V5ID09ICdfRycpPyB0aGlzLl9nbG9iYWxzIDogdGhpcy5fZ2xvYmFsc1trZXldOw0KCX0NCg0KCQkNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCgkvLyBnZXR0YWJsZQ0KDQoJZnVuY3Rpb24gZ2V0dGFibGUgKGEsIGIsIGMpIHsNCgkJYiA9IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYik7DQoJCWMgPSAoYyA+PSAyNTYpPyB0aGlzLmdldENvbnN0YW50KGMgLSAyNTYpIDogdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShjKTsNCg0KCQl0aGlzLl9yZWdpc3Rlci5zZXRJdGVtKGEsIGdldHRhYmxlX2ludGVybmFsLmNhbGwodGhpcywgYiwgYykpOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIGdldHRhYmxlX2ludGVybmFsIChiLCBjKSB7DQoJCXZhciByZXN1bHQsDQoJCQlsb2NhbCwNCgkJCWk7DQoNCgkJaWYgKGIgPT09IHVuZGVmaW5lZCkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdBdHRlbXB0IHRvIGluZGV4IGEgbmlsIHZhbHVlICgnICsgYyArICcgbm90IHByZXNlbnQgaW4gbmlsKScpOw0KDQoJCWlmIChiIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUpIHsNCgkJCXJlc3VsdCA9IGIuZ2V0TWVtYmVyKGMpOw0KDQoJCX0gZWxzZSBpZiAodHlwZW9mIGIgPT0gJ3N0cmluZycgJiYgc2hpbmUubGliLnN0cmluZ1tjXSkgew0KCQkJcmVzdWx0ID0gc2hpbmUubGliLnN0cmluZ1tjXTsNCg0KCQl9IGVsc2Ugew0KCQkJcmVzdWx0ID0gYltjXTsNCgkJfQ0KDQoJCWlmICh0aGlzICYmIHRoaXMuX2xvY2FsRnVuY3Rpb25zICYmIHJlc3VsdCAmJiByZXN1bHQgaW5zdGFuY2VvZiBzaGluZS5GdW5jdGlvbikgdGhpcy5fbG9jYWxGdW5jdGlvbnNbY10gPSByZXN1bHQ7DQoNCgkJcmV0dXJuIHJlc3VsdDsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIHNldGdsb2JhbA0KDQoJZnVuY3Rpb24gc2V0Z2xvYmFsKGEsIGIpIHsNCgkJdmFyIGtleSA9IHRoaXMuZ2V0Q29uc3RhbnQoYiksDQoJCQl2YWx1ZSA9IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYSk7DQoNCgkJc2V0Z2xvYmFsX2ludGVybmFsLmNhbGwodGhpcywga2V5LCB2YWx1ZSk7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gc2V0Z2xvYmFsX2ludGVybmFsKGtleSwgdmFsdWUpIHsNCgkJdmFyIG9sZFZhbHVlID0gdGhpcy5fZ2xvYmFsc1trZXldOw0KDQoJCXNoaW5lLmdjLmluY3JSZWYodmFsdWUpOw0KCQlzaGluZS5nYy5kZWNyUmVmKG9sZFZhbHVlKTsNCg0KCQl0aGlzLl9nbG9iYWxzW2tleV0gPSB2YWx1ZTsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIHNldHVwdmFsDQoNCglmdW5jdGlvbiBzZXR1cHZhbCAoYSwgYikgew0KCQl0aGlzLl91cHZhbHVlc1tiXS5zZXRWYWx1ZSh0aGlzLl9yZWdpc3Rlci5nZXRJdGVtKGEpKTsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIHNldHRhYmxlDQoNCglmdW5jdGlvbiBzZXR0YWJsZSAoYSwgYiwgYykgew0KCQlhID0gdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShhKTsNCgkJYiA9IChiID49IDI1Nik/IHRoaXMuZ2V0Q29uc3RhbnQoYiAtIDI1NikgOiB0aGlzLl9yZWdpc3Rlci5nZXRJdGVtKGIpOw0KCQljID0gKGMgPj0gMjU2KT8gdGhpcy5nZXRDb25zdGFudChjIC0gMjU2KSA6IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYyk7DQoNCgkJc2V0dGFibGVfaW50ZXJuYWwuY2FsbCh0aGlzLCBhLCBiLCBjKTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiBzZXR0YWJsZV9pbnRlcm5hbCAoYSwgYiwgYykgew0KCQlpZiAoYSA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ0F0dGVtcHQgdG8gaW5kZXggYSBtaXNzaW5nIGZpZWxkIChjYW5cJ3Qgc2V0ICInICsgYiArICciIG9uIGEgbmlsIHZhbHVlKScpOw0KDQoJCWlmIChhIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUpIHsNCgkJCWEuc2V0TWVtYmVyKGIsIGMpOwkJDQoNCgkJfSBlbHNlIHsNCgkJCWFbYl0gPSBjOw0KCQl9DQoJfQ0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCgkvLyBuZXd0YWJsZQ0KDQoJZnVuY3Rpb24gbmV3dGFibGUgKGEsIGIsIGMpIHsNCgkJdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShhLCBuZXd0YWJsZV9pbnRlcm5hbCgpKTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiBuZXd0YWJsZV9pbnRlcm5hbCAoKSB7DQoJCXZhciB0ID0gbmV3IHNoaW5lLlRhYmxlKCk7DQoJCXQuX19zaGluZS5yZWZDb3VudCA9IDA7DQoJCXJldHVybiB0Ow0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gc2VsZg0KDQoJZnVuY3Rpb24gc2VsZiAoYSwgYiwgYykgew0KCQliID0gdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShiKTsNCgkJYyA9IChjID49IDI1Nik/IHRoaXMuZ2V0Q29uc3RhbnQoYyAtIDI1NikgOiB0aGlzLl9yZWdpc3Rlci5nZXRJdGVtKGMpOw0KDQoJCXRoaXMuX3JlZ2lzdGVyLnNldEl0ZW0oYSArIDEsIGIpOw0KCQl0aGlzLl9yZWdpc3Rlci5zZXRJdGVtKGEsIHNlbGZfaW50ZXJuYWwoYiwgYykpOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHNlbGZfaW50ZXJuYWwgKGIsIGMpIHsNCgkJaWYgKGIgPT09IHVuZGVmaW5lZCkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdBdHRlbXB0IHRvIGluZGV4IGEgbmlsIHZhbHVlICgnICsgYyArICcgbm90IHByZXNlbnQgaW4gbmlsKScpOw0KCQlpZiAoYiBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlKSByZXR1cm4gYi5nZXRNZW1iZXIoYyk7DQoJCWlmICh0eXBlb2YgYiA9PSAnc3RyaW5nJyAmJiBzaGluZS5saWIuc3RyaW5nW2NdKSByZXR1cm4gc2hpbmUubGliLnN0cmluZ1tjXTsNCg0KCQlyZXR1cm4gYltjXTsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIGFkZCwgc3ViLCBtdWwsIGRpdiwgbW9kLCBwb3cNCg0KCWZ1bmN0aW9uIGJpbmFyeV9hcml0aG1ldGljIChhLCBiLCBjLCBtbSwgZikgew0KCQliID0gKGIgPj0gMjU2KT8gdGhpcy5nZXRDb25zdGFudChiIC0gMjU2KSA6IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYik7DQoJCWMgPSAoYyA+PSAyNTYpPyB0aGlzLmdldENvbnN0YW50KGMgLSAyNTYpIDogdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShjKTsNCg0KCQl2YXIgcmVzdWx0ID0gYmluYXJ5X2FyaXRobWV0aWNfaW50ZXJuYWwuY2FsbCh0aGlzLCBiLCBjLCBtbSwgZik7DQoJCXRoaXMuX3JlZ2lzdGVyLnNldEl0ZW0oYSwgcmVzdWx0KTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiBiaW5hcnlfYXJpdGhtZXRpY19pbnRlcm5hbCAoYiwgYywgbW0sIGYpIHsNCgkJdmFyIGNvZXJjZVRvTnVtYmVyID0gc2hpbmUudXRpbHMuY29lcmNlVG9OdW1iZXIsDQoJCQltdCwgZjsNCg0KCQlpZiAoKGIgJiYgYiBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlICYmIChtdCA9IGIuX19zaGluZS5tZXRhdGFibGUpICYmIChmID0gbXQuZ2V0TWVtYmVyKG1tKSkpDQoJCXx8IChjICYmIGMgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSAmJiAobXQgPSBjLl9fc2hpbmUubWV0YXRhYmxlKSAmJiAoZiA9IG10LmdldE1lbWJlcihtbSkpKSkgew0KCQkJcmV0dXJuIGYuYXBwbHkobnVsbCwgW2IsIGNdLCB0cnVlKVswXTsNCgkJfSANCg0KCQlpZiAodHlwZW9mIGIgIT0gJ251bWJlcicpIGIgPSBjb2VyY2VUb051bWJlcihiLCAnYXR0ZW1wdCB0byBwZXJmb3JtIGFyaXRobWV0aWMgb24gYSAldHlwZSB2YWx1ZScpOw0KCQlpZiAodHlwZW9mIGMgIT0gJ251bWJlcicpIGMgPSBjb2VyY2VUb051bWJlcihjLCAnYXR0ZW1wdCB0byBwZXJmb3JtIGFyaXRobWV0aWMgb24gYSAldHlwZSB2YWx1ZScpOw0KDQoJCXJldHVybiBmKGIsIGMpOw0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKi8NCgkvLyBhZGQNCg0KCWZ1bmN0aW9uIGFkZCAoYSwgYiwgYykgew0KCQliaW5hcnlfYXJpdGhtZXRpYy5jYWxsKHRoaXMsIGEsIGIsIGMsICdfX2FkZCcsIGFkZF9pbnRlcm5hbCk7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gYWRkX2ludGVybmFsICh4LCB5KSB7DQoJCXJldHVybiB4ICsgeTsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKiovDQoJLy8gc3ViDQoNCglmdW5jdGlvbiBzdWIgKGEsIGIsIGMpIHsNCgkJYmluYXJ5X2FyaXRobWV0aWMuY2FsbCh0aGlzLCBhLCBiLCBjLCAnX19zdWInLCBzdWJfaW50ZXJuYWwpOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHN1Yl9pbnRlcm5hbCAoeCwgeSkgew0KCQlyZXR1cm4geCAtIHk7DQoJfQ0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqLw0KCS8vIG11bA0KDQoJZnVuY3Rpb24gbXVsIChhLCBiLCBjKSB7DQoJCWJpbmFyeV9hcml0aG1ldGljLmNhbGwodGhpcywgYSwgYiwgYywgJ19fbXVsJywgbXVsX2ludGVybmFsKTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiBtdWxfaW50ZXJuYWwgKHgsIHkpIHsNCgkJcmV0dXJuIHggKiB5Ow0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKi8NCgkvLyBkaXYNCg0KCWZ1bmN0aW9uIGRpdiAoYSwgYiwgYykgew0KCQliaW5hcnlfYXJpdGhtZXRpYy5jYWxsKHRoaXMsIGEsIGIsIGMsICdfX2RpdicsIGRpdl9pbnRlcm5hbCk7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gZGl2X2ludGVybmFsICh4LCB5KSB7DQoJCWlmICh5ID09PSB1bmRlZmluZWQpIHRocm93IG5ldyBzaGluZS5FcnJvcignYXR0ZW1wdCB0byBwZXJmb3JtIGFyaXRobWV0aWMgb24gYSBuaWwgdmFsdWUnKTsNCgkJcmV0dXJuIHggLyB5Ow0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKi8NCgkvLyBtb2QNCg0KCWZ1bmN0aW9uIG1vZCAoYSwgYiwgYykgew0KCQliaW5hcnlfYXJpdGhtZXRpYy5jYWxsKHRoaXMsIGEsIGIsIGMsICdfX21vZCcsIG1vZF9pbnRlcm5hbCk7DQoJfQ0KDQoNCg0KCWZ1bmN0aW9uIG1vZF9pbnRlcm5hbCAoYiwgYykgew0KCQl2YXIgcmVzdWx0LCBhYnNDOw0KDQoJCWlmIChjID09PSAwIHx8IGMgPT09IC1JbmZpbml0eSB8fCBjID09PSBJbmZpbml0eSB8fCB3aW5kb3cuaXNOYU4oYikgfHwgd2luZG93LmlzTmFOKGMpKSByZXR1cm4gTmFOOw0KDQoJCXJlc3VsdCA9IE1hdGguYWJzKGIpICUgKGFic0MgPSBNYXRoLmFicyhjKSk7DQoJCWlmIChiICogYyA8IDApIHJlc3VsdCA9IGFic0MgLSByZXN1bHQ7DQoJCWlmIChjIDwgMCkgcmVzdWx0ICo9IC0xOw0KDQoJCXJldHVybiByZXN1bHQ7DQoJfQ0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqLw0KCS8vIHBvdw0KDQoJZnVuY3Rpb24gcG93IChhLCBiLCBjKSB7DQoJCWJpbmFyeV9hcml0aG1ldGljLmNhbGwodGhpcywgYSwgYiwgYywgJ19fcG93JywgTWF0aC5wb3cpOw0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gdW5tDQoNCglmdW5jdGlvbiB1bm0gKGEsIGIpIHsNCgkJYiA9IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYik7DQoJCXRoaXMuX3JlZ2lzdGVyLnNldEl0ZW0oYSwgdW5tX2ludGVybmFsKGIpKTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB1bm1faW50ZXJuYWwgKGIpIHsNCgkJdmFyIG10LCBmLCByZXN1bHQ7DQoNCgkJaWYgKGIgJiYgYiBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlICYmIChtdCA9IGIuX19zaGluZS5tZXRhdGFibGUpICYmIChmID0gbXQuZ2V0TWVtYmVyKCdfX3VubScpKSkgew0KCQkJcmVzdWx0ID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgkJCXJlc3VsdC5wdXNoKGIpOw0KCQkJcmV0dXJuIGYuYXBwbHkobnVsbCwgcmVzdWx0LCB0cnVlKVswXTsNCgkJfQ0KDQoJCWlmICh0eXBlb2YgYiAhPSAnbnVtYmVyJykgYiA9IHNoaW5lLnV0aWxzLmNvZXJjZVRvTnVtYmVyKGIsICdhdHRlbXB0IHRvIHBlcmZvcm0gYXJpdGhtZXRpYyBvbiBhICV0eXBlIHZhbHVlJyk7DQoJCXJldHVybiAtYjsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIG5vdA0KDQoJZnVuY3Rpb24gbm90IChhLCBiKSB7DQoJCXRoaXMuX3JlZ2lzdGVyLnNldEl0ZW0oYSwgIXRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYikpOw0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gbGVuDQoNCglmdW5jdGlvbiBsZW4gKGEsIGIpIHsNCgkJYiA9IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYik7DQoJCXRoaXMuX3JlZ2lzdGVyLnNldEl0ZW0oYSwgbGVuX2ludGVybmFsKGIpKTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiBsZW5faW50ZXJuYWwgKGIpIHsNCgkJdmFyIGxlbmd0aCwNCgkJCWk7DQoNCgkJaWYgKGIgPT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ2F0dGVtcHQgdG8gZ2V0IGxlbmd0aCBvZiBhIG5pbCB2YWx1ZScpOw0KCQlpZiAoYiBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlKSByZXR1cm4gc2hpbmUubGliLnRhYmxlLmdldG4oYik7DQoJCQ0KCQlpZiAodHlwZW9mIGIgPT0gJ29iamVjdCcpIHsNCgkJCWxlbmd0aCA9IDA7DQoJCQlmb3IgKGkgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkoaSkpIGxlbmd0aCsrOw0KCQkJcmV0dXJuIGxlbmd0aDsNCgkJfSANCg0KCQlyZXR1cm4gYi5sZW5ndGg7DQoJfQ0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCgkvLyBjb25jYXQNCg0KCWZ1bmN0aW9uIGNvbmNhdCAoYSwgYiwgYykgew0KCQl2YXIgdGV4dCA9IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYyksDQoJCQlpdGVtcyA9IFtdLA0KCQkJaTsNCg0KCQlmb3IgKGkgPSBjIC0gMTsgaSA+PSBiOyBpLS0pIHsNCgkJCWl0ZW1zLnB1c2godGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShpKSk7DQoJCX0NCg0KCQl0aGlzLl9yZWdpc3Rlci5zZXRJdGVtKGEsIGNvbmNhdF9pbnRlcm5hbCh0ZXh0LCBpdGVtcykpOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIGNvbmNhdF9pbnRlcm5hbCAodGV4dCwgYWRkaXRpb25zKSB7DQoJCXZhciB0ZXh0TWV0YVRhYmxlID0gdGV4dCAmJiB0ZXh0IGluc3RhbmNlb2Ygc2hpbmUuVGFibGUgJiYgKG10ID0gdGV4dC5fX3NoaW5lLm1ldGF0YWJsZSkgJiYgKGYgPSBtdC5nZXRNZW1iZXIoJ19fY29uY2F0JykpLA0KCQkJY29lcmNlVG9TdHJpbmcgPSBzaGluZS51dGlscy5jb2VyY2VUb1N0cmluZywNCgkJCWl0ZW0sIGksIGwsIG10LCBmLCBhcmdzOw0KDQoJCWZvciAoaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7DQoJCQlpdGVtID0gYWRkaXRpb25zW2ldOw0KDQoJCQlpZiAoKGl0ZW0gIT09IHVuZGVmaW5lZCAmJiBpdGVtIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUgJiYgKG10ID0gaXRlbS5fX3NoaW5lLm1ldGF0YWJsZSkgJiYgKGYgPSBtdC5nZXRNZW1iZXIoJ19fY29uY2F0JykpKQ0KCQkJfHwgKGYgPSB0ZXh0TWV0YVRhYmxlKSkgew0KCQkJCWFyZ3MgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpOw0KCQkJCWFyZ3MucHVzaChpdGVtLCB0ZXh0KTsNCg0KCQkJCXRleHQgPSBmLmFwcGx5KG51bGwsIGFyZ3MsIHRydWUpWzBdOw0KDQoJCQl9IGVsc2Ugew0KCQkJCXRleHQgPSBjb2VyY2VUb1N0cmluZyh0ZXh0LCAnYXR0ZW1wdCB0byBjb25jYXRlbmF0ZSBhICV0eXBlIHZhbHVlJyk7DQoJCQkJaXRlbSA9IGNvZXJjZVRvU3RyaW5nKGl0ZW0sICdhdHRlbXB0IHRvIGNvbmNhdGVuYXRlIGEgJXR5cGUgdmFsdWUnKTsNCgkJCQl0ZXh0ID0gaXRlbSArIHRleHQ7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gdGV4dDsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIGptcA0KDQoJZnVuY3Rpb24gam1wIChhLCBzYngpIHsNCgkJdGhpcy5fcGMgKz0gc2J4Ow0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gZXENCg0KCWZ1bmN0aW9uIGVxIChhLCBiLCBjKSB7DQoJCWIgPSAoYiA+PSAyNTYpPyB0aGlzLmdldENvbnN0YW50KGIgLSAyNTYpIDogdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShiKTsNCgkJYyA9IChjID49IDI1Nik/IHRoaXMuZ2V0Q29uc3RhbnQoYyAtIDI1NikgOiB0aGlzLl9yZWdpc3Rlci5nZXRJdGVtKGMpOw0KCQkNCgkJaWYgKGVxX2ludGVybmFsKGIsIGMpICE9IGEpIHRoaXMuX3BjKys7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gZXFfaW50ZXJuYWwgKGIsIGMpIHsNCgkJdmFyIG10YiwgbXRjLCBmLCByZXN1bHQ7DQoNCgkJaWYgKGIgIT09IGMgJiYgYiAmJiBiIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUgJiYgKGMgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlICYmIChtdGIgPSBiLl9fc2hpbmUubWV0YXRhYmxlKSAmJiAobXRjID0gYy5fX3NoaW5lLm1ldGF0YWJsZSkgJiYgbXRiID09PSBtdGMgJiYgKGYgPSBtdGIuZ2V0TWVtYmVyKCdfX2VxJykpKSB7DQoJCQlyZXN1bHQgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpOw0KCQkJcmVzdWx0LnB1c2goYiwgYyk7DQoJCQlyZXR1cm4gISFmLmFwcGx5KG51bGwsIHJlc3VsdCwgdHJ1ZSlbMF07DQoJCX0NCg0KCQlyZXR1cm4gKGIgPT09IGMpOw0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gbHQsIGxlDQoNCglmdW5jdGlvbiBjb21wYXJlIChhLCBiLCBjLCBtbSwgZikgew0KCQliID0gKGIgPj0gMjU2KT8gdGhpcy5nZXRDb25zdGFudChiIC0gMjU2KSA6IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYik7DQoJCWMgPSAoYyA+PSAyNTYpPyB0aGlzLmdldENvbnN0YW50KGMgLSAyNTYpIDogdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShjKTsNCg0KCQlpZiAoY29tcGFyZV9pbnRlcm5hbChiLCBjLCBtbSwgZikgIT0gYSkgdGhpcy5fcGMrKzsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiBjb21wYXJlX2ludGVybmFsIChiLCBjLCBtbSwgY29tcGFyZSkgew0KCQl2YXIgdHlwZUIgPSAodHlwZW9mIGIgIT0gJ29iamVjdCcgJiYgdHlwZW9mIGIpIHx8IChiIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUgJiYgJ3RhYmxlJykgfHwgJ3VzZXJkYXRhJywNCgkJCXR5cGVDID0gKHR5cGVvZiBjICE9ICdvYmplY3QnICYmIHR5cGVvZiBjKSB8fCAoYyBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlICYmICd0YWJsZScpIHx8ICd1c2VyZGF0YScsDQoJCQlmLCByZXN1bHQsIG10YiwgbXRjOw0KDQoJCWlmICh0eXBlQiAhPT0gdHlwZUMpIHsNCgkJCXRocm93IG5ldyBzaGluZS5FcnJvciAoJ2F0dGVtcHQgdG8gY29tcGFyZSAnICsgdHlwZUIgKyAnIHdpdGggJyArIHR5cGVDKTsNCgkJCQ0KCQl9IGVsc2UgaWYgKHR5cGVCID09ICd0YWJsZScpIHsNCgkJCWlmICgobXRiID0gYi5fX3NoaW5lLm1ldGF0YWJsZSkgJiYgKG10YyA9IGMuX19zaGluZS5tZXRhdGFibGUpICYmIG10YiA9PT0gbXRjICYmIChmID0gbXRiLmdldE1lbWJlcihtbSkpKSB7DQoJCQkJcmVzdWx0ID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgkJCQlyZXN1bHQucHVzaChiLCBjKTsNCgkJCQlyZXR1cm4gZi5hcHBseShudWxsLCByZXN1bHQsIHRydWUpWzBdOw0KDQoJCQl9IGVsc2Ugew0KCQkJCXRocm93IG5ldyBzaGluZS5FcnJvcignYXR0ZW1wdCB0byBjb21wYXJlIHR3byB0YWJsZSB2YWx1ZXMnKTsNCgkJCX0NCg0KCQl9IGVsc2Ugew0KCQkJcmV0dXJuIGNvbXBhcmUoYiwgYyk7DQoJCX0NCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKiovDQoJLy8gbHQNCg0KCWZ1bmN0aW9uIGx0IChhLCBiLCBjKSB7DQoJCWNvbXBhcmUuY2FsbCh0aGlzLCBhLCBiLCBjLCAnX19sdCcsIGx0X2Z1bmMpOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIGx0X2Z1bmMgKGIsIGMpIHsNCgkJcmV0dXJuIGIgPCBjOw0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKi8NCgkvLyBsZQ0KDQoJZnVuY3Rpb24gbGUgKGEsIGIsIGMpIHsNCgkJY29tcGFyZS5jYWxsKHRoaXMsIGEsIGIsIGMsICdfX2xlJywgbGVfZnVuYyk7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gbGVfZnVuYyAoYiwgYykgew0KCQlyZXR1cm4gYiA8PSBjOw0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gdGVzdA0KDQoJZnVuY3Rpb24gdGVzdCAoYSwgYiwgYykgew0KCQlhID0gdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShhKTsNCgkJaWYgKHNoaW5lLnV0aWxzLmNvZXJjZVRvQm9vbGVhbihhKSAhPT0gISFjKSB0aGlzLl9wYysrOw0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gdGVzdHNldA0KDQoJZnVuY3Rpb24gdGVzdHNldCAoYSwgYiwgYykgew0KCQliID0gdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShiKTsNCg0KCQlpZiAoc2hpbmUudXRpbHMuY29lcmNlVG9Cb29sZWFuKGIpID09PSAhIWMpIHsNCgkJCXRoaXMuX3JlZ2lzdGVyLnNldEl0ZW0oYSwgYik7DQoJCX0gZWxzZSB7DQoJCQl0aGlzLl9wYysrOw0KCQl9DQoJfQ0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCgkvLyBjYWxsDQoNCglmdW5jdGlvbiBjYWxsIChhLCBiLCBjKSB7DQoNCgkJdmFyIGFyZ3MgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpLCANCgkJCWksIGwsDQoJCQlyZXR2YWxzLA0KCQkJZnVuY1RvUmVzdW1lLA0KCQkJcnVubmluZywNCgkJCWYsIG87DQoNCg0KCQlpZiAodGhpcy5fdm0uX3N0YXR1cyA9PSBzaGluZS5SRVNVTUlORykgew0KCQkJLy8gSWYgd2UncmUgcmVzdW1pbmcgZnJvbSB0aGUgVk0gYmVpbmcgc3VzcGVuZGVkLg0KCQkJZnVuY1RvUmVzdW1lID0gdGhpcy5fdm0uX3Jlc3VtZVN0YWNrLnBvcCgpOw0KCQkNCgkJfSBlbHNlIGlmIChzaGluZS5kZWJ1ZyAmJiBzaGluZS5kZWJ1Zy5fc3RhdHVzID09IHNoaW5lLlJFU1VNSU5HKSB7DQoJCQkvLyBJZiB3ZSdyZSByZXN1bWluZyBmcm9tIGEgYnJlYWtwb2ludC9zdGVwcGluZywgcmVzdW1lIGNhbGwgc3RhY2sgZmlyc3QuDQoJCQlmdW5jVG9SZXN1bWUgPSBzaGluZS5kZWJ1Zy5fcmVzdW1lU3RhY2sucG9wKCk7DQoJCX0JDQoNCgkJaWYgKGZ1bmNUb1Jlc3VtZSkgewkJDQoJCQlpZiAoZnVuY1RvUmVzdW1lIGluc3RhbmNlb2Ygc2hpbmUuQ29yb3V0aW5lKSB7DQoJCQkJcmV0dmFscyA9IGZ1bmNUb1Jlc3VtZS5yZXN1bWUoKTsNCgkJCQlpZiAocmV0dmFscykgcmV0dmFscy5zaGlmdCgpOw0KDQoJCQl9IGVsc2UgaWYgKGZ1bmNUb1Jlc3VtZSBpbnN0YW5jZW9mIHNoaW5lLkNsb3N1cmUpIHsNCgkJCQlyZXR2YWxzID0gZnVuY1RvUmVzdW1lLl9ydW4oKTsNCg0KCQkJfSBlbHNlIHsNCgkJCQlyZXR2YWxzID0gZnVuY1RvUmVzdW1lKCk7DQoJCQl9DQoJCQkNCgkJfSBlbHNlIGlmICgocnVubmluZyA9IHRoaXMuX3ZtLl9jb3JvdXRpbmVSdW5uaW5nKSAmJiBydW5uaW5nLnN0YXR1cyA9PSBzaGluZS5SRVNVTUlORykgew0KCQkJLy8gSWYgd2UncmUgcmVzdW1pbmcgYSBjb3JvdXRpbmUgZnVuY3Rpb24uLi4NCgkJCQ0KCQkJZnVuY1RvUmVzdW1lID0gcnVubmluZy5fcmVzdW1lU3RhY2sucG9wKCk7DQoJCQlyZXR2YWxzID0gZnVuY1RvUmVzdW1lLl9ydW4oKTsNCgkJCQ0KCQl9IGVsc2Ugew0KCQkJLy8gUHJlcGFyZSB0byBydW4gdGhpcyBmdW5jdGlvbiBhcyB1c3VhbA0KCQkJYXJncyA9IGNhbGxfcHJlcC5jYWxsKHRoaXMsIGEsIGIpOw0KCQl9DQoNCg0KCQlpZiAoIWZ1bmNUb1Jlc3VtZSkgew0KCQkJZiA9IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYSk7DQoJCQlyZXR2YWxzID0gY2FsbF9pbnRlcm5hbC5jYWxsKHRoaXMsIGYsIGFyZ3MpOw0KCQl9DQoJCQ0KCQlzaGluZS5nYy5jb2xsZWN0KGFyZ3MpOw0KDQoNCgkJaWYgKHRoaXMuX3ZtLl9zdGF0dXMgPT0gc2hpbmUuU1VTUEVORElORykgew0KCQkJaWYgKHJldHZhbHMgIT09IHVuZGVmaW5lZCAmJiB0aGlzLl92bS5fcmVzdW1lVmFycyA9PT0gdW5kZWZpbmVkKSB7DQoJCQkJdGhpcy5fdm0uX3Jlc3VtZVZhcnMgPSAocmV0dmFscyBpbnN0YW5jZW9mIEFycmF5KT8gcmV0dmFscyA6IFtyZXR2YWxzXTsNCgkJCX0NCg0KCQkJcmV0dXJuOw0KCQl9DQoNCgkJaWYgKCEocmV0dmFscyAmJiByZXR2YWxzIGluc3RhbmNlb2YgQXJyYXkpKSByZXR2YWxzID0gW3JldHZhbHNdOw0KDQoJCWlmICgocnVubmluZyA9IHRoaXMuX3ZtLl9jb3JvdXRpbmVSdW5uaW5nKSAmJiBydW5uaW5nLnN0YXR1cyA9PSBzaGluZS5TVVNQRU5ESU5HKSByZXR1cm47DQoNCg0KCQlpZiAoYyA9PT0gMCkgew0KCQkJbCA9IHJldHZhbHMubGVuZ3RoOw0KCQkJDQoJCQlmb3IgKGkgPSAwOyBpIDwgbDsgaSsrKSB7DQoJCQkJdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShhICsgaSwgKG8gPSByZXR2YWxzW2ldKSA9PSBudWxsPyB1bmRlZmluZWQgOiBvKTsJCS8vIG51bGwgY29tcGFyaXNvbiBmb3IgRmxhc2ggQVBJIGNhbGxzDQoJCQl9DQoNCgkJCXRoaXMuX3JlZ2lzdGVyLnNwbGljZShhICsgbCk7DQoJCQkNCgkJfSBlbHNlIHsNCgkJCWZvciAoaSA9IDA7IGkgPCBjIC0gMTsgaSsrKSB7DQoJCQkJdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShhICsgaSwgKG8gPSByZXR2YWxzW2ldKSA9PSBudWxsPyB1bmRlZmluZWQgOiBvKTsJCS8vIG51bGwgY29tcGFyaXNvbiBmb3IgRmxhc2ggQVBJIGNhbGxzDQoJCQl9DQoJCX0NCgkJDQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gY2FsbF9wcmVwIChhLCBiKSB7DQoJCS8vVE9ETzogVHJ5IHNwbGl0dGluZyB0aGlzIGludG8gdHdvIGZ1bmN0aW9ucyBhbmQgY2hvc2UgYXQgaml0LXRpbWUgZGVwZW5kaW5nIG9uIHZhbHVlIG9mIGINCg0KCQl2YXIgaSwgbCwgYXJncyA9IFtdOw0KDQoJCWlmIChiID09PSAwKSB7DQoJCQlsID0gdGhpcy5fcmVnaXN0ZXIuZ2V0TGVuZ3RoKCk7DQoJCQ0KCQkJZm9yIChpID0gYSArIDE7IGkgPCBsOyBpKyspIHsNCgkJCQlhcmdzLnB1c2godGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShpKSk7DQoJCQl9DQoNCgkJfSBlbHNlIHsNCgkJCWZvciAoaSA9IDA7IGkgPCBiIC0gMTsgaSsrKSB7DQoJCQkJYXJncy5wdXNoKHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYSArIGkgKyAxKSk7DQoJCQl9DQoJCX0NCgkJcmV0dXJuIGFyZ3M7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gY2FsbF9pbnRlcm5hbCAoZiwgYXJncykgew0KCQl2YXIgcmV0dmFscywgbXQsIGM7DQoNCgkJaWYgKGYgIT09IHVuZGVmaW5lZCkgew0KCQkJaWYgKGYuYXBwbHkpIHsNCgkJCQlyZXR2YWxzID0gZi5hcHBseShudWxsLCBhcmdzKTsNCg0KCQkJfSBlbHNlIGlmIChmIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUgJiYgKG10ID0gZi5fX3NoaW5lLm1ldGF0YWJsZSkgJiYgKGMgPSBtdC5nZXRNZW1iZXIoJ19fY2FsbCcpKSAmJiBjLmFwcGx5KSB7DQoJCQkJYXJncy51bnNoaWZ0KGYpOw0KCQkJCXJldHZhbHMgPSBjLmFwcGx5KG51bGwsIGFyZ3MsIHRydWUpOw0KDQoJCQl9IGVsc2Ugew0KCSAJCQl0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ0F0dGVtcHQgdG8gY2FsbCBub24tZnVuY3Rpb24nKTsNCgkJCX0NCg0KCQl9IGVsc2Ugew0KIAkJCXRocm93IG5ldyBzaGluZS5FcnJvcignQXR0ZW1wdCB0byBjYWxsIGEgbmlsIHZhbHVlJyk7DQoJCX0NCg0KCQlyZXR1cm4gcmV0dmFsczsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIHRhaWxjYWxsDQoNCglmdW5jdGlvbiB0YWlsY2FsbCAoYSwgYikgewkNCgkJcmV0dXJuIGNhbGwuY2FsbCh0aGlzLCBhLCBiLCAwKTsNCgkJDQoJCS8vIE5PVEU6IEN1cnJlbnRseSBub3QgcmVwbGFjaW5nIHN0YWNrLCBzbyBpbmZpbmF0ZWx5IHJlY3Vyc2l2ZSBjYWxscyBXT1VMRCBkcmFpbiBtZW1vcnksIHVubGlrZSBob3cgdGFpbCBjYWxscyB3ZXJlIGludGVuZGVkLg0KCQkvLyBUT0RPOiBGb3Igbm9uLWV4dGVybmFsIGZ1bmN0aW9uIGNhbGxzLCByZXBsYWNlIHRoaXMgc3RhY2sgd2l0aCB0aGF0IG9mIHRoZSBuZXcgZnVuY3Rpb24uIFBvc3NpYmx5IHJldHVybiB0aGUgRnVuY3Rpb24gYW5kIGhhbmRsZSB0aGUgY2FsbCBpbiB0aGUgUkVUVVJOIHNlY3Rpb24gKGZvciB0aGUgY2FsbGluZyBmdW5jdGlvbikuDQoJfQ0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCgkvLyByZXR1cm4NCg0KCWZ1bmN0aW9uIHJldHVybl8gKGEsIGIpIHsNCgkJdmFyIHJldHZhbHMgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpLA0KCQkJdmFsLA0KCQkJaSwgbDsNCg0KCQlpZiAoYiA9PT0gMCkgew0KCQkJbCA9IHRoaXMuX3JlZ2lzdGVyLmdldExlbmd0aCgpOw0KCQkJDQoJCQlmb3IgKGkgPSBhOyBpIDwgbDsgaSsrKSB7DQoJCQkJcmV0dmFscy5wdXNoKHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oaSkpOw0KCQkJfQ0KDQoJCX0gZWxzZSB7DQoJCQlmb3IgKGkgPSAwOyBpIDwgYiAtIDE7IGkrKykgew0KCQkJCXJldHZhbHMucHVzaCh2YWwgPSB0aGlzLl9yZWdpc3Rlci5nZXRJdGVtKGEgKyBpKSk7DQoJCQkJc2hpbmUuZ2MuaW5jclJlZih2YWwpOw0KCQkJfQ0KCQl9DQoNCgkJY2xvc2UuY2FsbCh0aGlzLCAwKTsNCgkJDQovLwkJdGhpcy5fcmVnaXN0ZXIucmVzZXQoKTsNCgkJdGhpcy5kZWFkID0gdHJ1ZTsNCgkJDQoJCXJldHVybiByZXR2YWxzOw0KCX0JDQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIGZvcmxvb3ANCg0KCWZ1bmN0aW9uIGZvcmxvb3AgKGEsIHNieCkgew0KCQl2YXIgc3RlcCA9IHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYSArIDIpLA0KCQkJbGltaXQgPSB0aGlzLl9yZWdpc3Rlci5nZXRJdGVtKGEgKyAxKSwNCgkJCWluZGV4ID0gdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShhKSArIHN0ZXAsDQoJCQlwYXJpdHkgPSBzdGVwIC8gTWF0aC5hYnMoc3RlcCk7DQoJCQ0KCQl0aGlzLl9yZWdpc3Rlci5zZXRJdGVtKGEsIGluZGV4KTsNCgkJDQoJCWlmICgocGFyaXR5ID09PSAxICYmIGluZGV4IDw9IGxpbWl0KSB8fCAocGFyaXR5ICE9PSAxICYmIGluZGV4ID49IGxpbWl0KSkgew0KCQkJdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShhICsgMywgaW5kZXgpOw0KCQkJdGhpcy5fcGMgKz0gc2J4Ow0KCQl9DQoJfQ0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCgkvLyBmb3JwcmVwDQoNCglmdW5jdGlvbiBmb3JwcmVwIChhLCBzYngpIHsNCgkJdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShhLCB0aGlzLl9yZWdpc3Rlci5nZXRJdGVtKGEpIC0gdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShhICsgMikpOw0KCQl0aGlzLl9wYyArPSBzYng7IA0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gdGZvcmxvb3ANCg0KCWZ1bmN0aW9uIHRmb3Jsb29wIChhLCBiLCBjKSB7DQoJCXZhciBhcmdzID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKSwNCgkJCXJldHZhbHMsDQoJCQl2YWwsDQoJCQlpOw0KDQoJCWFyZ3MucHVzaCh0aGlzLl9yZWdpc3Rlci5nZXRJdGVtKGEgKyAxKSwgdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShhICsgMikpOw0KCQlyZXR2YWxzID0gdGZvcmxvb3BfaW50ZXJuYWwodGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShhKSwgYXJncyk7DQoNCgkJZm9yIChpID0gMDsgaSA8IGM7IGkrKykgdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShhICsgaSArIDMsIHJldHZhbHNbaV0pOw0KDQoJCWlmICgodmFsID0gcmV0dmFsc1swXSkgIT09IHVuZGVmaW5lZCkgew0KCQkJdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShhICsgMiwgdmFsKTsNCgkJfSBlbHNlIHsNCgkJCXRoaXMuX3BjKys7DQoJCX0NCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0Zm9ybG9vcF9pbnRlcm5hbCAoZiwgYXJncykgew0KCQl2YXIgcmV0dmFscyA9IGYuYXBwbHkodW5kZWZpbmVkLCBhcmdzKSwNCgkJCXZhbDsNCg0KCQlpZiAoIShyZXR2YWxzICYmIHJldHZhbHMgaW5zdGFuY2VvZiBBcnJheSkpIHsNCgkJCXZhbCA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCk7DQoJCQl2YWwucHVzaChyZXR2YWxzKTsNCgkJCXJldHZhbHMgPSB2YWw7DQoJCX0NCg0KCQlyZXR1cm4gcmV0dmFsczsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIHNldGxpc3QNCg0KCWZ1bmN0aW9uIHNldGxpc3QgKGEsIGIsIGMpIHsNCgkJdmFyIGxlbmd0aCA9IGIgfHwgdGhpcy5fcmVnaXN0ZXIuZ2V0TGVuZ3RoKCkgLSBhIC0gMSwNCgkJaTsNCgkJDQoJCWZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgew0KCQkJdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShhKS5zZXRNZW1iZXIoNTAgKiAoYyAtIDEpICsgaSArIDEsIHRoaXMuX3JlZ2lzdGVyLmdldEl0ZW0oYSArIGkgKyAxKSk7DQoJCX0NCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIGNsb3NlDQoNCglmdW5jdGlvbiBjbG9zZSAoYSwgYiwgYykgew0KCQljbG9zZV9pbnRlcm5hbC5jYWxsKHRoaXMsIGEsIGNsb3NlX2dldFZhbHVlLCBjbG9zZV9jbGVhckl0ZW0pOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIGNsb3NlX2dldFZhbHVlIChpbmRleCkgew0KCQlyZXR1cm4gdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShpbmRleCk7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gY2xvc2VfY2xlYXJJdGVtIChpbmRleCkgew0KCQl0aGlzLl9yZWdpc3Rlci5jbGVhckl0ZW0oaW5kZXgpOw0KCX0NCg0KCQkJCQ0KDQoNCglmdW5jdGlvbiBjbG9zZV9pbnRlcm5hbCAoYSwgZ2V0VmFsdWUsIGNsZWFySXRlbSkgew0KCQkNCgkJZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLl9sb2NhbHNVc2VkQXNVcHZhbHVlcy5sZW5ndGg7IGkgPCBsOyBpKyspIHsNCgkJCXZhciBsb2NhbCA9IHRoaXMuX2xvY2Fsc1VzZWRBc1VwdmFsdWVzW2ldOw0KDQoJCQlpZiAobG9jYWwgJiYgbG9jYWwucmVnaXN0ZXJJbmRleCA+PSBhKSB7DQoJCQkJbG9jYWwudXB2YWx1ZS52YWx1ZSA9IGdldFZhbHVlLmNhbGwodGhpcywgbG9jYWwucmVnaXN0ZXJJbmRleCk7DQoJCQkJbG9jYWwudXB2YWx1ZS5vcGVuID0gZmFsc2U7DQoNCgkJCQl0aGlzLl9sb2NhbHNVc2VkQXNVcHZhbHVlcy5zcGxpY2UoaS0tLCAxKTsNCgkJCQlsLS07DQoNCgkJCQlpZiAoY2xlYXJJdGVtKSBjbGVhckl0ZW0uY2FsbCh0aGlzLCBsb2NhbC5yZWdpc3RlckluZGV4KTsNCgkJCX0NCgkJfQ0KCX0NCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoJLy8gY2xvc3VyZQ0KDQoJZnVuY3Rpb24gY2xvc3VyZSAoYSwgYngpIHsNCgkJdmFyIHVwdmFsdWVEYXRhID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKSwNCgkJCWluc3RydWN0aW9ucyA9IHRoaXMuX2luc3RydWN0aW9ucywNCgkJCXNsaWNlID0gaW5zdHJ1Y3Rpb25zLnNsaWNlIHx8IGluc3RydWN0aW9ucy5zdWJhcnJheSwNCgkJCW9wY29kZSwgZjsNCg0KCQl3aGlsZSAoKG9wY29kZSA9IGluc3RydWN0aW9uc1t0aGlzLl9wYyAqIDRdKSAhPT0gdW5kZWZpbmVkICYmIChvcGNvZGUgPT09IDAgfHwgb3Bjb2RlID09PSA0KSAmJiB0aGlzLl9pbnN0cnVjdGlvbnNbdGhpcy5fcGMgKiA0ICsgMV0gPT09IDApIHsJLy8gbW92ZSwgZ2V0dXB2YWwNCgkJCXVwdmFsdWVEYXRhLnB1c2guYXBwbHkodXB2YWx1ZURhdGEsIHNsaWNlLmNhbGwoaW5zdHJ1Y3Rpb25zLCB0aGlzLl9wYyAqIDQsIHRoaXMuX3BjICogNCArIDQpKTsNCgkJCXRoaXMuX3BjKys7DQoJCX0NCg0KCQlmID0gbmV3IHNoaW5lLkZ1bmN0aW9uKHRoaXMuX3ZtLCB0aGlzLl9maWxlLCB0aGlzLl9mdW5jdGlvbnNbYnhdLCB0aGlzLl9nbG9iYWxzLCBjbG9zdXJlX3VwdmFsdWVzLmNhbGwodGhpcywgYngsIHVwdmFsdWVEYXRhLCBjbG9zdXJlX2dldFVwdmFsLCBjbG9zdXJlX3NldFVwdmFsKSk7DQoJCXRoaXMuX3JlZ2lzdGVyLnNldEl0ZW0oYSwgZik7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gY2xvc3VyZV91cHZhbHVlcyAoYngsIHVwdmFsdWVEYXRhLCBnZXRVcHZhbCwgc2V0VXB2YWwpIHsNCgkJdmFyIHVwdmFsdWVzID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKSwNCgkJCW9wY29kZSwgQSwgQiwgQywgaSwgbDsNCg0KCQlmb3IgKGkgPSAwLCBsID0gdXB2YWx1ZURhdGEubGVuZ3RoOyBpIDwgbDsgaSArPSA0KSB7DQoJCQlvcGNvZGUgPSB1cHZhbHVlRGF0YVtpXTsNCgkJCUEgPSB1cHZhbHVlRGF0YVtpICsgMV07DQoJCQlCID0gdXB2YWx1ZURhdGFbaSArIDJdOw0KCQkJQyA9IHVwdmFsdWVEYXRhW2kgKyAzXTsNCg0KCQkJdXB2YWx1ZXMucHVzaCgob3Bjb2RlPyBjbG9zdXJlX2dldHVwdmFsIDogY2xvc3VyZV9tb3ZlKS5jYWxsKHRoaXMsIGJ4LCBpIC8gNCwgQSwgQiwgQywgZ2V0VXB2YWwsIHNldFVwdmFsKSk7DQoJCX0NCg0KCQlyZXR1cm4gdXB2YWx1ZXM7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gY2xvc3VyZV9nZXRVcHZhbCAoYikgew0KCQlyZXR1cm4gdGhpcy5fcmVnaXN0ZXIuZ2V0SXRlbShiKTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiBjbG9zdXJlX3NldFVwdmFsIChiLCB2YWwpIHsNCgkJdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShiLCB2YWwpOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIGNsb3N1cmVfbW92ZSAoZnVuY0luZGV4LCBpbmRleCwgYSwgYiwgYywgZ2V0VXB2YWwsIHNldFVwdmFsKSB7DQoJCXZhciBtZSA9IHRoaXMsDQoJCQl1cGRhdGEsIHVwdmFsdWU7DQoNCgkJLy8gbW92ZQ0KCQlmb3IgKHZhciBqID0gMCwgbCA9IHRoaXMuX2xvY2Fsc1VzZWRBc1VwdmFsdWVzLmxlbmd0aDsgaiA8IGw7IGorKykgew0KCQkJdXBkYXRhID0gdGhpcy5fbG9jYWxzVXNlZEFzVXB2YWx1ZXNbal07DQoJCQlpZiAodXBkYXRhLnJlZ2lzdGVySW5kZXggPT09IGIpIHsNCgkJCQl1cHZhbHVlID0gdXBkYXRhLnVwdmFsdWU7DQoJCQkJYnJlYWs7DQoJCQl9DQoJCX0NCg0KCQlpZiAoIXVwdmFsdWUpIHsNCgkJCXVwdmFsdWUgPSB7DQoJCQkJb3BlbjogdHJ1ZSwNCgkJCQlnZXRWYWx1ZTogZnVuY3Rpb24gKCkgew0KCQkJCQkvLyByZXR1cm4gdGhpcy5vcGVuPyBtZS5fcmVnaXN0ZXIuZ2V0SXRlbShiKSA6IHRoaXMudmFsdWU7DQoJCQkJCXJldHVybiB0aGlzLm9wZW4/IGdldFVwdmFsLmNhbGwobWUsIGIpIDogdGhpcy52YWx1ZTsNCgkJCQl9LA0KCQkJCXNldFZhbHVlOiBmdW5jdGlvbiAodmFsKSB7DQoJCQkJCWlmICh0aGlzLm9wZW4pIHsNCgkJCQkJCS8vIG1lLl9yZWdpc3Rlci5zZXRJdGVtKGIsIHZhbCk7DQoJCQkJCQlzZXRVcHZhbC5jYWxsKG1lLCBiLCB2YWwpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJc2hpbmUuZ2MuaW5jclJlZih2YWwpOw0KCQkJCQkJc2hpbmUuZ2MuZGVjclJlZih0aGlzLnZhbHVlKTsNCgkJCQkJCXRoaXMudmFsdWUgPSB2YWw7DQoJCQkJCX0NCgkJCQl9LA0KCQkJCW5hbWU6IHRoaXMuX2Z1bmN0aW9uc1tmdW5jSW5kZXhdLnVwdmFsdWVzPyB0aGlzLl9mdW5jdGlvbnNbZnVuY0luZGV4XS51cHZhbHVlc1tpbmRleF0gOiAnKHVwdmFsdWUpJw0KCQkJfTsNCg0KCQkJdGhpcy5fbG9jYWxzVXNlZEFzVXB2YWx1ZXMucHVzaCh7DQoJCQkJcmVnaXN0ZXJJbmRleDogYiwNCgkJCQl1cHZhbHVlOiB1cHZhbHVlDQoJCQl9KTsNCgkJfQ0KDQoJCXJldHVybiB1cHZhbHVlOwkJDQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gY2xvc3VyZV9nZXR1cHZhbCAoZnVuY0luZGV4LCBpbmRleCwgYSwgYiwgYykgew0KCQl2YXIgbWUgPSB0aGlzOw0KDQoJCXJldHVybiB7DQoJCQlnZXRWYWx1ZTogZnVuY3Rpb24gKCkgew0KCQkJCXJldHVybiBtZS5fdXB2YWx1ZXNbYl0uZ2V0VmFsdWUoKTsNCgkJCX0sDQoJCQlzZXRWYWx1ZTogZnVuY3Rpb24gKHZhbCkgew0KCQkJCW1lLl91cHZhbHVlc1tiXS5zZXRWYWx1ZSh2YWwpOw0KCQkJfSwNCgkJCW5hbWU6IHRoaXMuX3VwdmFsdWVzW2JdLm5hbWUNCgkJfTsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KCS8vIHZhcmFyZw0KDQoJZnVuY3Rpb24gdmFyYXJnIChhLCBiKSB7DQoJCXZhciBpLCBsLA0KCQkJbGltaXQgPSBiID09PSAwPyBNYXRoLm1heCgwLCB0aGlzLl9wYXJhbXMubGVuZ3RoIC0gdGhpcy5fZGF0YS5wYXJhbUNvdW50KSA6IGIgLSAxOw0KDQoJCWZvciAoaSA9IDA7IGkgPCBsaW1pdDsgaSsrKSB7DQoJCQl0aGlzLl9yZWdpc3Rlci5zZXRJdGVtKGEgKyBpLCB0aGlzLl9wYXJhbXNbdGhpcy5fZGF0YS5wYXJhbUNvdW50ICsgaV0pOwkJCQ0KCQl9DQoNCgkJLy8gQXNzdW1wdGlvbjogQ2xlYXIgdGhlIHJlbWFpbmluZyBpdGVtcyBpbiB0aGUgcmVnaXN0ZXIuDQoJCWZvciAoaSA9IGEgKyBsaW1pdCwgbCA9IHRoaXMuX3JlZ2lzdGVyLmdldExlbmd0aCgpOyBpIDwgbDsgaSsrKSB7DQoJCQl0aGlzLl9yZWdpc3Rlci5jbGVhckl0ZW0oaSk7DQoJCX0NCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCg0KCXZhciAvLyBHQw0KCQlpbmNyID0gc2hpbmUuZ2MuaW5jclJlZiwNCgkJZGVjciA9IHNoaW5lLmdjLmRlY3JSZWYuYmluZChzaGluZS5nYyksDQoJCWNvbGxlY3QgPSBzaGluZS5nYy5jb2xsZWN0LmJpbmQoc2hpbmUuZ2MpLA0KCQljcmVhdGVBcnJheSA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5LmJpbmQoc2hpbmUuZ2MpLA0KCQljYWNoZUFycmF5ID0gc2hpbmUuZ2MuY2FjaGVBcnJheS5iaW5kKHNoaW5lLmdjKSwNCg0KCQkvLyBDb25zdGFudHMNCgkJRU1QVFlfQVJSID0gc2hpbmUuRU1QVFlfQVJSOw0KDQoNCglmdW5jdGlvbiBnZXRfdXB2ICh4KSB7DQoJCXJldHVybiB0aGlzW3hdDQoJfQ0KDQoNCglmdW5jdGlvbiBzZXRfdXB2ICh4LHkpIHsNCgkJc2V0Uih0aGlzLHgseSkNCgl9Ow0KDQoNCglmdW5jdGlvbiBzZXRSIChyZWdpc3RlciwgaW5kZXgsIHZhbHVlKSB7DQoJCWluY3IodmFsdWUpOw0KCQlkZWNyKHJlZ2lzdGVyW2luZGV4XSk7DQoJCXJlZ2lzdGVyW2luZGV4XSA9IHZhbHVlOw0KCX0NCg0KDQoJZnVuY3Rpb24gY2xlYXJSIChyZWdpc3RlciwgaW5kZXgpIHsNCgkJZm9yICh2YXIgaSA9IGluZGV4LCBsID0gcmVnaXN0ZXIubGVuZ3RoOyBpIDwgbDsgaSsrKSBkZWNyKHJlZ2lzdGVyW2ldKTsNCgkJcmVnaXN0ZXIubGVuZ3RoID0gaW5kZXggLSAxOw0KCX0NCg0KDQoJZnVuY3Rpb24gc2V0UkFyciAocmVnaXN0ZXIsIGluZGV4LCBsaW1pdCwgYXJyKSB7DQoJCXZhciB0b0RlY3IgPSByZWdpc3Rlci5zcGxpY2UoaW5kZXgsIEluZmluaXR5KSwNCgkJCWksIGw7DQogDQoJCWlmICghKGFyciBpbnN0YW5jZW9mIEFycmF5KSkgew0KCQkJaSA9IGNyZWF0ZUFycmF5KCk7DQoJCQlpLnB1c2goYXJyKTsNCgkJCWFyciA9IGk7DQoJCX0NCiANCgkJZm9yIChpID0gMCwgbCA9IGxpbWl0IHx8IGFyci5sZW5ndGg7IGkgPCBsOyBpKyspIHsNCgkJCWluY3IocmVnaXN0ZXJbaW5kZXggKyBpXSA9IGFycltpXSk7DQoJCX0NCiANCgkJZm9yIChpID0gMCwgbCA9IHRvRGVjci5sZW5ndGg7IGkgPCBsOyBpKyspIHsNCgkJCWRlY3IocmVnaXN0ZXIuc2hpZnQoKSk7DQoJCX0NCg0KCQljYWNoZUFycmF5KGFycik7DQoJfQ0KIA0KDQoJZnVuY3Rpb24gY2FsbFIgKHJlZ2lzdGVyLCBpbmRleCwgYywgYXJnU3RhcnQsIGFyZ0VuZCkgew0KCQl2YXIgYXJncyA9IGNyZWF0ZUFycmF5KCksDQoJCQlyZXN1bHQsIGksIGxpbWl0LCB0b0RlY3I7DQogDQogDQoJCWlmIChhcmdTdGFydCkgew0KCQkJbGltaXQgPSBhcmdFbmQ/IGFyZ0VuZCA6IHJlZ2lzdGVyLmxlbmd0aDsNCiANCgkJCWZvciAoaSA9IGFyZ1N0YXJ0OyBpIDwgbGltaXQ7IGkrKykgew0KCQkJCWFyZ3MucHVzaChyZWdpc3RlcltpXSk7DQoJCQl9DQoJCX0NCiANCgkJcmVzdWx0ID0gY2FsbF9pbnRlcm5hbChyZWdpc3RlcltpbmRleF0sYXJncyk7DQoJCXRvRGVjciA9IHJlZ2lzdGVyLnNwbGljZShpbmRleCwgSW5maW5pdHkpOw0KIA0KCQlpZiAoYyA9PSAxKSB7DQoJCQkvLyBOT09QDQoJCSANCgkJfSBlbHNlIGlmICghKHJlc3VsdCBpbnN0YW5jZW9mIEFycmF5KSkgew0KCQkJc2V0UihyZWdpc3RlciwgaW5kZXgsIHJlc3VsdCk7DQoJCSANCgkJfSBlbHNlIHsNCgkJCWZvciAoaSA9IDAsIGxpbWl0ID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGxpbWl0OyBpKyspIGluY3IocmVzdWx0W2ldKTsNCgkJIA0KCQkJcmVzdWx0LnVuc2hpZnQoaW5kZXgsIDApOw0KCQkJQXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShyZWdpc3RlciwgcmVzdWx0KTsNCgkJCSANCgkJCWNhY2hlQXJyYXkocmVzdWx0KTsNCgkJfQ0KDQoJCWZvciAoaSA9IDAsIGxpbWl0ID0gdG9EZWNyLmxlbmd0aDsgaSA8IGxpbWl0OyBpKyspIHsNCgkJCWRlY3IodG9EZWNyLnNoaWZ0KCkpOw0KCQl9DQoNCiAJCWNhY2hlQXJyYXkoYXJncyk7DQoJfQ0KIA0KIA0KCWZ1bmN0aW9uIHNldGxpc3RUIChSLCB0LCBpbmRleCwga2V5U3RhcnQsIGxlbmd0aCkgew0KCQl0LnNldE1lbWJlcihrZXlTdGFydCwgUltpbmRleF0pOw0KCQlpZiAoLS1sZW5ndGgpIHNldGxpc3RUKFIsIHQsIGluZGV4ICsgMSwga2V5U3RhcnQgKyAxLCBsZW5ndGgpOw0KCX0NCiANCiANCglmdW5jdGlvbiBjcmVhdGVfZnVuYyAoZGVmLCB1cHZhbHMsIGNsKSB7DQoJCXJldHVybiBuZXcgc2hpbmUuRnVuY3Rpb24oY2wuX3ZtLGNsLl9maWxlLGRlZixjbC5fZ2xvYmFscyx1cHZhbHMpOw0KCX0NCiANCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCg0KCS8qKg0KCSAqIEFycmF5IG9mIG9wZXJhdGlvbiBoYW5kbGVycyBpbmRleGVkIGJ5IG9wY29kZS4NCgkgKiBAdHlwZSBBcnJheQ0KCSAqIEBjb25zdGFudA0KCSAqLw0KCXNoaW5lLm9wZXJhdGlvbnMuSEFORExFUlMgPSBbbW92ZSwgbG9hZGssIGxvYWRib29sLCBsb2FkbmlsLCBnZXR1cHZhbCwgZ2V0Z2xvYmFsLCBnZXR0YWJsZSwgc2V0Z2xvYmFsLCBzZXR1cHZhbCwgc2V0dGFibGUsIG5ld3RhYmxlLCBzZWxmLCBhZGQsIHN1YiwgbXVsLCBkaXYsIG1vZCwgcG93LCB1bm0sIG5vdCwgbGVuLCBjb25jYXQsIGptcCwgZXEsIGx0LCBsZSwgdGVzdCwgdGVzdHNldCwgY2FsbCwgdGFpbGNhbGwsIHJldHVybl8sIGZvcmxvb3AsIGZvcnByZXAsIHRmb3Jsb29wLCBzZXRsaXN0LCBjbG9zZSwgY2xvc3VyZSwgdmFyYXJnXTsNCg0KDQoJLyoqDQoJICogQXJyYXkgb2YgaW5zdHJ1Y3Rpb24gbmFtZXMgaW5kZXhlZCBieSBvcGNvZGUuDQoJICogQHR5cGUgQXJyYXkNCgkgKiBAY29uc3RhbnQNCgkgKi8NCglzaGluZS5vcGVyYXRpb25zLk5BTUVTID0gWydtb3ZlJywgJ2xvYWRrJywgJ2xvYWRib29sJywgJ2xvYWRuaWwnLCAnZ2V0dXB2YWwnLCAnZ2V0Z2xvYmFsJywgJ2dldHRhYmxlJywgJ3NldGdsb2JhbCcsICdzZXR1cHZhbCcsICdzZXR0YWJsZScsICduZXd0YWJsZScsICdzZWxmJywgJ2FkZCcsICdzdWInLCAnbXVsJywgJ2RpdicsICdtb2QnLCAncG93JywgJ3VubScsICdub3QnLCAnbGVuJywgJ2NvbmNhdCcsICdqbXAnLCAnZXEnLCAnbHQnLCAnbGUnLCAndGVzdCcsICd0ZXN0c2V0JywgJ2NhbGwnLCAndGFpbGNhbGwnLCAncmV0dXJuJywgJ2Zvcmxvb3AnLCAnZm9ycHJlcCcsICd0Zm9ybG9vcCcsICdzZXRsaXN0JywgJ2Nsb3NlJywgJ2Nsb3N1cmUnLCAndmFyYXJnJ107DQoNCg0KDQoNCgkvKioNCgkgKiBDcmVhdGVzIGEgbmV3IEphdmFTY3JpcHQgZnVuY3Rpb24gaW4gdGhlIGN1cnJlbnQgc2NvcGUuIA0KCSAqIENhbiBiZSB1c2VkIGJ5IHRoZSBKSVQgY29tcGlsZXIgdG8gbWFrZSB1c2Ugb2YgdGhlIG9wZXJhdGlvbiBoYW5kbGVycy4NCgkgKiBAcGFyYW0ge3N0cmluZ30gZnVuY0RlZiBTdHJpbmcgY29udGFpbmluZyBhIEphdmFTY3JpcHQgZnVuY3Rpb24gZGVmaW5pdGlvbi4NCgkgKiBAcmV0dXJucyB7ZnVuY3Rpb259IFJlc3VsdGluZyBKYXZhU2NyaXB0IGZ1bmN0aW9uLg0KCSAqLw0KCXNoaW5lLm9wZXJhdGlvbnMuZXZhbHVhdGVJblNjb3BlID0gZnVuY3Rpb24gKGZ1bmNEZWYsIHZtKSB7DQoJCXZhciBmdW5jLA0KCQkJc2hpbmVfZyA9ICh2bSB8fCBzaGluZS5nZXRDdXJyZW50Vk0oKSkuX2dsb2JhbHM7DQoNCg0KCQlldmFsKCdmdW5jPScgKyBmdW5jRGVmKTsNCg0KCQlyZXR1cm4gZnVuYzsNCgl9Ow0KDQoNCg0KDQoJc2hpbmUub3BlcmF0aW9ucy5pbnRlcm5hbCA9IHsNCgkJZ2V0Z2xvYmFsOiBnZXRnbG9iYWxfaW50ZXJuYWwsDQoJCWdldHRhYmxlOiBnZXR0YWJsZV9pbnRlcm5hbCwNCgkJc2V0Z2xvYmFsOiBzZXRnbG9iYWxfaW50ZXJuYWwsDQoJCXNldHRhYmxlOiBzZXR0YWJsZV9pbnRlcm5hbCwNCgkJbmV3dGFibGU6IG5ld3RhYmxlX2ludGVybmFsLA0KCQlzZWxmOiBzZWxmX2ludGVybmFsLA0KCQliaW5hcnlfYXJpdGhtZXRpYzogYmluYXJ5X2FyaXRobWV0aWNfaW50ZXJuYWwsDQoJCWFkZDogYWRkX2ludGVybmFsLA0KCQlzdWI6IHN1Yl9pbnRlcm5hbCwNCgkJbXVsOiBtdWxfaW50ZXJuYWwsDQoJCWRpdjogZGl2X2ludGVybmFsLA0KCQltb2Q6IG1vZF9pbnRlcm5hbCwNCgkJdW5tOiB1bm1faW50ZXJuYWwsDQoJCWxlbjogbGVuX2ludGVybmFsLA0KCQljb25jYXQ6IGNvbmNhdF9pbnRlcm5hbCwNCgkJZXE6IGVxX2ludGVybmFsLA0KCQljb21wYXJlOiBjb21wYXJlX2ludGVybmFsLA0KCQljYWxsOiBjYWxsX2ludGVybmFsLA0KCQl0Zm9ybG9vcDogdGZvcmxvb3BfaW50ZXJuYWwsDQoJCWNsb3NlOiBjbG9zZV9pbnRlcm5hbCwNCgkJY2xvc3VyZV91cHZhbHVlczogY2xvc3VyZV91cHZhbHVlcywNCgkJbHRfZnVuYzogbHRfZnVuYywNCgkJbGVfZnVuYzogbGVfZnVuYw0KCX07DQoNCi8qKg0KICogQGZpbGVPdmVydmlldyBUaGUgTHVhIHN0YW5kYXJkIGxpYnJhcnkuDQogKiBAYXV0aG9yIDxhIGhyZWY9Im1haWx0bzpwYXVsLmN1dGhiZXJ0c29uQGdhbWVzeXMuY28udWsiPlBhdWwgQ3V0aGJlcnRzb248L2E+DQogKi8NCg0KCXZhciBSQU5ET01fTVVMVElQTElFUiA9IDE2ODA3LA0KCQlSQU5ET01fTU9EVUxVUyA9IDIxNDc0ODM2NDcsDQoNCgkJUk9TRVRUQV9TVE9ORSA9IHsNCgkJCScoW15hLXpBLVowLTklKF0pLSc6ICckMSo/JywNCgkgICAgICAgICcoLiktKFteYS16QS1aMC05P10pJzogJyQxKj8kMicsDQoJCQknKC4pLSQnOiAnJDEqPycsDQoJCQknJWEnOiAnW2EtekEtWl0nLA0KCQkJJyVBJzogJ1teYS16QS1aXScsDQoJCQknJWMnOiAnW1x4MDAtXHgxZl0nLA0KCQkJJyVDJzogJ1teXHgwMC1ceDFmXScsDQoJCQknJWQnOiAnXFxkJywNCgkJCSclRCc6ICdbXlxkXScsDQoJCQknJWwnOiAnW2Etel0nLA0KCQkJJyVMJzogJ1teYS16XScsDQoJCQknJXAnOiAnW1wuXCxcIlwnXD9cIVw7XDpcI1wkXCVcJlwoXClcKlwrXC1cL1w8XD5cPVxAXFtcXVxcXF5cX1x7XH1cfFx+XScsDQoJCQknJVAnOiAnW15cLlwsXCJcJ1w/XCFcO1w6XCNcJFwlXCZcKFwpXCpcK1wtXC9cPFw+XD1cQFxbXF1cXFxeXF9ce1x9XHxcfl0nLA0KCQkJJyVzJzogJ1sgXFx0XFxuXFxmXFx2XFxyXScsDQoJCQknJVMnOiAnW14gXHRcblxmXHZccl0nLA0KCQkJJyV1JzogJ1tBLVpdJywNCgkJCSclVSc6ICdbXkEtWl0nLA0KCQkJJyV3JzogJ1thLXpBLVowLTldJywNCgkJCSclVyc6ICdbXmEtekEtWjAtOV0nLA0KCQkJJyV4JzogJ1thLWZBLUYwLTldJywNCgkJCSclWCc6ICdbXmEtZkEtRjAtOV0nLA0KCQkJJyUoW15hLXpBLVpdKSc6ICdcXCQxJw0KCQl9LA0KDQoJCURBWVMgPSBbJ1N1bmRheScsICdNb25kYXknLCAnVHVlc2RheScsICdXZWRuZXNkYXknLCAnVGh1cnNkYXknLCAnRnJpZGF5JywgJ1NhdHVyZGF5J10sDQoJCQ0KCQlNT05USFMgPSBbJ0phbnVhcnknLCAnRmVicnVhcnknLCAnTWFyY2gnLCAnQXByaWwnLCAnTWF5JywgJ0p1bmUnLCAnSnVseScsICdBdWd1c3QnLCAnU2VwdGVtYmVyJywgJ09jdG9iZXInLCAnTm92ZW1iZXInLCAnRGVjZW1iZXInXSwNCgkJDQoJCURBWVNfSU5fTU9OVEggPSBbMzEsIDI4LCAzMSwgMzAsIDMxLCAzMCwgMzEsIDMxLCAzMCwgMzEsIDMwLCAzMV0sDQoJCQkJDQoJCURBVEVfRk9STUFUX0hBTkRMRVJTID0gew0KCQkJJyVhJzogZnVuY3Rpb24gKGQsIHV0YykgeyByZXR1cm4gREFZU1tkWydnZXQnICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnRGF5J10oKV0uc3Vic3RyKDAsIDMpOyB9LA0KCQkJJyVBJzogZnVuY3Rpb24gKGQsIHV0YykgeyByZXR1cm4gREFZU1tkWydnZXQnICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnRGF5J10oKV07IH0sDQoJCQknJWInOiBmdW5jdGlvbiAoZCwgdXRjKSB7IHJldHVybiBNT05USFNbZFsnZ2V0JyArICh1dGM/ICdVVEMnIDogJycpICsgJ01vbnRoJ10oKV0uc3Vic3RyKDAsIDMpOyB9LA0KCQkJJyVCJzogZnVuY3Rpb24gKGQsIHV0YykgeyByZXR1cm4gTU9OVEhTW2RbJ2dldCcgKyAodXRjPyAnVVRDJyA6ICcnKSArICdNb250aCddKCldOyB9LA0KCQkJJyVjJzogZnVuY3Rpb24gKGQsIHV0YykgeyByZXR1cm4gZFsndG8nICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnTG9jYWxlU3RyaW5nJ10oKTsgfSwNCgkJCSclZCc6IGZ1bmN0aW9uIChkLCB1dGMpIHsgcmV0dXJuICgnMCcgKyBkWydnZXQnICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnRGF0ZSddKCkpLnN1YnN0cigtMik7IH0sDQoJCQknJUgnOiBmdW5jdGlvbiAoZCwgdXRjKSB7IHJldHVybiAoJzAnICsgZFsnZ2V0JyArICh1dGM/ICdVVEMnIDogJycpICsgJ0hvdXJzJ10oKSkuc3Vic3RyKC0yKTsgfSwNCgkJCSclSSc6IGZ1bmN0aW9uIChkLCB1dGMpIHsgcmV0dXJuICgnMCcgKyAoKGRbJ2dldCcgKyAodXRjPyAnVVRDJyA6ICcnKSArICdIb3VycyddKCkgKyAxMSkgJSAxMiArIDEpKS5zdWJzdHIoLTIpOyB9LA0KCQkJJyVqJzogZnVuY3Rpb24gKGQsIHV0Yykgew0KCQkJCXZhciByZXN1bHQgPSBkWydnZXQnICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnRGF0ZSddKCksDQoJCQkJCW0gPSBkWydnZXQnICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnTW9udGgnXSgpOw0KCQkJCQkNCgkJCQlmb3IgKHZhciBpID0gMDsgaSA8IG07IGkrKykgcmVzdWx0ICs9IERBWVNfSU5fTU9OVEhbaV07DQoJCQkJaWYgKG0gPiAxICYmIGRbJ2dldCcgKyAodXRjPyAnVVRDJyA6ICcnKSArICdGdWxsWWVhciddKCkgJSA0ID09PSAwKSByZXN1bHQgKz0xOw0KDQoJCQkJcmV0dXJuICgnMDAnICsgcmVzdWx0KS5zdWJzdHIoLTMpOw0KCQkJfSwNCgkJCSclbSc6IGZ1bmN0aW9uIChkLCB1dGMpIHsgcmV0dXJuICgnMCcgKyAoZFsnZ2V0JyArICh1dGM/ICdVVEMnIDogJycpICsgJ01vbnRoJ10oKSArIDEpKS5zdWJzdHIoLTIpOyB9LA0KCQkJJyVNJzogZnVuY3Rpb24gKGQsIHV0YykgeyByZXR1cm4gKCcwJyArIGRbJ2dldCcgKyAodXRjPyAnVVRDJyA6ICcnKSArICdNaW51dGVzJ10oKSkuc3Vic3RyKC0yKTsgfSwNCgkJCSclcCc6IGZ1bmN0aW9uIChkLCB1dGMpIHsgcmV0dXJuIChkWydnZXQnICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnSG91cnMnXSgpIDwgMTIpPyAnQU0nIDogJ1BNJzsgfSwNCgkJCSclUyc6IGZ1bmN0aW9uIChkLCB1dGMpIHsgcmV0dXJuICgnMCcgKyBkWydnZXQnICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnU2Vjb25kcyddKCkpLnN1YnN0cigtMik7IH0sDQoJCQknJVUnOiBmdW5jdGlvbiAoZCwgdXRjKSB7IHJldHVybiBnZXRXZWVrT2ZZZWFyKGQsIDAsIHV0Yyk7IH0sDQoJCQknJXcnOiBmdW5jdGlvbiAoZCwgdXRjKSB7IHJldHVybiAnJyArIChkWydnZXQnICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnRGF5J10oKSk7IH0sDQoJCQknJVcnOiBmdW5jdGlvbiAoZCwgdXRjKSB7IHJldHVybiBnZXRXZWVrT2ZZZWFyKGQsIDEsIHV0Yyk7IH0sDQoJCQknJXgnOiBmdW5jdGlvbiAoZCwgdXRjKSB7IHJldHVybiBEQVRFX0ZPUk1BVF9IQU5ETEVSU1snJW0nXShkLCB1dGMpICsgJy8nICsgREFURV9GT1JNQVRfSEFORExFUlNbJyVkJ10oZCwgdXRjKSArICcvJyArIERBVEVfRk9STUFUX0hBTkRMRVJTWycleSddKGQsIHV0Yyk7IH0sDQoJCQknJVgnOiBmdW5jdGlvbiAoZCwgdXRjKSB7IHJldHVybiBEQVRFX0ZPUk1BVF9IQU5ETEVSU1snJUgnXShkLCB1dGMpICsgJzonICsgREFURV9GT1JNQVRfSEFORExFUlNbJyVNJ10oZCwgdXRjKSArICc6JyArIERBVEVfRk9STUFUX0hBTkRMRVJTWyclUyddKGQsIHV0Yyk7IH0sDQoJCQknJXknOiBmdW5jdGlvbiAoZCwgdXRjKSB7IHJldHVybiBEQVRFX0ZPUk1BVF9IQU5ETEVSU1snJVknXShkLCB1dGMpLnN1YnN0ciAoLTIpOyB9LA0KCQkJJyVZJzogZnVuY3Rpb24gKGQsIHV0YykgeyByZXR1cm4gJycgKyBkWydnZXQnICsgKHV0Yz8gJ1VUQycgOiAnJykgKyAnRnVsbFllYXInXSgpOyB9LA0KCQkJJyVaJzogZnVuY3Rpb24gKGQsIHV0YykgeyB2YXIgbTsgcmV0dXJuICh1dGMgJiYgJ1VUQycpIHx8ICgobSA9IGQudG9TdHJpbmcoKS5tYXRjaCgvW0EtWl1bQS1aXVtBLVpdLykpICYmIG1bMF0pOyB9LA0KCQkJJyUlJzogZnVuY3Rpb24gKCkgeyByZXR1cm4gJyUnIH0NCgkJfSwNCg0KDQoJCXJhbmRvbVNlZWQgPSAxLA0KCQlzdHJpbmdNZXRhdGFibGU7DQoNCg0KDQoNCglmdW5jdGlvbiBnZXRSYW5kb20gKCkgew0KCQlyYW5kb21TZWVkID0gKFJBTkRPTV9NVUxUSVBMSUVSICogcmFuZG9tU2VlZCkgJSBSQU5ET01fTU9EVUxVUzsNCgkJcmV0dXJuIHJhbmRvbVNlZWQgLyBSQU5ET01fTU9EVUxVUzsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiBnZXRWTSAoY29udGV4dCkgew0KCQlpZiAoY29udGV4dCAmJiBjb250ZXh0IGluc3RhbmNlb2Ygc2hpbmUuVk0pIHJldHVybiBjb250ZXh0Ow0KDQoJCXZhciB2bSA9IHNoaW5lLmdldEN1cnJlbnRWTSgpOw0KCQlpZiAoIXZtKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoIkNhbid0IGNhbGwgbGlicmFyeSBmdW5jdGlvbiB3aXRob3V0IHBhc3NpbmcgYSBWTSBvYmplY3QgYXMgdGhlIGNvbnRleHQiKTsNCg0KCQlyZXR1cm4gdm07DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gaXBhaXJzSXRlcmF0b3IgKHRhYmxlLCBpbmRleCkgew0KCQlpZiAoaW5kZXggPT09IHVuZGVmaW5lZCkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdCYWQgYXJndW1lbnQgIzIgdG8gaXBhaXJzKCkgaXRlcmF0b3InKTsNCg0KCQl2YXIgbmV4dEluZGV4ID0gaW5kZXggKyAxLA0KCQkJbnVtVmFsdWVzID0gdGFibGUuX19zaGluZS5udW1WYWx1ZXM7DQoNCgkJaWYgKCFudW1WYWx1ZXMuaGFzT3duUHJvcGVydHkobmV4dEluZGV4KSB8fCBudW1WYWx1ZXNbbmV4dEluZGV4XSA9PT0gdm9pZCAwKSByZXR1cm4gdm9pZCAwOw0KCQlyZXR1cm4gW25leHRJbmRleCwgbnVtVmFsdWVzW25leHRJbmRleF1dOw0KCX0NCgkNCg0KDQoNCglmdW5jdGlvbiBnZXRXZWVrT2ZZZWFyIChkLCBmaXJzdERheSwgdXRjKSB7IA0KCQl2YXIgZGF5T2ZZZWFyID0gcGFyc2VJbnQoREFURV9GT1JNQVRfSEFORExFUlNbJyVqJ10oZCksIDEwKSwNCgkJCWphbjEgPSBuZXcgRGF0ZShkLmdldEZ1bGxZZWFyICgpLCAwLCAxLCAxMiksDQoJCQlvZmZzZXQgPSAoOCAtIGphbjFbJ2dldCcgKyAodXRjPyAnVVRDJyA6ICcnKSArICdEYXknXSgpICsgZmlyc3REYXkpICUgNzsNCg0KCQlyZXR1cm4gKCcwJyArIChNYXRoLmZsb29yKChkYXlPZlllYXIgLSBvZmZzZXQpIC8gNykgKyAxKSkuc3Vic3RyKC0yKTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVQYXR0ZXJuIChwYXR0ZXJuKSB7DQoJCS8vIFRPRE8gQWRkIHN1cHBvcnQgZm9yIGJhbGFuY2VkIGNoYXJhY3RlciBtYXRjaGluZyAobm90IHN1cmUgdGhpcyBpcyBlYXNpbHkgYWNoaWV2ZWFibGUpLg0KCQlwYXR0ZXJuID0gJycgKyBwYXR0ZXJuOw0KDQoJCXZhciBuID0gMCwNCgkJCWksIGwsIGNoYXJhY3RlciwgYWRkU2xhc2g7DQoJCQkJCQ0KCQlmb3IgKGkgaW4gUk9TRVRUQV9TVE9ORSkgaWYgKFJPU0VUVEFfU1RPTkUuaGFzT3duUHJvcGVydHkoaSkpIHBhdHRlcm4gPSBwYXR0ZXJuLnJlcGxhY2UobmV3IFJlZ0V4cChpLCAnZycpLCBST1NFVFRBX1NUT05FW2ldKTsNCgkJbCA9IHBhdHRlcm4ubGVuZ3RoOw0KDQoJCWZvciAoaSA9IDA7IGkgPCBsOyBpKyspIHsNCgkJCWNoYXJhY3RlciA9IHBhdHRlcm4uc3Vic3RyKGksIDEpOw0KCQkJYWRkU2xhc2ggPSBmYWxzZTsNCg0KCQkJaWYgKGNoYXJhY3RlciA9PSAnWycpIHsNCgkJCQlpZiAobikgYWRkU2xhc2ggPSB0cnVlOw0KCQkJCW4rKzsNCg0KCQkJfSBlbHNlIGlmIChjaGFyYWN0ZXIgPT0gJ10nKSB7DQoJCQkJbi0tOw0KCQkJCWlmIChuKSBhZGRTbGFzaCA9IHRydWU7DQoJCQl9DQoNCgkJCWlmIChhZGRTbGFzaCkgew0KCQkJCS8vIHBhdHRlcm4gPSBwYXR0ZXJuLnN1YnN0cigwLCBpKSArICdcXCcgKyBwYXR0ZXJuLnN1YnN0cihpKyspOw0KCQkJCXBhdHRlcm4gPSBwYXR0ZXJuLnN1YnN0cigwLCBpKSArIHBhdHRlcm4uc3Vic3RyKGkrKyArIDEpOw0KCQkJCWwrKzsNCgkJCX0NCgkJfQkJCQ0KDQoJCXJldHVybiBwYXR0ZXJuOwkNCgl9DQoJDQoNCg0KDQoJZnVuY3Rpb24gbG9hZGZpbGUgKGZpbGVuYW1lLCBjYWxsYmFjaykgew0KCQl2YXIgdm0gPSBnZXRWTSh0aGlzKSwNCgkJCWZpbGUsDQoJCQlwYXRoRGF0YTsNCg0KCQl2bS5maWxlTWFuYWdlci5sb2FkKGZpbGVuYW1lLCBmdW5jdGlvbiAoZXJyLCBmaWxlKSB7DQoJCQlpZiAoZXJyKSB7DQoJCQkJdm0uX3RyaWdnZXIoJ21vZHVsZS1sb2FkLWVycm9yJywgW2ZpbGUsIGVycl0pOw0KDQoJCQkJaWYgKGVyciA9PSA0MDQgJiYgL1wubHVhJC8udGVzdChmaWxlbmFtZSkpIHsNCgkJCQkJbG9hZGZpbGUuY2FsbCh2bSwgZmlsZW5hbWUgKyAnLmpzb24nLCBjYWxsYmFjayk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJY2FsbGJhY2soKTsNCgkJCQl9DQoNCgkJCQlyZXR1cm47DQoJCQl9DQoNCgkJCXZhciBmdW5jID0gbmV3IHNoaW5lLkZ1bmN0aW9uKHZtLCBmaWxlLCBmaWxlLmRhdGEsIHZtLl9nbG9iYWxzKTsNCgkJCXZtLl90cmlnZ2VyKCdtb2R1bGUtbG9hZGVkJywgW2ZpbGUsIGZ1bmNdKTsNCgkJCQ0KCQkJY2FsbGJhY2soZnVuYyk7DQoJCX0pOw0KDQoJCXZtLl90cmlnZ2VyKCdsb2FkaW5nLW1vZHVsZScsIGZpbGVuYW1lKTsNCgl9DQoNCg0KDQoNCglzaGluZS5saWIgPSB7DQoJDQoJCQ0KCQlhc3NlcnQ6IGZ1bmN0aW9uICh2LCBtKSB7DQoJCQlpZiAodiA9PT0gZmFsc2UgfHwgdiA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IobSB8fCAnQXNzZXJ0aW9uIGZhaWxlZCEnKTsNCgkJCXJldHVybiBbdiwgbV07DQoJCX0sDQoJDQoJDQoJDQoJDQoJCWNvbGxlY3RnYXJiYWdlOiBmdW5jdGlvbiAob3B0LCBhcmcpIHsNCgkJCS8vIFVuaW1wbGVtZW50ZWQNCgkJfSwNCgkNCgkNCgkNCgkNCgkJZG9maWxlOiBmdW5jdGlvbiAoZmlsZW5hbWUpIHsNCgkJCS8vIFVuaW1wbGVtZW50ZWQNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCWVycm9yOiBmdW5jdGlvbiAobWVzc2FnZSkgewkNCgkJCXRocm93IG5ldyBzaGluZS5FcnJvcihtZXNzYWdlKTsNCgkJfSwNCgkNCgkNCgkNCgkJDQoJCWdldGZlbnY6IGZ1bmN0aW9uIChmKSB7DQoJCQkvLyBVbmltcGxlbWVudGVkDQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQkvKioNCgkJICogSW1wbGVtZW50YXRpb24gb2YgTHVhJ3MgZ2V0bWV0YXRhYmxlIGZ1bmN0aW9uLg0KCQkgKiBAcGFyYW0ge29iamVjdH0gdGFibGUgVGhlIHRhYmxlIGZyb20gd2hpY2ggdG8gb2J0YWluIHRoZSBtZXRhdGFibGUuDQoJCSAqLw0KCQlnZXRtZXRhdGFibGU6IGZ1bmN0aW9uICh0YWJsZSkgew0KCQkJdmFyIG10Ow0KDQoJCQlpZiAodGFibGUgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkgew0KCQkJCWlmICgobXQgPSB0YWJsZS5fX3NoaW5lLm1ldGF0YWJsZSkgJiYgKG10ID0gbXQuX19tZXRhdGFibGUpKSByZXR1cm4gbXQ7DQoJCQkJcmV0dXJuIHRhYmxlLl9fc2hpbmUubWV0YXRhYmxlOw0KDQoJCQl9IGVsc2UgaWYgKHR5cGVvZiB0YWJsZSA9PSAnc3RyaW5nJykgew0KCQkJCXJldHVybiBzdHJpbmdNZXRhdGFibGU7DQoJCQl9DQoJCX0sDQoJCQ0KCQ0KCQ0KCQ0KCQlpcGFpcnM6IGZ1bmN0aW9uICh0YWJsZSkgew0KCQkJaWYgKCEoKHRhYmxlIHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkpIHRocm93IG5ldyBzaGluZS5FcnJvcignQmFkIGFyZ3VtZW50ICMxIGluIGlwYWlycygpLiBUYWJsZSBleHBlY3RlZCcpOw0KCQkJcmV0dXJuIFtpcGFpcnNJdGVyYXRvciwgdGFibGUsIDBdOw0KCQl9LA0KCQ0KCQ0KCQ0KCQkNCgkJbG9hZDogZnVuY3Rpb24gKGZ1bmMsIGNodW5rbmFtZSkgew0KCQkJdmFyIHZtID0gZ2V0Vk0odGhpcyksDQoJCQkJY2h1bmsgPSAnJywgcGllY2UsIGxhc3RQaWVjZTsNCg0KCQkJd2hpbGUgKChwaWVjZSA9IGZ1bmMuYXBwbHkoZnVuYykpICYmIChwaWVjZSA9IHBpZWNlWzBdKSkgew0KCQkJCWNodW5rICs9IChsYXN0UGllY2UgPSBwaWVjZSk7DQoJCQl9DQoNCgkJCXJldHVybiBzaGluZS5saWIubG9hZHN0cmluZy5jYWxsKHZtLCBjaHVuayk7DQoJCX0sDQoJDQoJDQoJDQoJCQ0KCQlsb2FkZmlsZTogZnVuY3Rpb24gKGZpbGVuYW1lKSB7DQoJCQl2YXIgdm0gPSBnZXRWTSh0aGlzKSwNCgkJCQljYWxsYmFjayA9IGZ1bmN0aW9uIChyZXN1bHQpIHsNCgkJCQkJdm0ucmVzdW1lKHJlc3VsdCB8fCBbXSk7DQoJCQkJfTsNCg0KCQkJdm0uc3VzcGVuZCgpOw0KCQkJbG9hZGZpbGUuY2FsbCh2bSwgZmlsZW5hbWUsIGNhbGxiYWNrKTsNCgkJfSwNCgkNCgkNCgkNCgkJDQoJCWxvYWRzdHJpbmc6IGZ1bmN0aW9uIChzdHJpbmcsIGNodW5rbmFtZSkgew0KCQkJdmFyIHZtID0gZ2V0Vk0odGhpcyk7DQoJCQkNCgkJCWlmICh0eXBlb2Ygc3RyaW5nICE9ICdzdHJpbmcnKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ2JhZCBhcmd1bWVudCAjMSB0byBcJ2xvYWRzdHJpbmdcJyAoc3RyaW5nIGV4cGVjdGVkLCBnb3QgJyArIHNoaW5lLnV0aWxzLmNvZXJjZShzdHJpbmcsICdzdHJpbmcnKSArICcpJyk7DQoJCQlpZiAoIXN0cmluZykgcmV0dXJuIG5ldyBzaGluZS5GdW5jdGlvbih2bSk7DQoNCgkJCXZtLnN1c3BlbmQoKTsNCg0KCQkJdm0uZmlsZU1hbmFnZXIubG9hZChzdHJpbmcsIGZ1bmN0aW9uIChlcnIsIGZpbGUpIHsNCgkJCQlpZiAoZXJyKSB7DQoJCQkJCXZtLnJlc3VtZShbXSk7DQoJCQkJCXJldHVybjsNCgkJCQl9DQoNCgkJCQl2YXIgZnVuYyA9IG5ldyBzaGluZS5GdW5jdGlvbih2bSwgZmlsZSwgZmlsZS5kYXRhLCB2bS5fZ2xvYmFscywgc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKSk7DQoJCQkJdm0ucmVzdW1lKFtmdW5jXSk7DQoJCQl9KTsNCgkJfSwNCgkNCgkNCgkJCQ0KCQ0KCQkvKioNCgkJICogSW1wbGVtZW50YXRpb24gb2YgTHVhJ3MgbmV4dCBmdW5jdGlvbi4NCgkJICogQHBhcmFtIHtvYmplY3R9IHRhYmxlIFRoZSB0YWJsZSB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWV0YXRhYmxlLg0KCQkgKiBAcGFyYW0ge29iamVjdH0gaW5kZXggSW5kZXggb2YgdGhlIGl0ZW0gdG8gcmV0dXJuLg0KCQkgKi8NCgkJbmV4dDogZnVuY3Rpb24gKHRhYmxlLCBpbmRleCkgewkNCgkJCS8vIFNMT09PT09PT1cuLi4NCgkJCXZhciBmb3VuZCA9IChpbmRleCA9PT0gdW5kZWZpbmVkKSwNCgkJCQludW1WYWx1ZXMgPSB0YWJsZS5fX3NoaW5lLm51bVZhbHVlcywNCgkJCQlrZXlzLA0KCQkJCWtleSwgdmFsdWUsDQoJCQkJaSwgbDsNCg0KCQkJaWYgKGZvdW5kIHx8ICh0eXBlb2YgaW5kZXggPT0gJ251bWJlcicgJiYgaW5kZXggPiAwICYmIGluZGV4ID09IGluZGV4ID4+IDApKSB7DQoJCQkJaWYgKCdrZXlzJyBpbiBPYmplY3QpIHsNCgkJCQkJLy8gVXNlIE9iamVjdC5rZXlzLCBpZiBhdmFpbGFibGUuDQoJCQkJCWtleXMgPSBPYmplY3RbJ2tleXMnXShudW1WYWx1ZXMpOw0KCQkJCQkNCgkJCQkJaWYgKGZvdW5kKSB7DQoJCQkJCQkvLyBGaXJzdCBwYXNzDQoJCQkJCQlpID0gMTsNCg0KCQkJCQl9IGVsc2UgaWYgKGkgPSBrZXlzLmluZGV4T2YoJycgKyBpbmRleCkgKyAxKSB7DQoJCQkJCQlmb3VuZCA9IHRydWU7DQoJCQkJCX0gDQoNCgkJCQkJaWYgKGZvdW5kKSB7DQoJCQkJCQl3aGlsZSAoKGtleSA9IGtleXNbaV0pICE9PSB2b2lkIDAgJiYgKHZhbHVlID0gbnVtVmFsdWVzW2tleV0pID09PSB2b2lkIDApIGkrKzsNCgkJCQkJCWlmICh2YWx1ZSAhPT0gdm9pZCAwKSByZXR1cm4gW2tleSA+Pj0gMCwgdmFsdWVdOw0KCQkJCQl9DQoNCgkJCQl9IGVsc2Ugew0KCQkJCQkvLyBFbHNlIHVzZSBmb3ItaW4gKGZhc3RlciB0aGFuIGZvciBsb29wIG9uIHRhYmxlcyB3aXRoIGxhcmdlIGhvbGVzKQ0KDQoJCQkJCWZvciAobCBpbiBudW1WYWx1ZXMpIHsJDQoJCQkJCQlpID0gbCA+PiAwOw0KDQoJCQkJCQlpZiAoIWZvdW5kKSB7DQoJCQkJCQkJaWYgKGkgPT09IGluZGV4KSBmb3VuZCA9IHRydWU7DQoJCQkNCgkJCQkJCX0gZWxzZSBpZiAobnVtVmFsdWVzW2ldICE9PSB1bmRlZmluZWQpIHsNCgkJCQkJCQlyZXR1cm4gW2ksIG51bVZhbHVlc1tpXV07DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCQkNCgkJCWZvciAoaSBpbiB0YWJsZSkgew0KCQkJCWlmICh0YWJsZS5oYXNPd25Qcm9wZXJ0eShpKSAmJiAhKGkgaW4gc2hpbmUuVGFibGUucHJvdG90eXBlKSAmJiBpICE9PSAnX19zaGluZScpIHsNCgkJCQkJaWYgKCFmb3VuZCkgew0KCQkJCQkJaWYgKGkgPT0gaW5kZXgpIGZvdW5kID0gdHJ1ZTsNCgkNCgkJCQkJfSBlbHNlIGlmICh0YWJsZS5oYXNPd25Qcm9wZXJ0eShpKSAmJiB0YWJsZVtpXSAhPT0gdW5kZWZpbmVkICYmICgnJyArIGkpLnN1YnN0cigwLCAyKSAhPSAnX18nKSB7DQoJCQkJCQlyZXR1cm4gW2ksIHRhYmxlW2ldXTsNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCgkNCgkJCWZvciAoaSBpbiB0YWJsZS5fX3NoaW5lLmtleXMpIHsNCgkJCQlpZiAodGFibGUuX19zaGluZS5rZXlzLmhhc093blByb3BlcnR5KGkpKSB7DQoJCQkJCXZhciBrZXkgPSB0YWJsZS5fX3NoaW5lLmtleXNbaV07DQoJDQoJCQkJCWlmICghZm91bmQpIHsNCgkJCQkJCWlmIChrZXkgPT09IGluZGV4KSBmb3VuZCA9IHRydWU7DQoJCQ0KCQkJCQl9IGVsc2UgaWYgKHRhYmxlLl9fc2hpbmUudmFsdWVzW2ldICE9PSB1bmRlZmluZWQpIHsNCgkJCQkJCXJldHVybiBba2V5LCB0YWJsZS5fX3NoaW5lLnZhbHVlc1tpXV07DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCQ0KCQkJcmV0dXJuIHNoaW5lLmdjLmNyZWF0ZUFycmF5KCk7DQoJCX0sDQoJDQoJDQoJDQoJDQoJCS8qKg0KCQkgKiBJbXBsZW1lbnRhdGlvbiBvZiBMdWEncyBwYWlycyBmdW5jdGlvbi4NCgkJICogQHBhcmFtIHtvYmplY3R9IHRhYmxlIFRoZSB0YWJsZSB0byBiZSBpdGVyYXRlZCBvdmVyLg0KCQkgKi8NCgkJcGFpcnM6IGZ1bmN0aW9uICh0YWJsZSkgew0KCQkJaWYgKCEoKHRhYmxlIHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkpIHRocm93IG5ldyBzaGluZS5FcnJvcignQmFkIGFyZ3VtZW50ICMxIGluIHBhaXJzKCkuIFRhYmxlIGV4cGVjdGVkJyk7DQoJCQlyZXR1cm4gW3NoaW5lLmxpYi5uZXh0LCB0YWJsZV07DQoJCX0sDQoJDQoJCQ0KCQ0KCQ0KCQlwY2FsbDogZnVuY3Rpb24gKGZ1bmMpIHsNCgkJCXZhciBhcmdzID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKSwNCgkJCQlyZXN1bHQ7DQoJCQkJDQoJCQlmb3IgKHZhciBpID0gMSwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIGFyZ3MucHVzaCAoYXJndW1lbnRzW2ldKTsNCgkNCgkJCXRyeSB7CQkJDQoJCQkJaWYgKHR5cGVvZiBmdW5jID09ICdmdW5jdGlvbicpIHsNCgkJCQkJcmVzdWx0ID0gZnVuYy5hcHBseShudWxsLCBhcmdzKTsNCgkJCQkJDQoJCQkJfSBlbHNlIGlmICgoZnVuYyB8fCBzaGluZS5FTVBUWV9PQkopIGluc3RhbmNlb2Ygc2hpbmUuRnVuY3Rpb24pIHsNCgkJCQkJcmVzdWx0ID0gZnVuYy5hcHBseShudWxsLCBhcmdzLCB0cnVlKTsNCg0KCQkJCX0gZWxzZSB7DQoJCQkJCXRocm93IG5ldyBzaGluZS5FcnJvcignQXR0ZW1wdCB0byBjYWxsIG5vbi1mdW5jdGlvbicpOw0KCQkJCX0NCgkNCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQlyZXR1cm4gW2ZhbHNlLCBlICYmIGUubWVzc2FnZSB8fCBlXTsNCgkJCX0NCgkJCQ0KCQkJaWYgKCEoKHJlc3VsdCB8fCBzaGluZS5FTVBUWV9PQkopIGluc3RhbmNlb2YgQXJyYXkpKSByZXN1bHQgPSBbcmVzdWx0XTsNCgkJCXJlc3VsdC51bnNoaWZ0KHRydWUpOw0KCQkJDQoJCQlyZXR1cm4gcmVzdWx0Ow0KCQl9LA0KCQ0KDQoJCQ0KCQ0KCQlwcmludDogZnVuY3Rpb24gKCkgew0KCQkJdmFyIG91dHB1dCA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCksDQoJCQkJaXRlbTsNCgkJCQ0KCQkJZm9yICh2YXIgaSA9IDAsIGwgPSBhcmd1bWVudHMubGVuZ3RoOyBpPCBsOyBpKyspIHsNCgkJCQlvdXRwdXQucHVzaChzaGluZS5saWIudG9zdHJpbmcoYXJndW1lbnRzW2ldKSk7DQoJCQl9DQoJDQoJCQlyZXR1cm4gc2hpbmUuc3Rkb3V0LndyaXRlKG91dHB1dC5qb2luKCdcdCcpKTsNCgkJfSwNCgkNCgkNCgkNCgkNCgkJcmF3ZXF1YWw6IGZ1bmN0aW9uICh2MSwgdjIpIHsNCgkJCXJldHVybiAodjEgPT09IHYyKTsNCgkJfSwNCgkNCgkNCgkNCgkNCgkJcmF3Z2V0OiBmdW5jdGlvbiAodGFibGUsIGluZGV4KSB7DQoJCQlpZiAoISgodGFibGUgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlKSkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdCYWQgYXJndW1lbnQgIzEgaW4gcmF3Z2V0KCkuIFRhYmxlIGV4cGVjdGVkJyk7DQoJCQlyZXR1cm4gdGFibGVbaW5kZXhdOw0KCQl9LA0KCQ0KCQ0KCQ0KCQ0KCQlyYXdzZXQ6IGZ1bmN0aW9uICh0YWJsZSwgaW5kZXgsIHZhbHVlKSB7DQoJCQlpZiAoISgodGFibGUgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlKSkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdCYWQgYXJndW1lbnQgIzEgaW4gcmF3c2V0KCkuIFRhYmxlIGV4cGVjdGVkJyk7DQoJCQlpZiAoaW5kZXggPT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ0JhZCBhcmd1bWVudCAjMiBpbiByYXdzZXQoKS4gTmlsIG5vdCBhbGxvd2VkJyk7DQoJDQoJCQl0YWJsZVtpbmRleF0gPSB2YWx1ZTsNCgkJCXJldHVybiB0YWJsZTsNCgkJfSwNCgkNCg0KDQoNCgkJcmVxdWlyZTogZnVuY3Rpb24gKG1vZG5hbWUpIHsNCgkJCXZhciB2bSA9IGdldFZNKHRoaXMpLA0KCQkJCXBhY2thZ2VMaWIgPSB2bS5fZ2xvYmFsc1sncGFja2FnZSddLA0KCQkJCWN1cnJlbnQgPSBzaGluZS5DbG9zdXJlLl9jdXJyZW50LA0KCQkJCW1vZHVsZSwNCgkJCQlwcmVsb2FkLA0KCQkJCXBhdGhzLA0KCQkJCXBhdGgsDQoJCQkJZmlsZW5hbWUsIA0KCQkJCWRhdGEsDQoJCQkJZmFpbGVkUGF0aHMgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpOw0KDQoNCgkJCWZ1bmN0aW9uIGN1cnJ5TG9hZCAoZnVuYykgew0KCQkJCXJldHVybiBmdW5jdGlvbiAoKSB7DQoJCQkJCXJldHVybiBsb2FkKGZ1bmMpOw0KCQkJCX0NCgkJCX07DQoNCg0KCQkJZnVuY3Rpb24gbG9hZCAocHJlbG9hZEZ1bmMpIHsNCgkJCQl2YXIgcmVzdWx0Ow0KDQoJCQkJaWYgKHZtLl9yZXN1bWVTdGFjay5sZW5ndGgpIHsNCgkJCQkJcmVzdWx0ID0gdm0uX3Jlc3VtZVN0YWNrLnBvcCgpLl9ydW4oKTsNCg0KCQkJCX0gZWxzZSBpZiAoc2hpbmUuZGVidWcgJiYgc2hpbmUuZGVidWcuX3Jlc3VtZVN0YWNrICYmIHNoaW5lLmRlYnVnLl9yZXN1bWVTdGFjay5sZW5ndGgpIHsNCgkJCQkJcmVzdWx0ID0gc2hpbmUuZGVidWcuX3Jlc3VtZVN0YWNrLnBvcCgpLl9ydW4oKTsNCg0KCQkJCX0gZWxzZSB7DQoJCQkJCXBhY2thZ2VMaWIubG9hZGVkW21vZG5hbWVdID0gdHJ1ZTsNCgkJCQkJcmVzdWx0ID0gcHJlbG9hZEZ1bmMuY2FsbChudWxsLCBtb2RuYW1lKTsNCgkJCQl9DQoNCgkJCQlpZiAodm0uX3N0YXR1cyA9PSBzaGluZS5TVVNQRU5ESU5HICYmICFyZXN1bHQpIHsNCgkJCQkJY3VycmVudC5fcGMtLTsNCgkJCQkJdm0uX3Jlc3VtZVN0YWNrLnB1c2goY3VycnlMb2FkKHByZWxvYWRGdW5jKSk7DQoJCQkJCXJldHVybjsNCg0KCQkJCX0gZWxzZSBpZiAoc2hpbmUuZGVidWcgJiYgc2hpbmUuZGVidWcuX3N0YXR1cyA9PSBzaGluZS5TVVNQRU5ESU5HICYmICFyZXN1bHQpIHsNCgkJCQkJY3VycmVudC5fcGMtLTsNCgkJCQkJc2hpbmUuZGVidWcuX3Jlc3VtZVN0YWNrLnB1c2goY3VycnlMb2FkKHByZWxvYWRGdW5jKSk7DQoJCQkJCXJldHVybjsNCgkJCQl9DQoJCQ0KDQoJCQkJaWYgKCFyZXN1bHQpIHJldHVybjsNCgkJCQltb2R1bGUgPSByZXN1bHRbMF07DQoNCgkJCQlpZiAobW9kdWxlICE9PSB1bmRlZmluZWQpIHBhY2thZ2VMaWIubG9hZGVkLnNldE1lbWJlcihtb2RuYW1lLCBtb2R1bGUpOw0KCQkJCXJldHVybiBwYWNrYWdlTGliLmxvYWRlZFttb2RuYW1lXTsNCgkJCX0NCg0KCQkJbW9kbmFtZSA9IHNoaW5lLnV0aWxzLmNvZXJjZVRvU3RyaW5nKG1vZG5hbWUpOw0KCQkJaWYgKG1vZHVsZSA9IHBhY2thZ2VMaWIubG9hZGVkW21vZG5hbWVdKSByZXR1cm4gbW9kdWxlOw0KCQkJaWYgKHByZWxvYWQgPSBwYWNrYWdlTGliLnByZWxvYWRbbW9kbmFtZV0pIHJldHVybiBsb2FkKHByZWxvYWQpOw0KDQoJCQlmaWxlbmFtZSA9IG1vZG5hbWUucmVwbGFjZSgvXC4vZywgIi8iKSArICcubHVhLmpzb24nOw0KCQkJZGF0YSA9IHZtLmZpbGVNYW5hZ2VyLl9jYWNoZVtmaWxlbmFtZV07DQoNCgkJCWlmIChkYXRhKSB7DQoJCQkJdmFyIGZpbGUgPSBuZXcgc2hpbmUuRmlsZShmaWxlbmFtZSwgZGF0YSk7DQoJCQkJcHJlbG9hZCA9IG5ldyBzaGluZS5GdW5jdGlvbih2bSwgZmlsZSwgZmlsZS5kYXRhLCB2bS5fZ2xvYmFscyk7DQoJCQkJcGFja2FnZUxpYi5wcmVsb2FkW21vZG5hbWVdID0gcHJlbG9hZDsNCgkJCQlyZXR1cm4gbG9hZChwcmVsb2FkKTsNCgkJCX0NCg0KCQkJcGF0aHMgPSBwYWNrYWdlTGliLnBhdGgucmVwbGFjZSgvOzsvZywgJzsnKS5zcGxpdCgnOycpOw0KCQkJdm0uc3VzcGVuZCgpOw0KDQoNCgkJCWZ1bmN0aW9uIGxvYWROZXh0UGF0aCAoKSB7DQoJCQkJcGF0aCA9IHBhdGhzLnNoaWZ0KCk7DQoNCgkJCQlpZiAoIXBhdGgpIHsNCgkJCQkJdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdtb2R1bGUgXCcnICsgbW9kbmFtZSArICdcJyBub3QgZm91bmQ6JyArICdcbglubyBmaWVsZCBwYWNrYWdlLnByZWxvYWRbXCcnICsgbW9kbmFtZSArICdcJ11cbicgKyBmYWlsZWRQYXRocy5qb2luKCdcbicpKTsNCgkJCQ0KCQkJCX0gZWxzZSB7DQoJCQkJCXBhdGggPSBwYXRoLnJlcGxhY2UoL1w/L2csIG1vZG5hbWUucmVwbGFjZSgvXC4vZywgJy8nKSk7DQoNCgkJCQkJbG9hZGZpbGUuY2FsbCh2bSwgcGF0aCwgZnVuY3Rpb24gKHByZWxvYWQpIHsNCg0KCQkJCQkJaWYgKHByZWxvYWQpIHsNCgkJCQkJCQlwYWNrYWdlTGliLnByZWxvYWRbbW9kbmFtZV0gPSBwcmVsb2FkOw0KCQkJCQkJCXNoaW5lLkNsb3N1cmUuX2N1cnJlbnQuX3BjLS07DQoJCQkJCQkJdm0ucmVzdW1lKCk7DQoNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJZmFpbGVkUGF0aHMucHVzaCgnCW5vIGZpbGUgXCcnICsgcGF0aCArICdcJycpOw0KCQkJCQkJCWxvYWROZXh0UGF0aCgpOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCgkJCQl9DQoJCQl9DQoNCgkJCWxvYWROZXh0UGF0aCgpOw0KCQl9LAkNCgkNCg0KDQoJDQoJCXNlbGVjdDogZnVuY3Rpb24gKGluZGV4KSB7DQoJCQl2YXIgYXJncyA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCk7DQoJCQkNCgkJCWlmIChpbmRleCA9PSAnIycpIHsNCgkJCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCAtIDE7DQoJCQkJDQoJCQl9IGVsc2UgaWYgKGluZGV4ID0gcGFyc2VJbnQoaW5kZXgsIDEwKSkgew0KCQkJCXJldHVybiBhcmd1bWVudHMuY29uc3RydWN0b3IgPT09IEFycmF5PyBhcmd1bWVudHMuc2xpY2UoaW5kZXgpIDogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCBpbmRleCk7DQoJCQkJDQoJCQl9IGVsc2Ugew0KCQkJCXRocm93IG5ldyBzaGluZS5FcnJvcignYmFkIGFyZ3VtZW50ICMxIGluIHNlbGVjdCgpLiBOdW1iZXIgb3IgIiMiIGV4cGVjdGVkJyk7DQoJCQl9DQoJCX0sDQoJCQ0KCQ0KCQkNCgkJDQoJCS8qKg0KCQkgKiBJbXBsZW1lbnRhdGlvbiBvZiBMdWEncyBzZXRtZXRhdGFibGUgZnVuY3Rpb24uDQoJCSAqIEBwYXJhbSB7b2JqZWN0fSB0YWJsZSBUaGUgdGFibGUgdGhhdCB3aWxsIHJlY2VpdmUgdGhlIG1ldGF0YWJsZS4NCgkJICogQHBhcmFtIHtvYmplY3R9IG1ldGF0YWJsZSBUaGUgbWV0YXRhYmxlIHRvIGF0dGFjaC4NCgkJICovDQoJCXNldG1ldGF0YWJsZTogZnVuY3Rpb24gKHRhYmxlLCBtZXRhdGFibGUpIHsNCgkJCXZhciBtdDsNCg0KCQkJaWYgKCEoKHRhYmxlIHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkpIHRocm93IG5ldyBzaGluZS5FcnJvcignQmFkIGFyZ3VtZW50ICMxIGluIHNldG1ldGF0YWJsZSgpLiBUYWJsZSBleHBlY3RlZCcpOwkNCgkJCWlmICghKG1ldGF0YWJsZSA9PT0gdW5kZWZpbmVkIHx8IChtZXRhdGFibGUgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlKSkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdCYWQgYXJndW1lbnQgIzIgaW4gc2V0bWV0YXRhYmxlKCkuIE5pbCBvciB0YWJsZSBleHBlY3RlZCcpOwkNCgkJCWlmICgobXQgPSB0YWJsZS5fX3NoaW5lLm1ldGF0YWJsZSkgJiYgKG10ID0gbXQuX19tZXRhdGFibGUpKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ2Nhbm5vdCBjaGFuZ2UgYSBwcm90ZWN0ZWQgbWV0YXRhYmxlJyk7DQoNCgkJCXNoaW5lLmdjLmluY3JSZWYobWV0YXRhYmxlKTsNCgkJCXNoaW5lLmdjLmRlY3JSZWYodGFibGUuX19zaGluZS5tZXRhdGFibGUpOw0KDQoJCQl0YWJsZS5fX3NoaW5lLm1ldGF0YWJsZSA9IG1ldGF0YWJsZTsNCg0KCQkJcmV0dXJuIHRhYmxlOw0KCQl9LA0KCQkNCgkNCgkNCgkJDQoJCXRvbnVtYmVyOiBmdW5jdGlvbiAoZSwgYmFzZSkgew0KCQkJdmFyIG1hdGNoLCBjaGFycywgcGF0dGVybjsNCg0KCQkJaWYgKGUgPT09ICcnKSByZXR1cm47DQogICAgICAgICAgICAgDQogICAgICAgICAgICBiYXNlID0gYmFzZSB8fCAxMDsNCg0KCQkJaWYgKGJhc2UgPCAyIHx8IGJhc2UgPiAzNikgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdiYWQgYXJndW1lbnQgIzIgdG8gdG9udW1iZXIoKSAoYmFzZSBvdXQgb2YgcmFuZ2UpJyk7DQoJCQlpZiAoYmFzZSA9PSAxMCAmJiAoZSA9PT0gSW5maW5pdHkgfHwgZSA9PT0gLUluZmluaXR5IHx8ICh0eXBlb2YgZSA9PSAnbnVtYmVyJyAmJiB3aW5kb3cuaXNOYU4oZSkpKSkgcmV0dXJuIGU7DQoNCgkJCWlmIChiYXNlICE9IDEwICYmIGUgPT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ2JhZCBhcmd1bWVudCAjMSB0byBcJ3RvbnVtYmVyXCcgKHN0cmluZyBleHBlY3RlZCwgZ290IG5pbCknKTsNCiAgICAgICAgICAgIGUgPSAoJycgKyBlKS5yZXBsYWNlKC9eXHMrfFxzKyQvZywgJycpOyAgICAvLyBUcmltDQoNCiAgICAgICAgICAgIC8vIElmIHVzaW5nIGJhc2UgMTAsIHVzZSBub3JtYWwgY29lcmNpb24uDQoJCQlpZiAoYmFzZSA9PSAxMCkgcmV0dXJuIHNoaW5lLnV0aWxzLmNvZXJjZVRvTnVtYmVyKGUpOw0KDQoJCQllID0gc2hpbmUudXRpbHMuY29lcmNlVG9TdHJpbmcoZSk7DQoNCiAgICAgICAgICAgIC8vIElmIHVzaW5nIGJhc2UgMTYsIGluZ29yZSBhbnkgIjB4IiBwcmVmaXgNCgkJCWlmIChiYXNlID09IDE2ICYmIChtYXRjaCA9IGUubWF0Y2goL14oXC0pPzBbeFhdKC4rKSQvKSkpIGUgPSAobWF0Y2hbMV0gfHwgJycpICsgbWF0Y2hbMl07DQoNCgkJCWNoYXJzID0gJzAxMjM0NTY3ODlBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWic7DQoJCQlwYXR0ZXJuID0gbmV3IFJlZ0V4cCgnXlsnICsgY2hhcnMuc3Vic3RyKDAsIGJhc2UpICsgJ10qJCcsICdnaScpOw0KDQoJCQlpZiAoIXBhdHRlcm4udGVzdChlKSkgcmV0dXJuOwkvLyBJbnZhbGlkDQoJCQlyZXR1cm4gcGFyc2VJbnQoZSwgYmFzZSk7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQl0b3N0cmluZzogZnVuY3Rpb24gKGUpIHsNCgkJCXZhciBtdCwgbW07DQoNCgkJCWlmIChlICE9PSB1bmRlZmluZWQgJiYgZSBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlICYmIChtdCA9IGUuX19zaGluZS5tZXRhdGFibGUpICYmIChtbSA9IG10LmdldE1lbWJlcignX190b3N0cmluZycpKSkgcmV0dXJuIG1tLmNhbGwobW0sIGUpOw0KDQoJCQlpZiAoZSAmJiAoZSBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlIHx8IGUgaW5zdGFuY2VvZiBzaGluZS5GdW5jdGlvbikpIHJldHVybiBlLnRvU3RyaW5nKCk7DQoJCQlpZiAodHlwZW9mIGUgPT0gJ2Z1bmN0aW9uJykgcmV0dXJuICdmdW5jdGlvbjogW2hvc3QgY29kZV0nOw0KDQoJCQlyZXR1cm4gc2hpbmUudXRpbHMuY29lcmNlVG9TdHJpbmcoZSkgfHwgJ3VzZXJkYXRhJzsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCXR5cGU6IGZ1bmN0aW9uICh2KSB7DQoJCQl2YXIgdCA9IHR5cGVvZiB2Ow0KCQ0KCQkJc3dpdGNoICh0KSB7DQoJCQkJY2FzZSAndW5kZWZpbmVkJzogDQoJCQkJCXJldHVybiAnbmlsJzsNCgkJCQkNCgkJCQljYXNlICdudW1iZXInOiANCgkJCQljYXNlICdzdHJpbmcnOiANCgkJCQljYXNlICdib29sZWFuJzogDQoJCQkJY2FzZSAnZnVuY3Rpb24nOiANCgkJCQkJcmV0dXJuIHQ7DQoJCQkJIA0KCQkJCWNhc2UgJ29iamVjdCc6IA0KCQkJCQlpZiAodi5jb25zdHJ1Y3RvciA9PT0gc2hpbmUuVGFibGUpIHJldHVybiAndGFibGUnOw0KCQkJCQlpZiAoKHYgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIHNoaW5lLkZ1bmN0aW9uKSByZXR1cm4gJ2Z1bmN0aW9uJzsNCgkJCQkNCgkJCQkJcmV0dXJuICd1c2VyZGF0YSc7DQoJCQl9DQoJCX0sDQoJCQ0KCQkNCgkNCgkJdW5wYWNrOiBmdW5jdGlvbiAodGFibGUsIGksIGopIHsNCgkJCS8vIHY1LjI6IHNoaW5lLndhcm4gKCd1bnBhY2sgaXMgZGVwcmVjYXRlZC4gVXNlIHRhYmxlLnVucGFjayBpbnN0ZWFkLicpOw0KCQkJcmV0dXJuIHNoaW5lLmxpYi50YWJsZS51bnBhY2sodGFibGUsIGksIGopOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJX1ZFUlNJT046ICdMdWEgNS4xJywNCgkJDQoJCQ0KCQkNCgkJDQoJCXhwY2FsbDogZnVuY3Rpb24gKGZ1bmMsIGVycikgew0KCQkJdmFyIHJlc3VsdCwgc3VjY2VzcywgaW52YWxpZDsNCgkJCQkNCgkJCXRyeSB7DQoJCQkJaWYgKHR5cGVvZiBmdW5jID09ICdmdW5jdGlvbicpIHsNCgkJCQkJcmVzdWx0ID0gZnVuYy5hcHBseSgpOw0KCQkJCQkNCgkJCQl9IGVsc2UgaWYgKChmdW5jIHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBzaGluZS5GdW5jdGlvbikgew0KCQkJCQlyZXN1bHQgPSBmdW5jLmFwcGx5KG51bGwsIHVuZGVmaW5lZCwgdHJ1ZSk7DQoNCgkJCQl9IGVsc2Ugew0KCQkJCQlpbnZhbGlkID0gdHJ1ZTsNCgkJCQl9DQoNCgkJCQlzdWNjZXNzID0gdHJ1ZTsNCgkJCQkNCgkJCX0gY2F0Y2ggKGUpIHsNCgkJCQlyZXN1bHQgPSBlcnIuYXBwbHkobnVsbCwgdW5kZWZpbmVkLCB0cnVlKTsNCgkJCQlpZiAoKChyZXN1bHQgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIEFycmF5KSkgcmVzdWx0ID0gcmVzdWx0WzBdOw0KCQ0KCQkJCXN1Y2Nlc3MgPSBmYWxzZTsNCgkJCX0NCg0KCQkJaWYgKGludmFsaWQpIHRocm93IG5ldyBzaGluZS5FcnJvcignQXR0ZW1wdCB0byBjYWxsIG5vbi1mdW5jdGlvbicpOw0KCQkJDQoJCQlpZiAoISgocmVzdWx0IHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBBcnJheSkpIHJlc3VsdCA9IFtyZXN1bHRdOw0KCQkJcmVzdWx0LnVuc2hpZnQoc3VjY2Vzcyk7DQoJCQkNCgkJCXJldHVybiByZXN1bHQ7DQoJCX0NCgkNCgkNCgl9Ow0KCQ0KCQ0KCQ0KCQ0KCXNoaW5lLmxpYi5jb3JvdXRpbmUgPSBuZXcgc2hpbmUuVGFibGUoew0KDQoJCQ0KCQljcmVhdGU6IGZ1bmN0aW9uIChjbG9zdXJlKSB7DQoJCQkvL3JldHVybiBuZXcgc2hpbmUuQ29yb3V0aW5lIChjbG9zdXJlKTsNCgkJCXJldHVybiBzaGluZS5Db3JvdXRpbmUuY3JlYXRlKGNsb3N1cmUpOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJcmVzdW1lOiBmdW5jdGlvbiAodGhyZWFkKSB7DQoJCQlpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHJldHVybiB0aHJlYWQucmVzdW1lLmNhbGwodGhyZWFkKTsNCg0KCQkJdmFyIGFyZ3MgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpOw0KCQkJZm9yICh2YXIgaSA9IDEsIGwgPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKSBhcmdzLnB1c2goYXJndW1lbnRzW2ldKTsJDQoNCgkJCXJldHVybiB0aHJlYWQucmVzdW1lLmFwcGx5KHRocmVhZCwgYXJncyk7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQlydW5uaW5nOiBmdW5jdGlvbiAoKSB7DQoJCQl2YXIgdm0gPSBnZXRWTSh0aGlzKTsNCgkJCXJldHVybiB2bS5fY29yb3V0aW5lUnVubmluZzsNCgkJfSwNCgkJDQoJDQoJCQ0KCQkNCgkJc3RhdHVzOiBmdW5jdGlvbiAoY28pIHsNCgkJCXN3aXRjaCAoY28uc3RhdHVzKSB7DQoJCQkJY2FzZSBzaGluZS5SVU5OSU5HOiByZXR1cm4gKGNvID09PSBnZXRWTSgpLl9jb3JvdXRpbmVSdW5uaW5nKT8gJ3J1bm5pbmcnIDogJ25vcm1hbCc7DQoJCQkJY2FzZSBzaGluZS5TVVNQRU5ERUQ6IHJldHVybiAnc3VzcGVuZGVkJzsNCgkJCQljYXNlIHNoaW5lLkRFQUQ6IHJldHVybiAnZGVhZCc7DQoJCQl9DQoJCX0sDQoJCQ0KCQ0KCQkNCgkJDQoJCXdyYXA6IGZ1bmN0aW9uIChjbG9zdXJlKSB7DQoJCQl2YXIgY28gPSBzaGluZS5saWIuY29yb3V0aW5lLmNyZWF0ZShjbG9zdXJlKSwNCgkJCQl2bSA9IGdldFZNKHRoaXMpOw0KCQkJDQoJCQl2YXIgcmVzdWx0ID0gZnVuY3Rpb24gKCkgewkJCQ0KCQkJCXZhciBhcmdzID0gW2NvXTsNCgkJCQlmb3IgKHZhciBpID0gMCwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIGFyZ3MucHVzaChhcmd1bWVudHNbaV0pOwkNCgkNCgkJCQl2YXIgcmV0dmFscyA9IHNoaW5lLmxpYi5jb3JvdXRpbmUucmVzdW1lLmFwcGx5KG51bGwsIGFyZ3MpLA0KCQkJCQlzdWNjZXNzOw0KDQoJCQkJaWYgKCFyZXR2YWxzICYmICh2bS5fc3RhdHVzID09IHNoaW5lLlNVU1BFTkRJTkcgfHwgKHNoaW5lLmRlYnVnICYmIHNoaW5lLmRlYnVnLl9zdGF0dXMgPT0gc2hpbmUuU1VTUEVORElORykpKSByZXR1cm47DQoJCQkJc3VjY2VzcyA9IHJldHZhbHMuc2hpZnQoKTsNCgkJCQkJDQoJCQkJaWYgKHN1Y2Nlc3MpIHJldHVybiByZXR2YWxzOw0KCQkJCXRocm93IHJldHZhbHNbMF07DQoJCQl9Ow0KCQkJDQoJCQlyZXN1bHQuX2Nvcm91dGluZSA9IGNvOw0KCQkJcmV0dXJuIHJlc3VsdDsNCgkJfSwNCgkJDQoJDQoJCQ0KCQkNCgkJeWllbGQ6IGZ1bmN0aW9uICgpIHsNCgkJCXZhciBydW5uaW5nID0gZ2V0Vk0oKS5fY29yb3V0aW5lUnVubmluZywNCgkJCQlhcmdzOw0KDQoJCQkvLyBJZiBydW5uaW5nIGluIG1haW4gdGhyZWFkLCB0aHJvdyBlcnJvci4NCgkJCWlmICghcnVubmluZykgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdhdHRlbXB0IHRvIHlpZWxkIGFjcm9zcyBtZXRhbWV0aG9kL0MtY2FsbCBib3VuZGFyeSAobm90IGluIGNvcm91dGluZSknKTsNCgkJCWlmIChydW5uaW5nLnN0YXR1cyAhPSBzaGluZS5SVU5OSU5HKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ2F0dGVtcHQgdG8geWllbGQgbm9uLXJ1bm5pbmcgY29yb3V0aW5lIGluIGhvc3QnKTsNCg0KCQkJYXJncyA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCk7DQoJCQlmb3IgKHZhciBpID0gMCwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIGFyZ3MucHVzaChhcmd1bWVudHNbaV0pOwkNCgkNCgkJCXJ1bm5pbmcuX3lpZWxkVmFycyA9IGFyZ3M7DQoJCQlydW5uaW5nLnN0YXR1cyA9IHNoaW5lLlNVU1BFTkRJTkc7DQoNCgkJCXJldHVybiB7DQoJCQkJcmVzdW1lOiBmdW5jdGlvbiAoKSB7DQoJCQkJCXZhciBhcmdzID0gW3J1bm5pbmddLA0KCQkJCQkJaSwgDQoJCQkJCQlsID0gYXJndW1lbnRzLmxlbmd0aCwNCgkJCQkJCWYgPSBmdW5jdGlvbiAoKSB7IA0KCQkJCQkJCXNoaW5lLmxpYi5jb3JvdXRpbmUucmVzdW1lLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7IA0KCQkJCQkJfTsNCg0KCQkJCQlpZiAoYXJndW1lbnRzLmxlbmd0aCA9PSAxICYmIGFyZ3VtZW50c1swXSA9PT0gdW5kZWZpbmVkKSBsID0gMDsNCgkJCQkJZm9yIChpID0gMDsgaSA8IGw7IGkrKykgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7DQoNCgkJCQkJaWYgKHJ1bm5pbmcuc3RhdHVzID09IHNoaW5lLlNVU1BFTkRJTkcpIHsNCgkJCQkJCXdpbmRvdy5zZXRUaW1lb3V0KGYsIDEpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJZigpOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQl9DQoJCQkNCgl9KTsNCg0KDQoJDQoNCglzaGluZS5saWIuZGVidWcgPSBuZXcgc2hpbmUuVGFibGUoew0KDQoJCWRlYnVnOiBmdW5jdGlvbiAoKSB7DQoJCQkvLyBOb3QgaW1wbGVtZW50ZWQNCgkJfSwNCg0KDQoJCWdldGZlbnY6IGZ1bmN0aW9uIChvKSB7DQoJCQkvLyBOb3QgaW1wbGVtZW50ZWQNCgkJfSwNCg0KDQoJCWdldGhvb2s6IGZ1bmN0aW9uICh0aHJlYWQpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KDQoNCgkJZ2V0aW5mbzogZnVuY3Rpb24gKHRocmVhZCwgZnVuYywgd2hhdCkgew0KCQkJLy8gTm90IGltcGxlbWVudGVkDQoJCX0sDQoNCg0KCQlnZXRsb2NhbDogZnVuY3Rpb24gKHRocmVhZCwgbGV2ZWwsIGxvY2FsKSB7DQoJCQkvLyBOb3QgaW1wbGVtZW50ZWQNCgkJfSwNCg0KDQoJCWdldG1ldGF0YWJsZTogZnVuY3Rpb24gKG9iamVjdCkgew0KCQkJLy8gTm90IGltcGxlbWVudGVkDQoJCX0sDQoNCg0KCQlnZXRyZWdpc3RyeTogZnVuY3Rpb24gKCkgew0KCQkJLy8gTm90IGltcGxlbWVudGVkDQoJCX0sDQoNCg0KCQlnZXR1cHZhbHVlOiBmdW5jdGlvbiAoZnVuYywgdXApIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KDQoNCgkJc2V0ZmVudjogZnVuY3Rpb24gKG9iamVjdCwgdGFibGUpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KDQoNCgkJc2V0aG9vazogZnVuY3Rpb24gKHRocmVhZCwgaG9vaywgbWFzaywgY291bnQpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KDQoNCgkJc2V0bG9jYWw6IGZ1bmN0aW9uICh0aHJlYWQsIGxldmVsLCBsb2NhbCwgdmFsdWUpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KDQoNCgkJc2V0bWV0YXRhYmxlOiBmdW5jdGlvbiAob2JqZWN0LCB0YWJsZSkgew0KCQkJLy8gTm90IGltcGxlbWVudGVkDQoJCX0sDQoNCg0KCQlzZXR1cHZhbHVlOiBmdW5jdGlvbiAoZnVuYywgdXAsIHZhbHVlKSB7DQoJCQkvLyBOb3QgaW1wbGVtZW50ZWQNCgkJfSwNCg0KDQoJCXRyYWNlYmFjazogZnVuY3Rpb24gKHRocmVhZCwgbWVzc2FnZSwgbGV2ZWwpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9DQoJfSk7DQoNCg0KDQoNCglzaGluZS5saWIuaW8gPSBuZXcgc2hpbmUuVGFibGUoew0KCQkNCg0KCQljbG9zZTogZnVuY3Rpb24gKGZpbGUpIHsNCgkJCWlmIChmaWxlKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ0ZpbGUgb3BlcmF0aW9ucyBjdXJyZW50bHkgbm90IHN1cHBvcnRlZC4nKTsNCgkJCS8vIERlZmF1bHQgYmVoYXZpb3VyOiBEbyBub3RoaW5nLg0KCQl9LA0KDQoNCg0KDQoJCWZsdXNoOiBmdW5jdGlvbiAoKSB7DQoJCQkvLyBEZWZhdWx0IGJlaGF2aW91cjogRG8gbm90aGluZy4NCgkJCS8vIFRPRE86IHNoaW5lLnN0ZG91dC5mbHVzaCgpOyAvLyA/Pw0KCQl9LA0KDQoNCg0KDQoJCWlucHV0OiBmdW5jdGlvbiAoZmlsZSkgew0KCQkJdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdGaWxlIG9wZXJhdGlvbnMgY3VycmVudGx5IG5vdCBzdXBwb3J0ZWQuJyk7DQoJCX0sDQoNCg0KDQoNCgkJbGluZXM6IGZ1bmN0aW9uIChmaWxlbmFtZSkgew0KCQkJdGhyb3cgbmV3IHNoaW5lLkVycm9yKCdGaWxlIG9wZXJhdGlvbnMgY3VycmVudGx5IG5vdCBzdXBwb3J0ZWQuJyk7DQoJCX0sDQoNCg0KDQoNCgkJb3BlbjogZnVuY3Rpb24gKGZpbGVuYW1lKSB7DQoJCQl0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ0ZpbGUgb3BlcmF0aW9ucyBjdXJyZW50bHkgbm90IHN1cHBvcnRlZC4nKTsNCgkJfSwNCg0KDQoNCg0KCQlvdXRwdXQ6IGZ1bmN0aW9uIChmaWxlKSB7DQoJCQl0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ0ZpbGUgb3BlcmF0aW9ucyBjdXJyZW50bHkgbm90IHN1cHBvcnRlZC4nKTsNCgkJfSwNCg0KDQoNCg0KCQlwb3BlbjogZnVuY3Rpb24gKHByb2csIG1vZGUpIHsNCgkJCXRocm93IG5ldyBzaGluZS5FcnJvcignRmlsZSBvcGVyYXRpb25zIGN1cnJlbnRseSBub3Qgc3VwcG9ydGVkLicpOw0KCQl9LA0KDQoNCg0KDQoJCXJlYWQ6IGZ1bmN0aW9uICgpIHsNCgkJCXRocm93IG5ldyBzaGluZS5FcnJvcignRmlsZSBvcGVyYXRpb25zIGN1cnJlbnRseSBub3Qgc3VwcG9ydGVkLicpOw0KCQl9LA0KDQoNCg0KDQoJCXN0ZGVycjoge30sCS8vIFVzZXJkYXRhDQoJCXN0ZGluOiB7fSwNCgkJc3Rkb3V0OiB7fSwNCg0KDQoNCg0KCQl0bXBmaWxlOiBmdW5jdGlvbiAoKSB7DQoJCQl0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ0ZpbGUgb3BlcmF0aW9ucyBjdXJyZW50bHkgbm90IHN1cHBvcnRlZC4nKTsNCgkJfSwNCg0KDQoNCg0KCQkndHlwZSc6IGZ1bmN0aW9uICgpIHsNCgkJCS8vIFJldHVybiBuaWwNCgkJfSwNCg0KDQoNCg0KCQl3cml0ZTogZnVuY3Rpb24gKCkgew0KCQkJdmFyIGksIGFyZywgb3V0cHV0ID0gJyc7DQoJCQkNCgkJCWZvciAodmFyIGkgaW4gYXJndW1lbnRzKSB7DQoJCQkJaWYgKGFyZ3VtZW50cy5oYXNPd25Qcm9wZXJ0eShpKSkgew0KCQkJCQlvdXRwdXQgKz0gc2hpbmUudXRpbHMuY29lcmNlVG9TdHJpbmcoYXJndW1lbnRzW2ldLCAnYmFkIGFyZ3VtZW50ICMnICsgaSArICcgdG8gXCd3cml0ZVwnIChzdHJpbmcgZXhwZWN0ZWQsIGdvdCAldHlwZSknKTsNCgkJCQl9DQoJCQl9DQoJCQkNCgkJCXNoaW5lLnN0ZG91dC53cml0ZShvdXRwdXQpOw0KCQl9DQoJCQ0KCQkNCgl9KTsNCgkNCgkNCgkNCgkJDQoJc2hpbmUubGliLm1hdGggPSBuZXcgc2hpbmUuVGFibGUoew0KCQ0KCQ0KCQlhYnM6IGZ1bmN0aW9uICh4KSB7DQoJCQlyZXR1cm4gTWF0aC5hYnMoeCk7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQlhY29zOiBmdW5jdGlvbiAoeCkgew0KCQkJcmV0dXJuIE1hdGguYWNvcyh4KTsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCWFzaW46IGZ1bmN0aW9uICh4KSB7DQoJCQlyZXR1cm4gTWF0aC5hc2luKHgpOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJYXRhbjogZnVuY3Rpb24gKHgpIHsNCgkJCXJldHVybiBNYXRoLmF0YW4oeCk7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQlhdGFuMjogZnVuY3Rpb24gKHksIHgpIHsNCgkJCXJldHVybiBNYXRoLmF0YW4yKHksIHgpOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJY2VpbDogZnVuY3Rpb24gKHgpIHsNCgkJCXJldHVybiBNYXRoLmNlaWwoeCk7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQljb3M6IGZ1bmN0aW9uICh4KSB7DQoJCQlyZXR1cm4gTWF0aC5jb3MoeCk7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQljb3NoOiBmdW5jdGlvbiAoeCkgew0KCQkJdmFyIGUgPSBzaGluZS5saWIubWF0aC5leHA7DQoJCQlyZXR1cm4gKGUoeCkgKyBlKC14KSkgLyAyOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJZGVnOiBmdW5jdGlvbiAoeCkgew0KCQkJcmV0dXJuIHggKiAxODAgLyBNYXRoLlBJOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJZXhwOiBmdW5jdGlvbiAoeCkgew0KCQkJcmV0dXJuIE1hdGguZXhwKHgpOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJZmxvb3I6IGZ1bmN0aW9uICh4KSB7DQoJCQlyZXR1cm4gTWF0aC5mbG9vcih4KTsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCWZtb2Q6IGZ1bmN0aW9uICh4LCB5KSB7DQoJCQlyZXR1cm4geCAlIHk7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQlmcmV4cDogZnVuY3Rpb24gKHgpIHsNCgkJCXZhciBkZWx0YSwgZXhwb25lbnQsIG1hbnRpc3NhOw0KCQkJaWYgKHggPT0gMCkgcmV0dXJuIFswLCAwXTsNCg0KCQkJZGVsdGEgPSB4ID4gMD8gMSA6IC0xOw0KCQkJeCA9IHggKiBkZWx0YTsNCgkJCQ0KCQkJZXhwb25lbnQgPSBNYXRoLmZsb29yKE1hdGgubG9nKHgpIC8gTWF0aC5sb2coMikpICsgMTsNCgkJCW1hbnRpc3NhID0geCAvIE1hdGgucG93KDIsIGV4cG9uZW50KTsNCg0KCQkJcmV0dXJuIFttYW50aXNzYSAqIGRlbHRhLCBleHBvbmVudF07DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQlodWdlOiBJbmZpbml0eSwNCgkJDQoJCQ0KCQkNCgkJDQoJCWxkZXhwOiBmdW5jdGlvbiAobSwgZSkgew0KCQkJcmV0dXJuIG0gKiBNYXRoLnBvdygyLCBlKTsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCWxvZzogZnVuY3Rpb24gKHgsIGJhc2UpIHsNCgkJCXZhciByZXN1bHQgPSBNYXRoLmxvZyh4KTsNCgkJCWlmIChiYXNlICE9PSB1bmRlZmluZWQpIHJldHVybiByZXN1bHQgLyBNYXRoLmxvZyhiYXNlKTsNCgkJCXJldHVybiByZXN1bHQ7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQlsb2cxMDogZnVuY3Rpb24gKHgpIHsNCgkJCS8vIHY1LjI6IHNoaW5lLndhcm4gKCdtYXRoLmxvZzEwIGlzIGRlcHJlY2F0ZWQuIFVzZSBtYXRoLmxvZyB3aXRoIDEwIGFzIGl0cyBzZWNvbmQgYXJndW1lbnQgaW5zdGVhZC4nKTsNCgkJCXJldHVybiBNYXRoLmxvZyh4KSAvIE1hdGgubG9nKDEwKTsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCW1heDogZnVuY3Rpb24gKCkgew0KCQkJcmV0dXJuIE1hdGgubWF4LmFwcGx5KE1hdGgsIGFyZ3VtZW50cyk7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQltaW46IGZ1bmN0aW9uICgpIHsNCgkJCXJldHVybiBNYXRoLm1pbi5hcHBseShNYXRoLCBhcmd1bWVudHMpOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJbW9kZjogZnVuY3Rpb24gKHgpIHsNCgkJCXZhciBpbnRWYWx1ZSA9IE1hdGguZmxvb3IoeCksDQoJCQkJbWFudGlzc2EgPSB4IC0gaW50VmFsdWU7DQoJCQlyZXR1cm4gW2ludFZhbHVlLCBtYW50aXNzYV07DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQlwaTogTWF0aC5QSSwNCgkJDQoJCQ0KCQkNCgkJDQoJCXBvdzogZnVuY3Rpb24gKHgsIHkpIHsNCgkJCXZhciBjb2VyY2VUb051bWJlciA9IHNoaW5lLnV0aWxzLmNvZXJjZVRvTnVtYmVyOw0KCQkJeCA9IGNvZXJjZVRvTnVtYmVyKHgsICJiYWQgYXJndW1lbnQgIzEgdG8gJ3BvdycgKG51bWJlciBleHBlY3RlZCkiKQ0KCQkJeSA9IGNvZXJjZVRvTnVtYmVyKHksICJiYWQgYXJndW1lbnQgIzIgdG8gJ3BvdycgKG51bWJlciBleHBlY3RlZCkiKQ0KCQkJcmV0dXJuIE1hdGgucG93KHgsIHkpOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJcmFkOiBmdW5jdGlvbiAoeCkgew0KCQkJeCA9IHNoaW5lLnV0aWxzLmNvZXJjZVRvTnVtYmVyKHgsICJiYWQgYXJndW1lbnQgIzEgdG8gJ3JhZCcgKG51bWJlciBleHBlY3RlZCkiKQ0KCQkJcmV0dXJuIChNYXRoLlBJIC8gMTgwKSAqIHg7DQoJCX0sDQoJDQoJDQoJDQoJDQoJCS8qKg0KCQkgKiBJbXBsZW1lbnRhdGlvbiBvZiBMdWEncyBtYXRoLnJhbmRvbSBmdW5jdGlvbi4NCgkJICovDQoJCXJhbmRvbTogZnVuY3Rpb24gKG1pbiwgbWF4KSB7DQoJCQlpZiAobWluID09PSB1bmRlZmluZWQgJiYgbWF4ID09PSB1bmRlZmluZWQpIHJldHVybiBnZXRSYW5kb20oKTsNCgkNCgkNCgkJCWlmICh0eXBlb2YgbWluICE9PSAnbnVtYmVyJykgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCJiYWQgYXJndW1lbnQgIzEgdG8gJ3JhbmRvbScgKG51bWJlciBleHBlY3RlZCkiKTsNCgkNCgkJCWlmIChtYXggPT09IHVuZGVmaW5lZCkgew0KCQkJCW1heCA9IG1pbjsNCgkJCQltaW4gPSAxOw0KCQ0KCQkJfSBlbHNlIGlmICh0eXBlb2YgbWF4ICE9PSAnbnVtYmVyJykgew0KCQkJCXRocm93IG5ldyBzaGluZS5FcnJvcigiYmFkIGFyZ3VtZW50ICMyIHRvICdyYW5kb20nIChudW1iZXIgZXhwZWN0ZWQpIik7DQoJCQl9DQoJDQoJCQlpZiAobWluID4gbWF4KSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoImJhZCBhcmd1bWVudCAjMiB0byAncmFuZG9tJyAoaW50ZXJ2YWwgaXMgZW1wdHkpIik7DQoJCQlyZXR1cm4gTWF0aC5mbG9vcihnZXRSYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSArIG1pbik7DQoJCX0sDQoJDQoJDQoJDQoJDQoJCXJhbmRvbXNlZWQ6IGZ1bmN0aW9uICh4KSB7DQoJCQlpZiAodHlwZW9mIHggIT09ICdudW1iZXInKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoImJhZCBhcmd1bWVudCAjMSB0byAncmFuZG9tc2VlZCcgKG51bWJlciBleHBlY3RlZCkiKTsNCgkJCXJhbmRvbVNlZWQgPSB4Ow0KCQl9LA0KCQ0KCQ0KCQ0KCQkNCgkJc2luOiBmdW5jdGlvbiAoeCkgew0KCQkJcmV0dXJuIE1hdGguc2luKHgpOw0KCQl9LA0KCQ0KCQ0KCQ0KCQkNCgkJc2luaDogZnVuY3Rpb24gKHgpIHsNCgkJCXZhciBlID0gc2hpbmUubGliLm1hdGguZXhwOw0KCQkJcmV0dXJuIChlKHgpIC0gZSgteCkpIC8gMjsNCgkJfSwNCgkNCgkNCgkNCgkJDQoJCXNxcnQ6IGZ1bmN0aW9uICh4KSB7DQoJCQlyZXR1cm4gTWF0aC5zcXJ0KHgpOw0KCQl9LA0KCQ0KCQ0KCQ0KCQkNCgkJdGFuOiBmdW5jdGlvbiAoeCkgew0KCQkJcmV0dXJuIE1hdGgudGFuKHgpOw0KCQl9LA0KCQ0KCQ0KCQ0KCQkNCgkJdGFuaDogZnVuY3Rpb24gKHgpIHsNCgkJCXZhciBlID0gc2hpbmUubGliLm1hdGguZXhwOw0KCQkJcmV0dXJuIChlKHgpIC0gZSgteCkpLyhlKHgpICsgZSgteCkpOw0KCQl9DQoJDQoJCQ0KCX0pOw0KCQ0KCQ0KDQoJDQoJc2hpbmUubGliLm9zID0gbmV3IHNoaW5lLlRhYmxlKHsNCgkNCgkNCgkJY2xvY2s6IGZ1bmN0aW9uICgpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KCQ0KCQ0KCQ0KCQ0KCQlkYXRlOiBmdW5jdGlvbiAoZm9ybWF0LCB0aW1lKSB7DQoJCQlpZiAoZm9ybWF0ID09PSB1bmRlZmluZWQpIGZvcm1hdCA9ICclYyc7DQoJCQkNCgkJCXZhciB1dGMsDQoJCQkJZGF0ZSA9IG5ldyBEYXRlKCk7DQoJDQoJCQlpZiAodGltZSkgZGF0ZS5zZXRUaW1lKHRpbWUgKiAxMDAwKTsNCg0KCQkJaWYgKGZvcm1hdC5zdWJzdHIoMCwgMSkgPT09ICchJykgew0KCQkJCWZvcm1hdCA9IGZvcm1hdC5zdWJzdHIoMSk7DQoJCQkJdXRjID0gdHJ1ZTsNCgkJCX0NCgkNCgkJCWlmIChmb3JtYXQgPT09ICcqdCcpIHsNCgkJCQl2YXIgaXNEU1QgPSBmdW5jdGlvbiAoZCkgew0KCQkJCQl2YXIgeWVhciA9IGQuZ2V0RnVsbFllYXIoKSwNCgkJCQkJCWphbiA9IG5ldyBEYXRlKHllYXIsIDApOw0KCQkJCQkJDQoJCQkJCS8vIEFTU1VNUFRJT046IElmIHRoZSB0aW1lIG9mZnNldCBvZiB0aGUgZGF0ZSBpcyB0aGUgc2FtZSBhcyBpdCB3b3VsZCBiZSBpbiBKYW51YXJ5IG9mIHRoZSBzYW1lIHllYXIsIERTVCBpcyBub3QgaW4gZWZmZWN0Lg0KCQkJCQlyZXR1cm4gKGQuZ2V0VGltZXpvbmVPZmZzZXQoKSAhPT0gamFuLmdldFRpbWV6b25lT2Zmc2V0KCkpOw0KCQkJCX07DQoJCQkJDQoJCQkJcmV0dXJuIG5ldyBzaGluZS5UYWJsZSAoew0KCQkJCQl5ZWFyOiBwYXJzZUludChEQVRFX0ZPUk1BVF9IQU5ETEVSU1snJVknXShkYXRlLCB1dGMpLCAxMCksDQoJCQkJCW1vbnRoOiBwYXJzZUludChEQVRFX0ZPUk1BVF9IQU5ETEVSU1snJW0nXShkYXRlLCB1dGMpLCAxMCksDQoJCQkJCWRheTogcGFyc2VJbnQoREFURV9GT1JNQVRfSEFORExFUlNbJyVkJ10oZGF0ZSwgdXRjKSwgMTApLA0KCQkJCQlob3VyOiBwYXJzZUludChEQVRFX0ZPUk1BVF9IQU5ETEVSU1snJUgnXShkYXRlLCB1dGMpLCAxMCksDQoJCQkJCW1pbjogcGFyc2VJbnQoREFURV9GT1JNQVRfSEFORExFUlNbJyVNJ10oZGF0ZSwgdXRjKSwgMTApLA0KCQkJCQlzZWM6IHBhcnNlSW50KERBVEVfRk9STUFUX0hBTkRMRVJTWyclUyddKGRhdGUsIHV0YyksIDEwKSwNCgkJCQkJd2RheTogcGFyc2VJbnQoREFURV9GT1JNQVRfSEFORExFUlNbJyV3J10oZGF0ZSwgdXRjKSwgMTApICsgMSwNCgkJCQkJeWRheTogcGFyc2VJbnQoREFURV9GT1JNQVRfSEFORExFUlNbJyVqJ10oZGF0ZSwgdXRjKSwgMTApLA0KCQkJCQlpc2RzdDogaXNEU1QoZGF0ZSwgdXRjKQ0KCQkJCX0pOwkNCgkJCX0NCgkNCgkNCgkJCWZvciAodmFyIGkgaW4gREFURV9GT1JNQVRfSEFORExFUlMpIHsNCgkJCQlpZiAoREFURV9GT1JNQVRfSEFORExFUlMuaGFzT3duUHJvcGVydHkoaSkgJiYgZm9ybWF0LmluZGV4T2YoaSkgPj0gMCkgZm9ybWF0ID0gZm9ybWF0LnJlcGxhY2UoaSwgREFURV9GT1JNQVRfSEFORExFUlNbaV0oZGF0ZSwgdXRjKSk7DQoJCQl9DQoJCQkNCgkJCXJldHVybiBmb3JtYXQ7DQoJCX0sDQoJDQoJDQoJDQoJDQoJCWRpZmZ0aW1lOiBmdW5jdGlvbiAodDIsIHQxKSB7DQoJCQlyZXR1cm4gdDIgLSB0MTsNCgkJfSwNCgkNCgkNCgkNCgkNCgkJZXhlY3V0ZTogZnVuY3Rpb24gKCkgew0KCQkJaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHRocm93IG5ldyBzaGluZS5FcnJvcignc2hlbGwgaXMgbm90IGF2YWlsYWJsZS4gWW91IHNob3VsZCBhbHdheXMgY2hlY2sgZmlyc3QgYnkgY2FsbGluZyBvcy5leGVjdXRlIHdpdGggbm8gcGFyYW1ldGVycycpOw0KCQkJcmV0dXJuIDA7DQoJCX0sDQoJDQoJDQoJDQoJDQoJCWV4aXQ6IGZ1bmN0aW9uIChjb2RlKSB7DQoJCQl0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ0V4ZWN1dGlvbiB0ZXJtaW5hdGVkIFsnICsgKGNvZGUgfHwgMCkgKyAnXScpOw0KCQl9LA0KCQ0KCQ0KCQ0KCQ0KCQlnZXRlbnY6IGZ1bmN0aW9uICgpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KCQ0KCQ0KCQ0KCQ0KCQlyZW1vdmU6IGZ1bmN0aW9uICgpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KCQ0KCQ0KCQ0KCQ0KCQlyZW5hbWU6IGZ1bmN0aW9uICgpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KCQ0KCQ0KCQ0KCQ0KCQlzZXRsb2NhbGU6IGZ1bmN0aW9uICgpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KCQ0KCQ0KCQ0KCQ0KCQkvKioNCgkJICogSW1wbGVtZW50YXRpb24gb2YgTHVhJ3Mgb3MudGltZSBmdW5jdGlvbi4NCgkJICogQHBhcmFtIHtvYmplY3R9IHRhYmxlIFRoZSB0YWJsZSB0aGF0IHdpbGwgcmVjZWl2ZSB0aGUgbWV0YXRhYmxlLg0KCQkgKi8NCgkJdGltZTogZnVuY3Rpb24gKHRhYmxlKSB7DQoJCQl2YXIgdGltZTsNCgkJCQ0KCQkJaWYgKCF0YWJsZSkgew0KCQkJCXRpbWUgPSBEYXRlWydub3cnXT8gRGF0ZVsnbm93J10oKSA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KCQkJCQ0KCQkJfSBlbHNlIHsNCgkJCQl2YXIgZGF5LCBtb250aCwgeWVhciwgaG91ciwgbWluLCBzZWM7DQoJCQkJDQoJCQkJaWYgKCEoZGF5ID0gdGFibGUuZ2V0TWVtYmVyKCdkYXknKSkpIHRocm93IG5ldyBzaGluZS5FcnJvcigiRmllbGQgJ2RheScgbWlzc2luZyBpbiBkYXRlIHRhYmxlIik7DQoJCQkJaWYgKCEobW9udGggPSB0YWJsZS5nZXRNZW1iZXIoJ21vbnRoJykpKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoIkZpZWxkICdtb250aCcgbWlzc2luZyBpbiBkYXRlIHRhYmxlIik7DQoJCQkJaWYgKCEoeWVhciA9IHRhYmxlLmdldE1lbWJlcigneWVhcicpKSkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCJGaWVsZCAneWVhcicgbWlzc2luZyBpbiBkYXRlIHRhYmxlIik7DQoJCQkJaG91ciA9IHRhYmxlLmdldE1lbWJlcignaG91cicpIHx8IDEyOw0KCQkJCW1pbiA9IHRhYmxlLmdldE1lbWJlcignbWluJykgfHwgMDsNCgkJCQlzZWMgPSB0YWJsZS5nZXRNZW1iZXIoJ3NlYycpIHx8IDA7DQoJCQkJDQoJCQkJaWYgKHRhYmxlLmdldE1lbWJlcignaXNkc3QnKSkgaG91ci0tOw0KCQkJCXRpbWUgPSBuZXcgRGF0ZSh5ZWFyLCBtb250aCAtIDEsIGRheSwgaG91ciwgbWluLCBzZWMpLmdldFRpbWUoKTsNCgkJCX0NCgkJCQ0KCQkJcmV0dXJuIE1hdGguZmxvb3IodGltZSAvIDEwMDApOw0KCQl9LA0KCQ0KCQ0KCQ0KCQ0KCQl0bXBuYW1lOiBmdW5jdGlvbiAoKSB7DQoJCQkvLyBOb3QgaW1wbGVtZW50ZWQNCgkJfQ0KCQ0KCQkJDQoJfSk7DQoNCg0KDQoNCglzaGluZS5saWJbJ3BhY2thZ2UnXSA9IG5ldyBzaGluZS5UYWJsZSh7DQoNCgkJY3BhdGg6IHVuZGVmaW5lZCwNCg0KDQoJCWxvYWRlZDogbmV3IHNoaW5lLlRhYmxlKCksDQoNCg0KCQlsb2FkbGliOiBmdW5jdGlvbiAobGlibmFtZSwgZnVuY25hbWUpIHsNCgkJCS8vIE5vdCBpbXBsZW1lbnRlZA0KCQl9LA0KDQoNCgkJcGF0aDogJz8ubHVhLmpzb247Py5qc29uO21vZHVsZXMvPy5sdWEuanNvbjttb2R1bGVzLz8uanNvbjttb2R1bGVzLz8vPy5sdWEuanNvbjttb2R1bGVzLz8vaW5kZXgubHVhLmpzb24nLA0KDQoNCgkJcHJlbG9hZDoge30sDQoNCg0KCQlzZWVhbGw6IGZ1bmN0aW9uIChtb2R1bGUpIHsNCgkJCXZhciB2bSA9IGdldFZNKHRoaXMpLA0KCQkJCW10ID0gbmV3IHNoaW5lLlRhYmxlKCk7DQoNCgkJCW10LnNldE1lbWJlcignX19pbmRleCcsIHZtLl9nbG9iYWxzKTsNCgkJCXNoaW5lLmxpYi5zZXRtZXRhdGFibGUobW9kdWxlLCBtdCk7DQoJCX0NCgkJDQoJfSk7DQoNCg0KDQoNCglzaGluZS5saWIuc3RyaW5nID0gbmV3IHNoaW5lLlRhYmxlKHsNCgkJDQoJCQ0KCQknYnl0ZSc6IGZ1bmN0aW9uIChzLCBpLCBqKSB7DQoJCQlpID0gaSB8fCAxOw0KCQkJaiA9IGogfHwgaTsNCgkJCQ0KCQkJdmFyIHJlc3VsdCA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCksDQoJCQkJbGVuZ3RoID0gcy5sZW5ndGgsDQoJCQkJaW5kZXg7DQoJCQkNCgkJCWZvciAoaW5kZXggPSBpOyBpbmRleCA8PSBsZW5ndGggJiYgaW5kZXggPD0gaiA7IGluZGV4KyspIHJlc3VsdC5wdXNoKHMuY2hhckNvZGVBdChpbmRleCAtIDEpIHx8IHVuZGVmaW5lZCk7DQoJCQlyZXR1cm4gcmVzdWx0Ow0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJJ2NoYXInOiBmdW5jdGlvbiAoKSB7DQoJCQl2YXIgcmVzdWx0ID0gJyc7DQoJCQlmb3IgKHZhciBpID0gMCwgbCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsOyBpKyspIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGFyZ3VtZW50c1tpXSk7DQoJDQoJCQlyZXR1cm4gcmVzdWx0OwkJCQ0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJZHVtcDogZnVuY3Rpb24gKGZ1bmMpIHsNCgkJCXZhciBkYXRhID0gZnVuYy5fZGF0YSwNCgkJCQlyZXN1bHQgPSBzaGluZS5nYy5jcmVhdGVPYmplY3QoKSwNCgkJCQlhcnIgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpLA0KCQkJCWk7DQoNCgkJCWZvciAoaSBpbiBkYXRhKSB7DQoJCQkJaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoaSkpIHJlc3VsdFtpXSA9IGRhdGFbaV07DQoJCQl9DQoNCgkJCS8vIENvbnZlcnQgdHlwZWQgYXJyYXkgdG8gc3RhbmRhcmQgQXJyYXkuLi4NCgkJCWFyci5wdXNoLmFwcGx5KGFyciwgcmVzdWx0Lmluc3RydWN0aW9ucyk7DQoJCQlyZXN1bHQuaW5zdHJ1Y3Rpb25zID0gYXJyOw0KDQoJCQlyZXR1cm4gSlNPTi5zdHJpbmdpZnkocmVzdWx0KTsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCWZpbmQ6IGZ1bmN0aW9uIChzLCBwYXR0ZXJuLCBpbml0LCBwbGFpbikgew0KCQkJaWYgKHR5cGVvZiBzICE9ICdzdHJpbmcnICYmIHR5cGVvZiBzICE9ICdudW1iZXInKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoImJhZCBhcmd1bWVudCAjMSB0byAnZmluZCcgKHN0cmluZyBleHBlY3RlZCwgZ290ICIgKyB0eXBlb2YgcyArICIpIik7DQoJCQlpZiAodHlwZW9mIHBhdHRlcm4gIT0gJ3N0cmluZycgJiYgdHlwZW9mIHBhdHRlcm4gIT0gJ251bWJlcicpIHRocm93IG5ldyBzaGluZS5FcnJvcigiYmFkIGFyZ3VtZW50ICMyIHRvICdmaW5kJyAoc3RyaW5nIGV4cGVjdGVkLCBnb3QgIiArIHR5cGVvZiBwYXR0ZXJuICsgIikiKTsNCg0KCQkJcyA9ICcnICsgczsNCgkJCWluaXQgPSBpbml0IHx8IDE7DQoNCgkJCXZhciBpbmRleCwgcmVnLCBtYXRjaCwgcmVzdWx0Ow0KDQoJCQkvLyBSZWdleA0KCQkJaWYgKHBsYWluID09PSB1bmRlZmluZWQgfHwgIXBsYWluKSB7DQoJCQkJcGF0dGVybiA9IHRyYW5zbGF0ZVBhdHRlcm4ocGF0dGVybik7DQoJCQkJcmVnID0gbmV3IFJlZ0V4cChwYXR0ZXJuKTsNCgkJCQlpbmRleCA9IHMuc3Vic3RyKGluaXQgLSAxKS5zZWFyY2gocmVnKTsNCgkJCQkNCgkJCQlpZiAoaW5kZXggPCAwKSByZXR1cm47DQoJCQkJDQoJCQkJbWF0Y2ggPSBzLnN1YnN0cihpbml0IC0gMSkubWF0Y2gocmVnKTsNCgkJCQlyZXN1bHQgPSBbaW5kZXggKyBpbml0LCBpbmRleCArIGluaXQgKyBtYXRjaFswXS5sZW5ndGggLSAxXTsNCg0KCQkJCW1hdGNoLnNoaWZ0KCk7DQoJCQkJcmV0dXJuIHJlc3VsdC5jb25jYXQobWF0Y2gpOw0KCQkJfQ0KCQkJDQoJCQkvLyBQbGFpbg0KCQkJaW5kZXggPSBzLmluZGV4T2YocGF0dGVybiwgaW5pdCAtIDEpOw0KCQkJcmV0dXJuIChpbmRleCA9PT0gLTEpPyB1bmRlZmluZWQgOiBbaW5kZXggKyAxLCBpbmRleCArIHBhdHRlcm4ubGVuZ3RoXTsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCWZvcm1hdDogZnVuY3Rpb24gKGZvcm1hdHN0cmluZykgew0KCQkJdmFyIEZJTkRfUEFUVEVSTiA9IC9eKCgufFxzKSo/KSglKSgoLnxccykqKSQvLA0KCQkJCVBBUlNFX1BBVFRFUk4gPSAvXiglPykoWytcLSNcIDBdKikoXGQqKShcLihcZCopKT8oW2NkZUVmZ0dpb3Vxc3hYXSkoKC58XHMpKikkLywNCgkJCQlmaW5kRGF0YSwNCgkJCQlyZXN1bHQgPSAnJywNCgkJCQlwYXJzZURhdGEsDQoJCQkJYXJncyA9IGFyZ3VtZW50cy5jb25zdHJ1Y3RvciA9PT0gQXJyYXk/IGFyZ3VtZW50cyA6IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCksDQoJCQkJYXJnSW5kZXggPSAyLA0KCQkJCWluZGV4ID0gMjsNCg0KCQkJYXJncy5zaGlmdCgpOw0KDQoNCgkJCWZ1bmN0aW9uIHBhcnNlTWV0YShwYXJzZURhdGEpIHsNCgkJCQl2YXIgZmxhZ3MgPSBwYXJzZURhdGFbMl0sDQoJCQkJCXByZWNpc2lvbiA9IHBhcnNlSW50KHBhcnNlRGF0YVs1XSk7DQoNCgkJCQlpZiAoKCcnICsgZmxhZ3MpLmxlbmd0aCA+IDUpIHRocm93IG5ldyBzaGluZS5FcnJvcignaW52YWxpZCBmb3JtYXQgKHJlcGVhdGVkIGZsYWdzKScpOw0KCQkJCWlmICghcHJlY2lzaW9uICYmIHByZWNpc2lvbiAhPT0gMCkgcHJlY2lzaW9uID0gSW5maW5pdHk7DQoNCgkJCQlyZXR1cm4gew0KCQkJCQlzaG93U2lnbjogZmxhZ3MuaW5kZXhPZignKycpID49IDAsDQoJCQkJCXByZWZpeDogZmxhZ3MuaW5kZXhPZignICcpID49IDAsDQoJCQkJCWxlZnRBbGlnbjogZmxhZ3MuaW5kZXhPZignLScpID49IDAsDQoJCQkJCWFsdGVybmF0ZUZvcm06IGZsYWdzLmluZGV4T2YoJyMnKSA+PSAwLA0KCQkJCQl6ZXJvUGFkOiBmbGFncy5pbmRleE9mKCcwJykgPj0gMCwNCgkJCQkJbWluV2lkdGg6IHBhcnNlSW50KHBhcnNlRGF0YVszXSkgfHwgMCwNCgkJCQkJaGFzUHJlY2lzaW9uOiAhIXBhcnNlRGF0YVs0XSwNCgkJCQkJcHJlY2lzaW9uOiBwcmVjaXNpb24NCgkJCQl9Ow0KCQkJfQ0KDQoNCgkJCWZ1bmN0aW9uIHBhZCAoY2hhcmFjdGVyLCBsZW4pIHsNCgkJCQlyZXR1cm4gQXJyYXkobGVuICsgMSkuam9pbihjaGFyYWN0ZXIpOw0KCQkJfQ0KDQoNCgkJCWZ1bmN0aW9uIHBhZE51bWJlciAoYXJnLCBuZWcsIG1ldGEpIHsNCgkJCQl2YXIgbDsNCg0KCQkJCWlmIChtZXRhLnplcm9QYWQgJiYgIW1ldGEubGVmdEFsaWduICYmIChsID0gbWV0YS5taW5XaWR0aCAtIGFyZy5sZW5ndGgpID4gMCkgew0KCQkJCQlpZiAobmVnIHx8IG1ldGEuc2hvd1NpZ24gfHwgbWV0YS5wcmVmaXgpIGwtLTsNCgkJCQkJYXJnID0gcGFkKCcwJywgbCkgKyBhcmc7DQoJCQkJfQ0KDQoJCQkJaWYgKG5lZykgew0KCQkJCQlhcmcgPSAnLScgKyBhcmc7DQoNCgkJCQl9IGVsc2UgaWYgKG1ldGEuc2hvd1NpZ24pIHsNCgkJCQkJYXJnID0gJysnICsgYXJnOw0KCQkJCQ0KCQkJCX0gZWxzZSBpZiAobWV0YS5wcmVmaXgpIHsNCgkJCQkJYXJnID0gJyAnICsgYXJnOw0KCQkJCX0NCg0KCQkJCWlmICgobCA9IG1ldGEubWluV2lkdGggLSBhcmcubGVuZ3RoKSA+IDApIHsNCgkJCQkJaWYgKG1ldGEubGVmdEFsaWduKSByZXR1cm4gYXJnICsgcGFkKCcgJywgbCk7DQoJCQkJCXJldHVybiBwYWQoJyAnLCBsKSArIGFyZzsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gYXJnOw0KCQkJfQ0KDQoNCgkJCWZ1bmN0aW9uIGMgKGFyZykgew0KCQkJCWFyZyA9IHNoaW5lLnV0aWxzLmNvZXJjZVRvTnVtYmVyKGFyZywgJ2JhZCBhcmd1bWVudCAjJyArIGFyZ0luZGV4ICsgJyB0byBcJ2Zvcm1hdFwnIChudW1iZXIgZXhwZWN0ZWQpJyk7DQoJCQkJcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYXJnKTsNCgkJCX0NCg0KDQoJCQlmdW5jdGlvbiBkIChhcmcpIHsNCgkJCQlhcmcgPSBzaGluZS51dGlscy5jb2VyY2VUb051bWJlcihhcmcsICdiYWQgYXJndW1lbnQgIycgKyBhcmdJbmRleCArICcgdG8gXCdmb3JtYXRcJyAobnVtYmVyIGV4cGVjdGVkKScpOw0KDQoJCQkJdmFyIG1ldGEgPSBwYXJzZU1ldGEocGFyc2VEYXRhKSwNCgkJCQkJbmVnID0gYXJnIDwgMCwNCgkJCQkJbDsNCg0KCQkJCWFyZyA9ICcnICsgTWF0aC5mbG9vcihNYXRoLmFicyhhcmcpKTsNCg0KCQkJCWlmIChtZXRhLmhhc1ByZWNpc2lvbikgew0KCQkJCQlpZiAobWV0YS5wcmVjaXNpb24gIT09IEluZmluaXR5ICYmIChsID0gbWV0YS5wcmVjaXNpb24gLSBhcmcubGVuZ3RoKSA+IDApIGFyZyA9IHBhZCgnMCcsIGwpICsgYXJnOw0KCQkJCQltZXRhLnplcm9QYWQgPSBmYWxzZTsNCgkJCQl9IA0KDQoJCQkJcmV0dXJuIHBhZE51bWJlcihhcmcsIG5lZywgbWV0YSk7DQoJCQl9DQoNCg0KCQkJZnVuY3Rpb24gZiAoYXJnKSB7DQoJCQkJYXJnID0gc2hpbmUudXRpbHMuY29lcmNlVG9OdW1iZXIoYXJnLCAnYmFkIGFyZ3VtZW50ICMnICsgYXJnSW5kZXggKyAnIHRvIFwnZm9ybWF0XCcgKG51bWJlciBleHBlY3RlZCknKTsNCg0KCQkJCXZhciBtZXRhID0gcGFyc2VNZXRhKHBhcnNlRGF0YSksDQoJCQkJCW5lZyA9IGFyZyA8IDAsDQoJCQkJCW1hbnRpc3NhID0gYXJnIC0gTWF0aC5mbG9vcihhcmcpLA0KCQkJCQlwcmVjaXNpb24gPSBtZXRhLnByZWNpc2lvbiA9PT0gSW5maW5pdHk/IDYgOiBtZXRhLnByZWNpc2lvbjsNCg0KCQkJCWFyZyA9ICcnICsgTWF0aC5mbG9vcihNYXRoLmFicyhhcmcpKTsNCg0KCQkJCWlmIChwcmVjaXNpb24gPiAwKSB7DQoJCQkJCW1hbnRpc3NhID0gbWFudGlzc2EudG9GaXhlZChwcmVjaXNpb24pLnN1YnN0cigyKTsNCgkJCQkJcHJlY2lzaW9uIC09IG1hbnRpc3NhLmxlbmd0aDsNCgkJCQkJYXJnICs9ICcuJyArIG1hbnRpc3NhICsgKHByZWNpc2lvbj8gcGFkKCcwJywgcHJlY2lzaW9uKSA6ICcnKTsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gcGFkTnVtYmVyKGFyZywgbmVnLCBtZXRhKTsNCgkJCX0NCg0KDQoJCQlmdW5jdGlvbiBvIChhcmcsIGxpbWl0KSB7DQoJCQkJYXJnID0gc2hpbmUudXRpbHMuY29lcmNlVG9OdW1iZXIoYXJnLCAnYmFkIGFyZ3VtZW50ICMnICsgYXJnSW5kZXggKyAnIHRvIFwnZm9ybWF0XCcgKG51bWJlciBleHBlY3RlZCknKTsNCg0KCQkJCXZhciBuZWcgPSBhcmcgPCAwLA0KCQkJCQlsaW1pdCA9IE1hdGgucG93KDIsIDMyKSwNCgkJCQkJbWV0YSA9IHBhcnNlTWV0YShwYXJzZURhdGEpLA0KCQkJCQlsOw0KDQoJCQkJYXJnID0gTWF0aC5mbG9vcihhcmcpOw0KCQkJCWlmIChuZWcpIGFyZyA9IGxpbWl0ICsgYXJnOw0KDQoJCQkJYXJnID0gYXJnLnRvU3RyaW5nKDE2KTsNCgkJCQkvL2lmIChuZWcgJiYgaW50U2l6ZSA+IDIpIGFyZyA9IDsNCgkJCQlpZiAobWV0YS5oYXNQcmVjaXNpb24gJiYgbWV0YS5wcmVjaXNpb24gIT09IEluZmluaXR5ICYmIChsID0gbWV0YS5wcmVjaXNpb24gLSBhcmcubGVuZ3RoKSA+IDApIGFyZyA9IHBhZCgnMCcsIGwpICsgYXJnOyANCg0KCQkJCWlmICgobCA9IG1ldGEubWluV2lkdGggLSBhcmcubGVuZ3RoKSA+IDApIHsNCgkJCQkJaWYgKG1ldGEubGVmdEFsaWduKSByZXR1cm4gYXJnICsgcGFkKCcgJywgbCk7DQoJCQkJCXJldHVybiBwYWQoJyAnLCBsKSArIGFyZzsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gYXJnOw0KCQkJfQ0KDQoNCgkJCWZ1bmN0aW9uIHEgKGFyZykgew0KCQkJCWFyZyA9IHNoaW5lLnV0aWxzLmNvZXJjZVRvU3RyaW5nKGFyZyk7DQoJCQkJcmV0dXJuICciJyArIGFyZy5yZXBsYWNlKC8oW1xuIl0pL2csICdcXCQxJykgKyAnIic7DQoJCQl9DQoNCg0KCQkJZnVuY3Rpb24gcyAoYXJnKSB7DQoJCQkJdmFyIG1ldGEgPSBwYXJzZU1ldGEocGFyc2VEYXRhKSwNCgkJCQkJbDsNCg0KCQkJCWFyZyA9IHNoaW5lLnV0aWxzLmNvZXJjZVRvU3RyaW5nKGFyZyk7DQoJCQkJYXJnID0gYXJnLnN1YnN0cigwLCBtZXRhLnByZWNpc2lvbik7DQoNCgkJCQlpZiAoKGwgPSBtZXRhLm1pbldpZHRoIC0gYXJnLmxlbmd0aCkgPiAwKSB7DQoJCQkJCWlmIChtZXRhLmxlZnRBbGlnbikgew0KCQkJCQkJcmV0dXJuIGFyZyArIHBhZCgnICcsIGwpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJcmV0dXJuIHBhZChtZXRhLnplcm9QYWQ/ICcwJyA6ICcgJywgbCkgKyBhcmc7DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQlyZXR1cm4gYXJnOw0KCQkJfQ0KDQoNCgkJCWZ1bmN0aW9uIHggKGFyZykgew0KCQkJCWFyZyA9IHNoaW5lLnV0aWxzLmNvZXJjZVRvTnVtYmVyKGFyZywgJ2JhZCBhcmd1bWVudCAjJyArIGFyZ0luZGV4ICsgJyB0byBcJ2Zvcm1hdFwnIChudW1iZXIgZXhwZWN0ZWQpJyk7DQoNCgkJCQl2YXIgbmVnID0gYXJnIDwgMCwNCgkJCQkJaW50U2l6ZSA9IDQsIC8vdm0gJiYgdm0uX3RocmVhZCAmJiB2bS5fdGhyZWFkLl9maWxlLmRhdGEubWV0YSAmJiB2bS5fdGhyZWFkLl9maWxlLmRhdGEubWV0YS5zaXplcy5pbnQgfHwgNCwNCgkJCQkJbGltaXQgPSBNYXRoLnBvdygyLCAzMiksDQoJCQkJCW1ldGEgPSBwYXJzZU1ldGEocGFyc2VEYXRhKSwNCgkJCQkJbDsNCg0KCQkJCWFyZyA9IE1hdGguZmxvb3IoYXJnKTsNCgkJCQlpZiAobmVnKSBhcmcgPSBsaW1pdCArIGFyZzsNCg0KCQkJCWFyZyA9IGFyZy50b1N0cmluZygxNik7DQoJCQkJaWYgKG5lZyAmJiBpbnRTaXplID4gMikgYXJnID0gcGFkKCdmJywgKGludFNpemUgLSAyKSAqIDQpICsgYXJnOw0KCQkJCWlmIChtZXRhLmhhc1ByZWNpc2lvbiAmJiBtZXRhLnByZWNpc2lvbiAhPT0gSW5maW5pdHkgJiYgKGwgPSBtZXRhLnByZWNpc2lvbiAtIGFyZy5sZW5ndGgpID4gMCkgYXJnID0gcGFkKCcwJywgbCkgKyBhcmc7IA0KDQoJCQkJaWYgKG1ldGEuYWx0ZXJuYXRlRm9ybSkgYXJnID0gJzB4JyArIGFyZzsNCg0KCQkJCS8vIGlmICgobCA9IG1ldGEubWluV2lkdGggLSBhcmcubGVuZ3RoKSA+IDApIHsNCgkJCQkvLyAJaWYgKG1ldGEubGVmdEFsaWduKSByZXR1cm4gYXJnICsgcGFkKCcgJywgbCk7DQoJCQkJLy8gCXJldHVybiBwYWQoJyAnLCBsKSArIGFyZzsNCgkJCQkvLyB9DQoNCgkJCQltZXRhLnNob3dTaWduID0gbWV0YS5wcmVmaXggPSBmYWxzZTsNCgkJCQltZXRhLnplcm9QYWQgPSBtZXRhLnplcm9QYWQgJiYgbWV0YS5oYXNQcmVjaXNpb247DQoJCQkJYXJnID0gcGFkTnVtYmVyKGFyZywgZmFsc2UsIG1ldGEpOw0KDQoJCQkJcmV0dXJuIGFyZzsNCgkJCX0NCg0KDQoNCgkJCXdoaWxlIChmaW5kRGF0YSA9ICgnJyArIGZvcm1hdHN0cmluZykubWF0Y2goRklORF9QQVRURVJOKSkgew0KCQkJCXJlc3VsdCArPSBmaW5kRGF0YVsxXTsNCgkJCQl3aGlsZSAoZmluZERhdGFbaW5kZXhdICE9ICclJykgaW5kZXgrKzsNCgkJCQlwYXJzZURhdGEgPSAoJycgKyBmaW5kRGF0YVtpbmRleCArIDFdKS5tYXRjaChQQVJTRV9QQVRURVJOKTsNCg0KCQkJCWlmIChwYXJzZURhdGFbMV0pIHsNCgkJCQkJLy8gJSUNCgkJCQkJcmVzdWx0ICs9ICclJyArIHBhcnNlRGF0YVsyXSArIHBhcnNlRGF0YVszXSArIChwYXJzZURhdGFbNF0gfHwgJycpICsgcGFyc2VEYXRhWzZdOw0KDQoJCQkJfSBlbHNlIHsNCgkJCQkJc3dpdGNoKHBhcnNlRGF0YVs2XSkgew0KDQoJCQkJCQljYXNlICdjJzoNCgkJCQkJCQlyZXN1bHQgKz0gYyhhcmdzLnNoaWZ0KCkpOw0KCQkJCQkJCWJyZWFrOw0KDQoJCQkJCQljYXNlICdkJzoNCgkJCQkJCQlyZXN1bHQgKz0gZChhcmdzLnNoaWZ0KCkpOw0KCQkJCQkJCWJyZWFrOw0KDQoJCQkJCQljYXNlICdmJzoNCgkJCQkJCQlyZXN1bHQgKz0gZihhcmdzLnNoaWZ0KCkpOw0KCQkJCQkJCWJyZWFrOw0KDQoJCQkJCQljYXNlICdxJzoNCgkJCQkJCQlyZXN1bHQgKz0gcShhcmdzLnNoaWZ0KCkpOw0KCQkJCQkJCWJyZWFrOw0KDQoJCQkJCQljYXNlICdvJzoNCgkJCQkJCQlyZXN1bHQgKz0gbyhhcmdzLnNoaWZ0KCkpOw0KCQkJCQkJCWJyZWFrOw0KDQoJCQkJCQljYXNlICdzJzoNCgkJCQkJCQlyZXN1bHQgKz0gcyhhcmdzLnNoaWZ0KCkpOw0KCQkJCQkJCWJyZWFrOw0KDQoJCQkJCQljYXNlICd4JzoNCgkJCQkJCQlyZXN1bHQgKz0geChhcmdzLnNoaWZ0KCkpOw0KCQkJCQkJCWJyZWFrOw0KDQoJCQkJCQljYXNlICdYJzoNCgkJCQkJCQlyZXN1bHQgKz0geChhcmdzLnNoaWZ0KCkpLnRvVXBwZXJDYXNlKCk7DQoJCQkJCQkJYnJlYWs7DQoNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCWZvcm1hdHN0cmluZyA9IHBhcnNlRGF0YVs3XTsNCgkJCQlhcmdJbmRleCsrOw0KCQkJfQ0KDQoJCQlyZXR1cm4gcmVzdWx0ICsgZm9ybWF0c3RyaW5nOw0KCQl9LA0KCQkNCg0KCQkNCgkJDQoJCWdtYXRjaDogZnVuY3Rpb24gKHMsIHBhdHRlcm4pIHsNCgkJCXBhdHRlcm4gPSB0cmFuc2xhdGVQYXR0ZXJuKHBhdHRlcm4pOw0KCQkJdmFyIHJlZyA9IG5ldyBSZWdFeHAocGF0dGVybiwgJ2cnKSwNCgkJCQltYXRjaGVzID0gKCcnICsgcykubWF0Y2gocmVnKTsNCg0KCQkJcmV0dXJuIGZ1bmN0aW9uICgpIHsNCgkJCQl2YXIgbWF0Y2ggPSBtYXRjaGVzLnNoaWZ0KCksDQoJCQkJCWdyb3VwcyA9IG5ldyBSZWdFeHAocGF0dGVybikuZXhlYyhtYXRjaCk7DQoNCgkJCQlpZiAobWF0Y2ggPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KDQoJCQkJZ3JvdXBzLnNoaWZ0KCk7DQoJCQkJcmV0dXJuIGdyb3Vwcy5sZW5ndGg/IGdyb3VwcyA6IG1hdGNoOw0KCQkJfTsJCQkJDQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQlnc3ViOiBmdW5jdGlvbiAocywgcGF0dGVybiwgcmVwbCwgbikgew0KCQkJaWYgKHR5cGVvZiBzICE9ICdzdHJpbmcnICYmIHR5cGVvZiBzICE9ICdudW1iZXInKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoImJhZCBhcmd1bWVudCAjMSB0byAnZ3N1YicgKHN0cmluZyBleHBlY3RlZCwgZ290ICIgKyB0eXBlb2YgcyArICIpIik7DQoJCQlpZiAodHlwZW9mIHBhdHRlcm4gIT0gJ3N0cmluZycgJiYgdHlwZW9mIHBhdHRlcm4gIT0gJ251bWJlcicpIHRocm93IG5ldyBzaGluZS5FcnJvcigiYmFkIGFyZ3VtZW50ICMyIHRvICdnc3ViJyAoc3RyaW5nIGV4cGVjdGVkLCBnb3QgIiArIHR5cGVvZiBwYXR0ZXJuICsgIikiKTsNCgkJCWlmIChuICE9PSB1bmRlZmluZWQgJiYgKG4gPSBzaGluZS51dGlscy5jb2VyY2VUb051bWJlcihuKSkgPT09IHVuZGVmaW5lZCkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCJiYWQgYXJndW1lbnQgIzQgdG8gJ2dzdWInIChudW1iZXIgZXhwZWN0ZWQsIGdvdCAiICsgdHlwZW9mIG4gKyAiKSIpOw0KDQoJCQlzID0gJycgKyBzOw0KCQkJcGF0dGVybiA9IHRyYW5zbGF0ZVBhdHRlcm4oJycgKyBwYXR0ZXJuKTsNCg0KCQkJdmFyIGNvdW50ID0gMCwNCgkJCQlyZXN1bHQgPSAnJywNCgkJCQlzdHIsDQoJCQkJcHJlZml4LA0KCQkJCW1hdGNoLA0KCQkJCWxhc3RNYXRjaDsNCg0KCQkJd2hpbGUgKChuID09PSB1bmRlZmluZWQgfHwgY291bnQgPCBuKSAmJiBzICYmIChtYXRjaCA9IHMubWF0Y2gocGF0dGVybikpKSB7DQoNCgkJCQlpZiAodHlwZW9mIHJlcGwgPT0gJ2Z1bmN0aW9uJyB8fCAocmVwbCB8fCBzaGluZS5FTVBUWV9PQkopIGluc3RhbmNlb2Ygc2hpbmUuRnVuY3Rpb24pIHsNCgkJCQkJc3RyID0gcmVwbC5hcHBseShudWxsLCBbbWF0Y2hbMF1dLCB0cnVlKTsNCgkJCQkJaWYgKHN0ciBpbnN0YW5jZW9mIEFycmF5KSBzdHIgPSBzdHJbMF07DQoJCQkJCWlmIChzdHIgPT09IHVuZGVmaW5lZCkgc3RyID0gbWF0Y2hbMF07DQoNCgkJCQl9IGVsc2UgaWYgKChyZXBsIHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkgew0KCQkJCQlzdHIgPSByZXBsLmdldE1lbWJlcihtYXRjaFswXSk7DQoJCQkJCQ0KCQkJCX0gZWxzZSBpZiAodHlwZW9mIHJlcGwgPT0gJ29iamVjdCcpIHsNCgkJCQkJc3RyID0gcmVwbFttYXRjaF07DQoJCQkJCQ0KCQkJCX0gZWxzZSB7DQoJCQkJCXN0ciA9ICgnJyArIHJlcGwpLnJlcGxhY2UoLyUoWzAtOV0pL2csIGZ1bmN0aW9uIChtLCBpKSB7IHJldHVybiBtYXRjaFtpXTsgfSk7DQoJCQkJfQ0KDQoJCQkJaWYgKG1hdGNoWzBdLmxlbmd0aCA9PSAwICYmIGxhc3RNYXRjaCA9PT0gdW5kZWZpbmVkKSB7DQoJCQkJIAlwcmVmaXggPSAnJzsNCgkJCQl9IGVsc2Ugew0KCQkJCQlwcmVmaXggPSBzLnNwbGl0KG1hdGNoWzBdLCAxKVswXTsNCgkJCQl9DQoJDQoJCQkJbGFzdE1hdGNoID0gbWF0Y2hbMF07DQoJCQkJcmVzdWx0ICs9IHByZWZpeCArIHN0cjsNCgkJCQlzID0gcy5zdWJzdHIoKHByZWZpeCArIGxhc3RNYXRjaCkubGVuZ3RoKTsNCg0KCQkJCWNvdW50Kys7DQoJCQl9DQoNCgkJCXJldHVybiBbcmVzdWx0ICsgcywgY291bnRdOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJbGVuOiBmdW5jdGlvbiAocykgew0KCQkJLy8gaWYgKHR5cGVvZiBzICE9ICdzdHJpbmcnICYmIHR5cGVvZiBzICE9ICdudW1iZXInKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoImJhZCBhcmd1bWVudCAjMSB0byAnbGVuJyAoc3RyaW5nIGV4cGVjdGVkLCBnb3QgIiArIHR5cGVvZiBzICsgIikiKTsNCgkJCXMgPSBzaGluZS51dGlscy5jb2VyY2VUb1N0cmluZyhzLCAiYmFkIGFyZ3VtZW50ICMxIHRvICdsZW4nIChzdHJpbmcgZXhwZWN0ZWQsIGdvdCAldHlwZSkiKTsNCgkJCXJldHVybiBzLmxlbmd0aDsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCWxvd2VyOiBmdW5jdGlvbiAocykgew0KCQkJaWYgKHR5cGVvZiBzICE9ICdzdHJpbmcnICYmIHR5cGVvZiBzICE9ICdudW1iZXInKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoImJhZCBhcmd1bWVudCAjMSB0byAnbG93ZXInIChzdHJpbmcgZXhwZWN0ZWQsIGdvdCAiICsgdHlwZW9mIHMgKyAiKSIpOw0KCQkJcmV0dXJuICgnJyArIHMpLnRvTG93ZXJDYXNlKCk7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQltYXRjaDogZnVuY3Rpb24gKHMsIHBhdHRlcm4sIGluaXQpIHsNCgkJCWlmICh0eXBlb2YgcyAhPSAnc3RyaW5nJyAmJiB0eXBlb2YgcyAhPSAnbnVtYmVyJykgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCJiYWQgYXJndW1lbnQgIzEgdG8gJ21hdGNoJyAoc3RyaW5nIGV4cGVjdGVkLCBnb3QgIiArIHR5cGVvZiBzICsgIikiKTsNCgkJCWlmICh0eXBlb2YgcGF0dGVybiAhPSAnc3RyaW5nJyAmJiB0eXBlb2YgcGF0dGVybiAhPSAnbnVtYmVyJykgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCJiYWQgYXJndW1lbnQgIzIgdG8gJ21hdGNoJyAoc3RyaW5nIGV4cGVjdGVkLCBnb3QgIiArIHR5cGVvZiBwYXR0ZXJuICsgIikiKTsNCg0KCQkJaW5pdCA9IGluaXQ/IGluaXQgLSAxIDogMDsNCgkJCXMgPSAoJycgKyBzKS5zdWJzdHIoaW5pdCk7DQoJCQ0KCQkJdmFyIG1hdGNoZXMgPSBzLm1hdGNoKG5ldyBSZWdFeHAodHJhbnNsYXRlUGF0dGVybiAocGF0dGVybikpKTsNCgkJCQ0KCQkJaWYgKCFtYXRjaGVzKSByZXR1cm47DQoJCQlpZiAoIW1hdGNoZXNbMV0pIHJldHVybiBtYXRjaGVzWzBdOw0KDQoJCQltYXRjaGVzLnNoaWZ0KCk7DQoJCQlyZXR1cm4gbWF0Y2hlczsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCXJlcDogZnVuY3Rpb24gKHMsIG4pIHsNCgkJCXZhciByZXN1bHQgPSAnJywNCgkJCWk7DQoJCQkNCgkJCWZvciAoaSA9IDA7IGkgPCBuOyBpKyspIHJlc3VsdCArPSBzOw0KCQkJcmV0dXJuIHJlc3VsdDsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCXJldmVyc2U6IGZ1bmN0aW9uIChzKSB7DQoJCQl2YXIgcmVzdWx0ID0gJycsDQoJCQlpOw0KCQkJDQoJCQlmb3IgKGkgPSBzLmxlbmd0aDsgaSA+PSAwOyBpLS0pIHJlc3VsdCArPSBzLmNoYXJBdChpKTsNCgkJCXJldHVybiByZXN1bHQ7DQoJCX0sDQoJCQ0KCQkNCgkJDQoJCQ0KCQlzdWI6IGZ1bmN0aW9uIChzLCBpLCBqKSB7DQoJCQlpZiAodHlwZW9mIHMgIT0gJ3N0cmluZycgJiYgdHlwZW9mIHMgIT0gJ251bWJlcicpIHRocm93IG5ldyBzaGluZS5FcnJvcigiQmFkIGFyZ3VtZW50ICMxIHRvICdzdWInIChzdHJpbmcgZXhwZWN0ZWQsIGdvdCAiICsgdHlwZW9mIHMgKyAiKSIpOw0KCQkJcyA9ICcnICsgczsNCgkJCWkgPSBpIHx8IDE7DQoJCQlqID0gaiB8fCBzLmxlbmd0aDsNCgkJCQ0KCQkJaWYgKGkgPiAwKSB7DQoJCQkJaSA9IGkgLSAxOw0KCQkJfSBlbHNlIGlmIChpIDwgMCkgew0KCQkJCWkgPSBzLmxlbmd0aCArIGk7DQoJCQl9DQoJCQkNCgkJCWlmIChqIDwgMCkgaiA9IHMubGVuZ3RoICsgaiArIDE7DQoJCQkNCgkJCXJldHVybiBzLnN1YnN0cmluZyhpLCBqKTsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCXVwcGVyOiBmdW5jdGlvbiAocykgew0KCQkJcmV0dXJuIHMudG9VcHBlckNhc2UoKTsNCgkJfQkNCgkJDQoJCQ0KCX0pOw0KCQ0KDQoJc3RyaW5nTWV0YXRhYmxlID0gbmV3IHNoaW5lLlRhYmxlKHsgX19pbmRleDogc2hpbmUubGliLnN0cmluZyB9KTsNCg0KDQoJDQoJDQoJc2hpbmUubGliLnRhYmxlID0gbmV3IHNoaW5lLlRhYmxlKHsNCgkJDQoJCQ0KCQljb25jYXQ6IGZ1bmN0aW9uICh0YWJsZSwgc2VwLCBpLCBqKSB7DQoJCQlpZiAoISgodGFibGUgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlKSkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCJCYWQgYXJndW1lbnQgIzEgdG8gJ2NvbmNhdCcgKHRhYmxlIGV4cGVjdGVkKSIpOw0KCQ0KCQkJc2VwID0gc2VwIHx8ICcnOw0KCQkJaSA9IGkgfHwgMTsNCgkJCWogPSBqIHx8IHNoaW5lLmxpYi50YWJsZS5tYXhuKHRhYmxlKTsNCg0KCQkJdmFyIHJlc3VsdCA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCkuY29uY2F0KHRhYmxlLl9fc2hpbmUubnVtVmFsdWVzKS5zcGxpY2UoaSwgaiAtIGkgKyAxKTsNCgkJCXJldHVybiByZXN1bHQuam9pbihzZXApOw0KCQl9LA0KCQkNCgkNCgkNCgkNCgkJZ2V0bjogZnVuY3Rpb24gKHRhYmxlKSB7DQoJCQlpZiAoISgodGFibGUgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlKSkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCJCYWQgYXJndW1lbnQgIzEgaW4gJ2dldG4nICh0YWJsZSBleHBlY3RlZCkiKTsNCg0KCQkJdmFyIHZhbHMgPSB0YWJsZS5fX3NoaW5lLm51bVZhbHVlcywgDQoJCQkJa2V5cyA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCksDQoJCQkJaSwgDQoJCQkJaiA9IDA7DQoNCgkJCWZvciAoaSBpbiB2YWxzKSBpZiAodmFscy5oYXNPd25Qcm9wZXJ0eShpKSkga2V5c1tpXSA9IHRydWU7DQoJCQl3aGlsZSAoa2V5c1tqICsgMV0pIGorKzsNCgkNCgkJCS8vIEZvbGxvd2luZyB0cmFuc2xhdGVkIGZyb20gbHRhYmxlLmMgKGh0dHA6Ly93d3cubHVhLm9yZy9zb3VyY2UvNS4xL2x0YWJsZS5jLmh0bWwpDQoJCQlpZiAoaiA+IDAgJiYgdmFsc1tqXSA9PT0gdW5kZWZpbmVkKSB7DQoJCQkJLyogdGhlcmUgaXMgYSBib3VuZGFyeSBpbiB0aGUgYXJyYXkgcGFydDogKGJpbmFyeSkgc2VhcmNoIGZvciBpdCAqLw0KCQkJCXZhciBpID0gMDsNCgkNCgkJCQl3aGlsZSAoaiAtIGkgPiAxKSB7DQoJCQkJCXZhciBtID0gTWF0aC5mbG9vcigoaSArIGopIC8gMik7DQoJDQoJCQkJCWlmICh2YWxzW21dID09PSB1bmRlZmluZWQpIHsNCgkJCQkJCWogPSBtOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJaSA9IG07DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQlyZXR1cm4gaTsNCgkJCX0NCg0KCQkJcmV0dXJuIGo7DQoJCX0sDQoJCQ0KCQkJDQoJCQ0KCQkNCgkJLyoqDQoJCSAqIEltcGxlbWVudGF0aW9uIG9mIEx1YSdzIHRhYmxlLmluc2VydCBmdW5jdGlvbi4NCgkJICogQHBhcmFtIHtvYmplY3R9IHRhYmxlIFRoZSB0YWJsZSBpbiB3aGljaCB0byBpbnNlcnQuDQoJCSAqIEBwYXJhbSB7b2JqZWN0fSBpbmRleCBUaGUgcG9vc3Rpb24gdG8gaW5zZXJ0Lg0KCQkgKiBAcGFyYW0ge29iamVjdH0gb2JqIFRoZSB2YWx1ZSB0byBpbnNlcnQuDQoJCSAqLw0KCQlpbnNlcnQ6IGZ1bmN0aW9uICh0YWJsZSwgaW5kZXgsIG9iaikgew0KCQkJaWYgKCEoKHRhYmxlIHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkpIHRocm93IG5ldyBzaGluZS5FcnJvcignQmFkIGFyZ3VtZW50ICMxIGluIHRhYmxlLmluc2VydCgpLiBUYWJsZSBleHBlY3RlZCcpOw0KCQ0KCQkJaWYgKG9iaiA9PSB1bmRlZmluZWQpIHsNCgkJCQlvYmogPSBpbmRleDsNCgkJCQlpbmRleCA9IHRhYmxlLl9fc2hpbmUubnVtVmFsdWVzLmxlbmd0aDsNCgkJCX0gZWxzZSB7DQoJCQkJaW5kZXggPSBzaGluZS51dGlscy5jb2VyY2VUb051bWJlcihpbmRleCwgIkJhZCBhcmd1bWVudCAjMiB0byAnaW5zZXJ0JyAobnVtYmVyIGV4cGVjdGVkKSIpOw0KCQkJfQ0KCQ0KCQkJdGFibGUuX19zaGluZS5udW1WYWx1ZXMuc3BsaWNlKGluZGV4LCAwLCB1bmRlZmluZWQpOw0KCQkJdGFibGUuc2V0TWVtYmVyKGluZGV4LCBvYmopOw0KCQl9LA0KCQkNCgkJDQoJCQ0KCQkNCgkJbWF4bjogZnVuY3Rpb24gKHRhYmxlKSB7DQoJCQkvLyB2NS4yOiBzaGluZS53YXJuICgndGFibGUubWF4biBpcyBkZXByZWNhdGVkJyk7DQoJCQkNCgkJCWlmICghKCh0YWJsZSB8fCBzaGluZS5FTVBUWV9PQkopIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUpKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoIkJhZCBhcmd1bWVudCAjMSB0byAnbWF4bicgKHRhYmxlIGV4cGVjdGVkKSIpOw0KCQ0KCQkJLy8gLy8gbGVuZ3RoID0gMDsNCgkJCS8vIC8vIHdoaWxlICh0YWJsZVtsZW5ndGggKyAxXSAhPSB1bmRlZmluZWQpIGxlbmd0aCsrOw0KCQkJLy8gLy8gDQoJCQkvLyAvLyByZXR1cm4gbGVuZ3RoOw0KCQ0KCQkJLy8gdmFyIHJlc3VsdCA9IDAsDQoJCQkvLyAJaW5kZXgsDQoJCQkvLyAJaTsNCgkJCQkNCgkJCS8vIGZvciAoaSBpbiB0YWJsZSkgaWYgKChpbmRleCA9IDAgKyBwYXJzZUludCAoaSwgMTApKSA9PSBpICYmIHRhYmxlW2ldICE9PSBudWxsICYmIGluZGV4ID4gcmVzdWx0KSByZXN1bHQgPSBpbmRleDsNCgkJCS8vIHJldHVybiByZXN1bHQ7IA0KDQoJCQlyZXR1cm4gdGFibGUuX19zaGluZS5udW1WYWx1ZXMubGVuZ3RoIC0gMTsNCgkJfSwNCgkJDQoJCQ0KCQkNCgkJDQoJCS8qKg0KCQkgKiBJbXBsZW1lbnRhdGlvbiBvZiBMdWEncyB0YWJsZS5yZW1vdmUgZnVuY3Rpb24uDQoJCSAqIEBwYXJhbSB7b2JqZWN0fSB0YWJsZSBUaGUgdGFibGUgZnJvbSB3aGljaCB0byByZW1vdmUgYW4gZWxlbWVudC4NCgkJICogQHBhcmFtIHtvYmplY3R9IGluZGV4IFRoZSBwb3NpdGlvbiBvZiB0aGUgZWxlbWVudCB0byByZW1vdmUuDQoJCSAqLw0KCQlyZW1vdmU6IGZ1bmN0aW9uICh0YWJsZSwgaW5kZXgpIHsNCgkJCWlmICghKCh0YWJsZSB8fCBzaGluZS5FTVBUWV9PQkopIGluc3RhbmNlb2Ygc2hpbmUuVGFibGUpKSB0aHJvdyBuZXcgc2hpbmUuRXJyb3IoJ0JhZCBhcmd1bWVudCAjMSBpbiB0YWJsZS5yZW1vdmUoKS4gVGFibGUgZXhwZWN0ZWQnKTsNCgkNCgkJCXZhciBtYXggPSBzaGluZS5saWIudGFibGUuZ2V0bih0YWJsZSksDQoJCQkJdmFscyA9IHRhYmxlLl9fc2hpbmUubnVtVmFsdWVzLA0KCQkJCXJlc3VsdDsNCg0KCQkJaWYgKGluZGV4ID4gbWF4KSByZXR1cm47DQoJCQlpZiAoaW5kZXggPT0gdW5kZWZpbmVkKSBpbmRleCA9IG1heDsNCgkJCQkNCgkJCXJlc3VsdCA9IHZhbHMuc3BsaWNlKGluZGV4LCAxKTsNCgkJCXdoaWxlIChpbmRleCA8IG1heCAmJiB2YWxzW2luZGV4XSA9PT0gdW5kZWZpbmVkKSBkZWxldGUgdmFsc1tpbmRleCsrXTsNCg0KCQkJcmV0dXJuIHJlc3VsdDsNCgkJfSwJCQ0KCQkNCg0KCQkNCgkJDQoJCXNvcnQ6IGZ1bmN0aW9uICh0YWJsZSwgY29tcCkgew0KCQkJaWYgKCEoKHRhYmxlIHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkpIHRocm93IG5ldyBzaGluZS5FcnJvcigiQmFkIGFyZ3VtZW50ICMxIHRvICdzb3J0JyAodGFibGUgZXhwZWN0ZWQpIik7DQoJDQoJCQl2YXIgc29ydEZ1bmMsIA0KCQkJCWFyciA9IHRhYmxlLl9fc2hpbmUubnVtVmFsdWVzOw0KCQkNCgkJCWlmIChjb21wKSB7DQoJCQkJaWYgKCEoY29tcCBpbnN0YW5jZW9mIHNoaW5lLkZ1bmN0aW9uIHx8IGNvbXAuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCJCYWQgYXJndW1lbnQgIzIgdG8gJ3NvcnQnIChmdW5jdGlvbiBleHBlY3RlZCkiKTsNCgkNCgkJCQlzb3J0RnVuYyA9IGZ1bmN0aW9uIChhLCBiKSB7DQoJCQkJCXJldHVybiBjb21wLmFwcGx5KG51bGwsIFthLCBiXSwgdHJ1ZSlbMF0/IC0xIDogMTsNCgkJCQl9DQoJCQkNCgkJCX0gZWxzZSB7DQoJCQkJc29ydEZ1bmMgPSBmdW5jdGlvbiAoYSwgYikgew0KCQkJCQlyZXR1cm4gYSA8IGI/IC0xIDogMTsNCgkJCQl9Ow0KCQkJfQ0KCQ0KCQkJYXJyLnNoaWZ0KCk7DQoJCQlhcnIuc29ydChzb3J0RnVuYykudW5zaGlmdCh1bmRlZmluZWQpOw0KCQl9LA0KDQoNCg0KDQoJCXVucGFjazogZnVuY3Rpb24gKHRhYmxlLCBpLCBqKSB7DQoJCQlpZiAoISgodGFibGUgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIHNoaW5lLlRhYmxlKSkgdGhyb3cgbmV3IHNoaW5lLkVycm9yKCJCYWQgYXJndW1lbnQgIzEgdG8gJ3VucGFjaycgKHRhYmxlIGV4cGVjdGVkKSIpOwkNCgkNCgkJCWkgPSBpIHx8IDE7DQoJCQlpZiAoaiA9PT0gdW5kZWZpbmVkKSBqID0gc2hpbmUubGliLnRhYmxlLmdldG4odGFibGUpOw0KCQkJDQoJCQl2YXIgdmFscyA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCksDQoJCQkJaW5kZXg7DQoJDQoJCQlmb3IgKGluZGV4ID0gaTsgaW5kZXggPD0gajsgaW5kZXgrKykgdmFscy5wdXNoKHRhYmxlLmdldE1lbWJlcihpbmRleCkpOw0KCQkJcmV0dXJuIHZhbHM7DQoJCX0NCg0KDQoJfSk7DQoJDQovKioNCiAqIEBmaWxlT3ZlcnZpZXcgSklUIGNvbXBpbGF0aW9uIGZ1bmN0aW9uYWxpdHkuDQogKiBAYXV0aG9yIDxhIGhyZWY9Im1haWx0bzpwYXVsLmN1dGhiZXJ0c29uQGdhbWVzeXMuY28udWsiPlBhdWwgQ3V0aGJlcnRzb248L2E+DQogKi8NCg0KCS8qKg0KCSAqIE5hbWVzcGFjZSBmb3IgZnVuY3Rpb25zIHJlbGF0ZWQgdG8gdGhlIGp1c3QtaW4tdGltZSBjb21waWxlci4NCgkgKiBAbmFtZXNwYWNlDQoJICovDQoJc2hpbmUuaml0ID0gc2hpbmUuaml0IHx8IHt9Ow0KDQoNCg0KDQoJLyoqDQoJICogRmxhZyB3aXRoIHdoaWNoIHRvIHN3aXRjaCBKSVQgY29tcGlsZXIgb24gYW5kIG9mZi4NCgkgKiBAdHlwZSBib29sZWFuDQoJICovDQoJc2hpbmUuaml0LmVuYWJsZWQgPSBzaGluZS5qaXQuZW5hYmxlZCB8fCBmYWxzZTsNCg0KDQoNCg0KCS8qKg0KCSAqIFRoZSBudW1iZXIgb2YgdGltZXMgdGhhdCBhIGZ1bmN0aW9uIGlzIGludGVycHJldGVkIGJlZm9yZSBpdCBpcyBzZXQgdG8gYmUgY29tcGlsZWQuDQoJICogQHR5cGUgbnVtYmVyDQoJICovDQoJc2hpbmUuaml0LklOVk9DQVRJT05fVE9MRVJBTkNFID0gMjsNCg0KDQoNCg0KCS8qKg0KCSAqIFRoZSBtaW5pbXVtIEZQUyByZXF1aXJlZCBiZWZvcmUgdGhlIGNvbXBpbGVyIHdpbGwga2ljayBpbi4NCgkgKiBTZXQgdG8gemVybyBmb3Igc3luY2hyb25vdXMgY29tcGlsZS4NCgkgKiBAdHlwZSBudW1iZXINCgkgKi8NCglzaGluZS5qaXQuTUlOX0ZQU19UT19DT01QSUxFID0gNTk7DQoNCg0KDQoNCgkvKioNCgkgKiBUaGUgbGVuZ3RoIG9mIGludGVydmFsIGJldHdlZW4gY2hlY2tzIG9uIEZQUyBiZWZvcmUgY29tcGlsZSwgaW4gbXMuDQoJICogQHR5cGUgbnVtYmVyDQoJICovDQoJc2hpbmUuaml0LkNPTVBJTEVfSU5URVJWQUwgPSA1MDA7DQoNCg0KDQoNCgl2YXIgU0VUX1JFR19QQVRURVJOID0gL15zZXRSXChSLChcZCspLChbXjtdKj8pXCk7JC8sDQoJCWdjID0gc2hpbmUuZ2MsDQoJCUZ1bmN0aW9uX2FwcGx5ID0gc2hpbmUuRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5LA0KCQljb21waWxlUXVldWUgPSBnYy5jcmVhdGVBcnJheSgpLA0KCQlmcmFtZUNvdW50ZXIgPSAwLA0KCQl3YWl0aW5nVG9Db21waWxlID0gZmFsc2UsDQoJCWdldE5vdyA9IERhdGVbJ25vdyddPyBEYXRlWydub3cnXSA6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpOyB9LA0KCQl3YWl0VGltZXJTdGFydGVkOw0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KCSogIEhvb2tzIHRvIGVsc2V3aGVyZQ0KCSoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KCXNoaW5lLkZ1bmN0aW9uLnByb3RvdHlwZS5hcHBseSA9IGZ1bmN0aW9uICgpIHsNCgkJdmFyIGRhdGEsDQoJCQljb21waWxlZDsNCg0KCQlpZiAoc2hpbmUuaml0LmVuYWJsZWQpIHsNCgkJCWRhdGEgPSB0aGlzLl9kYXRhOw0KDQoJCQkvLyBJZiBmdW5jdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGNvbXBpbGVkLi4uDQoJCQlpZiAoY29tcGlsZWQgPSBkYXRhLl9jb21waWxlZCkgew0KCQkJCXRoaXMuYXBwbHkgPSBjcmVhdGVSdW5uZXIodGhpcywgZGF0YSwgY29tcGlsZWQpOw0KCQkJCXJldHVybiB0aGlzLmFwcGx5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCQl9DQoNCgkJCXRoaXMuX3J1bkNvdW50ID0gdGhpcy5fcnVuQ291bnQgfHwgMDsNCg0KCQkJaWYgKCF0aGlzLl9jb21waWxpbmcgJiYgKyt0aGlzLl9ydW5Db3VudCA9PSBzaGluZS5qaXQuSU5WT0NBVElPTl9UT0xFUkFOQ0UpIHsNCgkJCQl0aGlzLl9jb21waWxlKCk7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gRnVuY3Rpb25fYXBwbHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCgl9Ow0KDQoNCg0KDQoJLyoqDQoJICogQ29tcGlsZXMgdGhlIGZ1bmN0aW9uIHRvIEphdmFTY3JpcHQuDQoJICovDQoJc2hpbmUuRnVuY3Rpb24ucHJvdG90eXBlLl9jb21waWxlID0gZnVuY3Rpb24gKCkgew0KCQl2YXIgbWUgPSB0aGlzLA0KCQkJZGF0YSA9IHRoaXMuX2RhdGE7DQoNCgkJaWYgKCFkYXRhLl9jb21waWxpbmcpIHsNCgkJCWRhdGEuX2NvbXBpbGluZyA9IHRydWU7DQoNCgkJCXNoaW5lLmppdC5jb21waWxlKHRoaXMsIGZ1bmN0aW9uIChjb21waWxlZCkgew0KCQkJCWlmIChkYXRhLl9jb21waWxlZCA9IGNvbXBpbGVkKSB7DQoJCQkJCWRhdGEuX2NvbXBpbGluZyA9IGZhbHNlOw0KCQkJCQltZS5hcHBseSA9IGNyZWF0ZVJ1bm5lcihtZSwgZGF0YSwgY29tcGlsZWQpOw0KCQkJCX0NCgkJCX0pOw0KCQl9DQoJfTsNCg0KDQoNCg0KCWZ1bmN0aW9uIGNyZWF0ZVJ1bm5lciAoaW5zdGFuY2UsIGRhdGEsIGNvbXBpbGVkKSB7DQoJCXJldHVybiBmdW5jdGlvbiAoY29udGV4dCwgYXJncykgew0KCQkJdmFyIGNsb3N1cmUgPSBnYy5jcmVhdGVPYmplY3QoKSwNCgkJCQlyZXR2YWxzOw0KDQoJCQljbG9zdXJlLl92bSA9IGluc3RhbmNlLl92bTsNCgkJCWNsb3N1cmUuX2dsb2JhbHMgPSBpbnN0YW5jZS5fZ2xvYmFsczsNCgkJCWNsb3N1cmUuX3VwdmFsdWVzID0gaW5zdGFuY2UuX3VwdmFsdWVzOw0KCQkJY2xvc3VyZS5fY29uc3RhbnRzID0gZGF0YS5jb25zdGFudHM7DQoJCQljbG9zdXJlLl9mdW5jdGlvbnMgPSBkYXRhLmZ1bmN0aW9uczsNCgkJCWNsb3N1cmUuX2xvY2Fsc1VzZWRBc1VwdmFsdWVzID0gZ2MuY3JlYXRlQXJyYXkoKTsNCg0KCQkJcmV0dXJuIGNvbXBpbGVkLmFwcGx5KGNsb3N1cmUsIGFyZ3MpOyANCgkJfTsNCgl9DQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCgkqICBIb29rcyBmcm9tIGVsc2V3aGVyZSAoZXZlbnQgaGFuZGxlcnMpDQoJKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQoNCglzaGluZS5qaXQub25Db21waWxlID0gZnVuY3Rpb24gKCkge307ICAgLy8gT3ZlcndyaXRlIHRvIG1vbml0b3Igaml0IGNvbXBpbGVyIGFjdGl2aXR5Lg0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KCSogIENvbXBpbGUgUXVldWUNCgkqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovDQoNCg0KCWZ1bmN0aW9uIGVuYWJsZUNvbXBpbGVUaW1lciAoKSB7DQoJCWlmICghd2FpdGluZ1RvQ29tcGlsZSkgew0KCQkJd2FpdGluZ1RvQ29tcGlsZSA9IHRydWU7DQoJCQl3YWl0VGltZXJTdGFydGVkID0gZ2V0Tm93KCk7DQoJCQlmcmFtZUNvdW50ZXIgPSAwOw0KDQoJCQl3aW5kb3cuc2V0VGltZW91dChvbldhaXRUaW1lclRpY2ssIHNoaW5lLmppdC5DT01QSUxFX0lOVEVSVkFMKTsNCgkJCXdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUob25BbmltYXRpb25GcmFtZSk7DQoJCX0NCgl9DQoNCg0KDQoNCglmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lICgpIHsNCgkJaWYgKHdhaXRpbmdUb0NvbXBpbGUpIHsNCgkJCWZyYW1lQ291bnRlcisrOw0KCQkJd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShvbkFuaW1hdGlvbkZyYW1lKTsNCgkJfQ0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIG9uV2FpdFRpbWVyVGljayAoKSB7DQoJCWlmICghc2hpbmUgfHwgIXNoaW5lLmppdCkgcmV0dXJuOw0KCQkNCgkJdmFyIG5vdyA9IGdldE5vdygpLA0KCQkJZnBzID0gMTAwMCAqIGZyYW1lQ291bnRlciAvIChub3cgLSB3YWl0VGltZXJTdGFydGVkKTsNCg0KCQlpZiAoZnBzID49IHNoaW5lLmppdC5NSU5fRlBTX1RPX0NPTVBJTEUpIHsgDQoJCQlwcm9jZXNzUXVldWUoKTsNCg0KCQl9IGVsc2Ugew0KCQkJZnJhbWVDb3VudGVyID0gMDsNCgkJCXdhaXRUaW1lclN0YXJ0ZWQgPSBub3c7DQoJCQl3aW5kb3cuc2V0VGltZW91dChvbldhaXRUaW1lclRpY2ssIHNoaW5lLmppdC5DT01QSUxFX0lOVEVSVkFMKTsNCgkJfQ0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHByb2Nlc3NRdWV1ZSAoKSB7DQoJCXdhaXRpbmdUb0NvbXBpbGUgPSBmYWxzZTsNCgkJc2hpbmUuaml0Lm9uQ29tcGlsZSgpOw0KDQoJCXdoaWxlIChjb21waWxlUXVldWUubGVuZ3RoKSB7DQoJCQl2YXIgaXRlbSA9IGNvbXBpbGVRdWV1ZS5zaGlmdCgpDQoJCQljb21waWxlKGl0ZW1bMF0sIGl0ZW1bMV0pOw0KCQkJZ2MuY29sbGVjdChpdGVtKTsNCgkJfQ0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIGNvbXBpbGUgKGZ1bmMsIGNhbGxiYWNrKSB7DQoJCXZhciBqcyA9IHNoaW5lLmppdC50b0pTKGZ1bmMpOw0KCQljYWxsYmFjayhzaGluZS5vcGVyYXRpb25zLmV2YWx1YXRlSW5TY29wZShqcywgZnVuYy5fdm0pKTsNCgl9DQoNCg0KDQoNCgkvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoJKiAgSGVscGVycw0KCSoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KDQoJdmFyIE5FV0xJTkVfUEFUVEVSTiA9IC9cbi9nLA0KCQlBUE9TX1BBVFRFUk4gPSAvJy9nOw0KDQoNCgkvKioNCgkgKiBSZXR1cm5zIGEgcGFyc2FibGUgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgcHJpbWF0aXZlIHZhbHVlLg0KCSAqIEBwYXJhbSB7b2JqZWN0fSB2YWx1ZSBUaGUgaW5wdXQgdmFsdWUuDQoJICogQHJldHVybnMge3N0cmluZ30gQSBzdHJpbmctZW5jb2RlZCByZXByZXNlbnRhdGlvbi4NCgkgKi8NCglmdW5jdGlvbiBmb3JtYXRWYWx1ZSAodmFsdWUpIHsNCgkJaWYgKHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJykgew0KCQkJdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKE5FV0xJTkVfUEFUVEVSTiwgJ1xcbicpOw0KCQkJdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKEFQT1NfUEFUVEVSTiwgJ1xcXCcnKTsNCgkJCXJldHVybiAiJyIgKyB2YWx1ZSArICInIjsNCgkJfQ0KDQoJCXJldHVybiB2YWx1ZTsNCgl9DQoNCg0KDQoNCgkvKioNCgkgKiBBZGRzIGEgbmV3IHVuaXF1ZSB2YXJpYWJsZSB0byB0aGUgc2NvcGUgb2YgYSBmdW5jdGlvbi4NCgkgKiBAdGhpcyB7b2JqZWN0fSBUaGUgc3RhdGUgb2YgdGhlIGZ1bmN0aW9uIG9iamVjdCBiZWluZyBjb21waWxlZC4NCgkgKiBAcGFyYW0ge3N0cmluZ30gcHJlZml4IFRoZSBwcmVmaXggdG8gdGhlIHJlc3VsdGluZyB2YXJpYWJsZSBuYW1lLg0KCSAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBuYW1lIG9mIHRoZSBuZXcgdmFyaWFibGUuDQoJICovDQoJZnVuY3Rpb24gY3JlYXRlVmFyIChwcmVmaXgpIHsNCgkJdmFyIGtleSA9IHByZWZpeCArIHRoaXMucGM7DQoJCXRoaXMudmFycy5wdXNoKGtleSk7DQoJCXJldHVybiBrZXk7DQoJfQ0KDQoNCg0KDQoJLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KCSogIFRyYW5zbGF0b3JzDQoJKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfbW92ZSAoYSwgYikgew0KCQlyZXR1cm4gJ3NldFIoUiwnICsgYSArICcsUlsnICsgYiArICddKTsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9sb2FkayAoYSwgYngpIHsNCgkJcmV0dXJuICdzZXRSKFIsJyArIGEgKyAnLCcgKyBmb3JtYXRWYWx1ZSh0aGlzLmdldENvbnN0YW50KGJ4KSkgKyAnKTsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9sb2FkYm9vbCAoYSwgYiwgYykgew0KCQl2YXIgcmVzdWx0ID0gJ3NldFIoUiwnICsgYSArICcsJyArICEhYiArICcpOycsDQoJCQlwYzsNCg0KCQlpZiAoYykgew0KCQkJdGhpcy5qdW1wRGVzdGluYXRpb25zW3BjID0gdGhpcy5wYyArIDJdID0gMTsNCgkJCXJlc3VsdCArPSAncGM9JyArIHBjICsgJzticmVhazsnOw0KCQl9DQoNCgkJcmV0dXJuIHJlc3VsdDsNCgl9DQoJCQ0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9sb2FkbmlsIChhLCBiKSB7DQoJCXZhciBuaWxzID0gZ2MuY3JlYXRlQXJyYXkoKSwNCgkJCXJlc3VsdDsNCg0KCQlmb3IgKHZhciBpID0gYTsgaSA8PSBiOyBpKyspIG5pbHMucHVzaCgnc2V0UihSLCcgKyBpICsgJyk7Jyk7DQoJCXJlc3VsdCA9IG5pbHMuam9pbignJyk7DQoNCgkJZ2MuY29sbGVjdChuaWxzKTsNCg0KCQlyZXR1cm4gcmVzdWx0Ow0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9nZXR1cHZhbCAoYSwgYikgew0KCQlyZXR1cm4gJ3NldFIoUiwnICsgYSArICcsY2wuX3VwdmFsdWVzWycgKyBiICsgJ109PT12b2lkIDA/dm9pZCAwOmNsLl91cHZhbHVlc1snICsgYiArICddLmdldFZhbHVlKCkpOyc7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX2dldGdsb2JhbCAoYSwgYikgew0KCQl2YXIga2V5ID0gdGhpcy5nZXRDb25zdGFudChiKTsNCgkJcmV0dXJuICdzZXRSKFIsJyArIGEgKyAnLHNoaW5lX2cnICsgKChrZXkgPT0gJ19HJyk/ICcnIDogJ1snICsgZm9ybWF0VmFsdWUoa2V5KSArICddJykgKyAnKTsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9nZXR0YWJsZSAoYSwgYiwgYykgew0KCQljID0gKGMgPj0gMjU2KT8gZm9ybWF0VmFsdWUodGhpcy5nZXRDb25zdGFudChjIC0gMjU2KSkgOiAnUlsnICsgYyArICddJzsNCgkJcmV0dXJuICdzZXRSKFIsJyArIGEgKyAnLGdldHRhYmxlX2ludGVybmFsKFJbJyArIGIgKyAnXSwnICsgYyArICcpKTsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9zZXRnbG9iYWwoYSwgYikgew0KCQl2YXIga2V5ID0gZm9ybWF0VmFsdWUodGhpcy5nZXRDb25zdGFudChiKSk7DQoJCXJldHVybiAnc2V0Z2xvYmFsX2ludGVybmFsLmNhbGwoY2wsJyArIGtleSArICcsUlsnICsgYSArICddKTsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9zZXR1cHZhbCAoYSwgYikgew0KCQlyZXR1cm4gJ2NsLl91cHZhbHVlc1snICsgYiArICddLnNldFZhbHVlKFJbJyArIGEgKyAnXSk7JzsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfc2V0dGFibGUgKGEsIGIsIGMpIHsNCgkJYiA9IChiID49IDI1Nik/IGZvcm1hdFZhbHVlKHRoaXMuZ2V0Q29uc3RhbnQoYiAtIDI1NikpIDogJ1JbJyArIGIgKyAnXSc7DQoJCWMgPSAoYyA+PSAyNTYpPyBmb3JtYXRWYWx1ZSh0aGlzLmdldENvbnN0YW50KGMgLSAyNTYpKSA6ICdSWycgKyBjICsgJ10nOw0KDQoJCXJldHVybiAnc2V0dGFibGVfaW50ZXJuYWwoUlsnICsgYSArICddLCcgKyBiICsgJywnICsgYyArICcpOyc7DQoJfQ0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9uZXd0YWJsZSAoYSwgYiwgYykgew0KCQlyZXR1cm4gJ3NldFIoUiwnICsgYSArICcsbmV3dGFibGVfaW50ZXJuYWwoKSk7JzsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfc2VsZiAoYSwgYiwgYykgew0KCQljID0gKGMgPj0gMjU2KT8gZm9ybWF0VmFsdWUodGhpcy5nZXRDb25zdGFudChjIC0gMjU2KSkgOiAnUlsnICsgYyArICddJzsNCgkJcmV0dXJuICdzZXRSKFIsJyArIChhICsgMSkgKyAnLFJbJyArIGIgKyAnXSk7c2V0UihSLCcgKyBhICsgJyxzZWxmX2ludGVybmFsKFJbJyArIGIgKyAnXSwnICsgYyArICcpKTsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9iaW5hcnlfYXJpdGhtZXRpYyAoYSwgYiwgYywgbmFtZSkgew0KCQliID0gKGIgPj0gMjU2KT8gZm9ybWF0VmFsdWUodGhpcy5nZXRDb25zdGFudChiIC0gMjU2KSkgOiAnUlsnICsgYiArICddJzsNCgkJYyA9IChjID49IDI1Nik/IGZvcm1hdFZhbHVlKHRoaXMuZ2V0Q29uc3RhbnQoYyAtIDI1NikpIDogJ1JbJyArIGMgKyAnXSc7DQoNCgkJcmV0dXJuICdzZXRSKFIsJyArIGEgKyAnLCcgKyAnYmluYXJ5X2FyaXRobWV0aWNfaW50ZXJuYWwoJyArIGIgKyAnLCcgKyBjICsgIiwnX18iICsgbmFtZSArICInLCIgKyBuYW1lICsgJ19pbnRlcm5hbCkpOyc7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX2FkZCAoYSwgYiwgYykgew0KCQlyZXR1cm4gdHJhbnNsYXRlX2JpbmFyeV9hcml0aG1ldGljLmNhbGwodGhpcywgYSwgYiwgYywgJ2FkZCcpOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9zdWIgKGEsIGIsIGMpIHsNCgkJcmV0dXJuIHRyYW5zbGF0ZV9iaW5hcnlfYXJpdGhtZXRpYy5jYWxsKHRoaXMsIGEsIGIsIGMsICdzdWInKTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfbXVsIChhLCBiLCBjKSB7DQoJCXJldHVybiB0cmFuc2xhdGVfYmluYXJ5X2FyaXRobWV0aWMuY2FsbCh0aGlzLCBhLCBiLCBjLCAnbXVsJyk7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX2RpdiAoYSwgYiwgYykgew0KCQlyZXR1cm4gdHJhbnNsYXRlX2JpbmFyeV9hcml0aG1ldGljLmNhbGwodGhpcywgYSwgYiwgYywgJ2RpdicpOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9tb2QgKGEsIGIsIGMpIHsNCgkJcmV0dXJuIHRyYW5zbGF0ZV9iaW5hcnlfYXJpdGhtZXRpYy5jYWxsKHRoaXMsIGEsIGIsIGMsICdtb2QnKTsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfcG93IChhLCBiLCBjKSB7DQoJCWIgPSAoYiA+PSAyNTYpPyBmb3JtYXRWYWx1ZSh0aGlzLmdldENvbnN0YW50KGIgLSAyNTYpKSA6ICdSWycgKyBiICsgJ10nOw0KCQljID0gKGMgPj0gMjU2KT8gZm9ybWF0VmFsdWUodGhpcy5nZXRDb25zdGFudChjIC0gMjU2KSkgOiAnUlsnICsgYyArICddJzsNCg0KCQlyZXR1cm4gJ3NldFIoUiwnICsgYSArICcsYmluYXJ5X2FyaXRobWV0aWNfaW50ZXJuYWwoJyArIGIgKyAnLCcgKyBjICsgIiwnX19wb3cnLE1hdGgucG93KSk7IjsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfdW5tIChhLCBiKSB7DQoJCXJldHVybiAnc2V0UihSLCcgKyBhICsgJyx1bm1faW50ZXJuYWwoUlsnICsgYiArICddKSk7JzsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfbm90IChhLCBiKSB7DQoJCXJldHVybiAnc2V0UihSLCcgKyBhICsgJywhUlsnICsgYiArICddKTsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9sZW4gKGEsIGIpIHsNCgkJcmV0dXJuICdzZXRSKFIsJyArIGEgKyAnLGxlbl9pbnRlcm5hbChSWycgKyBiICsgJ10pKTsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9jb25jYXQgKGEsIGIsIGMpIHsNCgkJcmV0dXJuICdzZXRSKFIsJyArIGEgKyAnLGNvbmNhdF9pbnRlcm5hbChSWycgKyBjICsgJ10sUi5zbGljZSgnICsgYiArICcsJyArIGMgKyAnKS5yZXZlcnNlKCkpKTsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9qbXAgKGEsIHNieCkgew0KCQl2YXIgaSA9IHRoaXMucGMgKyBzYnggKyAxOw0KCQl0aGlzLmp1bXBEZXN0aW5hdGlvbnNbaV0gPSAxOw0KCQlyZXR1cm4gJ3BjPScgKyBpICsgJzticmVhazsnOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9lcSAoYSwgYiwgYykgew0KCQl2YXIgcGMgPSB0aGlzLnBjICsgMjsNCgkJdGhpcy5qdW1wRGVzdGluYXRpb25zW3BjXSA9IDE7DQoNCgkJYSA9IGE/ICchJyA6ICcnOw0KCQliID0gKGIgPj0gMjU2KT8gZm9ybWF0VmFsdWUodGhpcy5nZXRDb25zdGFudChiIC0gMjU2KSkgOiAnUlsnICsgYiArICddJzsNCgkJYyA9IChjID49IDI1Nik/IGZvcm1hdFZhbHVlKHRoaXMuZ2V0Q29uc3RhbnQoYyAtIDI1NikpIDogJ1JbJyArIGMgKyAnXSc7DQoNCgkJcmV0dXJuICdpZignICsgYSArICdlcV9pbnRlcm5hbCgnICsgYiArICcsJyArIGMgKyAnKSl7cGM9JyArIHBjICsgJzticmVha30nOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9jb21wYXJlIChhLCBiLCBjLCBtbSwgZikgew0KCQl2YXIgcGMgPSB0aGlzLnBjICsgMjsNCgkJdGhpcy5qdW1wRGVzdGluYXRpb25zW3BjXSA9IDE7DQoNCgkJYiA9IChiID49IDI1Nik/IGZvcm1hdFZhbHVlKHRoaXMuZ2V0Q29uc3RhbnQoYiAtIDI1NikpIDogJ1JbJyArIGIgKyAnXSc7DQoJCWMgPSAoYyA+PSAyNTYpPyBmb3JtYXRWYWx1ZSh0aGlzLmdldENvbnN0YW50KGMgLSAyNTYpKSA6ICdSWycgKyBjICsgJ10nOw0KDQoJCXJldHVybiAnaWYoY29tcGFyZV9pbnRlcm5hbCgnICsgYiArICcsJyArIGMgKyAiLCciICsgbW0gKyAiJywiICsgZiArJykhPScgKyBhICsgJyl7cGM9JyArIHBjICsgJzticmVhazt9JzsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfbHQgKGEsIGIsIGMpIHsNCgkJcmV0dXJuIHRyYW5zbGF0ZV9jb21wYXJlLmNhbGwodGhpcywgYSwgYiwgYywgJ19fbHQnLCAnbHRfZnVuYycpOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9sZSAoYSwgYiwgYykgew0KCQlyZXR1cm4gdHJhbnNsYXRlX2NvbXBhcmUuY2FsbCh0aGlzLCBhLCBiLCBjLCAnX19sZScsICdsZV9mdW5jJyk7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX3Rlc3QgKGEsIGIsIGMpIHsNCgkJdmFyIHBjID0gdGhpcy5wYyArIDI7DQoJCXRoaXMuanVtcERlc3RpbmF0aW9uc1twY10gPSAxOw0KDQoJCXJldHVybiAnaWYoc2hpbmUudXRpbHMuY29lcmNlVG9Cb29sZWFuKFJbJyArIGEgKyAnXSkhPScgKyBjICsgJyl7cGM9JyArIHBjICsgJzticmVha30nOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV90ZXN0c2V0IChhLCBiLCBjKSB7DQoJCXZhciBwYyA9IHRoaXMucGMgKyAyOw0KCQl0aGlzLmp1bXBEZXN0aW5hdGlvbnNbcGNdID0gMTsNCg0KCQlyZXR1cm4gJ2lmKHNoaW5lLnV0aWxzLmNvZXJjZVRvQm9vbGVhbihSWycgKyBiICsgJ10pPT0nICsgYyArICcpe1JbJyArIGEgKyAnXT1SWycgKyBiICsgJ119ZWxzZXtwYz0nICsgcGMgKyAnO2JyZWFrfScNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfY2FsbCAoYSwgYiwgYykgew0KCQl2YXIgYXJnTGltaXRzLA0KCQkJcmVzdWx0Ow0KDQoJCWlmIChiID09PSAwKSB7IC8vIEFyZ3VtZW50cyBmcm9tIFIoQSsxKSB0byB0b3ANCgkJCWFyZ0xpbWl0cyA9IChhICsgMSkgKyAnLHZvaWQgMCc7DQogDQoJCX0gZWxzZSBpZiAoYiA9PT0gMSkgeyAvLyBObyBhcmd1bWVudHMNCgkJCWFyZ0xpbWl0cyA9ICd2b2lkIDAsdm9pZCAwJzsNCiANCgkJfSBlbHNlIHsgLy8gQXJndW1lbnRzIGZyb20gUihBKzEpIHRvIFIoQStCLTEpDQoJCQlhcmdMaW1pdHMgPSAoYSArIDEpICsgJywnICsgKGEgKyBiKTsNCg0KCQkJdmFyIGNhblJlc3RydWN0dXJlID0gdHJ1ZSwNCgkJCQlpLCBsLA0KCQkJCXBhcmFtcyA9IGdjLmNyZWF0ZUFycmF5KCksDQoJCQkJbWF0Y2gsIGZ1bmM7DQoNCgkJCWZvciAoaSA9IDE7IGkgPCBiOyBpKyspIHsNCgkJCQlpZiAoISgobWF0Y2ggPSB0aGlzLmNvZGVbdGhpcy5wYyAtIGldKSAmJiBtYXRjaC5tYXRjaChTRVRfUkVHX1BBVFRFUk4pKSB8fCBtYXRjaFsxXSAhPSAiIiArIChhICsgYiAtIGkpKSB7DQoJCQkJCWNhblJlc3RydWN0dXJlID0gZmFsc2U7DQoJCQkJCWJyZWFrOw0KCQkJCS8vIH0gZWxzZSBpZiAobWF0Y2hbMl0uaW5kZXhPZignc2V0UignKSA+PSAwKSB7DQoJCQkJLy8gIGNhblJlc3RydWN0dXJlID0gZmFsc2U7DQoJCQkJLy8gIGJyZWFrOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXBhcmFtcy51bnNoaWZ0KG1hdGNoWzJdKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWlmIChjYW5SZXN0cnVjdHVyZSkgew0KCQkJCW1hdGNoID0gdGhpcy5jb2RlW3RoaXMucGMgLSBiXS5tYXRjaChTRVRfUkVHX1BBVFRFUk4pOw0KDQoJCQkJaWYgKG1hdGNoICYmIG1hdGNoWzFdID09ICcnICsgYSkgew0KCQkJCQlmdW5jID0gbWF0Y2hbMl07DQoJCQkJCWZvciAoaSA9IDE7IGkgPD0gYjsgaSsrKSB0aGlzLmNvZGVbdGhpcy5wYyAtIGldID0gJyc7DQoNCgkJCQkJaWYgKGMgPT0gMSkgew0KCQkJCQkJcmVzdWx0ID0gZnVuYyArICcuY2FsbCh2b2lkIDAsJyArIHBhcmFtcy5qb2luKCcsJykgKyAnKTsnOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJcmVzdWx0ID0gJ3NldFJBcnIoUiwnICsgYSArICcsJyArIChjPyBjIC0gMSA6ICd2b2lkIDAnKSArICcsJyArIGZ1bmMgKyAnLmNhbGwodm9pZCAwLCcgKyBwYXJhbXMuam9pbignLCcpICsgJykpOyc7DQoJCQkJCX0NCgkJCQl9DQoJCQl9IA0KCQl9DQogDQoJCWdjLmNvbGxlY3QocGFyYW1zKTsNCgkJcmV0dXJuIHJlc3VsdCB8fCAnY2FsbFIoUiwnICsgYSArICcsJyArIGMgKyAnLCcgKyBhcmdMaW1pdHMgKyAnKTsnOw0KCX0NCg0KDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX3RhaWxjYWxsIChhLCBiKSB7DQoJCS8vIFRPRE8NCgkJcmV0dXJuIHRyYW5zbGF0ZV9jYWxsLmNhbGwodGhpcywgYSwgYiwgMCk7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX3JldHVybiAoYSwgYikgew0KCQl2YXIgY2xvc2UgPSB0cmFuc2xhdGVfY2xvc2UuY2FsbCh0aGlzLCAwKSwNCgkJCWk7DQoNCgkJaWYgKGIgPT09IDApIHsNCgkJCWkgPSBjcmVhdGVWYXIuY2FsbCh0aGlzLCAnaScpOw0KCQkJcmV0dXJuICdfPVIuc2xpY2UoJyArIGEgKyAnKTsnICsgY2xvc2UgKyAncmV0dXJuIF87JzsNCg0KCQl9IGVsc2UgaWYgKGIgPT0gMSkgew0KCQkJcmV0dXJuIGNsb3NlICsgJ3JldHVybiBjcmVhdGVBcnJheSgpOyc7DQogDQoJCX0gZWxzZSB7DQoJCQlyZXR1cm4gJ189Ui5zbGljZSgnICsgYSArICcsJyArIChhICsgYiAtIDEpICsgJyk7JyArIGNsb3NlICsgJ3JldHVybiBfOyc7DQoJCX0NCgl9ICAgDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX2Zvcmxvb3AgKGEsIHNieCkgew0KCQl2YXIgc3RlcCA9ICdSWycgKyAoYSArIDIpICsgJ10nLA0KCQkJbGltaXQgPSAnUlsnICsgKGEgKyAxKSArICddJywNCgkJCWluZGV4ID0gJ1JbJyArIGEgKyAnXSsnICsgc3RlcCwNCgkJCWZvcndhcmQgPSBzdGVwICsgJz4wJywNCgkJCWxpbWl0VmFyID0gY3JlYXRlVmFyLmNhbGwodGhpcywgJ2xpbWl0JyksDQoJCQlwYyA9IHRoaXMucGMgKyBzYnggKyAxOw0KDQoJCS8vIFRyeSB0byByZWNvbnN0cnVjdCB0aGUgZm9yIGxvb3ANCgkJdmFyIGNhbkxvb3AgPSB0cnVlLA0KCQkJbG9vcFZhciwgaTsNCg0KCQlmb3IgKGkgPSBwYzsgaSA8IHRoaXMucGM7IGkrKykgew0KCQkJaWYgKHRoaXMuanVtcERlc3RpbmF0aW9uc1tpXSB8fCAodGhpcy5jb2RlW2ldICYmIHRoaXMuY29kZVtpXS5pbmRleE9mKCdwYz0nKSA+PSAwKSkgew0KCQkJCWNhbkxvb3AgPSBmYWxzZTsNCgkJCQlicmVhazsNCgkJCX0NCgkJfQ0KDQoJCWlmIChjYW5Mb29wKSB7DQoJCQlsb29wVmFyID0gJ1JbJyArIChhICsgMykgKyAnXSc7DQoJCQl0aGlzLmNvZGVbcGMgLSAxXSA9ICdmb3IoJyArIGxvb3BWYXIgKyAnPVJbJyArIGEgKyAnXSwnICsgbGltaXRWYXIgKyAnPScgKyBsaW1pdCArICc7JyArIGZvcndhcmQgKyAnPycgKyBsb29wVmFyICArICc8PScgKyBsaW1pdFZhciArICc6JyArIGxvb3BWYXIgICsgJz49JyArIGxpbWl0VmFyICsgJzsnICsgbG9vcFZhciArICcrPScgKyBzdGVwICsnKXsnOw0KCQkJZGVsZXRlIHRoaXMuanVtcERlc3RpbmF0aW9uc1t0aGlzLnBjXTsNCgkJCXJldHVybiAnfSc7DQoJCX0NCg0KDQoJCS8vIENhbid0IHJlY29uc3RydWN0IGR1ZSB0byBpbnRlcm5hbCBqdW1wcywgZmFsbGJhY2sgdG8ganVtcHMuLi4NCgkJdGhpcy5qdW1wRGVzdGluYXRpb25zW3BjXSA9IDE7DQoJCXJldHVybiAnc2V0UihSLCcgKyBhICsgJywnICsgaW5kZXggKyAnKTtfPScgKyBmb3J3YXJkICsgJztpZigoXyYmUlsnICsgYSArICddPD0nICsgbGltaXQgKyAnKXx8KCFfJiZSWycgKyBhICsgJ10+PScgKyBsaW1pdCArICcpKXtzZXRSKFIsJyArIChhICsgMykgKyAnLFJbJyArIGEgKyAnXSk7cGM9JyArIHBjICsgJzticmVha30nOw0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV9mb3JwcmVwIChhLCBzYngpIHsNCgkJdmFyIHBjID0gdGhpcy5wYyArIHNieCArIDE7DQoJCXRoaXMuanVtcERlc3RpbmF0aW9uc1twY10gPSAxOw0KDQoJCXJldHVybiAnc2V0UihSLCcgKyBhICsgJyxSWycgKyBhICsgJ10tUlsnICsgKGEgKyAyKSArICddKTtwYz0nICsgcGMgKyAnO2JyZWFrOyc7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX3Rmb3Jsb29wIChhLCBiLCBjKSB7DQoJCXZhciBmdmFyID0gY3JlYXRlVmFyLmNhbGwodGhpcywgJ3Rmb3InKSwNCgkJCXBjID0gdGhpcy5wYyArIDIsDQoJCQlyZXN1bHQsDQoJCQlpOw0KDQoJCS8vIFRyeSB0byByZWNvbnN0cnVjdCB0aGUgZm9yIGxvb3ANCgkJdmFyIHN0YXJ0cGMgPSB0aGlzLnBjICsgdGhpcy5faW5zdHJ1Y3Rpb25zW3RoaXMucGMgKiA0ICsgNl0gKyAxLA0KCQkJY2FuTG9vcCA9IHRydWUsDQoJCQlsb29wVmFyLCBpOw0KDQoJCWZvciAoaSA9IHN0YXJ0cGMgKyAxOyBpIDwgdGhpcy5wYzsgaSsrKSB7DQoJCQlpZiAodGhpcy5qdW1wRGVzdGluYXRpb25zW2ldIHx8ICh0aGlzLmNvZGVbaV0gJiYgdGhpcy5jb2RlW2ldLmluZGV4T2YoJ3BjPScpID49IDApKSB7DQoJCQkJY2FuTG9vcCA9IGZhbHNlOw0KCQkJCWJyZWFrOw0KCQkJfQ0KCQl9DQoNCgkJaWYgKGNhbkxvb3ApIHsNCgkJCWRlbGV0ZSB0aGlzLmp1bXBEZXN0aW5hdGlvbnNbdGhpcy5wY107DQoJCQl0aGlzLmNvZGVbdGhpcy5wYyArIDFdID0gJy8qIG5vb3AgKi8nDQoNCgkJCXJlc3VsdCA9ICd3aGlsZSgxKXsnOw0KCQkJcmVzdWx0ICs9IGZ2YXIgKyAnPXRmb3Jsb29wX2ludGVybmFsKFJbJyArIGEgKyAnXSxSLnNsaWNlKCcgKyAoYSArIDEpICsgJywnICsgKGEgKyAzKSArICcpKTsnOw0KCQkJZm9yIChpID0gMDsgaSA8IGM7IGkrKykgcmVzdWx0ICs9ICdzZXRSKFIsJyArIChhICsgaSArIDMpICsgJywnICsgZnZhciArICdbJyArIGkgKyAnXSk7JzsNCgkJCXJlc3VsdCArPSAnaWYoJyArIGZ2YXIgKyAnWzBdIT09dm9pZCAwKXtzZXRSKFIsJyArIChhICsgMikgKyAnLCcgKyBmdmFyICsgJ1swXSl9ZWxzZXticmVha30nOw0KDQoJCQl0aGlzLmNvZGVbc3RhcnRwY10gPSByZXN1bHQ7DQoJCQlyZXR1cm4gJ30nOw0KCQl9DQoNCg0KCQkvLyBDYW4ndCByZWNvbnN0cnVjdCBkdWUgdG8gaW50ZXJuYWwganVtcHMsIGZhbGxiYWNrIHRvIGp1bXBzLi4uDQoJCXRoaXMuanVtcERlc3RpbmF0aW9uc1twY10gPSAxOw0KDQoJCXJlc3VsdCA9IGZ2YXIgKyAnPXRmb3Jsb29wX2ludGVybmFsKFJbJyArIGEgKyAnXSxSLnNsaWNlKCcgKyAoYSArIDEpICsgJywnICsgKGEgKyAzKSArICcpKTsnOw0KCQlmb3IgKGkgPSAwOyBpIDwgYzsgaSsrKSByZXN1bHQgKz0gJ3NldFIoUiwnICsgKGEgKyBpICsgMykgKyAnLCcgKyBmdmFyICsgJ1snICsgaSArICddKTsnOw0KCQlyZXN1bHQgKz0gJ2lmKCcgKyBmdmFyICsgJ1swXSE9PXZvaWQgMCl7c2V0UihSLCcgKyAoYSArIDIpICsgJywnICsgZnZhciArICdbMF0pfWVsc2V7cGM9JyArIHBjICsgJzticmVha30nOw0KDQoJCXJldHVybiByZXN1bHQ7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX3NldGxpc3QgKGEsIGIsIGMpIHsNCgkJcmV0dXJuICdzZXRsaXN0VChSLFJbJyArIGEgKyAnXSwnICsgKGEgKyAxKSArICcsJyArICg1MCAqIChjIC0gMSkgKyAxKSArICcsJyArIChiID09IDA/ICdSLmxlbmd0aC0xJyA6IGIpICsgJyk7JzsNCgl9DQoNCg0KDQoNCglmdW5jdGlvbiB0cmFuc2xhdGVfY2xvc2UgKGEsIGIsIGMpIHsNCgkJaWYgKHRoaXMudmFycy5pbmRleE9mKCdnZXR1cHZhbCcpIDwgMCkgdGhpcy52YXJzLnB1c2goJ2dldHVwdmFsJyk7DQoJCXJldHVybiAnY2xvc2VfaW50ZXJuYWwuY2FsbChjbCwnICsgYSArICcsZ2V0dXB2YWwpOyc7DQoJfQ0KDQoNCg0KDQoJZnVuY3Rpb24gdHJhbnNsYXRlX2Nsb3N1cmUgKGEsIGJ4KSB7DQoJCXZhciB1cHZhbHVlRGF0YSA9IGdjLmNyZWF0ZUFycmF5KCksDQoJCQlpbnN0cnVjdGlvbnMgPSB0aGlzLl9pbnN0cnVjdGlvbnMsDQoJCQlwcm9jZXNzID0gcHJvY2VzcywNCgkJCXNsaWNlID0gaW5zdHJ1Y3Rpb25zLnNsaWNlIHx8IGluc3RydWN0aW9ucy5zdWJhcnJheSwNCgkJCW9wY29kZSwgcmVzdWx0Ow0KDQoJCXRoaXMucGMrKzsNCgkJaWYgKHRoaXMudmFycy5pbmRleE9mKCdnZXR1cHZhbCcpIDwgMCkgdGhpcy52YXJzLnB1c2goJ2dldHVwdmFsJyk7DQoJCWlmICh0aGlzLnZhcnMuaW5kZXhPZignc2V0dXB2YWwnKSA8IDApIHRoaXMudmFycy5wdXNoKCdzZXR1cHZhbCcpOw0KDQoJCXdoaWxlICgob3Bjb2RlID0gaW5zdHJ1Y3Rpb25zW3RoaXMucGMgKiA0XSkgIT09IHVuZGVmaW5lZCAmJiAob3Bjb2RlID09PSAwIHx8IG9wY29kZSA9PT0gNCkgJiYgdGhpcy5faW5zdHJ1Y3Rpb25zW3RoaXMucGMgKiA0ICsgMV0gPT09IDApIHsgLy8gbW92ZSwgZ2V0dXB2YWwNCgkJCXVwdmFsdWVEYXRhLnB1c2guYXBwbHkodXB2YWx1ZURhdGEsIHNsaWNlLmNhbGwoaW5zdHJ1Y3Rpb25zLCB0aGlzLnBjICogNCwgdGhpcy5wYyAqIDQgKyA0KSk7DQoJCQl0aGlzLnBjKys7DQoJCX0NCg0KCQl0aGlzLnBjLS07DQoNCgkJaWYgKHVwdmFsdWVEYXRhLmxlbmd0aCB8fCB0eXBlb2YgcHJvY2VzcyA9PSAndW5kZWZpbmVkJykgew0KCQkJcmVzdWx0ID0gJ3NldFIoUiwnICsgYSArICcsY3JlYXRlX2Z1bmMoY2wuX2Z1bmN0aW9uc1snICsgYnggKyAnXSxjbG9zdXJlX3VwdmFsdWVzLmNhbGwoY2wsJyArIGJ4ICsgJywnICsgSlNPTi5zdHJpbmdpZnkodXB2YWx1ZURhdGEpICsgJyxnZXR1cHZhbCxzZXR1cHZhbCksY2wpKTsnOw0KCQl9IGVsc2Ugew0KCQkJcmVzdWx0ID0gJ3NldFIoUiwnICsgYSArICcsY2wuX2Z1bmN0aW9uc1snICsgYnggKyAnXSk7JzsNCgkJfQ0KDQoJCWdjLmNvbGxlY3QodXB2YWx1ZURhdGEpOw0KCQlyZXR1cm4gcmVzdWx0Ow0KCX0NCg0KDQoNCg0KCWZ1bmN0aW9uIHRyYW5zbGF0ZV92YXJhcmcgKGEsIGIpIHsNCgkJdmFyIHJlc3VsdCA9ICdSLmxlbmd0aD0nICsgYSArICc7JywNCgkJCWksIGw7DQoNCgkJaWYgKGIgPT09IDApIHsNCgkJCXJlc3VsdCA9ICdmb3IoXz0nICsgdGhpcy5wYXJhbUNvdW50ICsgJztfPGFyZ3VtZW50cy5sZW5ndGg7XysrKXNldFIoUixfKycgKyAoYSAtIHRoaXMucGFyYW1Db3VudCkgKyAnLGFyZ3VtZW50c1tfXSk7JzsNCg0KCQl9IGVsc2Ugew0KCQkJZm9yIChpID0gMCwgbCA9IGIgLSAxOyBpIDwgbDsgaSsrKSB7DQoJCQkJcmVzdWx0ICs9ICdzZXRSKFIsJyArIChhICsgaSkgKyAnLGFyZ3VtZW50c1snICsgKHRoaXMucGFyYW1Db3VudCArIGkpICsgJ10pOyc7DQoJCQl9DQoJCX0NCg0KCQlyZXR1cm4gcmVzdWx0Ow0KCX0NCg0KDQoNCg0KCXNoaW5lLmppdC5UUkFOU0xBVE9SUyA9IFt0cmFuc2xhdGVfbW92ZSwgdHJhbnNsYXRlX2xvYWRrLCB0cmFuc2xhdGVfbG9hZGJvb2wsIHRyYW5zbGF0ZV9sb2FkbmlsLCB0cmFuc2xhdGVfZ2V0dXB2YWwsIHRyYW5zbGF0ZV9nZXRnbG9iYWwsIHRyYW5zbGF0ZV9nZXR0YWJsZSwgdHJhbnNsYXRlX3NldGdsb2JhbCwgdHJhbnNsYXRlX3NldHVwdmFsLCB0cmFuc2xhdGVfc2V0dGFibGUsIHRyYW5zbGF0ZV9uZXd0YWJsZSwgdHJhbnNsYXRlX3NlbGYsIHRyYW5zbGF0ZV9hZGQsIHRyYW5zbGF0ZV9zdWIsIHRyYW5zbGF0ZV9tdWwsIHRyYW5zbGF0ZV9kaXYsIHRyYW5zbGF0ZV9tb2QsIHRyYW5zbGF0ZV9wb3csIHRyYW5zbGF0ZV91bm0sIHRyYW5zbGF0ZV9ub3QsIHRyYW5zbGF0ZV9sZW4sIHRyYW5zbGF0ZV9jb25jYXQsIHRyYW5zbGF0ZV9qbXAsIHRyYW5zbGF0ZV9lcSwgdHJhbnNsYXRlX2x0LCB0cmFuc2xhdGVfbGUsIHRyYW5zbGF0ZV90ZXN0LCB0cmFuc2xhdGVfdGVzdHNldCwgdHJhbnNsYXRlX2NhbGwsIHRyYW5zbGF0ZV90YWlsY2FsbCwgdHJhbnNsYXRlX3JldHVybiwgdHJhbnNsYXRlX2Zvcmxvb3AsIHRyYW5zbGF0ZV9mb3JwcmVwLCB0cmFuc2xhdGVfdGZvcmxvb3AsIHRyYW5zbGF0ZV9zZXRsaXN0LCB0cmFuc2xhdGVfY2xvc2UsIHRyYW5zbGF0ZV9jbG9zdXJlLCB0cmFuc2xhdGVfdmFyYXJnXTsNCg0KDQoNCg0KCS8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCgkqICBDb21waWxlcg0KCSoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KDQoJLyoqDQoJICogQ29tcGlsZXMgYSBNb29uc2hpbmUgZnVuY3Rpb24gZGVmaW5pdGlvbiB0byBhIEphdmFTY3JpcHQgZnVuY3Rpb24uDQoJICogQHBhcmFtIHtzaGluZS5GdW5jdGlvbn0gZnVuYyBUaGUgaW5wdXQgTW9vbnNoaW5lIGZ1bmN0aW9uIGRlZmluaXRpb24uDQoJICogQHJldHVybnMge2Z1bmN0aW9ufSBBIEphdmFTY3JpcHQgcmVwcmVzZW50YXRpb24gb2YgdGhlIGZ1bmN0aW9uLg0KCSAqLw0KCXNoaW5lLmppdC5jb21waWxlID0gZnVuY3Rpb24gKGZ1bmMsIGNhbGxiYWNrKSB7DQoJCWlmIChzaGluZS5qaXQuTUlOX0ZQU19UT19DT01QSUxFKSB7DQoJCQl2YXIgYXJncyA9IGdjLmNyZWF0ZUFycmF5KCk7DQoJCQlhcmdzLnB1c2goZnVuYywgY2FsbGJhY2spOw0KDQoJCQljb21waWxlUXVldWUucHVzaChhcmdzKTsNCgkJCWVuYWJsZUNvbXBpbGVUaW1lcigpOw0KDQoJCX0gZWxzZSB7DQoJCQljb21waWxlKGZ1bmMsIGNhbGxiYWNrKTsNCgkJfQ0KCX07DQoNCg0KCS8qKg0KCSAqIFRyYW5zbGF0ZXMgYSBNb29uc2hpbmUgZnVuY3Rpb24gZGVmaW5pdGlvbiB0byBhIEphdmFTY3JpcHQgZnVuY3Rpb24gZGVmaW5pdGlvbi4NCgkgKiBAcGFyYW0ge3NoaW5lLkZ1bmN0aW9ufSBmdW5jIFRoZSBpbnB1dCBNb29uc2hpbmUgZnVuY3Rpb24gZGVmaW5pdGlvbi4NCgkgKiBAcmV0dXJucyB7c3RyaW5nfSBKYXZhU2NyaXB0IHNvdXJjZSBvZiB0aGUgZnVuY3Rpb24uDQoJICovDQoJc2hpbmUuaml0LnRvSlMgPSBmdW5jdGlvbiAoZnVuYykgew0KDQoJCXZhciBpbnN0cnVjdGlvbnMgPSBmdW5jLl9kYXRhLmluc3RydWN0aW9ucywNCgkJCXBhcmFtQ291bnQgPSBmdW5jLl9kYXRhLnBhcmFtQ291bnQsDQoJCQlpc1ZhcmFyZyA9IGZ1bmMuX2RhdGEuaXNfdmFyYXJnID4gMCwNCg0KCQkJY29kZSA9IGdjLmNyZWF0ZUFycmF5KCksDQoJCQlwYyA9IDAsDQoNCgkJCXN0YXRlLA0KCQkJb3Bjb2RlLCBhLCBiLCBjLA0KCQkJb2Zmc2V0LA0KCQkJY29tcGF0aWJpbGl0eSwNCgkJCXVwdmFsQ29kZSA9ICcnLA0KCQkJcGFyYW1OYW1lcyA9IGdjLmNyZWF0ZUFycmF5KCksDQoJCQlmdW5jLA0KCQkJcmVzdWx0LA0KCQkJaSwgbCwgdjsNCg0KDQoJCS8vIFNldHVwIHN0YXRlDQoJCXN0YXRlID0gew0KCQkJcGFyYW1Db3VudDogcGFyYW1Db3VudCwNCgkJCWlzVmFyYXJnOiBpc1ZhcmFyZywNCgkJCXN0YWNrU2l6ZTogZnVuYy5fZGF0YS5tYXhTdGFja1NpemUsDQoNCgkJCXBjOiBwYywNCgkJCWNvZGU6IGdjLmNyZWF0ZUFycmF5KCksDQoJCQl2YXJzOiBnYy5jcmVhdGVBcnJheSgpLA0KCQkJanVtcERlc3RpbmF0aW9uczogZ2MuY3JlYXRlQXJyYXkoKSwNCg0KCQkJX2NvbnN0YW50czogZnVuYy5fZGF0YS5jb25zdGFudHMsDQoJCQlfaW5zdHJ1Y3Rpb25zOiBmdW5jLl9kYXRhLmluc3RydWN0aW9ucywNCg0KCQkJZ2V0Q29uc3RhbnQ6IGZ1bmN0aW9uIChpbmRleCkgew0KCQkJCXZhciB2YWwgPSB0aGlzLl9jb25zdGFudHNbaW5kZXhdOw0KCQkJCXJldHVybiB0aGlzLl9jb25zdGFudHNbaW5kZXhdID09PSBudWxsPyB2b2lkIDAgOiB2YWw7DQoJCQl9ICAgICAgICAgICANCgkJfTsNCg0KCQlzdGF0ZS5qdW1wRGVzdGluYXRpb25zLnB1c2goMSk7DQoNCgkJLy8gR2V0IGNvZGUgcmVwcmVzZW50YXRpb24gb2YgaW5zdHJ1Y3Rpb25zDQoJCWwgPSBpbnN0cnVjdGlvbnMubGVuZ3RoIC8gNDsNCg0KCQl3aGlsZSAocGMgPCBsKSB7DQoJCQlvZmZzZXQgPSBwYyAqIDQ7DQoJCQlvcGNvZGUgPSBpbnN0cnVjdGlvbnNbb2Zmc2V0XTsNCgkJCWEgPSBpbnN0cnVjdGlvbnNbb2Zmc2V0ICsgMV07DQoJCQliID0gaW5zdHJ1Y3Rpb25zW29mZnNldCArIDJdOw0KCQkJYyA9IGluc3RydWN0aW9uc1tvZmZzZXQgKyAzXTsNCg0KCQkJaWYgKCFzdGF0ZS5jb2RlW3BjXSkgc3RhdGUuY29kZVtwY10gPSBzaGluZS5qaXQuVFJBTlNMQVRPUlNbb3Bjb2RlXS5jYWxsKHN0YXRlLCBhLCBiLCBjKTsNCgkJCXBjID0gKytzdGF0ZS5wYzsNCgkJfQ0KDQoNCgkJLy8gSW5zZXJ0IGp1bXAgZW50cnkgcG9pbnRzDQoJCWZvciAocGMgaW4gc3RhdGUuanVtcERlc3RpbmF0aW9ucykgew0KCQkJaSA9IHBhcnNlSW50KHBjLCAxMCk7DQoJCQlzdGF0ZS5jb2RlW2ldID0gJ2Nhc2UgJyArIHBjICsgJzonICsgc3RhdGUuY29kZVtpXTsNCgkJfQ0KDQoNCgkJLy8gdjUuMCBjb21wYXRpYmlsaXR5IChMVUFfQ09NUEFUX1ZBUkFSRykNCgkJaWYgKGZ1bmMuX2RhdGEuaXNfdmFyYXJnID09IDcpIHsgICAgDQoJCQljb21wYXRpYmlsaXR5ID0gICdzZXRSKFIsJyArIHBhcmFtQ291bnQgKyAnLG5ldyBzaGluZS5UYWJsZShBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsJyArIHBhcmFtQ291bnQgKyAnKSkpO1JbJyArIHBhcmFtQ291bnQgKyAnXS5zZXRNZW1iZXIoIm4iLCBhcmd1bWVudHMubGVuZ3RoLScgKyBwYXJhbUNvdW50ICsgJyk7JzsNCgkJfQ0KDQoNCgkJLy8gVXB2YWx1ZSBvcHRpbWlzYXRpb24NCgkJaWYgKHN0YXRlLnZhcnMuaW5kZXhPZignZ2V0dXB2YWwnKSA+PSAwKSB1cHZhbENvZGUgKz0gJ2dldHVwdmFsPWdldF91cHYuYmluZChSKTsnOw0KCQlpZiAoc3RhdGUudmFycy5pbmRleE9mKCdzZXR1cHZhbCcpID49IDApIHVwdmFsQ29kZSArPSAnc2V0dXB2YWw9c2V0X3Vwdi5iaW5kKFIpOyc7DQoNCg0KCQkvLyBBZGQgYm9pbGVycGxhdGUNCgkJY29kZSA9IFsnLyogJyArIChmdW5jLl9maWxlICYmIGZ1bmMuX2ZpbGUudXJsKSArICI6IiArIGZ1bmMuX2RhdGEubGluZURlZmluZWQgKyAnICovJywgJ3ZhciBjbD10aGlzLFI9Y3JlYXRlQXJyYXkoKSxwYz0wLF8nICsgKHN0YXRlLnZhcnMubGVuZ3RoPyAnLCcgKyBzdGF0ZS52YXJzLmpvaW4oJywnKSA6ICcnKSArICc7J107DQoJCS8vIGZvciAoaSA9IDA7IGkgPCBwYXJhbUNvdW50OyBpKyspIGNvZGUucHVzaCgnc2V0UihSLCcgKyBpICsgJyxhcmd1bWVudHNbJyArIGkgKyAnXSk7Jyk7DQoJCWZvciAoaSA9IDA7IGkgPCBwYXJhbUNvdW50OyBpKyspIHsNCgkJCWNvZGUucHVzaCgnc2V0UihSLCcgKyBpICsgJyxBJyArIGkgKyAnKTsnKTsNCgkJCXBhcmFtTmFtZXMucHVzaCgnQScgKyBpKTsNCgkJfQ0KDQoJCWlmIChjb21wYXRpYmlsaXR5KSBjb2RlLnB1c2goY29tcGF0aWJpbGl0eSk7DQoJCWNvZGUucHVzaCh1cHZhbENvZGUpOw0KCQljb2RlLnB1c2goJ3NoaW5lLkNsb3N1cmUuX2N1cnJlbnQ9Y2w7d2hpbGUoMSl7c3dpdGNoKHBjKXsnKTsNCgkJY29kZSA9IGNvZGUuY29uY2F0KHN0YXRlLmNvZGUpOw0KCQljb2RlLnB1c2goJ319Jyk7DQoNCg0KDQoJCS8vIE91dHB1dCBKUyBmdW5jdGlvbg0KCQkvLyByZXR1cm4gJ2Z1bmN0aW9uKCl7JyArIGNvZGUuam9pbignXG4nKSArICd9JzsNCgkJcmVzdWx0ID0gJ2Z1bmN0aW9uKCcgKyBwYXJhbU5hbWVzLmpvaW4oKSArICcpeycgKyBjb2RlLmpvaW4oJ1xuJykgKyAnfSc7DQoNCgkJZ2MuY29sbGVjdChjb2RlKTsNCgkJZ2MuY29sbGVjdChwYXJhbU5hbWVzKTsNCg0KCQlnYy5jb2xsZWN0KHN0YXRlLmNvZGUpOw0KCQlnYy5jb2xsZWN0KHN0YXRlLnZhcnMpOw0KCQlnYy5jb2xsZWN0KHN0YXRlLmp1bXBEZXN0aW5hdGlvbnMpOw0KDQoJCWdjLmNvbGxlY3Qoc3RhdGUpOw0KDQoJCXJldHVybiByZXN1bHQ7DQoJfTsNCg0KLyoqDQogKiBAZmlsZU92ZXJ2aWV3IEdhcmJhZ2UgY29sbGVjdGlvbiBuYW1lc3BhY2UuDQogKiBDb2xsZWN0cyBhbmQgcmV1c2VzIHZhbmlsbGEgb2JqZWN0cyBhbmQgYXJyYXlzIHRvIGF2b2lkIHRoZSBvdmVyaGVhZCBvZiBvYmplY3QgY3JlYXRpb24uDQogKiBAYXV0aG9yIDxhIGhyZWY9Im1haWx0bzpwYXVsLmN1dGhiZXJ0c29uQGdhbWVzeXMuY28udWsiPlBhdWwgQ3V0aGJlcnRzb248L2E+DQogKi8NCg0KCS8qKg0KCSAqIENvbnN0YW50IGVtcHR5IG9iamVjdCBmb3IgdXNlIGluIGNvbXBhcmlzb25zLCBldGMgdG8gYXZvaWQgY3JlYXRpbmcgYW4gb2JqZWN0IG5lZWRsZXNzbHkNCgkgKiBAdHlwZSBPYmplY3QNCgkgKiBAY29uc3RhbnQNCgkgKi8NCglzaGluZS5FTVBUWV9PQkogPSB7fTsNCg0KDQoJLyoqDQoJICogQ29uc3RhbnQgZW1wdHkgYXJyYXkgZm9yIHVzZSBpbiBjb21wYXJpc29ucywgZXRjIHRvIGF2b2lkIGNyZWF0aW5nIGFuIG9iamVjdCBuZWVkbGVzc2x5DQoJICogQHR5cGUgT2JqZWN0DQoJICogQGNvbnN0YW50DQoJICovDQoJc2hpbmUuRU1QVFlfQVJSID0gW107DQoNCg0KDQoNCgkvKioNCgkgKiBNb29uc2hpbmUgR0MgZnVuY3Rpb25zLg0KCSAqIEBuYW1lc3BhY2UNCgkgKi8NCglzaGluZS5nYyA9IHsgDQoNCg0KCQkvKioNCgkJICogQ29sbGVjdGVkIG9iamVjdHMsIGVtcHR5IGFuZCByZWFkeSBmb3IgcmV1c2UuDQoJCSAqIEB0eXBlIEFycmF5DQoJCSAqIEBzdGF0aWMNCgkJICovDQoJCW9iamVjdHM6IFtdLA0KDQoNCgkJLyoqDQoJCSAqIENvbGxlY3RlZCBvYmplY3RzLCBlbXB0eSBhbmQgcmVhZHkgZm9yIHJldXNlLg0KCQkgKiBAdHlwZSBBcnJheQ0KCQkgKiBAc3RhdGljDQoJCSAqLw0KCQlhcnJheXM6IFtdLA0KDQoNCgkJLyoqDQoJCSAqIE51bWJlciBvZiBvYmplY3RzIGFuZCBhcnJheSB0aGF0IGhhdmUgYmVlbiBjb2xsZWN0ZWQuIFVzZSBmb3IgZGVidWdnaW5nLg0KCQkgKiBAdHlwZSBOdW1iZXINCgkJICogQHN0YXRpYw0KCQkgKi8NCgkJY29sbGVjdGVkOiAwLA0KDQoNCgkJLyoqDQoJCSAqIE51bWJlciBvZiBvYmplY3RzIGFuZCBhcnJheSB0aGF0IGhhdmUgYmVlbiByZXVzZWQuIFVzZSBmb3IgZGVidWdnaW5nLg0KCQkgKiBAdHlwZSBOdW1iZXINCgkJICogQHN0YXRpYw0KCQkgKi8NCgkJcmV1c2VkOiAwLA0KDQoNCg0KDQoJCS8qKg0KCQkgKiBQcmVwYXJlIGFuIGFycmF5IGZvciByZXVzZS4NCgkJICogQHBhcmFtIHtBcnJheX0gYXJyIEFycmF5IHRvIGJlIHVzZWQuDQoJCSAqLw0KCQljYWNoZUFycmF5OiBmdW5jdGlvbiAoYXJyKSB7DQoJCQlhcnIubGVuZ3RoID0gMDsNCgkJCXRoaXMuYXJyYXlzLnB1c2goYXJyKTsNCgkJCS8vIHRoaXMuY29sbGVjdGVkKys7DQoJCX0sDQoNCg0KDQoNCgkJLyoqDQoJCSAqIFByZXBhcmUgYW4gb2JqZWN0IGZvciByZXVzZS4NCgkJICogQHBhcmFtIHtPYmplY3R9IG9iaiBPYmplY3QgdG8gYmUgdXNlZC4NCgkJICovDQoJCWNhY2hlT2JqZWN0OiBmdW5jdGlvbiAob2JqKSB7DQoJCQlmb3IgKHZhciBpIGluIG9iaikgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShpKSkgZGVsZXRlIG9ialtpXTsNCgkJCXRoaXMub2JqZWN0cy5wdXNoKG9iaik7DQoJCQkvLyB0aGlzLmNvbGxlY3RlZCsrOw0KCQl9LA0KDQoNCg0KDQoJCS8qKg0KCQkgKiBSZXR1cm5zIGEgY2xlYW4gYXJyYXkgZnJvbSB0aGUgY2FjaGUgb3IgY3JlYXRlcyBhIG5ldyBvbmUgaWYgY2FjaGUgaXMgZW1wdHkuDQoJCSAqIEByZXR1cm5zIHtBcnJheX0gQW4gZW1wdHkgYXJyYXkuDQoJCSAqLw0KCQljcmVhdGVBcnJheTogZnVuY3Rpb24gKCkgew0KCQkJaWYgKHRoaXMuYXJyYXlzLmxlbmd0aCkgdGhpcy5yZXVzZWQrKzsNCgkJCXJldHVybiB0aGlzLmFycmF5cy5wb3AoKSB8fCBbXTsNCgkJfSwNCg0KDQoNCg0KCQkvKioNCgkJICogUmV0dXJucyBhIGNsZWFuIG9iamVjdCBmcm9tIHRoZSBjYWNoZSBvciBjcmVhdGVzIGEgbmV3IG9uZSBpZiBjYWNoZSBpcyBlbXB0eS4NCgkJICogQHJldHVybnMge09iamVjdH0gQW4gZW1wdHkgb2JqZWN0Lg0KCQkgKi8NCgkJY3JlYXRlT2JqZWN0OiBmdW5jdGlvbiAoKSB7IA0KCQkJaWYgKHRoaXMub2JqZWN0cy5sZW5ndGgpIHRoaXMucmV1c2VkKys7DQoJCQlyZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpIHx8IHt9Ow0KCQl9LA0KDQoNCg0KDQoJCS8qKg0KCQkgKiBSZWR1Y2VzIHRoZSBudW1iZXIgb2YgcmVmZXJlbmNlcyBhc3NvY2lhdGVkIHdpdGggYW4gb2JqZWN0IGJ5IG9uZSBhbmQgY29sbGVjdCBpdCBpZiBuZWNlc3NhcnkuDQoJCSAqIEBwYXJhbSB7T2JqZWN0fSBBbnkgb2JqZWN0Lg0KCQkgKi8NCgkJZGVjclJlZjogZnVuY3Rpb24gKHZhbCkgew0KCQkJaWYgKCF2YWwgfHwgISh2YWwgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkgfHwgdmFsLl9fc2hpbmUucmVmQ291bnQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KCQkJaWYgKC0tdmFsLl9fc2hpbmUucmVmQ291bnQgPT0gMCkgdGhpcy5jb2xsZWN0KHZhbCk7DQoJCX0sDQoNCg0KDQoNCgkJLyoqDQoJCSAqIEluY3JlYXNlcyB0aGUgbnVtYmVyIG9mIHJlZmVyZW5jZXMgYXNzb2NpYXRlZCB3aXRoIGFuIG9iamVjdCBieSBvbmUuDQoJCSAqIEBwYXJhbSB7T2JqZWN0fSBBbnkgb2JqZWN0Lg0KCQkgKi8NCgkJaW5jclJlZjogZnVuY3Rpb24gKHZhbCkgew0KCQkJaWYgKCF2YWwgfHwgISh2YWwgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkgfHwgdmFsLl9fc2hpbmUucmVmQ291bnQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KCQkJdmFsLl9fc2hpbmUucmVmQ291bnQrKzsNCgkJfSwNCg0KDQoNCg0KCQkvKioNCgkJICogQ29sbGVjdCBhbiBvYmplY3QuDQoJCSAqIEBwYXJhbSB7T2JqZWN0fSBBbnkgb2JqZWN0Lg0KCQkgKi8NCgkJY29sbGVjdDogZnVuY3Rpb24gKHZhbCkgew0KCQkJaWYgKHZhbCA9PT0gdW5kZWZpbmVkIHx8IHZhbCA9PT0gbnVsbCkgcmV0dXJuOw0KCQkJaWYgKHZhbCBpbnN0YW5jZW9mIEFycmF5KSByZXR1cm4gdGhpcy5jYWNoZUFycmF5KHZhbCk7DQoJCQlpZiAodHlwZW9mIHZhbCA9PSAnb2JqZWN0JyAmJiB2YWwuY29uc3RydWN0b3IgPT0gT2JqZWN0KSByZXR1cm4gdGhpcy5jYWNoZU9iamVjdCh2YWwpOw0KDQoJCQlpZiAoISh2YWwgaW5zdGFuY2VvZiBzaGluZS5UYWJsZSkgfHwgdmFsLl9fc2hpbmUucmVmQ291bnQgPT09IHVuZGVmaW5lZCkgcmV0dXJuOw0KDQoJCQl2YXIgaSwgbCwgDQoJCQkJbWV0YSA9IHZhbC5fX3NoaW5lOw0KDQoJCQlmb3IgKGkgPSAwLCBsID0gbWV0YS5rZXlzLmxlbmd0aDsgaSA8IGw7IGkrKykgdGhpcy5kZWNyUmVmKG1ldGEua2V5c1tpXSk7DQoJCQlmb3IgKGkgPSAwLCBsID0gbWV0YS52YWx1ZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB0aGlzLmRlY3JSZWYobWV0YS52YWx1ZXNbaV0pOw0KCQkJZm9yIChpID0gMCwgbCA9IG1ldGEubnVtVmFsdWVzLmxlbmd0aDsgaSA8IGw7IGkrKykgdGhpcy5kZWNyUmVmKG1ldGEubnVtVmFsdWVzW2ldKTsNCg0KCQkJdGhpcy5jYWNoZUFycmF5KG1ldGEua2V5cyk7DQoJCQl0aGlzLmNhY2hlQXJyYXkobWV0YS52YWx1ZXMpOw0KDQoJCQlkZWxldGUgbWV0YS5rZXlzOw0KCQkJZGVsZXRlIG1ldGEudmFsdWVzOw0KDQoJCQl0aGlzLmNhY2hlT2JqZWN0KG1ldGEpOw0KCQkJZGVsZXRlIHZhbC5fX3NoaW5lOw0KDQoJCQlmb3IgKGkgaW4gdmFsKSBpZiAodmFsLmhhc093blByb3BlcnR5KGkpKSB0aGlzLmRlY3JSZWYodmFsW2ldKTsNCgkJfQ0KDQoNCgl9Ow0KDQoNCg0KDQp9KShzaGluZSB8fCB7fSk7DQoNCi8qKg0KICogQGZpbGVPdmVydmlldyBGdW5jdGlvbiBkZWZpbml0aW9uIGNsYXNzLg0KICogQGF1dGhvciA8YSBocmVmPSJtYWlsdG86cGF1bC5jdXRoYmVydHNvbkBnYW1lc3lzLmNvLnVrIj5QYXVsIEN1dGhiZXJ0c29uPC9hPg0KICovDQoNCi8qKg0KICogUmVwcmVzZW50cyBhIGZ1bmN0aW9uIGRlZmluaXRpb24uDQogKiBAY29uc3RydWN0b3INCiAqIEBleHRlbmRzIHNoaW5lLkV2ZW50RW1pdHRlcg0KICogQHBhcmFtIHtzaGluZS5GaWxlfSBmaWxlIFRoZSBmaWxlIGluIHdoaWNoIHRoZSBmdW5jdGlvbiBpcyBkZWNsYXJlZC4NCiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhIE9iamVjdCBjb250YWluaW5nIHRoZSBMdWFjIGRhdGEgZm9yIHRoZSBmdW5jdGlvbi4NCiAqIEBwYXJhbSB7b2JqZWN0fSBnbG9iYWxzIFRoZSBnbG9iYWwgdmFyaWFibGVzIGZvciB0aGUgZW52aXJvbm1lbnQgaW4gd2hpY2ggdGhlIGZ1bmN0aW9uIGlzIGRlY2xhcmVkLg0KICogQHBhcmFtIHtvYmplY3R9IFt1cHZhbHVlc10gVGhlIHVwdmFsdWVzIHBhc3NlZCBmcm9tIHRoZSBwYXJlbnQgY2xvc3VyZS4NCiAqIEBzZWUgSG9va3MgaW50byB0aGlzIGZ1bmN0aW9uIGluIGppdC5qcy4NCiAqLw0Kc2hpbmUuRnVuY3Rpb24gPSBmdW5jdGlvbiAodm0sIGZpbGUsIGRhdGEsIGdsb2JhbHMsIHVwdmFsdWVzKSB7DQoJdmFyIG1lLCBjb21waWxlZCwgY2xvc3VyZSwgcnVubmVyOw0KDQoJdGhpcy5fdm0gPSB2bTsNCgl0aGlzLl9maWxlID0gZmlsZTsNCgl0aGlzLl9kYXRhID0gZGF0YSB8fCBzaGluZS5nYy5jcmVhdGVPYmplY3QoKTsNCgl0aGlzLl9nbG9iYWxzID0gZ2xvYmFsczsNCgl0aGlzLl91cHZhbHVlcyA9IHVwdmFsdWVzIHx8IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCk7DQoJdGhpcy5faW5kZXggPSBzaGluZS5GdW5jdGlvbi5faW5kZXgrKzsNCgl0aGlzLmluc3RhbmNlcyA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCk7DQoJdGhpcy5fcmV0YWluQ291bnQgPSAwOw0KDQogCXRoaXMuX2NvbnZlcnRJbnN0cnVjdGlvbnMoKTsNCn07DQoNCg0Kc2hpbmUuRnVuY3Rpb24ucHJvdG90eXBlID0ge307DQpzaGluZS5GdW5jdGlvbi5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBzaGluZS5GdW5jdGlvbjsNCg0KDQovKioNCiAqIEtlZXBzIGEgY291bnQgb2YgdGhlIG51bWJlciBvZiBmdW5jdGlvbnMgY3JlYXRlZCwgaW4gb3JkZXIgdG8gaW5kZXggdGhlbSB1bmlxdWVseS4NCiAqIEB0eXBlIE51bWJlcg0KICogQHN0YXRpYw0KICovDQpzaGluZS5GdW5jdGlvbi5faW5kZXggPSAwOw0KDQoNCg0KDQovKioNCiAqIENyZWF0ZXMgYSBuZXcgZnVuY3Rpb24gaW5zdGFuY2UgZnJvbSB0aGUgZGVmaW5pdGlvbi4NCiAqIEByZXR1cm5zIHtzaGluZS5DbG9zdXJlfSBBbiBpbnN0YW5jZSBvZiB0aGUgZnVuY3Rpb24gZGVmaW5pdGlvbi4NCiAqLw0Kc2hpbmUuRnVuY3Rpb24ucHJvdG90eXBlLmdldEluc3RhbmNlID0gZnVuY3Rpb24gKCkgew0KCXJldHVybiBzaGluZS5DbG9zdXJlLmNyZWF0ZSh0aGlzLl92bSwgdGhpcy5fZmlsZSwgdGhpcy5fZGF0YSwgdGhpcy5fZ2xvYmFscywgdGhpcy5fdXB2YWx1ZXMpOw0KfTsNCg0KDQoNCg0KDQovKioNCiAqIENvbXBpbGVzIHRoZSBmdW5jdGlvbiB0byBKYXZhU2NyaXB0Lg0KICogQHNlZSBJbXBsZW1lbnRlZCBpbiBqaXQuanMuDQogKi8NCnNoaW5lLkZ1bmN0aW9uLnByb3RvdHlwZS5fY29tcGlsZSA9IGZ1bmN0aW9uICgpIHt9Ow0KDQoNCg0KDQovKioNCiAqIENvbnZlcnRzIHRoZSBmdW5jdGlvbidzIGluc3RydWN0aW9ucyBmcm9tIHRoZSBmb3JtYXQgaW4gZmlsZSBpbnRvIEFycmF5QnVmZmVyIG9yIEFycmF5IGluIHBsYWNlLg0KICovDQpzaGluZS5GdW5jdGlvbi5wcm90b3R5cGUuX2NvbnZlcnRJbnN0cnVjdGlvbnMgPSBmdW5jdGlvbiAoKSB7DQoJdmFyIGluc3RydWN0aW9ucyA9IHRoaXMuX2RhdGEuaW5zdHJ1Y3Rpb25zIHx8IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCksDQoJCWJ1ZmZlciwNCgkJcmVzdWx0LA0KCQlpLCBsLA0KCQlpbnN0cnVjdGlvbiwNCgkJb2Zmc2V0Ow0KCQ0KCWlmICgnQXJyYXlCdWZmZXInIGluIHdpbmRvdykgew0KCQlpZiAoaW5zdHJ1Y3Rpb25zIGluc3RhbmNlb2YgSW50MzJBcnJheSkgcmV0dXJuOw0KDQoJCWlmIChpbnN0cnVjdGlvbnMubGVuZ3RoID09IDAgfHwgaW5zdHJ1Y3Rpb25zWzBdLm9wID09PSB1bmRlZmluZWQpIHsNCgkJCWJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihpbnN0cnVjdGlvbnMubGVuZ3RoICogNCk7DQoJCQlyZXN1bHQgPSBuZXcgSW50MzJBcnJheShidWZmZXIpOw0KDQoJCQlyZXN1bHQuc2V0KGluc3RydWN0aW9ucyk7DQoJCQl0aGlzLl9kYXRhLmluc3RydWN0aW9ucyA9IHJlc3VsdDsNCgkJCXJldHVybjsNCgkJfQ0KDQoJCWJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihpbnN0cnVjdGlvbnMubGVuZ3RoICogNCAqIDQpOw0KCQlyZXN1bHQgPSBuZXcgSW50MzJBcnJheShidWZmZXIpOw0KCQkNCgl9IGVsc2Ugew0KCQlpZiAoaW5zdHJ1Y3Rpb25zLmxlbmd0aCA9PSAwIHx8IHR5cGVvZiBpbnN0cnVjdGlvbnNbMF0gPT0gJ251bWJlcicpIHJldHVybjsNCgkJcmVzdWx0ID0gW107DQoJfQ0KDQoJZm9yIChpID0gMCwgbCA9IGluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBsOyBpKyspIHsNCgkJaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbnNbaV07DQoJCW9mZnNldCA9IGkgKiA0Ow0KDQoJCXJlc3VsdFtvZmZzZXRdID0gaW5zdHJ1Y3Rpb24ub3A7DQoJCXJlc3VsdFtvZmZzZXQgKyAxXSA9IGluc3RydWN0aW9uLkE7DQoJCXJlc3VsdFtvZmZzZXQgKyAyXSA9IGluc3RydWN0aW9uLkI7DQoJCXJlc3VsdFtvZmZzZXQgKyAzXSA9IGluc3RydWN0aW9uLkM7DQoJfQ0KDQoJdGhpcy5fZGF0YS5pbnN0cnVjdGlvbnMgPSByZXN1bHQ7DQp9Ow0KDQoNCg0KDQovKioNCiAqIENhbGxzIHRoZSBmdW5jdGlvbiwgaW1wbGljaXRseSBjcmVhdGluZyBhIG5ldyBpbnN0YW5jZSBhbmQgcGFzc2luZyBvbiB0aGUgYXJndW1lbnRzIHByb3ZpZGVkLg0KICogQHJldHVybnMge0FycmF5fSBBcnJheSBvZiB0aGUgcmV0dXJuIHZhbHVlcyBmcm9tIHRoZSBjYWxsLg0KICovDQpzaGluZS5GdW5jdGlvbi5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIChjb250ZXh0KSB7DQoJdmFyIGFyZ3MgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpLA0KCQlsID0gYXJndW1lbnRzLmxlbmd0aCwNCgkJaTsNCgkJDQoJZm9yIChpID0gMTsgaSA8IGw7IGkrKykgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7DQoJcmV0dXJuIHRoaXMuYXBwbHkoY29udGV4dCwgYXJncyk7DQp9Ow0KDQoNCg0KDQovKioNCiAqIENhbGxzIHRoZSBmdW5jdGlvbiwgaW1wbGljaXRseSBjcmVhdGluZyBhIG5ldyBpbnN0YW5jZSBhbmQgdXNpbmcgaXRlbXMgb2YgYW4gYXJyYXkgYXMgYXJndW1lbnRzLg0KICogQHBhcmFtIHtvYmplY3R9IFtvYmogPSB7fV0gVGhlIG9iamVjdCBvbiB3aGljaCB0byBhcHBseSB0aGUgZnVuY3Rpb24uIEluY2x1ZGVkIGZvciBjb21wYXRpYmlsaXR5IHdpdGggSmF2YVNjcmlwdCdzIEZ1bmN0aW9uLmFwcGx5KCkuDQogKiBAcGFyYW0ge0FycmF5fSBhcmdzIEFycmF5IGNvbnRhaW5pbmcgYXJndW1lbnRzIHRvIHVzZS4NCiAqIEBzZWUgSG9va3MgaW50byB0aGlzIGZ1bmN0aW9uIGluIGppdC5qcy4NCiAqIEByZXR1cm5zIHtBcnJheX0gQXJyYXkgb2YgdGhlIHJldHVybiB2YWx1ZXMgZnJvbSB0aGUgY2FsbC4NCiAqLw0Kc2hpbmUuRnVuY3Rpb24ucHJvdG90eXBlLmFwcGx5ID0gZnVuY3Rpb24gKG9iaiwgYXJncywgaW50ZXJuYWwpIHsNCglpZiAob2JqICYmIG9iaiBpbnN0YW5jZW9mIEFycmF5ICYmICFhcmdzKSB7DQoJCWFyZ3MgPSBvYmo7DQoJCW9iaiA9IHVuZGVmaW5lZDsNCgl9DQoNCgl0cnkgew0KCQlyZXR1cm4gdGhpcy5nZXRJbnN0YW5jZSgpLmFwcGx5KG9iaiwgYXJncyk7DQoJfSBjYXRjaCAoZSkgew0KCQlzaGluZS5FcnJvci5jYXRjaEV4ZWN1dGlvbkVycm9yKGUpOw0KCX0NCn07DQoNCg0KDQovKioNCiAqIENyZWF0ZXMgYSB1bmlxdWUgZGVzY3JpcHRpb24gb2YgdGhlIGZ1bmN0aW9uLg0KICogQHJldHVybnMge3N0cmluZ30gRGVzY3JpcHRpb24uDQogKi8NCnNoaW5lLkZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uICgpIHsNCglyZXR1cm4gJ2Z1bmN0aW9uOiAweCcgKyB0aGlzLl9pbmRleC50b1N0cmluZygxNik7DQp9Ow0KDQoNCg0KDQovKioNCiAqIFNhdmVzIHRoaXMgZnVuY3Rpb24gZnJvbSBkaXNwb3NhbC4NCiAqLw0Kc2hpbmUuRnVuY3Rpb24ucHJvdG90eXBlLnJldGFpbiA9IGZ1bmN0aW9uICgpIHsNCgl0aGlzLl9yZXRhaW5Db3VudCsrOw0KfTsNCg0KDQoNCg0KLyoqDQogKiBSZWxlYXNlcyB0aGlzIGZ1bmN0aW9uIHRvIGJlIGRpc3Bvc2VkLg0KICovDQpzaGluZS5GdW5jdGlvbi5wcm90b3R5cGUucmVsZWFzZSA9IGZ1bmN0aW9uICgpIHsNCglpZiAoIS0tdGhpcy5fcmV0YWluQ291bnQgJiYgdGhpcy5fcmVhZHlUb0Rpc3Bvc2UpIHRoaXMuZGlzcG9zZSgpOw0KfTsNCg0KDQoNCg0KLyoqDQogKiBUZXN0IGlmIHRoZSBmdW5jdGlvbiBoYXMgYmVlbiBtYXJrZWQgYXMgcmV0YWluZWQuDQogKiBAcmV0dXJucyB7Ym9vbGVhbn0gV2hldGhlciBvciBub3QgdGhlIGZ1bmN0aW9uIGlzIG1hcmtlZCBhcyByZXRhaW5lZC4NCiAqLw0Kc2hpbmUuRnVuY3Rpb24ucHJvdG90eXBlLmlzUmV0YWluZWQgPSBmdW5jdGlvbiAoKSB7DQoJaWYgKHRoaXMuX3JldGFpbkNvdW50KSByZXR1cm4gdHJ1ZTsNCgkNCglmb3IgKHZhciBpIGluIHRoaXMuaW5zdGFuY2VzKSB7DQoJCWlmICh0aGlzLmluc3RhbmNlcy5oYXNPd25Qcm9wZXJ0eShpKSAmJiB0aGlzLmluc3RhbmNlc1tpXS5oYXNSZXRhaW5lZFNjb3BlKCkpIHJldHVybiB0cnVlOw0KCX0NCgkNCglyZXR1cm4gZmFsc2U7DQp9Ow0KDQoNCg0KDQovKioNCiAqIER1bXAgbWVtb3J5IGFzc29jaWF0ZWQgd2l0aCBmdW5jdGlvbi4NCiAqIHJldHVybnMge0Jvb2xlYW59IFdoZXRoZXIgb3Igbm90IHRoZSBmdW5jdGlvbiB3YXMgZHVtcGVkIHN1Y2Nlc3NmdWxseS4NCiAqLw0Kc2hpbmUuRnVuY3Rpb24ucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoZm9yY2UpIHsNCgl0aGlzLl9yZWFkeVRvRGlzcG9zZSA9IHRydWU7DQoJDQoJaWYgKGZvcmNlKSB7DQoJCWZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5pbnN0YW5jZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7DQoJCQl0aGlzLmluc3RhbmNlc1tpXS5kaXNwb3NlKHRydWUpOw0KCQl9DQoJCQ0KCX0gZWxzZSBpZiAodGhpcy5pc1JldGFpbmVkKCkpIHsNCgkJcmV0dXJuIGZhbHNlOw0KCX0NCg0KCWRlbGV0ZSB0aGlzLl92bTsNCglkZWxldGUgdGhpcy5fZmlsZTsNCglkZWxldGUgdGhpcy5fZGF0YTsNCglkZWxldGUgdGhpcy5fZ2xvYmFsczsNCglkZWxldGUgdGhpcy5fdXB2YWx1ZXM7DQoNCglkZWxldGUgdGhpcy5pbnN0YW5jZXM7CQ0KCWRlbGV0ZSB0aGlzLl9yZWFkeVRvRGlzcG9zZTsNCg0KCXJldHVybiB0cnVlOw0KfTsNCg0KLyoqDQogKiBAZmlsZU92ZXJ2aWV3IEZpbGVNYW5hZ2VyIGNsYXNzLg0KICogQGF1dGhvciA8YSBocmVmPSJtYWlsdG86cGF1bC5jdXRoYmVydHNvbkBnYW1lc3lzLmNvLnVrIj5QYXVsIEN1dGhiZXJ0c29uPC9hPg0KICovDQoNCi8qKg0KICogSGFuZGxlcyBsb2FkaW5nIHBhY2thZ2VzIGFuZCBkaXN0aWxsZWQgc2NyaXB0cy4NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgc2hpbmUuRXZlbnRFbWl0dGVyDQogKi8NCnNoaW5lLkZpbGVNYW5hZ2VyID0gZnVuY3Rpb24gKCkgew0KCXNoaW5lLkV2ZW50RW1pdHRlci5jYWxsKHRoaXMpOw0KCXRoaXMuX2NhY2hlID0ge307DQp9Ow0KDQoNCnNoaW5lLkZpbGVNYW5hZ2VyLnByb3RvdHlwZSA9IG5ldyBzaGluZS5FdmVudEVtaXR0ZXIoKTsNCnNoaW5lLkZpbGVNYW5hZ2VyLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IHNoaW5lLkZpbGVNYW5hZ2VyOw0KDQoNCg0KDQovKioNCiAqIExvYWRzIGEgZmlsZSBvciBwYWNrYWdlLg0KICogQHBhcmFtIHtTdHJpbmd8T2JqZWN0fSB1cmwgVXJsIG9mIGRpc3RpbGxlZCBqc29uIGZpbGUgb3IgbHVhYyBieXRlIGNvZGUgZmlsZSwgb3IgdGhlIGpzb24gb3IgYnl0ZSBjb2RlIGl0c2VsZiwgb3IgYW4gb2JqZWN0IHRyZWUuDQogKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBMb2FkIHN1Y2Nlc3NmdWwgY2FsbGJhY2suDQogKi8NCnNoaW5lLkZpbGVNYW5hZ2VyLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2spIHsNCgl2YXIgbWUgPSB0aGlzLA0KCQlkYXRhOw0KDQoNCglmdW5jdGlvbiBwYXJzZSAoZGF0YSwgdXJsKSB7DQoJCXZhciB0cmVlOw0KDQoJCWlmIChtZS5jb25zdHJ1Y3Rvci5faXNKc29uKGRhdGEpKSB7DQoJCQkvLyBKU09ODQoJCQl0cmVlID0gSlNPTi5wYXJzZShkYXRhKTsNCg0KCQl9IGVsc2UgaWYgKG1lLmNvbnN0cnVjdG9yLl9pc0x1YWMoZGF0YSkpIHsNCgkJCS8vIFJhdyBMdWEgNS4xIGJ5dGUgY29kZQ0KCQkJdHJlZSA9IG1lLmNvbnN0cnVjdG9yLl9wYXJzZUx1YWMoZGF0YSk7DQoJCX0NCg0KCQlpZiAodHJlZSkgew0KCQkJd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewkJLy8gTWFrZSBzdXJlIGFsbCBjYWxscyBhcmUgYXN5bmMuDQoJCQkJaWYgKHVybCkgbWUuX2NhY2hlW3VybF0gPSB0cmVlOw0KCQkJCW1lLl9vblN1Y2Nlc3ModXJsIHx8ICcnLCB0cmVlLCBjYWxsYmFjayk7DQoJCQl9LCAxKTsNCgkJfQ0KDQoJCXJldHVybiAhIXRyZWU7DQoJfQ0KDQoNCglmdW5jdGlvbiBzdWNjZXNzIChkYXRhKSB7DQoJCWlmICghcGFyc2UoZGF0YSwgdXJsKSkgdGhyb3cgbmV3IEVycm9yKCdGaWxlIGNvbnRhaW5zIG5vbi1wYXJzYWJsZSBjb250ZW50OiAnICsgdXJsKTsNCgl9DQoNCg0KCWZ1bmN0aW9uIGVycm9yIChjb2RlKSB7DQoJCW1lLl9vbkVycm9yKGNvZGUsIGNhbGxiYWNrKTsNCgl9DQoNCg0KCXN3aXRjaCAodHlwZW9mIHVybCkgew0KCQljYXNlICdzdHJpbmcnOg0KDQoJCQlpZiAoIXBhcnNlKHVybCkpIHsNCgkJCQkvLyBJZiBub3QgcGFyc2VhYmxlLCB0cmVhdCBhcyBmaWxlbmFtZQ0KCQkJCWlmIChkYXRhID0gdGhpcy5fY2FjaGVbdXJsXSkgew0KCQkJCQl3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IG1lLl9vblN1Y2Nlc3ModXJsLCBkYXRhLCBjYWxsYmFjayk7IH0sIDEpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCXNoaW5lLnV0aWxzLmdldCh1cmwsIHN1Y2Nlc3MsIGVycm9yKTsNCgkJCQl9DQoJCQl9DQoNCgkJCWJyZWFrOw0KDQoJDQoJCWNhc2UgJ29iamVjdCc6DQoJCQl0aGlzLl9vblN1Y2Nlc3MoJycsIHVybCwgY2FsbGJhY2spOw0KCQkJYnJlYWs7DQoNCg0KCQlkZWZhdWx0OiANCgkJCXRocm93IG5ldyBUeXBlRXJyb3IoJ0NhblwndCBsb2FkIG9iamVjdCBvZiB1bmtub3duIHR5cGUnKTsNCgl9DQp9Ow0KDQoNCg0KDQovKioNCiAqIEhhbmRsZXMgYSBzdWNjZXNzZnVsIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlci4NCiAqIEBwYXJhbSB7U3RyaW5nfSBkYXRhIFJlc3BvbnNlLg0KICovDQpzaGluZS5GaWxlTWFuYWdlci5wcm90b3R5cGUuX29uU3VjY2VzcyA9IGZ1bmN0aW9uICh1cmwsIGRhdGEsIGNhbGxiYWNrKSB7DQoJdmFyIGZpbGUsIGk7DQoNCglpZiAoZGF0YS5mb3JtYXQgPT0gJ21vb25zaGluZS5wYWNrYWdlJykgew0KCQlmb3IgKGkgaW4gZGF0YS5maWxlcykgdGhpcy5fY2FjaGVbaV0gPSBkYXRhLmZpbGVzW2ldOw0KCQl0aGlzLl90cmlnZ2VyKCdsb2FkZWQtcGFja2FnZScsIGRhdGEpOw0KDQoJCWlmICghKHVybCA9IGRhdGEubWFpbikpIHJldHVybjsNCgkJaWYgKCEoZGF0YSA9IGRhdGEuZmlsZXNbdXJsXSkpIHRocm93IG5ldyBSZWZlcmVuY2VFcnJvcigiVGhlIHBhY2thZ2UncyBtYWluIHJlZmVyZW5jZSBkb2VzIG5vdCBwb2ludCB0byBhIGZpbGVuYW1lIHdpdGhpbiB0aGUgcGFja2FnZSIpOw0KCX0NCg0KCWZpbGUgPSBuZXcgc2hpbmUuRmlsZSh1cmwsIGRhdGEpOw0KCQ0KCXRoaXMuX29uRmlsZUxvYWRlZChmaWxlLCBmdW5jdGlvbiAoKSB7DQoJCWNhbGxiYWNrKG51bGwsIGZpbGUpOw0KCX0pOw0KfTsNCg0KDQoNCg0KLyoqDQogKiBIb29rIGNhbGxlZCB3aGVuIGEgZGlzdGlsbGVkIGZpbGUgaXMgbG9hZGVkIHN1Y2Nlc3NmdWxseS4gT3ZlcnJpZGRlbiBieSBkZWJ1ZyBlbmdpbmUuDQogKiBAcGFyYW0ge1N0cmluZ30gZGF0YSBSZXNwb25zZS4NCiAqLw0Kc2hpbmUuRmlsZU1hbmFnZXIucHJvdG90eXBlLl9vbkZpbGVMb2FkZWQgPSBmdW5jdGlvbiAoZmlsZSwgY2FsbGJhY2spIHsNCgljYWxsYmFjaygpOw0KfTsNCg0KDQoNCg0KLyoqDQogKiBIYW5kbGVzIGFuIHVuc3VjY2Vzc2Z1bCByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIuIE92ZXJyaWRkZW4gYnkgZGVidWcgZW5naW5lLg0KICogQHBhcmFtIHtOdW1iZXJ9IGNvZGUgSFRUUCByZXNvbnNlIGNvZGUuDQogKi8NCnNoaW5lLkZpbGVNYW5hZ2VyLnByb3RvdHlwZS5fb25FcnJvciA9IGZ1bmN0aW9uIChjb2RlLCBjYWxsYmFjaykgew0KCWNhbGxiYWNrKGNvZGUpOw0KfTsNCg0KDQoNCg0KLyoqDQogKiBDaGVja3MgaWYgYSB2YWx1ZSByZXByZXNlbnRzIGEgSlNPTiBzdHJpbmcuDQogKiBAcGFyYW0ge1N0cmluZ30gdmFsIFN0cmluZyB0byBiZSBjaGVja2VkLg0KICogQHJldHVybnMge0Jvb2xlYW59IElzIGEgSlNPTiBzdHJpbmc/DQogKi8NCnNoaW5lLkZpbGVNYW5hZ2VyLl9pc0pzb24gPSBmdW5jdGlvbiAodmFsKSB7DQoJcmV0dXJuIC9eKHsuKn18XFsuKlxdKSQvLnRlc3QodmFsKTsNCn07DQoNCg0KDQoNCi8qKg0KICogQ2hlY2tzIGlmIGEgdmFsdWUgcmVwcmVzZW50cyBhIEx1YSA1LjEgYnl0ZSBjb2RlLg0KICogQHBhcmFtIHtTdHJpbmd9IHZhbCBTdHJpbmcgdG8gYmUgY2hlY2tlZC4NCiAqIEByZXR1cm5zIHtCb29sZWFufSBJcyBieXRlIGNvZGU/DQogKi8NCnNoaW5lLkZpbGVNYW5hZ2VyLl9pc0x1YWMgPSBmdW5jdGlvbiAodmFsKSB7DQoJcmV0dXJuIHZhbC5zdWJzdHIoMCwgNSkgPT0gU3RyaW5nLmZyb21DaGFyQ29kZSgyNywgNzYsIDExNywgOTcsIDgxKTsNCn07DQoNCg0KDQoNCi8qKg0KICogUGFyc2VzIGEgc3RyaW5nIGNvbnRhaW5pbmcgdmFsaWQgTHVhIDUuMSBieXRlIGNvZGUgaW50byBhIHRyZWUuDQogKiBOb3RlOiBSZXF1aXJlcyBNb29uc2hpbmUgRGlzdGlsbGVyeSBhbmQgY291bGQgcmV0dXJuIHVuZXhwZWN0ZWQgcmVzdWx0cyBpZiBBcnJheUJ1ZmZlciBpcyBub3Qgc3VwcG9ydGVkLg0KICogQHBhcmFtIHtTdHJpbmd9IGRhdGEgQnl0ZSBjb2RlIHN0cmluZy4NCiAqIEByZXR1cm5zIHtPYmplY3R9IFRyZWUgcmVwZXNlbnRpbmcgdGhlIEx1YSBzY3JpcHQuDQogKiBAdGhyb3dzIHtFcnJvcn0gSWYgTW9vbnNoaW5lJ3MgZGlzdGlsbGVyeSBpcyBub3QgYXZhaWxhYmxlLg0KICovDQpzaGluZS5GaWxlTWFuYWdlci5fcGFyc2VMdWFjID0gZnVuY3Rpb24gKGRhdGEpIHsNCglpZiAoIXNoaW5lLmRpc3RpbGxlcnkpIHRocm93IG5ldyBFcnJvcignTW9vbnNoaW5lIG5lZWRzIHRoZSBkaXN0aWxsZXJ5IHRvIHBhcnNlIEx1YSBieXRlIGNvZGUuIFBsZWFzZSBpbmNsdWRlICJkaXN0aWxsZXJ5Lm1vb25zaGluZS5qcyIgaW4gdGhlIHBhZ2UuJyk7DQoJaWYgKCEoJ0FycmF5QnVmZmVyJyBpbiB3aW5kb3cpKSBjb25zb2xlLndhcm4oJ0Jyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBBcnJheUJ1ZmZlcnMsIHRoaXMgY291bGQgY2F1c2UgdW5leHBlY3RlZCByZXN1bHRzIHdoZW4gbG9hZGluZyBiaW5hcnkgZmlsZXMuJyk7DQoJcmV0dXJuIG5ldyBzaGluZS5kaXN0aWxsZXJ5LlBhcnNlcigpLnBhcnNlKGRhdGEpOw0KfTsNCg0KDQoNCg0KLyoqDQogKiBEdW1wIG1lbW9yeSBhc3NvY2lhdGVkIHdpdGggRmlsZU1hbmFnZXIuDQogKi8NCnNoaW5lLkZpbGVNYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkgew0KCWRlbGV0ZSB0aGlzLl9jYWNoZTsNCn07DQoNCi8qKg0KICogQGZpbGVPdmVydmlldyBGaWxlIGNsYXNzLg0KICogQGF1dGhvciA8YSBocmVmPSJtYWlsdG86cGF1bC5jdXRoYmVydHNvbkBnYW1lc3lzLmNvLnVrIj5QYXVsIEN1dGhiZXJ0c29uPC9hPg0KICovDQoNCg0KLyoqDQogKiBSZXByZXNlbnRzIGEgTHVhYyBkYXRhIGZpbGUuDQogKiBAY29uc3RydWN0b3INCiAqIEBleHRlbmRzIHNoaW5lLkV2ZW50RW1pdHRlcg0KICogQHBhcmFtIHtTdHJpbmd9IHVybCBVcmwgb2YgdGhlIGRpc3RpbGxlZCBKU09OIGZpbGUuDQogKi8NCnNoaW5lLkZpbGUgPSBmdW5jdGlvbiAodXJsLCBkYXRhKSB7DQoJdGhpcy51cmwgPSB1cmw7DQoJdGhpcy5kYXRhID0gZGF0YTsNCn07DQoNCg0KDQoNCi8qKg0KICogRHVtcCBtZW1vcnkgYXNzb2NpYXRlZCB3aXRoIGZpbGUuDQogKi8NCnNoaW5lLkZpbGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7DQoJZGVsZXRlIHRoaXMudXJsOw0KCWRlbGV0ZSB0aGlzLmRhdGE7DQp9Ow0KDQovKioNCiAqIEBmaWxlT3ZlcnZpZXcgRXZlbnRFbWl0dGVyIGNsYXNzLg0KICogQGF1dGhvciA8YSBocmVmPSJtYWlsdG86cGF1bC5jdXRoYmVydHNvbkBnYW1lc3lzLmNvLnVrIj5QYXVsIEN1dGhiZXJ0c29uPC9hPg0KICovDQoNCg0KLyoqDQogKiBBYnN0cmFjdCBvYmplY3QgdGhhdCBmaXJlcyBldmVudHMuDQogKiBAY29uc3RydWN0b3INCiAqLw0Kc2hpbmUuRXZlbnRFbWl0dGVyID0gZnVuY3Rpb24gKCkgew0KCXRoaXMuX2xpc3RlbmVycyA9IHt9Ow0KfTsNCg0KDQoNCg0KLyoqDQogKiBUcmlnZ2VycyBhbiBldmVudC4NCiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIGV2ZW50Lg0KICogQHBhcmFtIHtBcnJheX0gW2RhdGEgPSBbXV0gQXJyYXkgY29udGFpbmluZyBhbnkgYXNzb2NpYXRlZCBkYXRhLg0KICovDQpzaGluZS5FdmVudEVtaXR0ZXIucHJvdG90eXBlLl90cmlnZ2VyID0gZnVuY3Rpb24gKG5hbWUsIGRhdGEpIHsNCgl2YXIgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzW25hbWVdLA0KCQlyZXN1bHQsDQoJCWk7DQoJCQ0KCWlmICghbGlzdGVuZXJzKSByZXR1cm47DQoJaWYgKCEoKGRhdGEgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YSA9IFtkYXRhXTsNCgkNCglmb3IgKGkgaW4gbGlzdGVuZXJzKSB7DQoJCWlmIChsaXN0ZW5lcnMuaGFzT3duUHJvcGVydHkoaSkpIHsNCgkJCXJlc3VsdCA9IGxpc3RlbmVyc1tpXS5hcHBseSh0aGlzLCBkYXRhKTsNCgkJCWlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCAmJiAhcmVzdWx0KSBicmVhazsNCgkJfQ0KCX0NCn07DQoNCg0KDQoNCi8qKg0KICogQWRkcyBhbiBldmVudCBsaXN0ZW5lci4NCiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIE5hbWUgb2YgdGhlIGV2ZW50Lg0KICogQHBhcmFtIHtGdW5jdGlvbn0gQ2FsbGJhY2sgTGlzdGVuZXIgZnVuY3Rpb24uDQogKi8NCnNoaW5lLkV2ZW50RW1pdHRlci5wcm90b3R5cGUub24gPSBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHsNCglpZiAoIXRoaXMuX2xpc3RlbmVyc1tuYW1lXSkgdGhpcy5fbGlzdGVuZXJzW25hbWVdID0gW107DQoJdGhpcy5fbGlzdGVuZXJzW25hbWVdLnB1c2goY2FsbGJhY2spOw0KfQ0KDQoNCg0KDQovKioNCiAqIFJlbW92ZXMgYW4gZXZlbnQgbGlzdGVuZXIuDQogKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBOYW1lIG9mIHRoZSBldmVudC4NCiAqIEBwYXJhbSB7RnVuY3Rpb259IENhbGxiYWNrIExpc3RlbmVyIGZ1bmN0aW9uIHRvIGJlIHJlbW92ZWQuDQogKi8NCnNoaW5lLkV2ZW50RW1pdHRlci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKG5hbWUsIGNhbGxiYWNrKSB7DQoJZm9yICh2YXIgaSBpbiB0aGlzLl9saXN0ZW5lcnNbbmFtZV0pIHsNCgkJaWYgKHRoaXMuX2xpc3RlbmVyc1tuYW1lXS5oYXNPd25Qcm9wZXJ0eShpKSAmJiB0aGlzLl9saXN0ZW5lcnNbbmFtZV1baV0gPT09IGNhbGxiYWNrKSB0aGlzLl9saXN0ZW5lcnNbbmFtZV0uc3BsaWNlKGksIDEpOw0KCX0NCn0NCg0KDQoNCg0KaWYgKHR5cGVvZiBtb2R1bGUgPT0gJ29iamVjdCcgJiYgbW9kdWxlLmV4cG9ydHMpIG1vZHVsZS5leHBvcnRzLkV2ZW50RW1pdHRlciA9IHNoaW5lLkV2ZW50RW1pdHRlcjsNCg0KLyoqDQogKiBAZmlsZU92ZXJ2aWV3IEVycm9yIGNsYXNzLg0KICogQGF1dGhvciA8YSBocmVmPSJtYWlsdG86cGF1bC5jdXRoYmVydHNvbkBnYW1lc3lzLmNvLnVrIj5QYXVsIEN1dGhiZXJ0c29uPC9hPg0KICovDQoNCg0KLyoqDQogKiBBbiBlcnJvciB0aGF0IG9jY3VycyBpbiB0aGUgTHVhIGNvZGUuDQogKiBAY29uc3RydWN0b3INCiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIEVycm9yIG1lc3NhZ2UuDQogKi8NCnNoaW5lLkVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCgl0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOw0KfTsNCg0KDQpzaGluZS5FcnJvci5wcm90b3R5cGUgPSBPYmplY3RbJ2NyZWF0ZSddPyBPYmplY3RbJ2NyZWF0ZSddKEVycm9yLnByb3RvdHlwZSkgOiBuZXcgRXJyb3IoKTsJLy8gT3ZlcmNvbWVzIENocm9taXVtIGJ1ZzogaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTIyODkwOQ0Kc2hpbmUuRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc2hpbmUuRXJyb3I7DQoNCg0KDQoNCi8qKg0KICogSGFuZGxlcyBlcnJvciByZXBvcnRpbmcgaW4gYSBjb25zaXN0ZW50IG1hbm5lci4NCiAqIEBzdGF0aWMNCiAqIEBwYXJhbSB7RXJyb3J8c2hpbmUuRXJyb3J9IGUgRXJyb3IgdGhhdCB3YXMgdGhvd24uDQogKi8NCnNoaW5lLkVycm9yLmNhdGNoRXhlY3V0aW9uRXJyb3IgPSBmdW5jdGlvbiAoZSkgew0KCWlmICghZSkgcmV0dXJuOw0KDQoJaWYgKChlIHx8IHNoaW5lLkVNUFRZX09CSikgaW5zdGFuY2VvZiBzaGluZS5FcnJvcikgew0KCQlpZiAoIWUubHVhTWVzc2FnZSkgZS5sdWFNZXNzYWdlID0gZS5tZXNzYWdlOw0KCQkvLyBlLm1lc3NhZ2UgPSBlLmx1YU1lc3NhZ2UgKyAnXG4gICAgJyArIChlLmx1YVN0YWNrIHx8IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCkpLmpvaW4oJ1xuICAgICcpOw0KCQllLm1lc3NhZ2UgPSBlLmx1YU1lc3NhZ2UgKyAnXG4gICAgJyArIGUuX3N0YWNrVG9TdHJpbmcoKTsNCgl9DQoNCgl0aHJvdyBlOw0KfTsNCg0KDQoNCg0KLyoqDQogKiBDb2VyY2VzIHRoZSBlcnJvciB0byBhIHN0cmluZyBmb3IgbG9nZ2luZy4NCiAqIEByZXR1cm4ge3N0cmluZ30gU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGVycm9yLg0KICovDQpzaGluZS5FcnJvci5wcm90b3R5cGUuX3N0YWNrVG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7DQoJdmFyIHJlc3VsdCA9IFtdLA0KCQljbG9zdXJlLCBwYywgDQoJCWZ1bmNOYW1lLCBwYXJlbnQsIHVwLA0KCQlmaWxlbmFtZSwgcGF0aCwNCgkJaSwgaiwgbDsNCg0KCXRoaXMubHVhU3RhY2sgPSB0aGlzLmx1YVN0YWNrIHx8IFtdOw0KDQoJZm9yIChpID0gMCwgbCA9IHRoaXMubHVhU3RhY2subGVuZ3RoOyBpIDwgbDsgaSsrKSB7DQoJCWlmICh0aGlzLmx1YVN0YWNrW2kgLSAxXSANCgkJCSYmIHRoaXMubHVhU3RhY2tbaV1bMF0gPT09IHRoaXMubHVhU3RhY2tbaSAtIDFdWzBdIA0KCQkJJiYgdGhpcy5sdWFTdGFja1tpXVsxXSA9PT0gdGhpcy5sdWFTdGFja1tpIC0gMV1bMV0NCgkJKSB7DQoJCQljb250aW51ZTsJLy8gRmlsdGVyIG91dCByZXBlYXRlZCBpdGVtcyAoZHVlIHRvIGxpYi5yZXF1aXJlKS4NCgkJfQ0KDQoNCgkJaWYgKHR5cGVvZiB0aGlzLmx1YVN0YWNrW2ldID09ICdzdHJpbmcnKSB7DQoJCQlyZXN1bHQucHVzaCh0aGlzLmx1YVN0YWNrW2ldKTsNCg0KCQl9IGVsc2Ugew0KCQkJY2xvc3VyZSA9IHRoaXMubHVhU3RhY2tbaV1bMF07DQoJCQlwYyA9IHRoaXMubHVhU3RhY2tbaV1bMV07DQoNCgkJCWlmICghKGZ1bmNOYW1lID0gY2xvc3VyZS5fZGF0YS5zb3VyY2VOYW1lKSkgew0KDQoJCQkJaWYgKHBhcmVudCA9IHRoaXMubHVhU3RhY2tbaSArIDFdICYmIHRoaXMubHVhU3RhY2tbaSArIDFdWzBdKSB7DQoJCQkJCS8vIFNlYXJjaCBsb2NhbHMNCgkJCQkJZm9yIChqIGluIHBhcmVudC5fbG9jYWxGdW5jdGlvbnMpIHsNCgkJCQkJCWlmIChwYXJlbnQuX2xvY2FsRnVuY3Rpb25zW2pdLl9kYXRhID09PSBjbG9zdXJlLl9kYXRhKSB7DQoJCQkJCQkJZnVuY05hbWUgPSBqOw0KCQkJCQkJCWJyZWFrOw0KCQkJCQkJfSANCgkJCQkJfQ0KDQoJCQkJCS8vIFNlYXJjaCB1cHZhbHVlcw0KCQkJCQlpZiAoIWZ1bmNOYW1lKSB7DQoJCQkJCQlmb3IgKGogaW4gcGFyZW50Ll91cHZhbHVlcykgew0KCQkJCQkJCXVwID0gcGFyZW50Ll91cHZhbHVlc1tqXS5nZXRWYWx1ZSgpOw0KDQoJCQkJCQkJaWYgKCh1cCB8fCBzaGluZS5FTVBUWV9PQkopIGluc3RhbmNlb2Ygc2hpbmUuRnVuY3Rpb24gJiYgdXAuX2RhdGEgPT09IGNsb3N1cmUuX2RhdGEpIHsNCgkJCQkJCQkJZnVuY05hbWUgPSBwYXJlbnQuX3VwdmFsdWVzW2pdLm5hbWU7DQoJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCX0gDQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQkvLyBTZWFyY2ggZ2xvYmFscw0KCQkJCWlmICghZnVuY05hbWUpIHsNCgkJCQkJZm9yIChqIGluIGNsb3N1cmUuX2dsb2JhbHMpIHsNCgkJCQkJCWlmICgoY2xvc3VyZS5fZ2xvYmFsc1tqXSB8fCBzaGluZS5FTVBUWV9PQkopIGluc3RhbmNlb2Ygc2hpbmUuRnVuY3Rpb24gJiYgY2xvc3VyZS5fZ2xvYmFsc1tqXS5fZGF0YSA9PT0gY2xvc3VyZS5fZGF0YSkgew0KCQkJCQkJCWZ1bmNOYW1lID0gajsNCgkJCQkJCQlicmVhazsNCgkJCQkJCX0gDQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCg0KCQkJaWYgKGNsb3N1cmUuX2ZpbGUgJiYgY2xvc3VyZS5fZmlsZS51cmwpIHsNCgkJCQlpZiAoZmlsZW5hbWUgPSBjbG9zdXJlLl9maWxlLmRhdGEuc291cmNlUGF0aCkgew0KCQkJCQlmaWxlbmFtZSA9IGNsb3N1cmUuX2ZpbGUudXJsLm1hdGNoKCdeKC4qKVwvLio/JCcpOw0KCQkJCQlmaWxlbmFtZSA9IChmaWxlbmFtZSA9PT0gbnVsbD8gJy4nIDogZmlsZW5hbWVbMV0gfHwgJycpICsgJy8nICsgZmlsZW5hbWU7DQoJCQkJCWZpbGVuYW1lID0gZmlsZW5hbWUucmVwbGFjZSgvXC9cLlwvL2csICcvJykucmVwbGFjZSgvXC8uKj9cL1wuXC5cLy9nLCAnLycpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCWZpbGVuYW1lID0gY2xvc3VyZS5fZmlsZS51cmw7DQoJCQkJfQ0KCQkJfSBlbHNlIHsNCgkJCQlmaWxlbmFtZSA9ICcoY29tcGlsZWQgY29kZSknOw0KCQkJfQ0KDQoJCQlyZXN1bHQucHVzaCAoKGZ1bmNOYW1lIHx8ICdmdW5jdGlvbicpICsgJyBbJyArIChmaWxlbmFtZSB8fCAnZmlsZScpICsgJzonICsgKGNsb3N1cmUuX2RhdGEubGluZVBvc2l0aW9ucz8gY2xvc3VyZS5fZGF0YS5saW5lUG9zaXRpb25zW3BjXSA6ICc/JykgKyAnXScpDQoJCX0NCgl9DQoJDQoJcmV0dXJuIHJlc3VsdC5qb2luKCdcbiAgICAnKTsNCn07DQoNCg0KDQoNCi8qKg0KICogQ29lcmNlcyB0aGUgZXJyb3IgdG8gYSBzdHJpbmcgZm9yIGxvZ2dpbmcuDQogKiBAcmV0dXJuIHtzdHJpbmd9IFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiBlcnJvci4NCiAqLw0Kc2hpbmUuRXJyb3IucHJvdG90eXBlLnRvU3RyaW5nID0gZnVuY3Rpb24gKCkgew0KCXJldHVybiAnTHVhIHJ1bi10aW1lIGVycm9yOiAnICsgdGhpcy5tZXNzYWdlOw0KfTsNCg0KLyoqDQogKiBAZmlsZU92ZXJ2aWV3IENsb3N1cmUgY2xhc3MuDQogKiBAYXV0aG9yIDxhIGhyZWY9Im1haWx0bzpwYXVsLmN1dGhiZXJ0c29uQGdhbWVzeXMuY28udWsiPlBhdWwgQ3V0aGJlcnRzb248L2E+DQogKi8NCg0KDQovKioNCiAqIFJlcHJlc2VudHMgYW4gaW5zdGFuY2Ugb2YgYSBmdW5jdGlvbiBhbmQgaXRzIHJlbGF0ZWQgY2xvc3VyZS4NCiAqIEBjb25zdHJ1Y3Rvcg0KICogQGV4dGVuZHMgc2hpbmUuRXZlbnRFbWl0dGVyDQogKiBAcGFyYW0ge3NoaW5lLkZpbGV9IGZpbGUgVGhlIGZpbGUgaW4gd2hpY2ggdGhlIGZ1bmN0aW9uIGlzIGRlY2xhcmVkLg0KICogQHBhcmFtIHtvYmplY3R9IGRhdGEgT2JqZWN0IGNvbnRhaW5pbmcgdGhlIEx1YWMgZGF0YSBmb3IgdGhlIGZ1bmN0aW9uLg0KICogQHBhcmFtIHtvYmplY3R9IGdsb2JhbHMgVGhlIGdsb2JhbCB2YXJpYWJsZXMgZm9yIHRoZSBlbnZpcm9ubWVudCBpbiB3aGljaCB0aGUgZnVuY3Rpb24gaXMgZGVjbGFyZWQuDQogKiBAcGFyYW0ge29iamVjdH0gW3VwdmFsdWVzXSBUaGUgdXB2YWx1ZXMgcGFzc2VkIGZyb20gdGhlIHBhcmVudCBjbG9zdXJlLg0KICovDQpzaGluZS5DbG9zdXJlID0gZnVuY3Rpb24gKHZtLCBmaWxlLCBkYXRhLCBnbG9iYWxzLCB1cHZhbHVlcykgew0KCXZhciBtZSA9IHRoaXM7DQoJDQoJdGhpcy5fdm0gPSB2bTsNCgl0aGlzLl9nbG9iYWxzID0gZ2xvYmFsczsNCgl0aGlzLl9maWxlID0gZmlsZTsNCgl0aGlzLl9kYXRhID0gZGF0YTsNCg0KCXRoaXMuX3VwdmFsdWVzID0gdXB2YWx1ZXMgfHwgc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgl0aGlzLl9jb25zdGFudHMgPSBkYXRhLmNvbnN0YW50czsNCgl0aGlzLl9mdW5jdGlvbnMgPSBkYXRhLmZ1bmN0aW9uczsNCgl0aGlzLl9pbnN0cnVjdGlvbnMgPSBkYXRhLmluc3RydWN0aW9uczsNCg0KCXRoaXMuX3JlZ2lzdGVyID0gdGhpcy5fcmVnaXN0ZXIgfHwgc2hpbmUuUmVnaXN0ZXIuY3JlYXRlKCk7DQoJdGhpcy5fcGMgPSAwOw0KCXRoaXMuX2xvY2Fsc1VzZWRBc1VwdmFsdWVzID0gdGhpcy5fbG9jYWxzVXNlZEFzVXB2YWx1ZXMgfHwgc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgl0aGlzLl9mdW5jSW5zdGFuY2VzID0gdGhpcy5fZnVuY0luc3RhbmNlcyB8fCBzaGluZS5nYy5jcmVhdGVBcnJheSgpOw0KCXRoaXMuX2xvY2FsRnVuY3Rpb25zID0gc2hpbmUuZ2MuY3JlYXRlT2JqZWN0KCk7DQoJDQoJdmFyIG1lID0gdGhpcywNCgkJcmVzdWx0ID0gZnVuY3Rpb24gKCkgeyANCgkJCXZhciBhcmdzID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgkJCWZvciAodmFyIGkgPSAwLCBsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgYXJncy5wdXNoKGFyZ3VtZW50c1tpXSk7DQoJCQlyZXR1cm4gbWUuZXhlY3V0ZShhcmdzKTsNCgkJfTsNCgkJDQoJcmVzdWx0Ll9pbnN0YW5jZSA9IHRoaXM7DQoNCglyZXN1bHQuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsNCgkJbWUuZGlzcG9zZS5hcHBseShtZSwgYXJndW1lbnRzKTsNCgkJZGVsZXRlIHRoaXMuZGlzcG9zZTsNCgl9Ow0KDQoJcmV0dXJuIHJlc3VsdDsNCn07DQoNCg0Kc2hpbmUuQ2xvc3VyZS5wcm90b3R5cGUgPSB7fTsNCnNoaW5lLkNsb3N1cmUucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gc2hpbmUuQ2xvc3VyZTsNCg0Kc2hpbmUuQ2xvc3VyZS5fZ3JhdmV5YXJkID0gW107DQpzaGluZS5DbG9zdXJlLl9jdXJyZW50ID0gdW5kZWZpbmVkOw0KDQoNCg0KDQpzaGluZS5DbG9zdXJlLmNyZWF0ZSA9IGZ1bmN0aW9uICh2bSwgZmlsZSwgZGF0YSwgZ2xvYmFscywgdXB2YWx1ZXMpIHsNCgl2YXIgaW5zdGFuY2UgPSBzaGluZS5DbG9zdXJlLl9ncmF2ZXlhcmQucG9wKCk7DQoJLy9jb25zb2xlLmxvZyhpbnN0YW5jZT8gJ3JldXNpbmcnIDogJ2NyZWF0aW5nJyk7DQoJDQoJaWYgKGluc3RhbmNlKSB7DQoJCXJldHVybiBzaGluZS5DbG9zdXJlLmFwcGx5KGluc3RhbmNlLCBhcmd1bWVudHMpOw0KCX0gZWxzZSB7DQoJCXJldHVybiBuZXcgc2hpbmUuQ2xvc3VyZSh2bSwgZmlsZSwgZGF0YSwgZ2xvYmFscywgdXB2YWx1ZXMpOw0KCX0NCn07DQoNCg0KDQoNCi8qKg0KICogU3RhcnRzIGV4ZWN1dGlvbiBvZiB0aGUgZnVuY3Rpb24gaW5zdGFuY2UgZnJvbSB0aGUgYmVnaW5uaW5nLg0KICogQHBhcmFtIHtBcnJheX0gYXJncyBBcnJheSBjb250YWluaW5nIGFyZ3VtZW50cyB0byB1c2UuDQogKiBAcmV0dXJucyB7QXJyYXl9IEFycmF5IG9mIHJldHVybiB2YWx1ZXMuDQogKi8NCnNoaW5lLkNsb3N1cmUucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbiAoYXJncykgew0KCXZhciBtZSA9IHRoaXM7DQoNCglpZiAodGhpcy5fdm0uX3N0YXR1cyAhPSBzaGluZS5SVU5OSU5HKSB7DQoJCXRoaXMuX3ZtLl9jYWxsYmFja1F1ZXVlLnB1c2goZnVuY3Rpb24gKCkgew0KCQkJbWUuZXhlY3V0ZS5jYWxsKG1lLCBhcmdzKTsNCgkJfSk7DQoNCgkJcmV0dXJuOwkJDQoJfQ0KDQoNCgl0aGlzLl9wYyA9IDA7DQoNCgkvL2lmICh0aGlzLl9kYXRhICYmIHRoaXMuX2RhdGEuc291cmNlTmFtZSkgc2hpbmUuc3RkZGVidWcud3JpdGUoJ0V4ZWN1dGluZyAnICsgdGhpcy5fZGF0YS5zb3VyY2VOYW1lICsgJy4uLicpOyAvLz8gJyAnICsgdGhpcy5fZGF0YS5zb3VyY2VOYW1lIDogJyBmdW5jdGlvbicpICsgJy4uLjxicj48YnI+Jyk7DQoJLy9zaGluZS5zdGRkZWJ1Zy53cml0ZSgnXG4nKTsNCg0KCS8vIEFTU1VNUFRJT046IFBhcmFtZXRlciB2YWx1ZXMgYXJlIGF1dG9tYXRpY2FsbHkgY29waWVkIHRvIFIoMCkgb253YXJkcyBvZiB0aGUgZnVuY3Rpb24gb24gaW5pdGlhbGlzYXRpb24uIFRoaXMgaXMgYmFzZWQgb24gb2JzZXJ2YXRpb24gYW5kIGlzIG5laXRoZXIgY29uZmlybWVkIG5vciBkZW5pZWQgaW4gYW55IGRvY3VtZW50YXRpb24uIChEaWZmZXJlbnQgcnVsZXMgYXBwbHkgdG8gdjUuMC1zdHlsZSBWQVJBUkcgZnVuY3Rpb25zKQ0KCXRoaXMuX3BhcmFtcyA9IHNoaW5lLmdjLmNyZWF0ZUFycmF5KCkuY29uY2F0KGFyZ3MpOw0KCXRoaXMuX3JlZ2lzdGVyLnNldChhcmdzLnNwbGljZSgwLCB0aGlzLl9kYXRhLnBhcmFtQ291bnQpKTsNCg0KCWlmICh0aGlzLl9kYXRhLmlzX3ZhcmFyZyA9PSA3KSB7CS8vIHY1LjAgY29tcGF0aWJpbGl0eSAoTFVBX0NPTVBBVF9WQVJBUkcpDQoJCXZhciBhcmcgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpLmNvbmNhdChhcmdzKSwNCgkJCWxlbmd0aCA9IGFyZy5sZW5ndGg7DQoJCQkJCQ0KCQlhcmcgPSBuZXcgc2hpbmUuVGFibGUoYXJnKTsNCgkJYXJnLnNldE1lbWJlcignbicsIGxlbmd0aCk7DQoJCQ0KCQl0aGlzLl9yZWdpc3Rlci5wdXNoKGFyZyk7DQoJfQ0KCQ0KCXRyeSB7DQoJCXJldHVybiB0aGlzLl9ydW4oKTsNCg0KCX0gY2F0Y2ggKGUpIHsNCgkJaWYgKCEoKGUgfHwgc2hpbmUuRU1QVFlfT0JKKSBpbnN0YW5jZW9mIHNoaW5lLkVycm9yKSkgew0KCQkJdmFyIHN0YWNrID0gKGUuc3RhY2sgfHwgJycpOw0KDQoJCQllID0gbmV3IHNoaW5lLkVycm9yKCdFcnJvciBpbiBob3N0IGNhbGw6ICcgKyBlLm1lc3NhZ2UpOw0KCQkJZS5zdGFjayA9IHN0YWNrOw0KCQkJZS5sdWFTdGFjayA9IHN0YWNrLnNwbGl0KCdcbicpOw0KCQl9DQoNCgkJaWYgKCFlLmx1YVN0YWNrKSBlLmx1YVN0YWNrID0gc2hpbmUuZ2MuY3JlYXRlQXJyYXkoKTsNCgkJZS5sdWFTdGFjay5wdXNoKFt0aGlzLCB0aGlzLl9wYyAtIDFdKTsNCgkNCgkJdGhyb3cgZTsNCgl9DQp9Ow0KDQoNCg0KDQovKioNCiAqIENvbnRpbnVlcyBleGVjdXRpb24gb2YgdGhlIGZ1bmN0aW9uIGluc3RhbmNlIGZyb20gaXRzIGN1cnJlbnQgcG9zaXRpb24uDQogKiBAcmV0dXJucyB7QXJyYXl9IEFycmF5IG9mIHJldHVybiB2YWx1ZXMuDQogKi8NCnNoaW5lLkNsb3N1cmUucHJvdG90eXBlLl9ydW4gPSBmdW5jdGlvbiAoKSB7DQoJdmFyIGluc3RydWN0aW9uLA0KCQlsaW5lLA0KCQlyZXR2YWwsDQoJCXlpZWxkVmFycywNCgkJcnVubmluZzsNCg0KCXRoaXMudGVybWluYXRlZCA9IGZhbHNlOw0KCQ0KCQ0KCWlmICh0aGlzLl92bS5fc3RhdHVzID09IHNoaW5lLlJFU1VNSU5HKSB7DQoJIAlpZiAodGhpcy5fdm0uX3Jlc3VtZVN0YWNrLmxlbmd0aCkgew0KCQkJdGhpcy5fcGMtLTsNCgkJCQ0KCQl9IGVsc2Ugew0KCQkJdGhpcy5fdm0uX3N0YXR1cyA9IHNoaW5lLlJVTk5JTkc7DQoNCgkJCXlpZWxkVmFycyA9IHRoaXMuX3ZtLl9yZXN1bWVWYXJzOw0KCQkJZGVsZXRlIHRoaXMuX3ZtLl9yZXN1bWVWYXJzOw0KCQl9DQoNCgl9IGVsc2UgaWYgKHNoaW5lLmRlYnVnICYmIHNoaW5lLmRlYnVnLl9zdGF0dXMgPT0gc2hpbmUuUkVTVU1JTkcpIHsNCgkgCWlmIChzaGluZS5kZWJ1Zy5fcmVzdW1lU3RhY2subGVuZ3RoKSB7DQoJCQl0aGlzLl9wYy0tOw0KCQkJDQoJCX0gZWxzZSB7DQoJCQlzaGluZS5kZWJ1Zy5fc2V0U3RhdHVzKHNoaW5lLlJVTk5JTkcpOw0KCQl9DQoNCgl9IGVsc2UgaWYgKChydW5uaW5nID0gdGhpcy5fdm0uX2Nvcm91dGluZVJ1bm5pbmcpICYmIHJ1bm5pbmcuc3RhdHVzID09IHNoaW5lLlJFU1VNSU5HKSB7DQoJIAlpZiAocnVubmluZy5fcmVzdW1lU3RhY2subGVuZ3RoKSB7DQoJCQl0aGlzLl9wYy0tOw0KCQkJDQoJCX0gZWxzZSB7DQoJCQlydW5uaW5nLnN0YXR1cyA9IHNoaW5lLlJVTk5JTkc7DQoJCQkvL3NoaW5lLnN0ZGRlYnVnLndyaXRlKCdbY29yb3V0aW5lIHJlc3VtZWRdXG4nKTsNCgkNCgkJCXlpZWxkVmFycyA9IHJ1bm5pbmcuX3lpZWxkVmFyczsNCgkJfQ0KCX0JDQoJDQoNCglpZiAoeWllbGRWYXJzKSB7DQoJCS8vIGluc3RydWN0aW9uID0gdGhpcy5faW5zdHJ1Y3Rpb25zW3RoaXMuX3BjIC0gMV07DQoNCgkJdmFyIG9mZnNldCA9ICh0aGlzLl9wYyAtIDEpICogNCwNCgkJCWEgPSB0aGlzLl9pbnN0cnVjdGlvbnNbb2Zmc2V0ICsgMV0sDQoJCQliID0gdGhpcy5faW5zdHJ1Y3Rpb25zW29mZnNldCArIDJdLA0KCQkJYyA9IHRoaXMuX2luc3RydWN0aW9uc1tvZmZzZXQgKyAzXSwNCgkJCXJldHZhbHMgPSBzaGluZS5nYy5jcmVhdGVBcnJheSgpOw0KDQoJCWZvciAodmFyIGkgPSAwLCBsID0geWllbGRWYXJzLmxlbmd0aDsgaSA8IGw7IGkrKykgcmV0dmFscy5wdXNoKHlpZWxkVmFyc1tpXSk7DQoNCgkJaWYgKGMgPT09IDApIHsNCgkJCWwgPSByZXR2YWxzLmxlbmd0aDsNCgkJDQoJCQlmb3IgKGkgPSAwOyBpIDwgbDsgaSsrKSB7DQoJCQkJdGhpcy5fcmVnaXN0ZXIuc2V0SXRlbShhICsgaSwgcmV0dmFsc1tpXSk7DQoJCQl9DQoNCgkJCXRoaXMuX3JlZ2lzdGVyLnNwbGljZShhICsgbCk7DQoJCQ0KCQl9IGVsc2Ugew0KCQkJZm9yIChpID0gMDsgaSA8IGMgLSAxOyBpKyspIHsNCgkJCQl0aGlzLl9yZWdpc3Rlci5zZXRJdGVtKGEgKyBpLCByZXR2YWxzW2ldKTsNCgkJCX0NCgkJfQ0KDQoJCXNoaW5lLmdjLmNvbGxlY3QocmV0dmFscyk7DQoJfQ0KDQoNCgl3aGlsZSAodGhpcy5faW5zdHJ1Y3Rpb25zW3RoaXMuX3BjICogNF0gIT09IHVuZGVmaW5lZCkgew0KCQlsaW5lID0gdGhpcy5fZGF0YS5saW5lUG9zaXRpb25zICYmIHRoaXMuX2RhdGEubGluZVBvc2l0aW9uc1t0aGlzLl9wY107DQoJCXJldHZhbCA9IHRoaXMuX2V4ZWN1dGVJbnN0cnVjdGlvbih0aGlzLl9wYysrLCBsaW5lKTsNCg0KCQlpZiAoKHJ1bm5pbmcgPSB0aGlzLl92bS5fY29yb3V0aW5lUnVubmluZykgJiYgcnVubmluZy5zdGF0dXMgPT0gc2hpbmUuU1VTUEVORElORykgew0KCQkJcnVubmluZy5fcmVzdW1lU3RhY2sucHVzaCh0aGlzKTsNCg0KCQkJaWYgKHJ1bm5pbmcuX2Z1bmMuX2luc3RhbmNlID09IHRoaXMpIHsNCgkJCQlyZXR2YWwgPSBydW5uaW5nLl95aWVsZFZhcnM7DQoNCgkJCQlydW5uaW5nLnN0YXR1cyA9IHNoaW5lLlNVU1BFTkRFRDsNCgkJCQlzaGluZS5Db3JvdXRpbmUuX3JlbW92ZSgpOw0KDQoJCQkJLy9zaGluZS5zdGRkZWJ1Zy53cml0ZSgnW2Nvcm91dGluZSBzdXNwZW5kZWRdXG4nKTsNCgkJCQkNCgkJCQlyZXR1cm4gcmV0dmFsOw0KCQkJfQ0KCQkJDQoJCQlyZXR1cm47DQoJCX0NCg0KCQlpZiAodGhpcy5fdm0uX3N0YXR1cyA9PSBzaGluZS5TVVNQRU5ESU5HICYmICFyZXR2YWwpIHsNCgkJCXRoaXMuX3ZtLl9yZXN1bWVTdGFjay5wdXNoKHRoaXMpOw0KCQkJcmV0dXJuOw0KCQl9DQoJCQ0KCQlpZiAoc2hpbmUuZGVidWcgJiYgc2hpbmUuZGVidWcuX3N0YXR1cyA9PSBzaGluZS5TVVNQRU5ESU5HICYmICFyZXR2YWwpIHsNCgkJCXNoaW5lLmRlYnVnLl9yZXN1bWVTdGFjay5wdXNoKHRoaXMpOw0KCQkJcmV0dXJuOw0KCQl9DQoJCQ0KCQkNCgkJaWYgKHJldHZhbCAhPT0gdW5kZWZpbmVkKSB7DQoJCQl0aGlzLnRlcm1pbmF0ZWQgPSB0cnVlOw0KCQkJdGhpcy5kaXNwb3NlKCk7DQoJCQkNCgkJCXJldHVybiByZXR2YWw7DQoJCX0NCgl9DQoJDQoJdGhpcy50ZXJtaW5hdGVkID0gdHJ1ZTsNCgl0aGlzLmRpc3Bvc2UoKTsNCn07DQoNCg0KDQoNCi8qKg0KICogRXhlY3V0ZXMgYSBzaW5nbGUgaW5zdHJ1Y3Rpb24uDQogKiBAcGFyYW0ge29iamVjdH0gaW5zdHJ1Y3Rpb24gSW5mb3JtYXRpb24gYWJvdXQgdGhlIGluc3RydWN0aW9uLg0KICogQHBhcmFtIHtudW1iZXJ9IGxpbmUgVGhlIGxpbmUgbnVtYmVyIG9uIHdoaWNoIHRvIGZpbmQgdGhlIGluc3RydWN0aW9uIChmb3IgZGVidWdnaW5nKS4NCiAqIEByZXR1cm5zIHtBcnJheX0gQXJyYXkgb2YgdGhlIHZhbHVlcyB0aGF0IG1ha2UgYmUgcmV0dXJuZWQgZnJvbSBleGVjdXRpbmcgdGhlIGluc3RydWN0aW9uLg0KICovDQpzaGluZS5DbG9zdXJlLnByb3RvdHlwZS5fZXhlY3V0ZUluc3RydWN0aW9uID0gZnVuY3Rpb24gKHBjLCBsaW5lKSB7DQoJdGhpcy5jb25zdHJ1Y3Rvci5fY3VycmVudCA9IHRoaXM7DQoNCgl2YXIgb2Zmc2V0ID0gcGMgKiA0LA0KCQlvcGNvZGUgPSB0aGlzLl9pbnN0cnVjdGlvbnNbb2Zmc2V0XSwNCgkJb3AgPSBzaGluZS5vcGVyYXRpb25zLkhBTkRMRVJTW29wY29kZV0sDQoJCUEgPSB0aGlzLl9pbnN0cnVjdGlvbnNbb2Zmc2V0ICsgMV0sDQoJCUIgPSB0aGlzLl9pbnN0cnVjdGlvbnNbb2Zmc2V0ICsgMl0sDQoJCUMgPSB0aGlzLl9pbnN0cnVjdGlvbnNbb2Zmc2V0ICsgM107DQoNCgkvLyBpZiAoIW9wKSB0aHJvdyBuZXcgRXJyb3IoJ09wZXJhdGlvbiBub3QgaW1wbGVtZW50ZWQhICgnICsgb3Bjb2RlICsgJyknKTsNCglyZXR1cm4gb3AuY2FsbCh0aGlzLCBBLCBCLCBDKTsNCn07DQoJDQoNCg0KDQovKioNCiAqIFJldHVybnMgdGhlIHZhbHVlIG9mIHRoZSBjb25zdGFudCByZWdpc3RlcmVkIGF0IGEgZ2l2ZW4gaW5kZXguDQogKiBAcGFyYW0ge251bWJlcn0gaW5kZXggQXJyYXkgY29udGFpbmluZyBhcmd1bWVudHMgdG8gdXNlLg0KICogQHJldHVybnMge29iamVjdH0gVmFsdWUgb2YgdGhlIGNvbnN0YW50Lg0KICovDQpzaGluZS5DbG9zdXJlLnByb3RvdHlwZS5nZXRDb25zdGFudCA9IGZ1bmN0aW9uIChpbmRleCkgew0KCWlmICh0aGlzLl9jb25zdGFudHNbaW5kZXhdID09PSBudWxsKSByZXR1cm47DQoJcmV0dXJuIHRoaXMuX2NvbnN0YW50c1tpbmRleF07DQp9Ow0KDQoJDQoNCg0KLyoqDQogKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBjbG9zdXJlIGhhcyByZXRhaW5lZCBjaGlsZCBzY29wZXMuDQogKiBAcmV0dXJucyB7Ym9vbGVhbn0gSGFzIHJldGFpbmVkIGNoaWxkIHNjb3Blcy4NCiAqLw0Kc2hpbmUuQ2xvc3VyZS5wcm90b3R5cGUuaGFzUmV0YWluZWRTY29wZSA9IGZ1bmN0aW9uICgpIHsNCg0KCWlmICh0aGlzLl9sb2NhbHNVc2VkQXNVcHZhbHVlcy5sZW5ndGgpIHJldHVybiB0cnVlOw0KCWlmICh0aGlzLl91cHZhbHVlcy5sZW5ndGgpIHJldHVybiB0cnVlOw0KDQoJLy8gZm9yICh2YXIgaSBpbiB0aGlzLl91cHZhbHVlcykgew0KCS8vIAlpZiAodGhpcy5fZnVuY0luc3RhbmNlcy5oYXNPd25Qcm9wZXJ0eShpKSAmJiB0aGlzLl91cHZhbHVlc1tpXS5vcGVuKSByZXR1cm4gdHJ1ZTsNCgkvLyB9DQoNCglmb3IgKHZhciBpIGluIHRoaXMuX2Z1bmNJbnN0YW5jZXMpIHsNCgkJaWYgKHRoaXMuX2Z1bmNJbnN0YW5jZXMuaGFzT3duUHJvcGVydHkoaSkgJiYgdGhpcy5fZnVuY0luc3RhbmNlc1tpXS5pc1JldGFpbmVkKCkpIHJldHVybiB0cnVlOw0KCX0NCg0KCXJldHVybiBmYWxzZTsNCn07DQoNCg0KDQoNCi8qKg0KICogRHVtcCBtZW1vcnkgYXNzb2NpdGF0ZWQgd2l0aCBjbG9zdXJlLg0KICovDQpzaGluZS5DbG9zdXJlLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKGZvcmNlKSB7DQoNCglpZiAoZm9yY2UgfHwgIXRoaXMuaGFzUmV0YWluZWRTY29wZSgpKSB7DQoJCWRlbGV0ZSB0aGlzLl92bTsNCgkJZGVsZXRlIHRoaXMuX2dsb2JhbHM7DQoJCWRlbGV0ZSB0aGlzLl9maWxlOw0KCQlkZWxldGUgdGhpcy5fZGF0YTsNCgkNCgkJZGVsZXRlIHRoaXMuX2Z1bmN0aW9uczsNCgkJZGVsZXRlIHRoaXMuX2luc3RydWN0aW9uczsNCgkNCgkJZGVsZXRlIHRoaXMuX3BjOw0KCQkvLyBkZWxldGUgdGhpcy5fZnVuY0luc3RhbmNlczsNCgkNCgkJc2hpbmUuZ2MuY29sbGVjdCh0aGlzLl9wYXJhbXMpOw0KCQlzaGluZS5nYy5jb2xsZWN0KHRoaXMuX2xvY2FsRnVuY3Rpb25zKTsNCg0KCQlkZWxldGUgdGhpcy5fcGFyYW1zOw0KCQ0KCQlkZWxldGUgdGhpcy5fY29uc3RhbnRzOw0KDQovLwkJZGVsZXRlIHRoaXMuX2xvY2Fsc1VzZWRBc1VwdmFsdWVzOw0KCQlkZWxldGUgdGhpcy5fdXB2YWx1ZXM7DQoNCgkJdGhpcy5fcmVnaXN0ZXIucmVzZXQoKTsNCgkJdGhpcy5fZnVuY0luc3RhbmNlcy5sZW5ndGggPSAwOw0KCQl0aGlzLl9sb2NhbHNVc2VkQXNVcHZhbHVlcy5sZW5ndGggPSAwOw0KDQoJCXNoaW5lLkNsb3N1cmUuX2dyYXZleWFyZC5wdXNoKHRoaXMpOw0KCX0NCgkNCn07DQoNCg"}];
haxe.crypto.Base64.CHARS = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
haxe.crypto.Base64.BYTES = haxe.io.Bytes.ofString(haxe.crypto.Base64.CHARS);
})();
